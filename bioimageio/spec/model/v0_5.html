<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>bioimageio.spec.model.v0_5 API documentation</title>
            <link rel="icon" href="https://bioimage.io/static/img/bioimage-io-icon-small.svg"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../model.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;bioimageio.spec.model</a>

<a href="https://bioimage.io/">            <img src="https://bioimage.io/static/img/bioimage-io-logo.svg" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#SpaceUnit">SpaceUnit</a>
            </li>
            <li>
                    <a class="variable" href="#TimeUnit">TimeUnit</a>
            </li>
            <li>
                    <a class="variable" href="#AxisType">AxisType</a>
            </li>
            <li>
                    <a class="class" href="#TensorId">TensorId</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TensorId.root_model">root_model</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AxisId">AxisId</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#AxisId.root_model">root_model</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#NonBatchAxisId">NonBatchAxisId</a>
            </li>
            <li>
                    <a class="variable" href="#PreprocessingId">PreprocessingId</a>
            </li>
            <li>
                    <a class="variable" href="#PostprocessingId">PostprocessingId</a>
            </li>
            <li>
                    <a class="variable" href="#SAME_AS_TYPE">SAME_AS_TYPE</a>
            </li>
            <li>
                    <a class="variable" href="#ParameterizedSize_N">ParameterizedSize_N</a>
            </li>
            <li>
                    <a class="class" href="#ParameterizedSize">ParameterizedSize</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ParameterizedSize.N">N</a>
                        </li>
                        <li>
                                <a class="variable" href="#ParameterizedSize.min">min</a>
                        </li>
                        <li>
                                <a class="variable" href="#ParameterizedSize.step">step</a>
                        </li>
                        <li>
                                <a class="function" href="#ParameterizedSize.validate_size">validate_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ParameterizedSize.get_size">get_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ParameterizedSize.get_n">get_n</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DataDependentSize">DataDependentSize</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DataDependentSize.min">min</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataDependentSize.max">max</a>
                        </li>
                        <li>
                                <a class="function" href="#DataDependentSize.validate_size">validate_size</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SizeReference">SizeReference</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SizeReference.tensor_id">tensor_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SizeReference.axis_id">axis_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SizeReference.offset">offset</a>
                        </li>
                        <li>
                                <a class="function" href="#SizeReference.get_size">get_size</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AxisBase">AxisBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#AxisBase.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AxisBase.description">description</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#WithHalo">WithHalo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#WithHalo.halo">halo</a>
                        </li>
                        <li>
                                <a class="variable" href="#WithHalo.size">size</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#BATCH_AXIS_ID">BATCH_AXIS_ID</a>
            </li>
            <li>
                    <a class="class" href="#BatchAxis">BatchAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BatchAxis.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.size">size</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.concatenable">concatenable</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#BatchAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChannelAxis">ChannelAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ChannelAxis.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.channel_names">channel_names</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.size">size</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.concatenable">concatenable</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChannelAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IndexAxisBase">IndexAxisBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#IndexAxisBase.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexAxisBase.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexAxisBase.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexAxisBase.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexAxisBase.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IndexInputAxis">IndexInputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#IndexInputAxis.concatenable">concatenable</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexInputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IndexOutputAxis">IndexOutputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#IndexOutputAxis.size">size</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexOutputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeAxisBase">TimeAxisBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeAxisBase.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeAxisBase.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeAxisBase.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeAxisBase.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeAxisBase.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeInputAxis">TimeInputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeInputAxis.concatenable">concatenable</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeInputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SpaceAxisBase">SpaceAxisBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SpaceAxisBase.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#SpaceAxisBase.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SpaceAxisBase.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#SpaceAxisBase.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#SpaceAxisBase.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SpaceInputAxis">SpaceInputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SpaceInputAxis.concatenable">concatenable</a>
                        </li>
                        <li>
                                <a class="variable" href="#SpaceInputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#INPUT_AXIS_TYPES">INPUT_AXIS_TYPES</a>
            </li>
            <li>
                    <a class="variable" href="#InputAxis">InputAxis</a>
            </li>
            <li>
                    <a class="class" href="#TimeOutputAxis">TimeOutputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeOutputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeOutputAxisWithHalo.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SpaceOutputAxis">SpaceOutputAxis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SpaceOutputAxis.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SpaceOutputAxisWithHalo.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#OutputAxis">OutputAxis</a>
            </li>
            <li>
                    <a class="variable" href="#OUTPUT_AXIS_TYPES">OUTPUT_AXIS_TYPES</a>
            </li>
            <li>
                    <a class="variable" href="#AnyAxis">AnyAxis</a>
            </li>
            <li>
                    <a class="variable" href="#ANY_AXIS_TYPES">ANY_AXIS_TYPES</a>
            </li>
            <li>
                    <a class="variable" href="#TVs">TVs</a>
            </li>
            <li>
                    <a class="variable" href="#NominalOrOrdinalDType">NominalOrOrdinalDType</a>
            </li>
            <li>
                    <a class="class" href="#NominalOrOrdinalDataDescr">NominalOrOrdinalDataDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#NominalOrOrdinalDataDescr.values">values</a>
                        </li>
                        <li>
                                <a class="variable" href="#NominalOrOrdinalDataDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#NominalOrOrdinalDataDescr.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#NominalOrOrdinalDataDescr.range">range</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#IntervalOrRatioDType">IntervalOrRatioDType</a>
            </li>
            <li>
                    <a class="class" href="#IntervalOrRatioDataDescr">IntervalOrRatioDataDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#IntervalOrRatioDataDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#IntervalOrRatioDataDescr.range">range</a>
                        </li>
                        <li>
                                <a class="variable" href="#IntervalOrRatioDataDescr.unit">unit</a>
                        </li>
                        <li>
                                <a class="variable" href="#IntervalOrRatioDataDescr.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#IntervalOrRatioDataDescr.offset">offset</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#TensorDataDescr">TensorDataDescr</a>
            </li>
            <li>
                    <a class="class" href="#ProcessingDescrBase">ProcessingDescrBase</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#BinarizeKwargs">BinarizeKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BinarizeKwargs.threshold">threshold</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BinarizeAlongAxisKwargs">BinarizeAlongAxisKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BinarizeAlongAxisKwargs.threshold">threshold</a>
                        </li>
                        <li>
                                <a class="variable" href="#BinarizeAlongAxisKwargs.axis">axis</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BinarizeDescr">BinarizeDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BinarizeDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#BinarizeDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#BinarizeDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ClipDescr">ClipDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ClipDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ClipDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ClipDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EnsureDtypeKwargs">EnsureDtypeKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#EnsureDtypeKwargs.dtype">dtype</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EnsureDtypeDescr">EnsureDtypeDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#EnsureDtypeDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#EnsureDtypeDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#EnsureDtypeDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleLinearKwargs">ScaleLinearKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleLinearKwargs.gain">gain</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleLinearKwargs.offset">offset</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleLinearAlongAxisKwargs">ScaleLinearAlongAxisKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleLinearAlongAxisKwargs.axis">axis</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleLinearAlongAxisKwargs.gain">gain</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleLinearAlongAxisKwargs.offset">offset</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleLinearDescr">ScaleLinearDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleLinearDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleLinearDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleLinearDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SigmoidDescr">SigmoidDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SigmoidDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SigmoidDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#SigmoidDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SoftmaxKwargs">SoftmaxKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SoftmaxKwargs.axis">axis</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SoftmaxDescr">SoftmaxDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SoftmaxDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SoftmaxDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#SoftmaxDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FixedZeroMeanUnitVarianceKwargs">FixedZeroMeanUnitVarianceKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceKwargs.mean">mean</a>
                        </li>
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceKwargs.std">std</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs">FixedZeroMeanUnitVarianceAlongAxisKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.mean">mean</a>
                        </li>
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.std">std</a>
                        </li>
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.axis">axis</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#FixedZeroMeanUnitVarianceDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ZeroMeanUnitVarianceKwargs">ZeroMeanUnitVarianceKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ZeroMeanUnitVarianceKwargs.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZeroMeanUnitVarianceKwargs.eps">eps</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ZeroMeanUnitVarianceDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZeroMeanUnitVarianceDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZeroMeanUnitVarianceDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleRangeKwargs">ScaleRangeKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleRangeKwargs.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeKwargs.min_percentile">min_percentile</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeKwargs.max_percentile">max_percentile</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeKwargs.eps">eps</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeKwargs.reference_tensor">reference_tensor</a>
                        </li>
                        <li>
                                <a class="function" href="#ScaleRangeKwargs.min_smaller_max">min_smaller_max</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleRangeDescr">ScaleRangeDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleRangeDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleRangeDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleMeanVarianceKwargs">ScaleMeanVarianceKwargs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceKwargs.reference_tensor">reference_tensor</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceKwargs.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceKwargs.eps">eps</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleMeanVarianceDescr">ScaleMeanVarianceDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceDescr.implemented_id">implemented_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceDescr.kwargs">kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleMeanVarianceDescr.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#PreprocessingDescr">PreprocessingDescr</a>
            </li>
            <li>
                    <a class="variable" href="#PostprocessingDescr">PostprocessingDescr</a>
            </li>
            <li>
                    <a class="class" href="#TensorDescrBase">TensorDescrBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TensorDescrBase.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.description">description</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.axes">axes</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.shape">shape</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.test_tensor">test_tensor</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.sample_tensor">sample_tensor</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.data">data</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorDescrBase.dtype">dtype</a>
                        </li>
                        <li>
                                <a class="function" href="#TensorDescrBase.get_axis_sizes_for_array">get_axis_sizes_for_array</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#InputTensorDescr">InputTensorDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#InputTensorDescr.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#InputTensorDescr.optional">optional</a>
                        </li>
                        <li>
                                <a class="variable" href="#InputTensorDescr.preprocessing">preprocessing</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#convert_axes">convert_axes</a>
            </li>
            <li>
                    <a class="class" href="#OutputTensorDescr">OutputTensorDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#OutputTensorDescr.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#OutputTensorDescr.postprocessing">postprocessing</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#TensorDescr">TensorDescr</a>
            </li>
            <li>
                    <a class="function" href="#validate_tensors">validate_tensors</a>
            </li>
            <li>
                    <a class="variable" href="#FileDescr_dependencies">FileDescr_dependencies</a>
            </li>
            <li>
                    <a class="class" href="#ArchitectureFromFileDescr">ArchitectureFromFileDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ArchitectureFromFileDescr.source">source</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ArchitectureFromLibraryDescr">ArchitectureFromLibraryDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ArchitectureFromLibraryDescr.import_from">import_from</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.source">source</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.authors">authors</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.parent">parent</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsEntryDescrBase.comment">comment</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KerasHdf5WeightsDescr">KerasHdf5WeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#KerasHdf5WeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerasHdf5WeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerasHdf5WeightsDescr.tensorflow_version">tensorflow_version</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#FileDescr_external_data">FileDescr_external_data</a>
            </li>
            <li>
                    <a class="class" href="#OnnxWeightsDescr">OnnxWeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#OnnxWeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#OnnxWeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#OnnxWeightsDescr.opset_version">opset_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#OnnxWeightsDescr.external_data">external_data</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PytorchStateDictWeightsDescr">PytorchStateDictWeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#PytorchStateDictWeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchStateDictWeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchStateDictWeightsDescr.architecture">architecture</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchStateDictWeightsDescr.pytorch_version">pytorch_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#PytorchStateDictWeightsDescr.dependencies">dependencies</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TensorflowJsWeightsDescr">TensorflowJsWeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TensorflowJsWeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowJsWeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowJsWeightsDescr.tensorflow_version">tensorflow_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowJsWeightsDescr.source">source</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TensorflowSavedModelBundleWeightsDescr">TensorflowSavedModelBundleWeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TensorflowSavedModelBundleWeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowSavedModelBundleWeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowSavedModelBundleWeightsDescr.tensorflow_version">tensorflow_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowSavedModelBundleWeightsDescr.dependencies">dependencies</a>
                        </li>
                        <li>
                                <a class="variable" href="#TensorflowSavedModelBundleWeightsDescr.source">source</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TorchscriptWeightsDescr">TorchscriptWeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TorchscriptWeightsDescr.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#TorchscriptWeightsDescr.weights_format_name">weights_format_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#TorchscriptWeightsDescr.pytorch_version">pytorch_version</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#WeightsDescr">WeightsDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#WeightsDescr.keras_hdf5">keras_hdf5</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.onnx">onnx</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.pytorch_state_dict">pytorch_state_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.tensorflow_js">tensorflow_js</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.tensorflow_saved_model_bundle">tensorflow_saved_model_bundle</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.torchscript">torchscript</a>
                        </li>
                        <li>
                                <a class="function" href="#WeightsDescr.check_entries">check_entries</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.available_formats">available_formats</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeightsDescr.missing_formats">missing_formats</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ModelId">ModelId</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#LinkedModel">LinkedModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#LinkedModel.id">id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ReproducibilityTolerance">ReproducibilityTolerance</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ReproducibilityTolerance.relative_tolerance">relative_tolerance</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReproducibilityTolerance.absolute_tolerance">absolute_tolerance</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReproducibilityTolerance.mismatched_elements_per_million">mismatched_elements_per_million</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReproducibilityTolerance.output_ids">output_ids</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReproducibilityTolerance.weights_formats">weights_formats</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#BioimageioConfig">BioimageioConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#BioimageioConfig.reproducibility_tolerance">reproducibility_tolerance</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Config">Config</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Config.bioimageio">bioimageio</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ModelDescr">ModelDescr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ModelDescr.implemented_format_version">implemented_format_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.implemented_type">implemented_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.authors">authors</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.documentation">documentation</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.inputs">inputs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.outputs">outputs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.packaged_by">packaged_by</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.parent">parent</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.run_mode">run_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.timestamp">timestamp</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.training_data">training_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.weights">weights</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.config">config</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_input_test_arrays">get_input_test_arrays</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_output_test_arrays">get_output_test_arrays</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_batch_size">get_batch_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_output_tensor_sizes">get_output_tensor_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_ns">get_ns</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_tensor_sizes">get_tensor_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.get_axis_sizes">get_axis_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelDescr.convert_from_old_format_wo_validation">convert_from_old_format_wo_validation</a>
                        </li>
                        <li>
                                <a class="variable" href="#ModelDescr.implemented_format_version_tuple">implemented_format_version_tuple</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#generate_covers">generate_covers</a>
            </li>
            <li>
                    <a class="class" href="#TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]]">TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]]</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]]">TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]]</a>
                            <ul class="memberlist">
                </ul>

            </li>
    </ul>


            <footer>bioimageio.core 0.9.5</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
bioimageio<wbr>.<a href="./../../spec.html">spec</a><wbr>.<a href="./../model.html">model</a><wbr>.v0_5    </h1>

                
                        <input id="mod-v0_5-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-v0_5-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">collections.abc</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">ceil</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePosixPath</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tempfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">mkdtemp</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>    <span class="n">Any</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>    <span class="n">Callable</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>    <span class="n">ClassVar</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>    <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>    <span class="n">Generic</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="n">List</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>    <span class="n">Literal</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>    <span class="n">Mapping</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>    <span class="n">NamedTuple</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>    <span class="n">Optional</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="n">Sequence</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="n">Set</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">Tuple</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="n">Type</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>    <span class="n">TypeVar</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>    <span class="n">Union</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>    <span class="n">cast</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="p">)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">annotated_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ge</span><span class="p">,</span> <span class="n">Gt</span><span class="p">,</span> <span class="n">Interval</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">,</span> <span class="n">MinLen</span><span class="p">,</span> <span class="n">Predicate</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">imageio.v3</span><span class="w"> </span><span class="kn">import</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imwrite</span>  <span class="c1"># pyright: ignore[reportUnknownVariableType]</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>    <span class="n">AfterValidator</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>    <span class="n">Discriminator</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="n">Field</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="n">RootModel</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="n">SerializationInfo</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="n">SerializerFunctionWrapHandler</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="n">StrictInt</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="n">Tag</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>    <span class="n">ValidationInfo</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>    <span class="n">WrapSerializer</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="n">field_validator</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="n">model_serializer</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">model_validator</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="p">)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Self</span><span class="p">,</span> <span class="n">assert_never</span><span class="p">,</span> <span class="n">get_args</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.common_nodes</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">InvalidDescr</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="n">Node</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">NodeWithExplicitlySetFields</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">DTYPE_LIMITS</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.field_warning</span><span class="w"> </span><span class="kn">import</span> <span class="n">issue_warning</span><span class="p">,</span> <span class="n">warn</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BioimageioYamlContent</span> <span class="k">as</span> <span class="n">BioimageioYamlContent</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileDescr</span> <span class="k">as</span> <span class="n">FileDescr</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="n">FileSource</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="n">WithSuffix</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>    <span class="n">YamlValue</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>    <span class="n">extract_file_name</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="n">get_reader</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>    <span class="n">wo_special_file_name</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io_basics</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sha256</span> <span class="k">as</span> <span class="n">Sha256</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io_packaging</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="n">FileDescr_</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">FileSource_</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="n">package_file_descr_serializer</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.io_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_array</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.node_converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Converter</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.type_guards</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_dict</span><span class="p">,</span> <span class="n">is_sequence</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="n">FAIR</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="n">AbsoluteTolerance</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">LowerCaseIdentifier</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">LowerCaseIdentifierAnno</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="n">MismatchedElementsPerMillion</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="n">RelativeTolerance</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datetime</span> <span class="k">as</span> <span class="n">Datetime</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Identifier</span> <span class="k">as</span> <span class="n">Identifier</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotEmpty</span> <span class="k">as</span> <span class="n">NotEmpty</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">SiUnit</span> <span class="k">as</span> <span class="n">SiUnit</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.url</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpUrl</span> <span class="k">as</span> <span class="n">HttpUrl</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.validation_context</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_validation_context</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.validator_annotations</span><span class="w"> </span><span class="kn">import</span> <span class="n">RestrictCharacters</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.version_type</span><span class="w"> </span><span class="kn">import</span> <span class="n">Version</span> <span class="k">as</span> <span class="n">Version</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.._internal.warning_levels</span><span class="w"> </span><span class="kn">import</span> <span class="n">INFO</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_2</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetDescr</span> <span class="k">as</span> <span class="n">DatasetDescr02</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_2</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinkedDataset</span> <span class="k">as</span> <span class="n">LinkedDataset02</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetDescr</span> <span class="k">as</span> <span class="n">DatasetDescr</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetId</span> <span class="k">as</span> <span class="n">DatasetId</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinkedDataset</span> <span class="k">as</span> <span class="n">LinkedDataset</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..dataset.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Uploader</span> <span class="k">as</span> <span class="n">Uploader</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="n">VALID_COVER_IMAGE_EXTENSIONS</span> <span class="k">as</span> <span class="n">VALID_COVER_IMAGE_EXTENSIONS</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span> <span class="k">as</span> <span class="n">Author</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">BadgeDescr</span> <span class="k">as</span> <span class="n">BadgeDescr</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">CiteEntry</span> <span class="k">as</span> <span class="n">CiteEntry</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeprecatedLicenseId</span> <span class="k">as</span> <span class="n">DeprecatedLicenseId</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Doi</span> <span class="k">as</span> <span class="n">Doi</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>    <span class="n">FileSource_documentation</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>    <span class="n">GenericModelDescrBase</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="n">LinkedResourceBase</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>    <span class="n">_author_conv</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportPrivateUsage]</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>    <span class="n">_maintainer_conv</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportPrivateUsage]</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">LicenseId</span> <span class="k">as</span> <span class="n">LicenseId</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinkedResource</span> <span class="k">as</span> <span class="n">LinkedResource</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Maintainer</span> <span class="k">as</span> <span class="n">Maintainer</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrcidId</span> <span class="k">as</span> <span class="n">OrcidId</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">RelativeFilePath</span> <span class="k">as</span> <span class="n">RelativeFilePath</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">..generic.v0_3</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResourceId</span> <span class="k">as</span> <span class="n">ResourceId</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span> <span class="k">as</span> <span class="n">_Author_v0_4</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BinarizeDescr</span> <span class="k">as</span> <span class="n">_BinarizeDescr_v0_4</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">CallableFromDepencency</span> <span class="k">as</span> <span class="n">CallableFromDepencency</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">CallableFromDepencency</span> <span class="k">as</span> <span class="n">_CallableFromDepencency_v0_4</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">CallableFromFile</span> <span class="k">as</span> <span class="n">_CallableFromFile_v0_4</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClipDescr</span> <span class="k">as</span> <span class="n">_ClipDescr_v0_4</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClipKwargs</span> <span class="k">as</span> <span class="n">ClipKwargs</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImplicitOutputShape</span> <span class="k">as</span> <span class="n">_ImplicitOutputShape_v0_4</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">InputTensorDescr</span> <span class="k">as</span> <span class="n">_InputTensorDescr_v0_4</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">KnownRunMode</span> <span class="k">as</span> <span class="n">KnownRunMode</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelDescr</span> <span class="k">as</span> <span class="n">_ModelDescr_v0_4</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">OutputTensorDescr</span> <span class="k">as</span> <span class="n">_OutputTensorDescr_v0_4</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParameterizedInputShape</span> <span class="k">as</span> <span class="n">_ParameterizedInputShape_v0_4</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">PostprocessingDescr</span> <span class="k">as</span> <span class="n">_PostprocessingDescr_v0_4</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">PreprocessingDescr</span> <span class="k">as</span> <span class="n">_PreprocessingDescr_v0_4</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingKwargs</span> <span class="k">as</span> <span class="n">ProcessingKwargs</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunMode</span> <span class="k">as</span> <span class="n">RunMode</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScaleLinearDescr</span> <span class="k">as</span> <span class="n">_ScaleLinearDescr_v0_4</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScaleMeanVarianceDescr</span> <span class="k">as</span> <span class="n">_ScaleMeanVarianceDescr_v0_4</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScaleRangeDescr</span> <span class="k">as</span> <span class="n">_ScaleRangeDescr_v0_4</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">SigmoidDescr</span> <span class="k">as</span> <span class="n">_SigmoidDescr_v0_4</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">TensorName</span> <span class="k">as</span> <span class="n">_TensorName_v0_4</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeightsFormat</span> <span class="k">as</span> <span class="n">WeightsFormat</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZeroMeanUnitVarianceDescr</span> <span class="k">as</span> <span class="n">_ZeroMeanUnitVarianceDescr_v0_4</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.v0_4</span><span class="w"> </span><span class="kn">import</span> <span class="n">package_weights</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="n">SpaceUnit</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="s2">&quot;attometer&quot;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>    <span class="s2">&quot;angstrom&quot;</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="s2">&quot;centimeter&quot;</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="s2">&quot;decimeter&quot;</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>    <span class="s2">&quot;exameter&quot;</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="s2">&quot;femtometer&quot;</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="s2">&quot;foot&quot;</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="s2">&quot;gigameter&quot;</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="s2">&quot;hectometer&quot;</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="s2">&quot;inch&quot;</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>    <span class="s2">&quot;kilometer&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="s2">&quot;megameter&quot;</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="s2">&quot;meter&quot;</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="s2">&quot;mile&quot;</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="s2">&quot;millimeter&quot;</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="s2">&quot;nanometer&quot;</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="s2">&quot;parsec&quot;</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="s2">&quot;petameter&quot;</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="s2">&quot;picometer&quot;</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="s2">&quot;terameter&quot;</span><span class="p">,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="s2">&quot;yard&quot;</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="s2">&quot;yoctometer&quot;</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="s2">&quot;yottameter&quot;</span><span class="p">,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>    <span class="s2">&quot;zeptometer&quot;</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="s2">&quot;zettameter&quot;</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="p">]</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">&quot;&quot;&quot;Space unit compatible to the [OME-Zarr axes specification 0.5](https://ngff.openmicroscopy.org/0.5/#axes-md)&quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="n">TimeUnit</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="s2">&quot;attosecond&quot;</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>    <span class="s2">&quot;centisecond&quot;</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="s2">&quot;day&quot;</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="s2">&quot;decisecond&quot;</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>    <span class="s2">&quot;exasecond&quot;</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="s2">&quot;femtosecond&quot;</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>    <span class="s2">&quot;gigasecond&quot;</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="s2">&quot;hectosecond&quot;</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="s2">&quot;hour&quot;</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>    <span class="s2">&quot;kilosecond&quot;</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="s2">&quot;megasecond&quot;</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="s2">&quot;microsecond&quot;</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>    <span class="s2">&quot;millisecond&quot;</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>    <span class="s2">&quot;minute&quot;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="s2">&quot;nanosecond&quot;</span><span class="p">,</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="s2">&quot;petasecond&quot;</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="s2">&quot;picosecond&quot;</span><span class="p">,</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>    <span class="s2">&quot;second&quot;</span><span class="p">,</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="s2">&quot;terasecond&quot;</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>    <span class="s2">&quot;yoctosecond&quot;</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>    <span class="s2">&quot;yottasecond&quot;</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>    <span class="s2">&quot;zeptosecond&quot;</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>    <span class="s2">&quot;zettasecond&quot;</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="p">]</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">&quot;&quot;&quot;Time unit compatible to the [OME-Zarr axes specification 0.5](https://ngff.openmicroscopy.org/0.5/#axes-md)&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="n">AxisType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;space&quot;</span><span class="p">]</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="n">_AXIS_TYPE_MAP</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AxisType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;batch&quot;</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>    <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;channel&quot;</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="p">}</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="n">_AXIS_ID_MAP</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;batch&quot;</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>    <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>    <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;channel&quot;</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="p">}</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorId</span><span class="p">(</span><span class="n">LowerCaseIdentifier</span><span class="p">):</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>    <span class="n">root_model</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">RootModel</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">RootModel</span><span class="p">[</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">LowerCaseIdentifierAnno</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="p">]</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_normalize_axis_id</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="n">normalized</span> <span class="o">=</span> <span class="n">_AXIS_ID_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">normalized</span><span class="p">:</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="s2">&quot;Normalized axis id from &#39;</span><span class="si">{}</span><span class="s2">&#39; to &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">normalized</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>    <span class="k">return</span> <span class="n">normalized</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AxisId</span><span class="p">(</span><span class="n">LowerCaseIdentifier</span><span class="p">):</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>    <span class="n">root_model</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">RootModel</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">RootModel</span><span class="p">[</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>            <span class="n">LowerCaseIdentifierAnno</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>            <span class="n">MaxLen</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="n">AfterValidator</span><span class="p">(</span><span class="n">_normalize_axis_id</span><span class="p">),</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="p">]</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>    <span class="p">]</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_is_batch</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_is_not_batch</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="k">return</span> <span class="ow">not</span> <span class="n">_is_batch</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">_is_not_batch</span><span class="p">)]</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="n">PreprocessingId</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="s2">&quot;binarize&quot;</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>    <span class="s2">&quot;clip&quot;</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="s2">&quot;ensure_dtype&quot;</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>    <span class="s2">&quot;scale_linear&quot;</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>    <span class="s2">&quot;scale_range&quot;</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="s2">&quot;sigmoid&quot;</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="s2">&quot;softmax&quot;</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="p">]</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="n">PostprocessingId</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>    <span class="s2">&quot;binarize&quot;</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="s2">&quot;clip&quot;</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="s2">&quot;ensure_dtype&quot;</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="s2">&quot;scale_linear&quot;</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>    <span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>    <span class="s2">&quot;scale_range&quot;</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>    <span class="s2">&quot;sigmoid&quot;</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>    <span class="s2">&quot;softmax&quot;</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="p">]</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="n">SAME_AS_TYPE</span> <span class="o">=</span> <span class="s2">&quot;&lt;same as type&gt;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="n">ParameterizedSize_N</span> <span class="o">=</span> <span class="nb">int</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">Annotates an integer to calculate a concrete axis size from a `ParameterizedSize`.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ParameterizedSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes a range of valid tensor axis sizes as `size = min + n*step`.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">    - **min** and **step** are given by the model description.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">    - All blocksize paramters n = 0,1,2,... yield a valid `size`.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">    - A greater blocksize paramter n = 0,1,2,... results in a greater **size**.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">      This allows to adjust the axis size more generically.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="n">N</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ParameterizedSize_N</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Positive integer to parameterize this axis&quot;&quot;&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="nb">min</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="n">step</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>                <span class="sa">f</span><span class="s2">&quot;axis of size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> is not parameterized by `min + n*step` =&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> + n*</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">`&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">*</span> <span class="n">n</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParameterizedSize_N</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;return smallest n parameterizing a size greater or equal than `s`&quot;&quot;&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="k">return</span> <span class="n">ceil</span><span class="p">((</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DataDependentSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="nb">min</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="nb">max</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_max_gt_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;expected `min` &lt; `max`, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SizeReference</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A tensor axis size (extent in pixels/frames) defined in relation to a reference axis.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">    `axis.size = reference.size * reference.scale / axis.scale + offset`</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">    Note:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">    1. The axis and the referenced axis need to have the same unit (or no unit).</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">    2. Batch axes may not be referenced.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">    3. Fractions are rounded down.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">    4. If the reference axis is `concatenable` the referencing axis is assumed to be</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">        `concatenable` as well with the same block order.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">    Example:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">    An unisotropic input image of w*h=100*49 pixels depicts a phsical space of 200*196mm.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">    Let&#39;s assume that we want to express the image height h in relation to its width w</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">    instead of only accepting input images of exactly 100*49 pixels</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">    (for example to express a range of valid image shapes by parametrizing w, see `ParameterizedSize`).</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">    &gt;&gt;&gt; w = SpaceInputAxis(id=AxisId(&quot;w&quot;), size=100, unit=&quot;millimeter&quot;, scale=2)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">    &gt;&gt;&gt; h = SpaceInputAxis(</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">    ...     id=AxisId(&quot;h&quot;),</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">    ...     size=SizeReference(tensor_id=TensorId(&quot;input&quot;), axis_id=AxisId(&quot;w&quot;), offset=-1),</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">    ...     unit=&quot;millimeter&quot;,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">    ...     scale=4,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">    ... )</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">    &gt;&gt;&gt; print(h.size.get_size(h, w))</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    49</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">     h = w * w.scale / h.scale + offset = 100 * 2mm / 4mm - 1 = 49</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="n">tensor_id</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;tensor id of the reference axis&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>    <span class="n">axis_id</span><span class="p">:</span> <span class="n">AxisId</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;axis id of the reference axis&quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">StrictInt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="p">],</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="n">ref_axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="p">],</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="n">ref_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>    <span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the concrete size for a given axis and its reference axis.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        Args:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">            axis: The axis this `SizeReference` is the size of.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">            ref_axis: The reference axis to compute the size from.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">            n: If the **ref_axis** is parameterized (of type `ParameterizedSize`)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">                and no fixed **ref_size** is given,</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">                **n** is used to compute the size of the parameterized **ref_axis**.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">            ref_size: Overwrite the reference size instead of deriving it from</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">                **ref_axis**</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">                (**ref_axis.scale** is still used; any given **n** is ignored).</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="s2">&quot;Given `axis.size` is not defined by this `SizeReference`&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="k">assert</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="p">,</span> <span class="p">(</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="sa">f</span><span class="s2">&quot;Expected `ref_axis.id` to be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="s2">&quot;`SizeReference` requires `axis` and `ref_axis` to have the same `unit`,&quot;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="sa">f</span><span class="s2">&quot; but </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="k">if</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be a `DataDependentSize`.&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                <span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be sized by a&quot;</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                    <span class="o">+</span> <span class="s2">&quot; `SizeReference` itself.&quot;</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                <span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref_size</span> <span class="o">*</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_unit</span><span class="p">(</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="p">],</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="p">):</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="k">return</span> <span class="n">axis</span><span class="o">.</span><span class="n">unit</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AxisBase</span><span class="p">(</span><span class="n">NodeWithExplicitlySetFields</span><span class="p">):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">AxisId</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An axis id unique across all axes of one tensor.&quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="n">description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A short description of this axis beyond its type and id.&quot;&quot;&quot;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WithHalo</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="n">halo</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The halo should be cropped from the output tensor to avoid boundary effects.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">    It is to be cropped from both sides, i.e. `size_after_crop = size - 2 * halo`.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">    To document a halo that is already cropped by the model use `size.offset` instead.&quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="n">SizeReference</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="p">]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="p">),</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="p">]</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;reference to another axis with an optional offset (see `SizeReference`)&quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="n">BATCH_AXIS_ID</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BatchAxis</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;batch&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;batch&quot;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">_is_batch</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BATCH_AXIS_ID</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The batch size may be fixed to 1,</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">    otherwise (the default) it may be chosen arbitrarily depending on available memory&quot;&quot;&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="nd">@property</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="nd">@property</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="nd">@property</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChannelAxis</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;channel&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;channel&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="n">channel_names</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]]</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="nd">@property</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_names</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="nd">@property</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>    <span class="nd">@property</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>    <span class="nd">@property</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="nd">@property</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="nd">@property</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_WithInputAxisSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">Union</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">ParameterizedSize</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">],</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                <span class="n">ParameterizedSize</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>            <span class="p">]</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="p">),</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>    <span class="p">]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The size/length of this axis can be specified as</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">    - fixed integer</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">    - parameterized series of valid sizes (`ParameterizedSize`)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">    - reference to another axis with an optional offset (`SizeReference`)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexInputAxis</span><span class="p">(</span><span class="n">IndexAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">    input axis.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexOutputAxis</span><span class="p">(</span><span class="n">IndexAxisBase</span><span class="p">):</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">Union</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">SizeReference</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">],</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="p">]</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="p">),</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>    <span class="p">]</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The size/length of this axis can be specified as</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">    - fixed integer</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">    - reference to another axis with an optional offset (`SizeReference`)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">    - data dependent size using `DataDependentSize` (size is only known after model inference)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TimeUnit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeInputAxis</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">    input axis.</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;space&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;space&quot;</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpaceUnit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceInputAxis</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">    input axis.</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="n">INPUT_AXIS_TYPES</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="n">BatchAxis</span><span class="p">,</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>    <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>    <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">&quot;&quot;&quot;intended for isinstance comparisons in py&lt;3.10&quot;&quot;&quot;</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="n">_InputAxisUnion</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>    <span class="n">BatchAxis</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">,</span> <span class="n">IndexInputAxis</span><span class="p">,</span> <span class="n">TimeInputAxis</span><span class="p">,</span> <span class="n">SpaceInputAxis</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="p">]</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="n">InputAxis</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">_InputAxisUnion</span><span class="p">,</span> <span class="n">Discriminator</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_WithOutputAxisSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">Union</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">SizeReference</span><span class="p">],</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="p">]</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="p">),</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>    <span class="p">]</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The size/length of this axis can be specified as</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">    - fixed integer</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">    - reference to another axis with an optional offset (see `SizeReference`)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeOutputAxis</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">_WithOutputAxisSize</span><span class="p">):</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    <span class="k">pass</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeOutputAxisWithHalo</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="k">pass</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_halo_axis_discriminator_value</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;with_halo&quot;</span><span class="p">,</span> <span class="s2">&quot;wo_halo&quot;</span><span class="p">]:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">return</span> <span class="s2">&quot;with_halo&quot;</span> <span class="k">if</span> <span class="s2">&quot;halo&quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">else</span> <span class="s2">&quot;wo_halo&quot;</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="k">return</span> <span class="s2">&quot;with_halo&quot;</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;halo&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;wo_halo&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="n">_TimeOutputAxisUnion</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="n">Union</span><span class="p">[</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">TimeOutputAxis</span><span class="p">,</span> <span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;wo_halo&quot;</span><span class="p">)],</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span> <span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;with_halo&quot;</span><span class="p">)],</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>    <span class="p">],</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>    <span class="n">Discriminator</span><span class="p">(</span><span class="n">_get_halo_axis_discriminator_value</span><span class="p">),</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="p">]</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceOutputAxis</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">_WithOutputAxisSize</span><span class="p">):</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>    <span class="k">pass</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceOutputAxisWithHalo</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>    <span class="k">pass</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="n">_SpaceOutputAxisUnion</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>    <span class="n">Union</span><span class="p">[</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">SpaceOutputAxis</span><span class="p">,</span> <span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;wo_halo&quot;</span><span class="p">)],</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span> <span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;with_halo&quot;</span><span class="p">)],</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="p">],</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="n">Discriminator</span><span class="p">(</span><span class="n">_get_halo_axis_discriminator_value</span><span class="p">),</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="p">]</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="n">_OutputAxisUnion</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="n">BatchAxis</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">,</span> <span class="n">IndexOutputAxis</span><span class="p">,</span> <span class="n">_TimeOutputAxisUnion</span><span class="p">,</span> <span class="n">_SpaceOutputAxisUnion</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="p">]</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="n">OutputAxis</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">_OutputAxisUnion</span><span class="p">,</span> <span class="n">Discriminator</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)]</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="n">OUTPUT_AXIS_TYPES</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>    <span class="n">BatchAxis</span><span class="p">,</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>    <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>    <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>    <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>    <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>    <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">&quot;&quot;&quot;intended for isinstance comparisons in py&lt;3.10&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="n">AnyAxis</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">,</span> <span class="n">OutputAxis</span><span class="p">]</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="n">ANY_AXIS_TYPES</span> <span class="o">=</span> <span class="n">INPUT_AXIS_TYPES</span> <span class="o">+</span> <span class="n">OUTPUT_AXIS_TYPES</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">&quot;&quot;&quot;intended for isinstance comparisons in py&lt;3.10&quot;&quot;&quot;</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="n">TVs</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>    <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>    <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>    <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="p">]</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="n">NominalOrOrdinalDType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>    <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>    <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>    <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>    <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>    <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>    <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>    <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>    <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="p">]</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NominalOrOrdinalDataDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>    <span class="n">values</span><span class="p">:</span> <span class="n">TVs</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A fixed set of nominal or an ascending sequence of ordinal values.</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">    In this case `data.type` is required to be an unsigend integer type, e.g. &#39;uint8&#39;.</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">    String `values` are interpreted as labels for tensor values 0, ..., N.</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">    Note: as YAML 1.2 does not natively support a &quot;set&quot; datatype,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">    nominal values should be given as a sequence (aka list/array) as well.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="n">NominalOrOrdinalDType</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="p">],</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="p">),</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;uint8&quot;</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_values_match_type</span><span class="p">(</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="n">incompatible</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                    <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">DTYPE_LIMITS</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                    <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                        <span class="n">v</span> <span class="o">&lt;</span> <span class="n">DTYPE_LIMITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                        <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">DTYPE_LIMITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                    <span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                    <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;uint&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                    <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;int&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                <span class="p">):</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                    <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">incompatible</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="k">break</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="k">if</span> <span class="n">incompatible</span><span class="p">:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                <span class="sa">f</span><span class="s2">&quot;data type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39; incompatible with values </span><span class="si">{</span><span class="n">incompatible</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;arbitrary unit&quot;</span><span class="p">],</span> <span class="n">SiUnit</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="nd">@property</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="n">IntervalOrRatioDType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="p">]</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IntervalOrRatioDataDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>  <span class="c1"># TODO: rename to dtype</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="n">IntervalOrRatioDType</span><span class="p">,</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">,</span> <span class="s2">&quot;uint16&quot;</span><span class="p">],</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="p">),</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>    <span class="nb">range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="kc">None</span><span class="p">,</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="kc">None</span><span class="p">,</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tuple `(minimum, maximum)` specifying the allowed range of the data in this tensor.</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">    `None` corresponds to min/max of what can be expressed by **type**.&quot;&quot;&quot;</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;arbitrary unit&quot;</span><span class="p">],</span> <span class="n">SiUnit</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;arbitrary unit&quot;</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale for data on an interval (or ratio) scale.&quot;&quot;&quot;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Offset for data on a ratio scale.&quot;&quot;&quot;</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_replace_inf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="k">if</span> <span class="n">is_dict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]):</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="n">forbidden</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                    <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                    <span class="s2">&quot;-inf&quot;</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                    <span class="s2">&quot;.inf&quot;</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                    <span class="s2">&quot;-.inf&quot;</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">),</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="p">)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">forbidden</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]):</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                    <span class="n">issue_warning</span><span class="p">(</span><span class="s2">&quot;replaced &#39;inf&#39; value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">])</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                    <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">forbidden</span> <span class="k">else</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="p">)</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="n">TensorDataDescr</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">NominalOrOrdinalDataDescr</span><span class="p">,</span> <span class="n">IntervalOrRatioDataDescr</span><span class="p">]</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ProcessingDescrBase</span><span class="p">(</span><span class="n">NodeWithExplicitlySetFields</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;processing base class&quot;&quot;&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `BinarizeDescr`&quot;&quot;&quot;</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The fixed threshold&quot;&quot;&quot;</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `BinarizeDescr`&quot;&quot;&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="n">threshold</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The fixed threshold values along `axis`&quot;&quot;&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The `threshold` axis&quot;&quot;&quot;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Binarize the tensor with a fixed threshold.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">    Values above `BinarizeKwargs.threshold`/`BinarizeAlongAxisKwargs.threshold`</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    will be set to one, values below the threshold to zero.</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    Examples:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">    - in YAML</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">        ```yaml</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">        postprocessing:</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">          - id: binarize</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">            kwargs:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">              axis: &#39;channel&#39;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">              threshold: [0.25, 0.5, 0.75]</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">        ```</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">    - in Python:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [BinarizeDescr(</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">        ...   kwargs=BinarizeAlongAxisKwargs(</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        ...       axis=AxisId(&#39;channel&#39;),</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        ...       threshold=[0.25, 0.5, 0.75],</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        ...   )</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        ... )]</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;binarize&quot;</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;binarize&quot;</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BinarizeKwargs</span><span class="p">,</span> <span class="n">BinarizeAlongAxisKwargs</span><span class="p">]</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ClipDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set tensor values below min to min and above max to max.</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    See `ScaleRangeDescr` for examples.</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;clip&quot;</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;clip&quot;</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ClipKwargs</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `EnsureDtypeDescr`&quot;&quot;&quot;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>        <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="p">]</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnsureDtypeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cast the tensor data type to `EnsureDtypeKwargs.dtype` (if not matching).</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    This can for example be used to ensure the inner neural network model gets a</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">    different input tensor data type than the fully described bioimage.io model does.</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">    Examples:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        The described bioimage.io model (incl. preprocessing) accepts any</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        float32-compatible tensor, normalizes it with percentiles and clipping and then</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        casts it to uint8, which is what the neural network in this example expects.</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">            ```yaml</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">            inputs:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">            - data:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">                type: float32  # described bioimage.io model is compatible with any float32 input tensor</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">              preprocessing:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">              - id: scale_range</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">                  kwargs:</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">                  axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">                  max_percentile: 99.8</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">                  min_percentile: 5.0</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">              - id: clip</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">                  kwargs:</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">                  min: 0.0</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">                  max: 1.0</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">              - id: ensure_dtype  # the neural network of the model requires uint8</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">                  kwargs:</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">                  dtype: uint8</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">            ```</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">        - in Python:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">            &gt;&gt;&gt; preprocessing = [</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">            ...     ScaleRangeDescr(</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">            ...         kwargs=ScaleRangeKwargs(</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">            ...           axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">            ...           max_percentile= 99.8,</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">            ...           min_percentile= 5.0,</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">            ...         )</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">            ...     ),</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">            ...     ClipDescr(kwargs=ClipKwargs(min=0.0, max=1.0)),</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">            ...     EnsureDtypeDescr(kwargs=EnsureDtypeKwargs(dtype=&quot;uint8&quot;)),</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">            ... ]</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ensure_dtype&quot;</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ensure_dtype&quot;</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">EnsureDtypeKwargs</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Key word arguments for `ScaleLinearDescr`&quot;&quot;&quot;</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>    <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;multiplicative factor&quot;&quot;&quot;</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;additive term&quot;&quot;&quot;</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="s2">&quot;Redundant linear scaling not allowd. Set `gain` != 1.0 and/or `offset`&quot;</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="o">+</span> <span class="s2">&quot; != 0.0.&quot;</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            <span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Key word arguments for `ScaleLinearDescr`&quot;&quot;&quot;</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis of gain and offset values.&quot;&quot;&quot;</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>    <span class="n">gain</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;multiplicative factor&quot;&quot;&quot;</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;additive term&quot;&quot;&quot;</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">):</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                        <span class="sa">f</span><span class="s2">&quot;Size of `gain` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span><span class="si">}</span><span class="s2">) and `offset` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span><span class="si">}</span><span class="s2">) must match.&quot;</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                    <span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="s2">&quot;Do not specify an `axis` for scalar gain and offset values.&quot;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">off</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">):</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                <span class="s2">&quot;Redundant linear scaling not allowd. Set `gain` != 1.0 and/or `offset`&quot;</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                <span class="o">+</span> <span class="s2">&quot; != 0.0.&quot;</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixed linear scaling.</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">    Examples:</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">      1. Scale with scalar gain and offset</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">          - id: scale_linear</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">              gain: 2.0</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">              offset: 3.0</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        ```</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        - in Python:</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        ...     ScaleLinearDescr(kwargs=ScaleLinearKwargs(gain= 2.0, offset=3.0))</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        ... ]</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">      2. Independent scaling along an axis</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">          - id: scale_linear</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">              axis: &#39;channel&#39;</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">              gain: [1.0, 2.0, 3.0]</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">        ```</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">        - in Python:</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        ...     ScaleLinearDescr(</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">        ...         kwargs=ScaleLinearAlongAxisKwargs(</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        ...             axis=AxisId(&quot;channel&quot;),</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">        ...             gain=[1.0, 2.0, 3.0],</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        ...         )</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        ...     )</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">        ... ]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_linear&quot;</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_linear&quot;</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScaleLinearKwargs</span><span class="p">,</span> <span class="n">ScaleLinearAlongAxisKwargs</span><span class="p">]</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SigmoidDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The logistic sigmoid function, a.k.a. expit function.</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">    Examples:</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">    - in YAML</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        postprocessing:</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">          - id: sigmoid</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">        ```</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">    - in Python:</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [SigmoidDescr()]</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;sigmoid&quot;</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sigmoid&quot;</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>    <span class="nd">@property</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessingKwargs</span><span class="p">:</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;empty kwargs&quot;&quot;&quot;</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>        <span class="k">return</span> <span class="n">ProcessingKwargs</span><span class="p">()</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SoftmaxKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `SoftmaxDescr`&quot;&quot;&quot;</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">)</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis to apply the softmax function along.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">    Note:</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        Defaults to &#39;channel&#39; axis</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        (which may not exist, in which case</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">        a different axis id has to be specified).</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SoftmaxDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The softmax function.</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">    Examples:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">    - in YAML</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">        postprocessing:</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">          - id: softmax</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">              axis: channel</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        ```</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">    - in Python:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [SoftmaxDescr(kwargs=SoftmaxKwargs(axis=AxisId(&quot;channel&quot;)))]</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;softmax&quot;</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;softmax&quot;</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">SoftmaxKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">SoftmaxKwargs</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `FixedZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>    <span class="n">mean</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The mean value to normalize with.&quot;&quot;&quot;</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="n">std</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)]</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard deviation value to normalize with.&quot;&quot;&quot;</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `FixedZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="n">mean</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The mean value(s) to normalize with.&quot;&quot;&quot;</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>    <span class="n">std</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)]]]</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard deviation value(s) to normalize with.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">    Size must match `mean` values.&quot;&quot;&quot;</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">])]</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis of the mean/std values to normalize each entry along that dimension</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">    separately.&quot;&quot;&quot;</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_mean_and_std_match</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>                <span class="sa">f</span><span class="s2">&quot;Size of `mean` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span><span class="si">}</span><span class="s2">) and `std` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>                <span class="o">+</span> <span class="s2">&quot; must match.&quot;</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="p">)</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Subtract a given mean and divide by the standard deviation.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">    Normalize with fixed, precomputed values for</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">    `FixedZeroMeanUnitVarianceKwargs.mean` and `FixedZeroMeanUnitVarianceKwargs.std`</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">    Use `FixedZeroMeanUnitVarianceAlongAxisKwargs` for independent scaling along given</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">    axes.</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">    Examples:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">    1. scalar value for whole tensor</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">          - id: fixed_zero_mean_unit_variance</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">              mean: 103.5</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">              std: 13.7</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">        ```</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">        - in Python</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [FixedZeroMeanUnitVarianceDescr(</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">        ...   kwargs=FixedZeroMeanUnitVarianceKwargs(mean=103.5, std=13.7)</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">        ... )]</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">    2. independently along an axis</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">          - id: fixed_zero_mean_unit_variance</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">              axis: channel</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">              mean: [101.5, 102.5, 103.5]</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">              std: [11.7, 12.7, 13.7]</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        ```</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        - in Python</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [FixedZeroMeanUnitVarianceDescr(</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">        ...   kwargs=FixedZeroMeanUnitVarianceAlongAxisKwargs(</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">        ...     axis=AxisId(&quot;channel&quot;),</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a><span class="sd">        ...     mean=[101.5, 102.5, 103.5],</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        ...     std=[11.7, 12.7, 13.7],</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a><span class="sd">        ...   )</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a><span class="sd">        ... )]</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>    <span class="p">)</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="n">FixedZeroMeanUnitVarianceKwargs</span><span class="p">,</span> <span class="n">FixedZeroMeanUnitVarianceAlongAxisKwargs</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>    <span class="p">]</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZeroMeanUnitVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">    To normalize each sample independently leave out the &#39;batch&#39; axis.</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;epsilon for numeric stability: `out = (tensor - mean) / (std + eps)`.&quot;&quot;&quot;</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZeroMeanUnitVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Subtract mean and divide by variance.</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">    Examples:</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">        Subtract tensor mean and variance</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">          - id: zero_mean_unit_variance</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">        ```</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">        - in Python</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [ZeroMeanUnitVarianceDescr()]</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>        <span class="s2">&quot;zero_mean_unit_variance&quot;</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>    <span class="p">)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zero_mean_unit_variance&quot;</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ZeroMeanUnitVarianceKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">ZeroMeanUnitVarianceKwargs</span><span class="o">.</span><span class="n">model_construct</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>    <span class="p">)</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleRangeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ScaleRangeDescr`</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">    For `min_percentile`=0.0 (the default) and `max_percentile`=100 (the default)</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">    this processing step normalizes data to the [0, 1] intervall.</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">    For other percentiles the normalized values will partially be outside the [0, 1]</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">    intervall. Use `ScaleRange` followed by `ClipDescr` if you want to limit the</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">    normalized values to a range.</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute the min/max percentile value.</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">    To normalize samples independently, leave out the &quot;batch&quot; axis.</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>    <span class="n">min_percentile</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The lower percentile used to determine the value to align with zero.&quot;&quot;&quot;</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>    <span class="n">max_percentile</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The upper percentile used to determine the value to align with one.</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">    Has to be bigger than `min_percentile`.</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">    The range is 1 to 100 instead of 0 to 100 to avoid mistakenly</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">    accepting percentiles specified in the range 0.0 to 1.0.&quot;&quot;&quot;</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Epsilon for numeric stability.</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">    `out = (tensor - v_lower) / (v_upper - v_lower + eps)`;</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">    with `v_lower,v_upper` values at the respective percentiles.&quot;&quot;&quot;</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>    <span class="n">reference_tensor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tensor ID to compute the percentiles from. Default: The tensor itself.</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">    For any tensor in `inputs` only input tensor references are allowed.&quot;&quot;&quot;</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;max_percentile&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">min_smaller_max</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">min_p</span> <span class="o">:=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;min_percentile&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">:</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;min_percentile </span><span class="si">{</span><span class="n">min_p</span><span class="si">}</span><span class="s2"> &gt;= max_percentile </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleRangeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale with percentiles.</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="sd">    Examples:</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">    1. Scale linearly to map 5th percentile to 0 and 99.8th percentile to 1.0</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">          - id: scale_range</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">              axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">              max_percentile: 99.8</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">              min_percentile: 5.0</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">        ```</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        - in Python</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">        ...     ScaleRangeDescr(</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">        ...         kwargs=ScaleRangeKwargs(</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">        ...           axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">        ...           max_percentile= 99.8,</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">        ...           min_percentile= 5.0,</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        ...         )</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        ...     ),</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        ...     ClipDescr(</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">        ...         kwargs=ClipKwargs(</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">        ...             min=0.0,</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">        ...             max=1.0,</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">        ...         )</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">        ...     ),</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">        ... ]</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">      2. Combine the above scaling with additional clipping to clip values outside the range given by the percentiles.</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        - in YAML</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">        ```yaml</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        preprocessing:</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">          - id: scale_range</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">            kwargs:</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">              axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">              max_percentile: 99.8</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">              min_percentile: 5.0</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">                  - id: scale_range</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">           - id: clip</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">             kwargs:</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">              min: 0.0</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">              max: 1.0</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">        ```</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">        - in Python</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [ScaleRangeDescr(</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">        ...   kwargs=ScaleRangeKwargs(</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        ...       axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">        ...       max_percentile= 99.8,</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">        ...       min_percentile= 5.0,</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="sd">        ...   )</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">        ... )]</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_range&quot;</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_range&quot;</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ScaleRangeKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">ScaleRangeKwargs</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleMeanVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ScaleMeanVarianceKwargs`&quot;&quot;&quot;</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>    <span class="n">reference_tensor</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of tensor to match.&quot;&quot;&quot;</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">    To normalize samples independently, leave out the &#39;batch&#39; axis.</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Epsilon for numeric stability:</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">    `out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.`&quot;&quot;&quot;</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleMeanVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale a tensor&#39;s data distribution to match another tensor&#39;s mean/std.</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">    `out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.`</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_mean_variance&quot;</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_mean_variance&quot;</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ScaleMeanVarianceKwargs</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="n">PreprocessingDescr</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>    <span class="n">Union</span><span class="p">[</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>        <span class="n">BinarizeDescr</span><span class="p">,</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>        <span class="n">ClipDescr</span><span class="p">,</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>        <span class="n">EnsureDtypeDescr</span><span class="p">,</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>        <span class="n">FixedZeroMeanUnitVarianceDescr</span><span class="p">,</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>        <span class="n">ScaleLinearDescr</span><span class="p">,</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="n">ScaleRangeDescr</span><span class="p">,</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="n">SigmoidDescr</span><span class="p">,</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="n">SoftmaxDescr</span><span class="p">,</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>        <span class="n">ZeroMeanUnitVarianceDescr</span><span class="p">,</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>    <span class="p">],</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>    <span class="n">Discriminator</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="p">]</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="n">PostprocessingDescr</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>    <span class="n">Union</span><span class="p">[</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>        <span class="n">BinarizeDescr</span><span class="p">,</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>        <span class="n">ClipDescr</span><span class="p">,</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>        <span class="n">EnsureDtypeDescr</span><span class="p">,</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>        <span class="n">FixedZeroMeanUnitVarianceDescr</span><span class="p">,</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>        <span class="n">ScaleLinearDescr</span><span class="p">,</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>        <span class="n">ScaleMeanVarianceDescr</span><span class="p">,</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>        <span class="n">ScaleRangeDescr</span><span class="p">,</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>        <span class="n">SigmoidDescr</span><span class="p">,</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>        <span class="n">SoftmaxDescr</span><span class="p">,</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>        <span class="n">ZeroMeanUnitVarianceDescr</span><span class="p">,</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>    <span class="p">],</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>    <span class="n">Discriminator</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="p">]</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="n">IO_AxisT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;IO_AxisT&quot;</span><span class="p">,</span> <span class="n">InputAxis</span><span class="p">,</span> <span class="n">OutputAxis</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorDescrBase</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">IO_AxisT</span><span class="p">]):</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tensor id. No duplicates are allowed.&quot;&quot;&quot;</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>    <span class="n">description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;free text description&quot;&quot;&quot;</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">IO_AxisT</span><span class="p">]]</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;tensor axes&quot;&quot;&quot;</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>    <span class="nd">@property</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">,</span> <span class="n">check_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_axes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]:</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>        <span class="n">batch_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span><span class="p">]</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>                <span class="sa">f</span><span class="s2">&quot;Only one batch axis (per tensor) allowed, but got </span><span class="si">{</span><span class="n">batch_axes</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>            <span class="p">)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="n">seen_ids</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>        <span class="n">duplicate_axes_ids</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>            <span class="p">(</span><span class="n">duplicate_axes_ids</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">seen_ids</span> <span class="k">else</span> <span class="n">seen_ids</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="n">duplicate_axes_ids</span><span class="p">:</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate axis ids: </span><span class="si">{</span><span class="n">duplicate_axes_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>        <span class="k">return</span> <span class="n">axes</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>    <span class="n">test_tensor</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An example tensor to use for testing.</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">    Using the model with the test input tensors is expected to yield the test output tensors.</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">    Each test tensor has be a an ndarray in the</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">    [numpy.lib file format](https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html#module-numpy.lib.format).</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">    The file extension must be &#39;.npy&#39;.&quot;&quot;&quot;</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="n">sample_tensor</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A sample tensor to illustrate a possible input/output for the model,</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">    The sample image primarily serves to inform a human user about an example use case</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="sd">    and is typically stored as .hdf5, .png or .tiff.</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="sd">    It has to be readable by the [imageio library](https://imageio.readthedocs.io/en/stable/formats/index.html#supported-formats)</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a><span class="sd">    (numpy&#39;s `.npy` format is not supported).</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="sd">    The image dimensionality has to match the number of axes specified in this tensor description.</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_sample_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span><span class="p">:</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="n">reader</span> <span class="o">=</span> <span class="n">get_reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">sha256</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="n">tensor</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span>  <span class="c1"># pyright: ignore[reportUnknownVariableType]</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>            <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>            <span class="n">extension</span><span class="o">=</span><span class="n">PurePosixPath</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">original_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>        <span class="p">)</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>        <span class="n">n_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>        <span class="n">n_dims_min</span> <span class="o">=</span> <span class="n">n_dims_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>                <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="n">ParameterizedSize</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">)):</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">min</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>                    <span class="c1"># size reference may result in singleton axis</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>        <span class="n">n_dims_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_dims_min</span><span class="p">)</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>        <span class="k">if</span> <span class="n">n_dims</span> <span class="o">&lt;</span> <span class="n">n_dims_min</span> <span class="ow">or</span> <span class="n">n_dims</span> <span class="o">&gt;</span> <span class="n">n_dims_max</span><span class="p">:</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                <span class="sa">f</span><span class="s2">&quot;Expected sample tensor to have </span><span class="si">{</span><span class="n">n_dims_min</span><span class="si">}</span><span class="s2"> to&quot;</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">n_dims_max</span><span class="si">}</span><span class="s2"> dimensions, but found </span><span class="si">{</span><span class="n">n_dims</span><span class="si">}</span><span class="s2"> (shape: </span><span class="si">{</span><span class="n">tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>            <span class="p">)</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>        <span class="n">IntervalOrRatioDataDescr</span><span class="p">()</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>    <span class="p">)</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of the tensor&#39;s data values, optionally per channel.</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">    If specified per channel, the data `type` needs to match across channels.&quot;&quot;&quot;</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>    <span class="nd">@property</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>        <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>        <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>        <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>        <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>        <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>        <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>        <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>        <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>    <span class="p">]:</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;dtype as specified under `data.type` or `data[i].type`&quot;&quot;&quot;</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_type_across_channels</span><span class="p">(</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]:</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">value</span><span class="p">}</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>                <span class="s2">&quot;Tensor data descriptions per channel need to agree in their data&quot;</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; `type`, but found </span><span class="si">{</span><span class="n">dtypes</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>            <span class="p">)</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_matches_channelaxis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">):</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>                <span class="k">break</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>                <span class="sa">f</span><span class="s2">&quot;Got tensor data descriptions for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> channels, but&quot;</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; axis has size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>            <span class="p">)</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes_for_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>                <span class="sa">f</span><span class="s2">&quot;Dimension mismatch: array shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (#</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; incompatible with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes.&quot;</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>            <span class="p">)</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)}</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="k">class</span><span class="w"> </span><span class="nc">InputTensorDescr</span><span class="p">(</span><span class="n">TensorDescrBase</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">]):</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span> <span class="o">=</span> <span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Input tensor id.</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">    No duplicates are allowed across all inputs and outputs.&quot;&quot;&quot;</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>    <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;indicates that this tensor may be `None`&quot;&quot;&quot;</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>    <span class="n">preprocessing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>    <span class="p">)</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of how this input should be preprocessed.</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">    notes:</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">    - If preprocessing does not start with an &#39;ensure_dtype&#39; entry, it is added</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">      to ensure an input tensor&#39;s data type matches the input tensor&#39;s data description.</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">    - If preprocessing does not end with an &#39;ensure_dtype&#39; or &#39;binarize&#39; entry, an</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">      &#39;ensure_dtype&#39; step is added to ensure preprocessing steps are not unintentionally</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a><span class="sd">      changing the data type.</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_preprocessing_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>        <span class="n">axes_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>            <span class="n">kwargs_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">)</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>            <span class="k">if</span> <span class="n">kwargs_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>                <span class="k">continue</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected `preprocessing.i.kwargs.axes` to be a sequence, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>                <span class="p">)</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_ids</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs_axes</span><span class="p">):</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>                    <span class="s2">&quot;`preprocessing.i.kwargs.axes` needs to be subset of axes ids&quot;</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>                <span class="p">)</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">NominalOrOrdinalDataDescr</span><span class="p">,</span> <span class="n">IntervalOrRatioDataDescr</span><span class="p">)):</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>        <span class="c1"># ensure `preprocessing` begins with `EnsureDtypeDescr`</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">EnsureDtypeDescr</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>        <span class="p">):</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>            <span class="p">)</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>        <span class="c1"># ensure `preprocessing` ends with `EnsureDtypeDescr` or `BinarizeDescr`</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">EnsureDtypeDescr</span><span class="p">,</span> <span class="n">BinarizeDescr</span><span class="p">)):</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>                <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>            <span class="p">)</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_axes</span><span class="p">(</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>        <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">_ParameterizedInputShape_v0_4</span><span class="p">,</span> <span class="n">_ImplicitOutputShape_v0_4</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>    <span class="p">],</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>    <span class="n">tensor_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">],</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>    <span class="n">halo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>    <span class="n">size_refs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a><span class="p">):</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>    <span class="n">ret</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>        <span class="n">axis_type</span> <span class="o">=</span> <span class="n">_AXIS_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span><span class="p">:</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BatchAxis</span><span class="p">())</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>            <span class="k">continue</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ParameterizedInputShape_v0_4</span><span class="p">):</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>            <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">ParameterizedSize</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ImplicitOutputShape_v0_4</span><span class="p">):</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>            <span class="n">ref_t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">reference_tensor</span><span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>            <span class="k">if</span> <span class="n">ref_t</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>                <span class="n">t_id</span><span class="p">,</span> <span class="n">orig_a_id</span> <span class="o">=</span> <span class="n">ref_t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>                <span class="n">t_id</span> <span class="o">=</span> <span class="n">ref_t</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>                <span class="n">orig_a_id</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>            <span class="n">a_id</span> <span class="o">=</span> <span class="n">_AXIS_ID_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig_a_id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">orig_scale</span> <span class="o">:=</span> <span class="n">shape</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>                <span class="c1"># old way to insert a new axis dimension</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>                <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">orig_scale</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>                <span class="k">if</span> <span class="n">axis_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">):</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>                    <span class="c1"># these axes no longer have a scale</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>                    <span class="n">offset_from_scale</span> <span class="o">=</span> <span class="n">orig_scale</span> <span class="o">*</span> <span class="n">size_refs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>                        <span class="n">_TensorName_v0_4</span><span class="p">(</span><span class="n">t_id</span><span class="p">),</span> <span class="p">{}</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig_a_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>                    <span class="n">offset_from_scale</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="n">t_id</span><span class="p">),</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>                    <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a_id</span><span class="p">),</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>                    <span class="n">offset</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">offset_from_scale</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                <span class="p">)</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TimeInputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>                <span class="k">if</span> <span class="n">halo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TimeOutputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>                        <span class="n">TimeOutputAxisWithHalo</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>                    <span class="p">)</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexInputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                    <span class="n">size</span> <span class="o">=</span> <span class="n">DataDependentSize</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">size</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexOutputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                    <span class="s2">&quot;Conversion of channel size from an implicit output shape may be&quot;</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                    <span class="o">+</span> <span class="s2">&quot; wrong&quot;</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                <span class="p">)</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                    <span class="n">ChannelAxis</span><span class="p">(</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                        <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                            <span class="n">Identifier</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;channel</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                        <span class="p">]</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                    <span class="p">)</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                <span class="p">)</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>                    <span class="n">ChannelAxis</span><span class="p">(</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                        <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span><span class="n">Identifier</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;channel</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                    <span class="p">)</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>                <span class="p">)</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;space&quot;</span><span class="p">:</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpaceInputAxis</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>                <span class="k">if</span> <span class="n">halo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpaceOutputAxis</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                        <span class="sa">f</span><span class="s2">&quot;output axis with halo and fixed size (here </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">) not allowed&quot;</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>                    <span class="p">)</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                        <span class="n">SpaceOutputAxisWithHalo</span><span class="p">(</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                            <span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>                        <span class="p">)</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>                    <span class="p">)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_axes_letters_to_ids</span><span class="p">(</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]]:</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>    <span class="k">return</span> <span class="p">[</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_complement_v04_axis</span><span class="p">(</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>    <span class="n">tensor_axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]:</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>    <span class="n">non_complement_axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">}</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>    <span class="n">complement_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tensor_axes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_complement_axes</span><span class="p">]</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complement_axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>            <span class="sa">f</span><span class="s2">&quot;Expected none or a single complement axis, but axes &#39;</span><span class="si">{</span><span class="n">axes</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;for tensor dims &#39;</span><span class="si">{</span><span class="n">tensor_axes</span><span class="si">}</span><span class="s2">&#39; leave &#39;</span><span class="si">{</span><span class="n">complement_axes</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>        <span class="p">)</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>    <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">complement_axes</span> <span class="k">else</span> <span class="n">AxisId</span><span class="p">(</span><span class="n">complement_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_convert_proc</span><span class="p">(</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>    <span class="n">p</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_PreprocessingDescr_v0_4</span><span class="p">,</span> <span class="n">_PostprocessingDescr_v0_4</span><span class="p">],</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>    <span class="n">tensor_axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">,</span> <span class="n">PostprocessingDescr</span><span class="p">]:</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_BinarizeDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>        <span class="k">return</span> <span class="n">BinarizeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">BinarizeKwargs</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">threshold</span><span class="p">))</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_ClipDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>        <span class="k">return</span> <span class="n">ClipDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">ClipKwargs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">max</span><span class="p">))</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_SigmoidDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>        <span class="k">return</span> <span class="n">SigmoidDescr</span><span class="p">()</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_ScaleLinearDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="n">_axes_letters_to_ids</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>            <span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>            <span class="n">axis</span> <span class="o">=</span> <span class="n">_get_complement_v04_axis</span><span class="p">(</span><span class="n">tensor_axes</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ScaleLinearKwargs</span><span class="p">(</span><span class="n">gain</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ScaleLinearAlongAxisKwargs</span><span class="p">(</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>                <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">offset</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>            <span class="p">)</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>        <span class="k">return</span> <span class="n">ScaleLinearDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_ScaleMeanVarianceDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>        <span class="k">return</span> <span class="n">ScaleMeanVarianceDescr</span><span class="p">(</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>            <span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleMeanVarianceKwargs</span><span class="p">(</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                <span class="n">axes</span><span class="o">=</span><span class="n">_axes_letters_to_ids</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">),</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>                <span class="n">reference_tensor</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">reference_tensor</span><span class="p">)),</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>                <span class="n">eps</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>            <span class="p">)</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>        <span class="p">)</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_ZeroMeanUnitVarianceDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>            <span class="n">mean</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">mean</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>            <span class="n">std</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">std</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>            <span class="k">assert</span> <span class="n">mean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>            <span class="k">assert</span> <span class="n">std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>            <span class="n">axis</span> <span class="o">=</span> <span class="n">_get_complement_v04_axis</span><span class="p">(</span><span class="n">tensor_axes</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>            <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected single float value for mean, not &lt;list&gt;&quot;</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected single float value for std, not &lt;list&gt;&quot;</span><span class="p">)</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                <span class="k">return</span> <span class="n">FixedZeroMeanUnitVarianceDescr</span><span class="p">(</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                    <span class="n">kwargs</span><span class="o">=</span><span class="n">FixedZeroMeanUnitVarianceKwargs</span><span class="o">.</span><span class="n">model_construct</span><span class="p">(</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                        <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                        <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                    <span class="p">)</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                <span class="p">)</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                    <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">mean</span><span class="p">)]</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>                    <span class="n">std</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">std</span><span class="p">)]</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>                <span class="k">return</span> <span class="n">FixedZeroMeanUnitVarianceDescr</span><span class="p">(</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>                    <span class="n">kwargs</span><span class="o">=</span><span class="n">FixedZeroMeanUnitVarianceAlongAxisKwargs</span><span class="p">(</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>                        <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                    <span class="p">)</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                <span class="p">)</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>            <span class="n">axes</span> <span class="o">=</span> <span class="n">_axes_letters_to_ids</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;per_dataset&quot;</span><span class="p">:</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;batch&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">axes</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                <span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>            <span class="k">return</span> <span class="n">ZeroMeanUnitVarianceDescr</span><span class="p">(</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                <span class="n">kwargs</span><span class="o">=</span><span class="n">ZeroMeanUnitVarianceKwargs</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>            <span class="p">)</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_ScaleRangeDescr_v0_4</span><span class="p">):</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="k">return</span> <span class="n">ScaleRangeDescr</span><span class="p">(</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>            <span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleRangeKwargs</span><span class="p">(</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>                <span class="n">axes</span><span class="o">=</span><span class="n">_axes_letters_to_ids</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">axes</span><span class="p">),</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>                <span class="n">min_percentile</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">min_percentile</span><span class="p">,</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>                <span class="n">max_percentile</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">max_percentile</span><span class="p">,</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>                <span class="n">eps</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>            <span class="p">)</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>        <span class="p">)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>        <span class="n">assert_never</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_InputTensorConv</span><span class="p">(</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>    <span class="n">Converter</span><span class="p">[</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="n">_InputTensorDescr_v0_4</span><span class="p">,</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        <span class="n">InputTensorDescr</span><span class="p">,</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>        <span class="n">FileSource_</span><span class="p">,</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_</span><span class="p">],</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>        <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>    <span class="p">]</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a><span class="p">):</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>        <span class="n">src</span><span class="p">:</span> <span class="n">_InputTensorDescr_v0_4</span><span class="p">,</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>        <span class="n">tgt</span><span class="p">:</span> <span class="s2">&quot;type[InputTensorDescr] | type[dict[str, Any]]&quot;</span><span class="p">,</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>        <span class="n">test_tensor</span><span class="p">:</span> <span class="n">FileSource_</span><span class="p">,</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>        <span class="n">sample_tensor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_</span><span class="p">],</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>        <span class="n">size_refs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;InputTensorDescr | dict[str, Any]&quot;</span><span class="p">:</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>        <span class="n">axes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_axes</span><span class="p">(</span>  <span class="c1"># pyright: ignore[reportAssignmentType]</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>            <span class="n">src</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>            <span class="n">shape</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>            <span class="n">tensor_type</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>            <span class="n">halo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>            <span class="n">size_refs</span><span class="o">=</span><span class="n">size_refs</span><span class="p">,</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>        <span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>        <span class="n">prep</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>            <span class="n">cp</span> <span class="o">=</span> <span class="n">_convert_proc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">ScaleMeanVarianceDescr</span><span class="p">)</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>            <span class="n">prep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>        <span class="n">prep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)))</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>        <span class="k">return</span> <span class="n">tgt</span><span class="p">(</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>            <span class="nb">id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>            <span class="n">test_tensor</span><span class="o">=</span><span class="n">FileDescr</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">test_tensor</span><span class="p">),</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>            <span class="n">sample_tensor</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                <span class="kc">None</span> <span class="k">if</span> <span class="n">sample_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">FileDescr</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sample_tensor</span><span class="p">)</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            <span class="p">),</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>            <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">data_type</span><span class="p">),</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>            <span class="n">preprocessing</span><span class="o">=</span><span class="n">prep</span><span class="p">,</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>        <span class="p">)</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="n">_input_tensor_conv</span> <span class="o">=</span> <span class="n">_InputTensorConv</span><span class="p">(</span><span class="n">_InputTensorDescr_v0_4</span><span class="p">,</span> <span class="n">InputTensorDescr</span><span class="p">)</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a><span class="k">class</span><span class="w"> </span><span class="nc">OutputTensorDescr</span><span class="p">(</span><span class="n">TensorDescrBase</span><span class="p">[</span><span class="n">OutputAxis</span><span class="p">]):</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span> <span class="o">=</span> <span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Output tensor id.</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a><span class="sd">    No duplicates are allowed across all inputs and outputs.&quot;&quot;&quot;</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>    <span class="n">postprocessing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingDescr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingDescr</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>    <span class="p">)</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of how this output should be postprocessed.</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a><span class="sd">    note: `postprocessing` always ends with an &#39;ensure_dtype&#39; operation.</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a><span class="sd">          If not given this is added to cast to this tensor&#39;s `data.type`.</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_postprocessing_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>        <span class="n">axes_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">:</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>            <span class="n">kwargs_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">)</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>            <span class="k">if</span> <span class="n">kwargs_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>                <span class="k">continue</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>                    <span class="sa">f</span><span class="s2">&quot;expected `axes` sequence, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>                <span class="p">)</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_ids</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs_axes</span><span class="p">):</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`kwargs.axes` needs to be subset of axes ids&quot;</span><span class="p">)</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">NominalOrOrdinalDataDescr</span><span class="p">,</span> <span class="n">IntervalOrRatioDataDescr</span><span class="p">)):</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>        <span class="c1"># ensure `postprocessing` ends with `EnsureDtypeDescr` or `BinarizeDescr`</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">EnsureDtypeDescr</span><span class="p">,</span> <span class="n">BinarizeDescr</span><span class="p">)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>        <span class="p">):</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>                <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>            <span class="p">)</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_OutputTensorConv</span><span class="p">(</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>    <span class="n">Converter</span><span class="p">[</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>        <span class="n">_OutputTensorDescr_v0_4</span><span class="p">,</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>        <span class="n">OutputTensorDescr</span><span class="p">,</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>        <span class="n">FileSource_</span><span class="p">,</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_</span><span class="p">],</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>        <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>    <span class="p">]</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a><span class="p">):</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>        <span class="n">src</span><span class="p">:</span> <span class="n">_OutputTensorDescr_v0_4</span><span class="p">,</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>        <span class="n">tgt</span><span class="p">:</span> <span class="s2">&quot;type[OutputTensorDescr] | type[dict[str, Any]]&quot;</span><span class="p">,</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>        <span class="n">test_tensor</span><span class="p">:</span> <span class="n">FileSource_</span><span class="p">,</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>        <span class="n">sample_tensor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_</span><span class="p">],</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>        <span class="n">size_refs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;OutputTensorDescr | dict[str, Any]&quot;</span><span class="p">:</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>        <span class="c1"># TODO: split convert_axes into convert_output_axes and convert_input_axes</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>        <span class="n">axes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputAxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_axes</span><span class="p">(</span>  <span class="c1"># pyright: ignore[reportAssignmentType]</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>            <span class="n">src</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>            <span class="n">shape</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>            <span class="n">tensor_type</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>            <span class="n">halo</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">halo</span><span class="p">,</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>            <span class="n">size_refs</span><span class="o">=</span><span class="n">size_refs</span><span class="p">,</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>        <span class="p">)</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>        <span class="n">data_descr</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">data_type</span><span class="p">)</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>        <span class="k">if</span> <span class="n">data_descr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>            <span class="n">data_descr</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>        <span class="k">return</span> <span class="n">tgt</span><span class="p">(</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>            <span class="nb">id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>            <span class="n">test_tensor</span><span class="o">=</span><span class="n">FileDescr</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">test_tensor</span><span class="p">),</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>            <span class="n">sample_tensor</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>                <span class="kc">None</span> <span class="k">if</span> <span class="n">sample_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">FileDescr</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sample_tensor</span><span class="p">)</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>            <span class="p">),</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">data_descr</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>            <span class="n">postprocessing</span><span class="o">=</span><span class="p">[</span><span class="n">_convert_proc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">],</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>        <span class="p">)</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a><span class="n">_output_tensor_conv</span> <span class="o">=</span> <span class="n">_OutputTensorConv</span><span class="p">(</span><span class="n">_OutputTensorDescr_v0_4</span><span class="p">,</span> <span class="n">OutputTensorDescr</span><span class="p">)</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a><span class="n">TensorDescr</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">,</span> <span class="n">OutputTensorDescr</span><span class="p">]</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_tensors</span><span class="p">(</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>    <span class="n">tensors</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]],</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>    <span class="n">tensor_origin</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>        <span class="s2">&quot;test_tensor&quot;</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>    <span class="p">],</span>  <span class="c1"># for more precise error messages, e.g. &#39;test_tensor&#39;</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a><span class="p">):</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>    <span class="n">all_tensor_axes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">e_msg</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">TensorDescr</span><span class="p">):</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;inputs&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">InputTensorDescr</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;outputs&#39;</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>    <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">tensors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>            <span class="n">axis_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>                <span class="n">axis_sizes</span> <span class="o">=</span> <span class="n">descr</span><span class="o">.</span><span class="n">get_axis_sizes_for_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>        <span class="n">all_tensor_axes</span><span class="p">[</span><span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis_sizes</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>    <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">tensors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>            <span class="k">continue</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>        <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">):</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>            <span class="n">invalid_test_tensor_dtype</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>                <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>                <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>                <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>                <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>                <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>                <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>                <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>                <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>                <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>                <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>            <span class="p">)</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>            <span class="n">invalid_test_tensor_dtype</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">descr</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>        <span class="k">if</span> <span class="n">invalid_test_tensor_dtype</span><span class="p">:</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">.dtype &#39;</span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not&quot;</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; match described dtype &#39;</span><span class="si">{</span><span class="n">descr</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>            <span class="p">)</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1e-4</span> <span class="ow">and</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">:</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>                <span class="s2">&quot;Output values are too small for reliable testing.&quot;</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Values &lt;-1e5 or &gt;=1e5 must be present in </span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>            <span class="p">)</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>            <span class="n">actual_size</span> <span class="o">=</span> <span class="n">all_tensor_axes</span><span class="p">[</span><span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>            <span class="k">if</span> <span class="n">actual_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>                <span class="k">continue</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>                <span class="k">continue</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>                <span class="k">if</span> <span class="n">actual_size</span> <span class="o">!=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">: axis &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;has incompatible size </span><span class="si">{</span><span class="n">actual_size</span><span class="si">}</span><span class="s2">, expected </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>                    <span class="p">)</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">validate_size</span><span class="p">(</span><span class="n">actual_size</span><span class="p">)</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">validate_size</span><span class="p">(</span><span class="n">actual_size</span><span class="p">)</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>                <span class="n">ref_tensor_axes</span> <span class="o">=</span> <span class="n">all_tensor_axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">)</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                <span class="k">if</span> <span class="n">ref_tensor_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size.tensor_id: Unknown tensor&quot;</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; reference &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>                    <span class="p">)</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>                <span class="n">ref_axis</span><span class="p">,</span> <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_tensor_axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>                <span class="k">if</span> <span class="n">ref_axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size.axis_id: Unknown tensor axis&quot;</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; reference &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>                    <span class="p">)</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size: `SizeReference` requires&quot;</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>                        <span class="o">+</span> <span class="s2">&quot; axis and reference axis to have the same `unit`, but&quot;</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>                    <span class="p">)</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>                <span class="k">if</span> <span class="n">actual_size</span> <span class="o">!=</span> <span class="p">(</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>                    <span class="n">expected_size</span> <span class="o">:=</span> <span class="p">(</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>                        <span class="n">ref_size</span> <span class="o">*</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>                    <span class="p">)</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                <span class="p">):</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">: axis &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; of size&quot;</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">actual_size</span><span class="si">}</span><span class="s2"> invalid for referenced size </span><span class="si">{</span><span class="n">ref_size</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; expected </span><span class="si">{</span><span class="n">expected_size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>                    <span class="p">)</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a><span class="n">FileDescr_dependencies</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>    <span class="n">FileDescr_</span><span class="p">,</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>    <span class="n">WithSuffix</span><span class="p">((</span><span class="s2">&quot;.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;.yml&quot;</span><span class="p">),</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>    <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;environment.yaml&quot;</span><span class="p">)]),</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a><span class="p">]</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_ArchitectureCallableDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>    <span class="nb">callable</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MyNetworkClass&quot;</span><span class="p">,</span> <span class="s2">&quot;get_my_model&quot;</span><span class="p">])]</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Identifier of the callable that returns a torch.nn.Module instance.&quot;&quot;&quot;</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">YamlValue</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">YamlValue</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>    <span class="p">)</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for the `callable`&quot;&quot;&quot;</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchitectureFromFileDescr</span><span class="p">(</span><span class="n">_ArchitectureCallableDescr</span><span class="p">,</span> <span class="n">FileDescr</span><span class="p">):</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Architecture source file&quot;&quot;&quot;</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>    <span class="nd">@model_serializer</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">when_used</span><span class="o">=</span><span class="s2">&quot;unless-none&quot;</span><span class="p">)</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">:</span> <span class="n">SerializerFunctionWrapHandler</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">SerializationInfo</span><span class="p">):</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>        <span class="k">return</span> <span class="n">package_file_descr_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchitectureFromLibraryDescr</span><span class="p">(</span><span class="n">_ArchitectureCallableDescr</span><span class="p">):</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>    <span class="n">import_from</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Where to import the callable from, i.e. `from &lt;import_from&gt; import &lt;callable&gt;`&quot;&quot;&quot;</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_ArchFileConv</span><span class="p">(</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>    <span class="n">Converter</span><span class="p">[</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>        <span class="n">_CallableFromFile_v0_4</span><span class="p">,</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>        <span class="n">ArchitectureFromFileDescr</span><span class="p">,</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sha256</span><span class="p">],</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>    <span class="p">]</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a><span class="p">):</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>        <span class="n">src</span><span class="p">:</span> <span class="n">_CallableFromFile_v0_4</span><span class="p">,</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>        <span class="n">tgt</span><span class="p">:</span> <span class="s2">&quot;type[ArchitectureFromFileDescr | dict[str, Any]]&quot;</span><span class="p">,</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>        <span class="n">sha256</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sha256</span><span class="p">],</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ArchitectureFromFileDescr | dict[str, Any]&quot;</span><span class="p">:</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>            <span class="n">http</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">callable_</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>            <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">http</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>            <span class="n">source</span><span class="p">,</span> <span class="n">callable_</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>            <span class="n">source</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>            <span class="n">callable_</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>        <span class="k">return</span> <span class="n">tgt</span><span class="p">(</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>            <span class="nb">callable</span><span class="o">=</span><span class="n">Identifier</span><span class="p">(</span><span class="n">callable_</span><span class="p">),</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">FileSource_</span><span class="p">,</span> <span class="n">source</span><span class="p">),</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>            <span class="n">sha256</span><span class="o">=</span><span class="n">sha256</span><span class="p">,</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>            <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>        <span class="p">)</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a><span class="n">_arch_file_conv</span> <span class="o">=</span> <span class="n">_ArchFileConv</span><span class="p">(</span><span class="n">_CallableFromFile_v0_4</span><span class="p">,</span> <span class="n">ArchitectureFromFileDescr</span><span class="p">)</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_ArchLibConv</span><span class="p">(</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>    <span class="n">Converter</span><span class="p">[</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>        <span class="n">_CallableFromDepencency_v0_4</span><span class="p">,</span> <span class="n">ArchitectureFromLibraryDescr</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>    <span class="p">]</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a><span class="p">):</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>        <span class="n">src</span><span class="p">:</span> <span class="n">_CallableFromDepencency_v0_4</span><span class="p">,</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>        <span class="n">tgt</span><span class="p">:</span> <span class="s2">&quot;type[ArchitectureFromLibraryDescr | dict[str, Any]]&quot;</span><span class="p">,</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ArchitectureFromLibraryDescr | dict[str, Any]&quot;</span><span class="p">:</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>        <span class="o">*</span><span class="n">mods</span><span class="p">,</span> <span class="n">callable_</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>        <span class="n">import_from</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>        <span class="k">return</span> <span class="n">tgt</span><span class="p">(</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">import_from</span><span class="o">=</span><span class="n">import_from</span><span class="p">,</span> <span class="nb">callable</span><span class="o">=</span><span class="n">Identifier</span><span class="p">(</span><span class="n">callable_</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>        <span class="p">)</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a><span class="n">_arch_lib_conv</span> <span class="o">=</span> <span class="n">_ArchLibConv</span><span class="p">(</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>    <span class="n">_CallableFromDepencency_v0_4</span><span class="p">,</span> <span class="n">ArchitectureFromLibraryDescr</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a><span class="p">)</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WeightsEntryDescrBase</span><span class="p">(</span><span class="n">FileDescr</span><span class="p">):</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">]</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># human readable</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source of the weights file.&quot;&quot;&quot;</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>    <span class="n">authors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Authors</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a><span class="sd">    Either the person(s) that have trained this model resulting in the original weights file.</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a><span class="sd">        (If this is the initial weights entry, i.e. it does not have a `parent`)</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a><span class="sd">    Or the person(s) who have converted the weights to this weights format.</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a><span class="sd">        (If this is a child weight, i.e. it has a `parent` field)</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>    <span class="n">parent</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">])</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The source weights these weights were converted from.</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a><span class="sd">    For example, if a model&#39;s weights were converted from the `pytorch_state_dict` format to `torchscript`,</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a><span class="sd">    The `pytorch_state_dict` weights entry has no `parent` and is the parent of the `torchscript` weights.</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a><span class="sd">    All weight entries except one (the initial set of weights resulting from training the model),</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">    need to have this field.&quot;&quot;&quot;</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A comment about this weights entry, for example how these weights were created.&quot;&quot;&quot;</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weights entry can&#39;t be it&#39;s own parent.&quot;</span><span class="p">)</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>    <span class="nd">@model_serializer</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">when_used</span><span class="o">=</span><span class="s2">&quot;unless-none&quot;</span><span class="p">)</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">:</span> <span class="n">SerializerFunctionWrapHandler</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">SerializationInfo</span><span class="p">):</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>        <span class="k">return</span> <span class="n">package_file_descr_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KerasHdf5WeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;keras_hdf5&quot;</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Keras HDF5&quot;</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TensorFlow version used to create these weights.&quot;&quot;&quot;</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a><span class="n">FileDescr_external_data</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>    <span class="n">FileDescr_</span><span class="p">,</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>    <span class="n">WithSuffix</span><span class="p">(</span><span class="s2">&quot;.data&quot;</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>    <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;weights.onnx.data&quot;</span><span class="p">)]),</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a><span class="p">]</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a><span class="k">class</span><span class="w"> </span><span class="nc">OnnxWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;onnx&quot;</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ONNX&quot;</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>    <span class="n">opset_version</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ONNX opset version&quot;&quot;&quot;</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>    <span class="n">external_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_external_data</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source of the external ONNX data file holding the weights.</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a><span class="sd">    (If present **source** holds the ONNX architecture without weights).&quot;&quot;&quot;</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_external_data_unique_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a>            <span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>            <span class="o">==</span> <span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_data</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>        <span class="p">):</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>                <span class="sa">f</span><span class="s2">&quot;ONNX `external_data` file name &#39;</span><span class="si">{</span><span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_data</span><span class="o">.</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>                <span class="o">+</span> <span class="s2">&quot; must be different from ONNX `source` file name.&quot;</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>            <span class="p">)</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PytorchStateDictWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;pytorch_state_dict&quot;</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Pytorch State Dict&quot;</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>    <span class="n">architecture</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ArchitectureFromFileDescr</span><span class="p">,</span> <span class="n">ArchitectureFromLibraryDescr</span><span class="p">]</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>    <span class="n">pytorch_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the PyTorch library used.</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a><span class="sd">    If `architecture.depencencies` is specified it has to include pytorch and any version pinning has to be compatible.</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>    <span class="n">dependencies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_dependencies</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom depencies beyond pytorch described in a Conda environment file.</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a><span class="sd">    Allows to specify custom dependencies, see conda docs:</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a><span class="sd">    - [Exporting an environment file across platforms](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#exporting-an-environment-file-across-platforms)</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a><span class="sd">    - [Creating an environment file manually](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-file-manually)</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a><span class="sd">    The conda environment file should include pytorch and any version pinning has to be compatible with</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a><span class="sd">    **pytorch_version**.</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorflowJsWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;tensorflow_js&quot;</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tensorflow.js&quot;</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the TensorFlow library used.&quot;&quot;&quot;</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The multi-file weights.</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a><span class="sd">    All required files/folders should be a zip archive.&quot;&quot;&quot;</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorflowSavedModelBundleWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tensorflow Saved Model&quot;</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the TensorFlow library used.&quot;&quot;&quot;</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>    <span class="n">dependencies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_dependencies</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom dependencies beyond tensorflow.</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a><span class="sd">    Should include tensorflow and any version pinning has to be compatible with **tensorflow_version**.&quot;&quot;&quot;</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The multi-file weights.</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a><span class="sd">    All required files/folders should be a zip archive.&quot;&quot;&quot;</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TorchscriptWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;torchscript&quot;</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;TorchScript&quot;</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>    <span class="n">pytorch_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the PyTorch library used.&quot;&quot;&quot;</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WeightsDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>    <span class="n">keras_hdf5</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">KerasHdf5WeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>    <span class="n">onnx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OnnxWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>    <span class="n">pytorch_state_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PytorchStateDictWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>    <span class="n">tensorflow_js</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorflowJsWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>    <span class="n">tensorflow_saved_model_bundle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorflowSavedModelBundleWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>        <span class="kc">None</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>    <span class="p">)</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>    <span class="n">torchscript</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TorchscriptWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="p">{</span><span class="n">wtype</span> <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing weights entry&quot;</span><span class="p">)</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>        <span class="n">entries_wo_parent</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>            <span class="n">wtype</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>            <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>        <span class="p">}</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>                <span class="s2">&quot;Exactly one weights entry may not specify the `parent` field (got&quot;</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>                <span class="o">+</span> <span class="s2">&quot; </span><span class="si">{value}</span><span class="s2">). That entry is considered the original set of model weights.&quot;</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>                <span class="o">+</span> <span class="s2">&quot; Other weight formats are created through conversion of the orignal or&quot;</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>                <span class="o">+</span> <span class="s2">&quot; already converted weights. They have to reference the weights format&quot;</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>                <span class="o">+</span> <span class="s2">&quot; they were converted from as their `parent`.&quot;</span><span class="p">,</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>                <span class="n">value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">),</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;weights&quot;</span><span class="p">,</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>            <span class="p">)</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>        <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>                <span class="k">continue</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>            <span class="k">assert</span> <span class="n">wtype</span> <span class="o">==</span> <span class="n">entry</span><span class="o">.</span><span class="n">type</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entries</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>            <span class="p">):</span>  <span class="c1"># self reference checked for `parent` field</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>                    <span class="sa">f</span><span class="s2">&quot;`weights.</span><span class="si">{</span><span class="n">wtype</span><span class="si">}</span><span class="s2">.parent=</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2"> not in specified weight&quot;</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; formats: </span><span class="si">{</span><span class="n">entries</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>                <span class="p">)</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>            <span class="s2">&quot;keras_hdf5&quot;</span><span class="p">,</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>            <span class="s2">&quot;onnx&quot;</span><span class="p">,</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>            <span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">,</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>            <span class="s2">&quot;tensorflow_js&quot;</span><span class="p">,</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>            <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">,</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>            <span class="s2">&quot;torchscript&quot;</span><span class="p">,</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>        <span class="p">],</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>    <span class="p">):</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;keras_hdf5&quot;</span><span class="p">:</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;onnx&quot;</span><span class="p">:</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">:</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;tensorflow_js&quot;</span><span class="p">:</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">:</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;torchscript&quot;</span><span class="p">:</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>    <span class="nd">@property</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;keras_hdf5&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span><span class="p">}),</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;onnx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span><span class="p">}),</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>                <span class="p">{}</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span><span class="p">}</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>            <span class="p">),</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>                <span class="p">{}</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;tensorflow_js&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span><span class="p">}</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>            <span class="p">),</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>                <span class="p">{}</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>                <span class="k">else</span> <span class="p">{</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>                    <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>                <span class="p">}</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>            <span class="p">),</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;torchscript&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span><span class="p">}),</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>        <span class="p">}</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>    <span class="nd">@property</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">missing_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>            <span class="n">wf</span> <span class="k">for</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">WeightsFormat</span><span class="p">)</span> <span class="k">if</span> <span class="n">wf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_formats</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>        <span class="p">}</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelId</span><span class="p">(</span><span class="n">ResourceId</span><span class="p">):</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>    <span class="k">pass</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LinkedModel</span><span class="p">(</span><span class="n">LinkedResourceBase</span><span class="p">):</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reference to a bioimage.io model.&quot;&quot;&quot;</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">ModelId</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A valid model `id` from the bioimage.io collection.&quot;&quot;&quot;</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_DataDepSize</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>    <span class="nb">min</span><span class="p">:</span> <span class="n">StrictInt</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>    <span class="nb">max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrictInt</span><span class="p">]</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_AxisSizes</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;the lenghts of all axes of model inputs and outputs&quot;&quot;&quot;</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_TensorSizes</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;_AxisSizes as nested dicts&quot;&quot;&quot;</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]]</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReproducibilityTolerance</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes what small numerical differences -- if any -- may be tolerated</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a><span class="sd">    in the generated output when executing in different environments.</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a><span class="sd">    A tensor element *output* is considered mismatched to the **test_tensor** if</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a><span class="sd">    abs(*output* - **test_tensor**) &gt; **absolute_tolerance** + **relative_tolerance** * abs(**test_tensor**).</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a><span class="sd">    (Internally we call [numpy.testing.assert_allclose](https://numpy.org/doc/stable/reference/generated/numpy.testing.assert_allclose.html).)</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a><span class="sd">    Motivation:</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a><span class="sd">        For testing we can request the respective deep learning frameworks to be as</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a><span class="sd">        reproducible as possible by setting seeds and chosing deterministic algorithms,</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a><span class="sd">        but differences in operating systems, available hardware and installed drivers</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a><span class="sd">        may still lead to numerical differences.</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>    <span class="n">relative_tolerance</span><span class="p">:</span> <span class="n">RelativeTolerance</span> <span class="o">=</span> <span class="mf">1e-3</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum relative tolerance of reproduced test tensor.&quot;&quot;&quot;</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>    <span class="n">absolute_tolerance</span><span class="p">:</span> <span class="n">AbsoluteTolerance</span> <span class="o">=</span> <span class="mf">1e-4</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum absolute tolerance of reproduced test tensor.&quot;&quot;&quot;</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>    <span class="n">mismatched_elements_per_million</span><span class="p">:</span> <span class="n">MismatchedElementsPerMillion</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of mismatched elements/pixels per million to tolerate.&quot;&quot;&quot;</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>    <span class="n">output_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Limits the output tensor IDs these reproducibility details apply to.&quot;&quot;&quot;</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>    <span class="n">weights_formats</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Limits the weights formats these details apply to.&quot;&quot;&quot;</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BioimageioConfig</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>    <span class="n">reproducibility_tolerance</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ReproducibilityTolerance</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tolerances to allow when reproducing the model&#39;s test outputs</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a><span class="sd">    from the model&#39;s test inputs.</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a><span class="sd">    Only the first entry matching tensor id and weights format is considered.</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>    <span class="n">bioimageio</span><span class="p">:</span> <span class="n">BioimageioConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">BioimageioConfig</span><span class="o">.</span><span class="n">model_construct</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>    <span class="p">)</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelDescr</span><span class="p">(</span><span class="n">GenericModelDescrBase</span><span class="p">):</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Specification of the fields used in a bioimage.io-compliant RDF to describe AI models with pretrained weights.</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a><span class="sd">    These fields are typically stored in a YAML file which we call a model resource description file (model RDF).</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>    <span class="n">implemented_format_version</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;0.5.6&quot;</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>        <span class="n">format_version</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0.5.6&quot;</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>        <span class="n">format_version</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of the bioimage.io model description specification used.</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a><span class="sd">        When creating a new model always use the latest micro/patch version described here.</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a><span class="sd">        The `format_version` is important for any consumer software to understand how to parse the fields.</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Specialized resource type &#39;model&#39;&quot;&quot;&quot;</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;bioimage.io-wide unique resource identifier</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a><span class="sd">    assigned by bioimage.io; version **un**specific.&quot;&quot;&quot;</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>    <span class="n">authors</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>    <span class="p">)</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The authors are the creators of the model RDF and the primary points of contact.&quot;&quot;&quot;</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>    <span class="n">documentation</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;URL or relative path to a markdown file with additional documentation.</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="sd">    The recommended documentation file name is `README.md`. An `.md` suffix is mandatory.</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a><span class="sd">    The documentation should include a &#39;#[#] Validation&#39; (sub)section</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a><span class="sd">    with details on how to quantitatively validate the model on unseen data.&quot;&quot;&quot;</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;documentation&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_documentation</span><span class="p">(</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]:</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>        <span class="n">doc_reader</span> <span class="o">=</span> <span class="n">get_reader</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>        <span class="n">doc_content</span> <span class="o">=</span> <span class="n">doc_reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;#.*[vV]alidation&quot;</span><span class="p">,</span> <span class="n">doc_content</span><span class="p">):</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>                <span class="s2">&quot;No &#39;# Validation&#39; (sub)section found in </span><span class="si">{value}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;documentation&quot;</span><span class="p">,</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>            <span class="p">)</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]]</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes the input tensors expected by this model.&quot;&quot;&quot;</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_input_axes</span><span class="p">(</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]:</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>        <span class="n">input_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ipt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>            <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>                <span class="o">**</span><span class="p">{</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>                    <span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ipt</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>                <span class="p">},</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>                <span class="o">**</span><span class="n">input_size_refs</span><span class="p">,</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>            <span class="p">}</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_axis</span><span class="p">(</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>                    <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">ipt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>                    <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>                    <span class="n">valid_independent_refs</span><span class="o">=</span><span class="n">valid_independent_refs</span><span class="p">,</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>                <span class="p">)</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>        <span class="k">return</span> <span class="n">inputs</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_axis</span><span class="p">(</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>        <span class="n">tensor_id</span><span class="p">:</span> <span class="n">TensorId</span><span class="p">,</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>        <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">AnyAxis</span><span class="p">,</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>        <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>            <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>            <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>        <span class="p">],</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>    <span class="p">):</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>            <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">)</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>        <span class="p">):</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>            <span class="k">return</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>            <span class="n">assert_never</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>        <span class="c1"># validate axis.size SizeReference</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">)</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>        <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_independent_refs</span><span class="p">:</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>                <span class="s2">&quot;Invalid tensor axis reference at&quot;</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">].axes[</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">].size: </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>            <span class="p">)</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>        <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="p">(</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>                <span class="s2">&quot;Self-referencing not allowed for&quot;</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">].axes[</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">].size: </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>            <span class="p">)</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>        <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>            <span class="k">if</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>                    <span class="s2">&quot;A channel axis&#39; size may only reference another fixed size&quot;</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>                    <span class="o">+</span> <span class="s2">&quot; channel axis.&quot;</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>                <span class="p">)</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="si">{i}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="p">:</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>                    <span class="s2">&quot;channel axis ref (another channel axis) has to specify fixed&quot;</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>                    <span class="o">+</span> <span class="s2">&quot; size&quot;</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>                <span class="p">)</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>                <span class="n">generated_channel_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>                    <span class="n">Identifier</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ref_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>                <span class="p">]</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>                <span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span> <span class="o">=</span> <span class="n">generated_channel_names</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ax_unit</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>            <span class="n">ref_unit</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>        <span class="p">):</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                <span class="s2">&quot;The units of an axis and its reference axis need to match, but&quot;</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">ax_unit</span><span class="si">}</span><span class="s2">&#39; != &#39;</span><span class="si">{</span><span class="n">ref_unit</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>            <span class="p">)</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid reference axis &#39;</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>                <span class="o">+</span> <span class="s2">&quot; (a batch axis is not allowed as reference).&quot;</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>            <span class="p">)</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>            <span class="n">min_size</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">min_size</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>                    <span class="sa">f</span><span class="s2">&quot;axis </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> with minimum size </span><span class="si">{</span><span class="n">min_size</span><span class="si">}</span><span class="s2"> is too small for halo&quot;</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>                <span class="p">)</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>            <span class="n">input_halo</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">halo</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>            <span class="k">if</span> <span class="n">input_halo</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_halo</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_halo</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>                    <span class="sa">f</span><span class="s2">&quot;input_halo </span><span class="si">{</span><span class="n">input_halo</span><span class="si">}</span><span class="s2"> (output_halo </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="si">}</span><span class="s2"> *&quot;</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; output_scale </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2"> / input_scale </span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>                <span class="p">)</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_test_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span><span class="p">:</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>        <span class="n">test_output_arrays</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>            <span class="kc">None</span> <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">load_array</span><span class="p">(</span><span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>            <span class="k">for</span> <span class="n">descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>        <span class="p">]</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>        <span class="n">test_input_arrays</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>            <span class="kc">None</span> <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">load_array</span><span class="p">(</span><span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>            <span class="k">for</span> <span class="n">descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>        <span class="p">]</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a>        <span class="n">tensors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>            <span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>            <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>                <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">),</span> <span class="n">test_input_arrays</span> <span class="o">+</span> <span class="n">test_output_arrays</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>            <span class="p">)</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>        <span class="p">}</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>        <span class="n">validate_tensors</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">tensor_origin</span><span class="o">=</span><span class="s2">&quot;test_tensor&quot;</span><span class="p">)</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>            <span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">array</span> <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="n">test_output_arrays</span><span class="p">)</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>        <span class="p">}</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>        <span class="k">for</span> <span class="n">rep_tol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bioimageio</span><span class="o">.</span><span class="n">reproducibility_tolerance</span><span class="p">:</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span><span class="p">:</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>                <span class="k">continue</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>            <span class="k">if</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">output_ids</span><span class="p">:</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>                <span class="n">out_arrays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>                    <span class="n">oid</span><span class="p">:</span> <span class="n">a</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>                    <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">output_arrays</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>                    <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">output_ids</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>                <span class="p">}</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>                <span class="n">out_arrays</span> <span class="o">=</span> <span class="n">output_arrays</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>            <span class="k">for</span> <span class="n">out_id</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">out_arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>                <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>                    <span class="k">continue</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>                <span class="k">if</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">max_test_value</span> <span class="o">:=</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">:</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>                        <span class="s2">&quot;config.bioimageio.reproducibility_tolerance.absolute_tolerance=&quot;</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span><span class="si">}</span><span class="s2"> &gt; 0.01*</span><span class="si">{</span><span class="n">max_test_value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (1% of the maximum value of the test tensor &#39;</span><span class="si">{</span><span class="n">out_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>                    <span class="p">)</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tensor_references_in_proc_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>        <span class="n">ipt_refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>        <span class="n">out_refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>        <span class="k">for</span> <span class="n">ipt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ipt</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>                <span class="n">ref</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference_tensor&quot;</span><span class="p">)</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>                    <span class="k">continue</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ipt_refs</span><span class="p">:</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>                        <span class="sa">f</span><span class="s2">&quot;`reference_tensor` &#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s2">&#39; not found. Valid input tensor&quot;</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; references are: </span><span class="si">{</span><span class="n">ipt_refs</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>                    <span class="p">)</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">:</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>                <span class="n">ref</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference_tensor&quot;</span><span class="p">)</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>                    <span class="k">continue</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ipt_refs</span> <span class="ow">and</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out_refs</span><span class="p">:</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>                        <span class="sa">f</span><span class="s2">&quot;`reference_tensor` &#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s2">&#39; not found. Valid tensor references&quot;</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; are: </span><span class="si">{</span><span class="n">ipt_refs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">out_refs</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>                    <span class="p">)</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>    <span class="c1"># TODO: use validate funcs in validate_test_tensors</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>    <span class="c1"># def validate_inputs(self, input_tensors: Mapping[TensorId, NDArray[Any]]) -&gt; Mapping[TensorId, NDArray[Any]]:</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>        <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>        <span class="n">RestrictCharacters</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&quot;_+- ()&quot;</span><span class="p">),</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>        <span class="n">MinLen</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>        <span class="n">warn</span><span class="p">(</span><span class="n">MaxLen</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="s2">&quot;Name longer than 64 characters.&quot;</span><span class="p">,</span> <span class="n">INFO</span><span class="p">),</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>    <span class="p">]</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A human-readable name of this model.</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a><span class="sd">    It should be no longer than 64 characters</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a><span class="sd">    and may only contain letter, number, underscore, minus, parentheses and spaces.</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a><span class="sd">    We recommend to chose a name that refers to the model&#39;s task and image modality.</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]]</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes the output tensors.&quot;&quot;&quot;</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tensor_ids</span><span class="p">(</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">],</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]:</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>        <span class="n">tensor_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>            <span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a>        <span class="p">]</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>        <span class="n">duplicate_tensor_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tensor_ids</span><span class="p">:</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>                <span class="n">duplicate_tensor_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>        <span class="k">if</span> <span class="n">duplicate_tensor_ids</span><span class="p">:</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate tensor ids: </span><span class="si">{</span><span class="n">duplicate_tensor_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>        <span class="k">return</span> <span class="n">outputs</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_axes_with_parameterized_size</span><span class="p">(</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>        <span class="n">io</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>    <span class="p">):</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">io</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>        <span class="p">}</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_axes_with_independent_size</span><span class="p">(</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>        <span class="n">io</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>    <span class="p">):</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>            <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">io</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>        <span class="p">}</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_output_axes</span><span class="p">(</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">],</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]:</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>        <span class="n">input_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>            <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>        <span class="p">)</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>        <span class="n">output_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>            <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>                <span class="o">**</span><span class="p">{</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>                    <span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">axes</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>                <span class="p">},</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>                <span class="o">**</span><span class="n">input_size_refs</span><span class="p">,</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>                <span class="o">**</span><span class="n">output_size_refs</span><span class="p">,</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>            <span class="p">}</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_axis</span><span class="p">(</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>                    <span class="s2">&quot;outputs&quot;</span><span class="p">,</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>                    <span class="n">out</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>                    <span class="n">a</span><span class="p">,</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a>                    <span class="n">ax</span><span class="p">,</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>                    <span class="n">valid_independent_refs</span><span class="o">=</span><span class="n">valid_independent_refs</span><span class="p">,</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>                <span class="p">)</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>        <span class="k">return</span> <span class="n">outputs</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>    <span class="n">packaged_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>    <span class="p">)</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The persons that have packaged and uploaded this model.</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a><span class="sd">    Only required if those persons differ from the `authors`.&quot;&quot;&quot;</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LinkedModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The model from which this model is derived, e.g. by fine-tuning the weights.&quot;&quot;&quot;</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_parent_is_not_self</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A model description may not reference itself as parent.&quot;</span><span class="p">)</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>    <span class="n">run_mode</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">RunMode</span><span class="p">],</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>        <span class="n">warn</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Run mode &#39;</span><span class="si">{value}</span><span class="s2">&#39; has limited support across consumer softwares.&quot;</span><span class="p">),</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom run mode for this model: for more complex prediction procedures like test time</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a><span class="sd">    data augmentation that currently cannot be expressed in the specification.</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a><span class="sd">    No standard run modes are defined yet.&quot;&quot;&quot;</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Timestamp in [ISO 8601](#https://en.wikipedia.org/wiki/ISO_8601) format</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a><span class="sd">    with a few restrictions listed [here](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat).</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a><span class="sd">    (In Python a datetime object is valid, too).&quot;&quot;&quot;</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>    <span class="n">training_data</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>        <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">LinkedDataset</span><span class="p">,</span> <span class="n">DatasetDescr</span><span class="p">,</span> <span class="n">DatasetDescr02</span><span class="p">],</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>        <span class="n">Field</span><span class="p">(</span><span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span><span class="p">),</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dataset used to train this model&quot;&quot;&quot;</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>    <span class="n">weights</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">WeightsDescr</span><span class="p">,</span> <span class="n">WrapSerializer</span><span class="p">(</span><span class="n">package_weights</span><span class="p">)]</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The weights for this model.</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a><span class="sd">    Weights can be given for different formats, but should otherwise be equivalent.</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a><span class="sd">    The available weight formats determine which consumers can use this model.&quot;&quot;&quot;</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>    <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Config</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_default_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="p">:</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a>            <span class="n">generated_covers</span> <span class="o">=</span> <span class="n">generate_covers</span><span class="p">(</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>                <span class="p">[</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a>                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">))</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a>                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a>                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a>                <span class="p">],</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a>                <span class="p">[</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">))</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a>                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>                <span class="p">],</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>            <span class="p">)</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>                <span class="s2">&quot;Failed to generate cover image(s): </span><span class="si">{e}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>                <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>                <span class="n">msg_context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;covers&quot;</span><span class="p">,</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>            <span class="p">)</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">generated_covers</span><span class="p">)</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_test_arrays</span><span class="p">(</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>        <span class="n">io_descr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>    <span class="p">):</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>        <span class="n">ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDescr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">io_descr</span><span class="p">:</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to get test arrays: description of &#39;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; is missing a `test_tensor`.&quot;</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>                <span class="p">)</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>            <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">]</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_batch_size</span><span class="p">(</span><span class="n">tensor_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>        <span class="n">tensor_with_batchsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">:</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a>                <span class="k">if</span> <span class="n">aid</span> <span class="o">!=</span> <span class="n">BATCH_AXIS_ID</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="n">batch_size</span><span class="p">:</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>                    <span class="k">continue</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>                <span class="k">if</span> <span class="n">batch_size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>                    <span class="k">assert</span> <span class="n">tensor_with_batchsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>                        <span class="sa">f</span><span class="s2">&quot;batch size mismatch for tensors &#39;</span><span class="si">{</span><span class="n">tensor_with_batchsize</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">) and &#39;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>                    <span class="p">)</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>                <span class="n">tensor_with_batchsize</span> <span class="o">=</span> <span class="n">tid</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>        <span class="k">return</span> <span class="n">batch_size</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_tensor_sizes</span><span class="p">(</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]]:</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the tensor output sizes for given **input_sizes**.</span>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a><span class="sd">        Only if **input_sizes** has a valid input shape, the tensor output size is exact.</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a><span class="sd">        Otherwise it might be larger than the actual (valid) output&quot;&quot;&quot;</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_batch_size</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>        <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>        <span class="n">tensor_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tensor_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>        <span class="k">return</span> <span class="n">tensor_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;get parameter `n` for each parameterized axis</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a><span class="sd">        such that the valid input size is &gt;= the given input size&quot;&quot;&quot;</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>        <span class="n">ret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">:</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>                <span class="n">size_descr</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">tid</span><span class="p">][</span><span class="n">aid</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>                    <span class="n">ret</span><span class="p">[(</span><span class="n">tid</span><span class="p">,</span> <span class="n">aid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">size_descr</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>                <span class="k">elif</span> <span class="n">size_descr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">)):</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>                    <span class="k">pass</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>                    <span class="n">assert_never</span><span class="p">(</span><span class="n">size_descr</span><span class="p">)</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tensor_sizes</span><span class="p">(</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorSizes</span><span class="p">:</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>        <span class="n">axis_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>        <span class="k">return</span> <span class="n">_TensorSizes</span><span class="p">(</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>            <span class="p">{</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>                <span class="p">}</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>            <span class="p">},</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>            <span class="p">{</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>                <span class="p">}</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>            <span class="p">},</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>        <span class="p">)</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes</span><span class="p">(</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>        <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>        <span class="n">max_input_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_AxisSizes</span><span class="p">:</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine input and output block shape for scale factors **ns**</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a><span class="sd">        of parameterized input sizes.</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a><span class="sd">        Args:</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a><span class="sd">            ns: Scale factor `n` for each axis (keyed by (tensor_id, axis_id))</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a><span class="sd">                that is parameterized as `size = min + n * step`.</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a><span class="sd">            batch_size: The desired size of the batch dimension.</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a><span class="sd">                If given **batch_size** overwrites any batch size present in</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a><span class="sd">                **max_input_shape**. Default 1.</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a><span class="sd">            max_input_shape: Limits the derived block shapes.</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a><span class="sd">                Each axis for which the input size, parameterized by `n`, is larger</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a><span class="sd">                than **max_input_shape** is set to the minimal value `n_min` for which</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a><span class="sd">                this is still true.</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a><span class="sd">                Use this for small input samples or large values of **ns**.</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a><span class="sd">                Or simply whenever you know the full input shape.</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a><span class="sd">        Returns:</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a><span class="sd">            Resolved axis sizes for model inputs and outputs.</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>        <span class="n">max_input_shape</span> <span class="o">=</span> <span class="n">max_input_shape</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">_t_id</span><span class="p">,</span> <span class="n">a_id</span><span class="p">),</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>                <span class="k">if</span> <span class="n">a_id</span> <span class="o">==</span> <span class="n">BATCH_AXIS_ID</span><span class="p">:</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>                    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>                    <span class="k">break</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>        <span class="n">all_axes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>            <span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>        <span class="p">}</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>        <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">,</span> <span class="n">OutputAxis</span><span class="p">]):</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for batch axis&quot;</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>                    <span class="p">)</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>                <span class="k">return</span> <span class="n">batch_size</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for fixed size&quot;</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>                        <span class="o">+</span> <span class="s2">&quot; axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>                    <span class="p">)</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>                        <span class="s2">&quot;Size increment factor (n) missing for parametrized axis&quot;</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>                    <span class="p">)</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>                <span class="n">s_max</span> <span class="o">=</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>                <span class="k">if</span> <span class="n">s_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s_max</span><span class="p">))</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for axis &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39; with size reference.&quot;</span><span class="p">,</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>                    <span class="p">)</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>                <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">all_axes</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">]</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>                <span class="n">ref_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">)</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">,</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">))</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>                <span class="k">assert</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ref_key</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_size</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">),</span> <span class="n">ref_key</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>                    <span class="n">ref_axis</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">,</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>                    <span class="n">ref_size</span><span class="o">=</span><span class="n">ref_size</span><span class="p">,</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>                <span class="p">)</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>                        <span class="s2">&quot;Ignoring unexpected increment factor (n) for data dependent&quot;</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>                        <span class="o">+</span> <span class="s2">&quot; size axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>                    <span class="p">)</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>                <span class="k">return</span> <span class="n">_DataDepSize</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>        <span class="c1"># first resolve all , but the `SizeReference` input sizes</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>        <span class="c1"># resolve all other input axis sizes</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>        <span class="c1"># resolve all output axis sizes</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>        <span class="k">return</span> <span class="n">_AxisSizes</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">convert_from_old_format_wo_validation</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_from_old_format_wo_validation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert metadata following an older format version to this classes&#39; format</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a><span class="sd">        without validating the result.</span>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fv</span> <span class="o">:=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format_version&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>            <span class="ow">and</span> <span class="n">fv</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a>        <span class="p">):</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a>            <span class="n">fv_parts</span> <span class="o">=</span> <span class="n">fv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fv_parts</span><span class="p">):</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a>                <span class="k">return</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>            <span class="n">fv_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">fv_parts</span><span class="p">))</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>            <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>            <span class="k">if</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a>                <span class="n">m04</span> <span class="o">=</span> <span class="n">_ModelDescr_v0_4</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m04</span><span class="p">,</span> <span class="n">InvalidDescr</span><span class="p">):</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a>                            <span class="n">m04</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a>                        <span class="p">)</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a>                            <span class="s2">&quot;Failed to convert from invalid model 0.4 description.&quot;</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceeding with model 0.5 validation without conversion.&quot;</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>                        <span class="p">)</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>                    <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">m04</span><span class="p">)</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>                <span class="k">if</span> <span class="n">updated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>            <span class="k">elif</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>                <span class="c1"># bump patch version</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;format_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_ModelConv</span><span class="p">(</span><span class="n">Converter</span><span class="p">[</span><span class="n">_ModelDescr_v0_4</span><span class="p">,</span> <span class="n">ModelDescr</span><span class="p">]):</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">_ModelDescr_v0_4</span><span class="p">,</span> <span class="n">tgt</span><span class="p">:</span> <span class="s2">&quot;type[ModelDescr] | type[dict[str, Any]]&quot;</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ModelDescr | dict[str, Any]&quot;</span><span class="p">:</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>            <span class="n">c</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&quot;_+- ()&quot;</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>        <span class="p">)</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">conv_authors</span><span class="p">(</span><span class="n">auths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">_Author_v0_4</span><span class="p">]]):</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>            <span class="n">conv</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>                <span class="n">_author_conv</span><span class="o">.</span><span class="n">convert</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="n">_author_conv</span><span class="o">.</span><span class="n">convert_as_dict</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>            <span class="p">)</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>            <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">auths</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">conv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">auths</span><span class="p">]</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>        <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>            <span class="n">arch_file_conv</span> <span class="o">=</span> <span class="n">_arch_file_conv</span><span class="o">.</span><span class="n">convert</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>            <span class="n">arch_lib_conv</span> <span class="o">=</span> <span class="n">_arch_lib_conv</span><span class="o">.</span><span class="n">convert</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>            <span class="n">arch_file_conv</span> <span class="o">=</span> <span class="n">_arch_file_conv</span><span class="o">.</span><span class="n">convert_as_dict</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>            <span class="n">arch_lib_conv</span> <span class="o">=</span> <span class="n">_arch_lib_conv</span><span class="o">.</span><span class="n">convert_as_dict</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>        <span class="n">input_size_refs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>            <span class="n">ipt</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>                <span class="n">a</span><span class="p">:</span> <span class="n">s</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>                <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>                    <span class="n">ipt</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>                    <span class="p">(</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>                        <span class="n">ipt</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ParameterizedInputShape_v0_4</span><span class="p">)</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>                        <span class="k">else</span> <span class="n">ipt</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>                    <span class="p">),</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>                <span class="p">)</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>            <span class="p">}</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>            <span class="k">for</span> <span class="n">ipt</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>            <span class="k">if</span> <span class="n">ipt</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>        <span class="p">}</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>        <span class="n">output_size_refs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>            <span class="o">**</span><span class="p">{</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>                <span class="n">out</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)}</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>                <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ImplicitOutputShape_v0_4</span><span class="p">)</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>            <span class="p">},</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>            <span class="o">**</span><span class="n">input_size_refs</span><span class="p">,</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>        <span class="p">}</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a>        <span class="k">return</span> <span class="n">tgt</span><span class="p">(</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a>            <span class="n">attachments</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>                <span class="p">[]</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">attachments</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>                <span class="k">else</span> <span class="p">[</span><span class="n">FileDescr</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">files</span><span class="p">]</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>            <span class="p">),</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>            <span class="n">authors</span><span class="o">=</span><span class="p">[</span><span class="n">_author_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">authors</span><span class="p">],</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>            <span class="n">cite</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">doi</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">url</span><span class="p">}</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">cite</span><span class="p">],</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>            <span class="n">covers</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>            <span class="n">description</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>            <span class="n">documentation</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">documentation</span><span class="p">,</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>            <span class="n">format_version</span><span class="o">=</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">,</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a>            <span class="n">git_repo</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">git_repo</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a>            <span class="n">icon</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">icon</span><span class="p">,</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>            <span class="nb">id</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ModelId</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a>            <span class="n">id_emoji</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">id_emoji</span><span class="p">,</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a>            <span class="n">license</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">license</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a>            <span class="n">links</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">links</span><span class="p">,</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a>            <span class="n">maintainers</span><span class="o">=</span><span class="p">[</span><span class="n">_maintainer_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">maintainers</span><span class="p">],</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>            <span class="n">tags</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>            <span class="n">uploader</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">uploader</span><span class="p">,</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>            <span class="n">version</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>                <span class="n">_input_tensor_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">input_size_refs</span><span class="p">)</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>                <span class="k">for</span> <span class="n">ipt</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">test_inputs</span><span class="p">,</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">sample_inputs</span> <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">test_inputs</span><span class="p">),</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>                <span class="p">)</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>            <span class="p">],</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>                <span class="n">_output_tensor_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">output_size_refs</span><span class="p">)</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>                <span class="k">for</span> <span class="n">out</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">test_outputs</span><span class="p">,</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">sample_outputs</span> <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">test_outputs</span><span class="p">),</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>                <span class="p">)</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>            <span class="p">],</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>            <span class="n">parent</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>                <span class="kc">None</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>                <span class="k">else</span> <span class="n">LinkedModel</span><span class="p">(</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">ModelId</span><span class="p">(</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>                        <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>                        <span class="o">+</span> <span class="p">(</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>                            <span class="s2">&quot;&quot;</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>                            <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">version_number</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>                            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">version_number</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>                        <span class="p">)</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>                    <span class="p">)</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>                <span class="p">)</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>            <span class="p">),</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>            <span class="n">training_data</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>                <span class="kc">None</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">training_data</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>                <span class="k">else</span> <span class="p">(</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>                    <span class="n">LinkedDataset</span><span class="p">(</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>                        <span class="nb">id</span><span class="o">=</span><span class="n">DatasetId</span><span class="p">(</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>                            <span class="o">+</span> <span class="p">(</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>                                <span class="s2">&quot;&quot;</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>                                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">version_number</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>                                <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">training_data</span><span class="o">.</span><span class="n">version_number</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>                            <span class="p">)</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>                        <span class="p">)</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>                    <span class="p">)</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">training_data</span><span class="p">,</span> <span class="n">LinkedDataset02</span><span class="p">)</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>                    <span class="k">else</span> <span class="n">src</span><span class="o">.</span><span class="n">training_data</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>                <span class="p">)</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>            <span class="p">),</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>            <span class="n">packaged_by</span><span class="o">=</span><span class="p">[</span><span class="n">_author_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">packaged_by</span><span class="p">],</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>            <span class="n">run_mode</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">run_mode</span><span class="p">,</span>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>            <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="n">WeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>                <span class="n">keras_hdf5</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">keras_hdf5</span><span class="p">)</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">KerasHdf5WeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a>                    <span class="n">tensorflow_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">tensorflow_version</span> <span class="ow">or</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;1.15&quot;</span><span class="p">),</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a>                <span class="p">),</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a>                <span class="n">onnx</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">onnx</span><span class="p">)</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">OnnxWeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>                    <span class="n">opset_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">opset_version</span> <span class="ow">or</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>                <span class="p">),</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>                <span class="n">pytorch_state_dict</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">pytorch_state_dict</span><span class="p">)</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">PytorchStateDictWeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>                    <span class="n">architecture</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>                        <span class="n">arch_file_conv</span><span class="p">(</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>                            <span class="n">w</span><span class="o">.</span><span class="n">architecture</span><span class="p">,</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>                            <span class="n">w</span><span class="o">.</span><span class="n">architecture_sha256</span><span class="p">,</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>                            <span class="n">w</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>                        <span class="p">)</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">architecture</span><span class="p">,</span> <span class="n">_CallableFromFile_v0_4</span><span class="p">)</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>                        <span class="k">else</span> <span class="n">arch_lib_conv</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">architecture</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>                    <span class="p">),</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a>                    <span class="n">pytorch_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">pytorch_version</span> <span class="ow">or</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;1.10&quot;</span><span class="p">),</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a>                    <span class="n">dependencies</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>                        <span class="kc">None</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a>                        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">dependencies</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>                        <span class="k">else</span> <span class="p">(</span><span class="n">FileDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>                            <span class="n">source</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>                                <span class="n">FileSource</span><span class="p">,</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>                                <span class="nb">str</span><span class="p">(</span><span class="n">deps</span> <span class="o">:=</span> <span class="n">w</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)[</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>                                    <span class="p">(</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>                                        <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;conda:&quot;</span><span class="p">)</span>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>                                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;conda:&quot;</span><span class="p">)</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>                                        <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>                                    <span class="p">)</span> <span class="p">:</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>                                <span class="p">],</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>                            <span class="p">)</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>                        <span class="p">)</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>                    <span class="p">),</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>                <span class="p">),</span>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a>                <span class="n">tensorflow_js</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">tensorflow_js</span><span class="p">)</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">TensorflowJsWeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>                    <span class="n">tensorflow_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">tensorflow_version</span> <span class="ow">or</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;1.15&quot;</span><span class="p">),</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>                <span class="p">),</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>                <span class="n">tensorflow_saved_model_bundle</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>                    <span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>                <span class="p">)</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">TensorflowSavedModelBundleWeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>                    <span class="n">tensorflow_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">tensorflow_version</span> <span class="ow">or</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;1.15&quot;</span><span class="p">),</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a>                    <span class="n">dependencies</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>                        <span class="kc">None</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a>                        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">dependencies</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>                        <span class="k">else</span> <span class="p">(</span><span class="n">FileDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>                            <span class="n">source</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>                                <span class="n">FileSource</span><span class="p">,</span>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>                                <span class="p">(</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>                                    <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;conda:&quot;</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a>                                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;conda:&quot;</span><span class="p">)</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a>                                    <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>                                <span class="p">),</span>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>                            <span class="p">)</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a>                        <span class="p">)</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>                    <span class="p">),</span>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a>                <span class="p">),</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a>                <span class="n">torchscript</span><span class="o">=</span><span class="p">(</span><span class="n">w</span> <span class="o">:=</span> <span class="n">src</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">torchscript</span><span class="p">)</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a>                <span class="ow">and</span> <span class="p">(</span><span class="n">TorchscriptWeightsDescr</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">)(</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a>                    <span class="n">source</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a>                    <span class="n">authors</span><span class="o">=</span><span class="n">conv_authors</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">authors</span><span class="p">),</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a>                    <span class="n">parent</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>                    <span class="n">pytorch_version</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">pytorch_version</span> <span class="ow">or</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;1.10&quot;</span><span class="p">),</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a>                <span class="p">),</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a>            <span class="p">),</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a>        <span class="p">)</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a><span class="n">_model_conv</span> <span class="o">=</span> <span class="n">_ModelConv</span><span class="p">(</span><span class="n">_ModelDescr_v0_4</span><span class="p">,</span> <span class="n">ModelDescr</span><span class="p">)</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a><span class="c1"># create better cover images for 3d data and non-image outputs</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_covers</span><span class="p">(</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">squeeze</span><span class="p">(</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]]:</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;apply numpy.ndarray.squeeze while keeping track of the axis descriptions remaining&quot;&quot;&quot;</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>                <span class="sa">f</span><span class="s2">&quot;tensor shape </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> does not match described axes&quot;</span>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">axes</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a>            <span class="p">)</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">axes</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a>        <span class="n">data</span> <span class="o">-=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>        <span class="n">data</span> <span class="o">/=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_2d_image</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]):</span>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a>        <span class="n">original_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a>        <span class="n">original_axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a>        <span class="c1"># take slice fom any batch or index axis if needed</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>        <span class="c1"># and convert the first channel axis and take a slice from any additional channel axes</span>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>        <span class="n">slices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a>        <span class="n">ndim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a>        <span class="n">ndim_need</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a>        <span class="n">has_c_axis</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a>            <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">BatchAxis</span><span class="p">,</span> <span class="n">IndexInputAxis</span><span class="p">,</span> <span class="n">IndexOutputAxis</span><span class="p">))</span>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a>                <span class="ow">and</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">ndim_need</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a>            <span class="p">):</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a>                <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">):</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a>                <span class="k">if</span> <span class="n">has_c_axis</span><span class="p">:</span>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a>                    <span class="c1"># second channel axis</span>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)]</span>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a>                    <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a>                    <span class="n">has_c_axis</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a>                    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a>                        <span class="c1"># visualize two channels with cyan and magenta</span>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a>                            <span class="p">[</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a>                                <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),)],</span>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a>                                <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)],</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a>                                <span class="p">(</span>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a>                                    <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)]</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a>                                    <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a>                                <span class="p">)</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a>                                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># TODO: take maximum instead?</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a>                            <span class="p">],</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a>                            <span class="n">axis</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a>                        <span class="p">)</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a>                    <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a>                        <span class="k">pass</span>  <span class="c1"># visualize 3 channels as RGB</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a>                        <span class="c1"># visualize first 3 channels as RGB</span>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">),)]</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a>                    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndim</span>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a>        <span class="c1"># take slice from z axis if needed</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a>        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">ndim_need</span><span class="p">:</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">):</span>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a>                    <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a>                    <span class="k">break</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>        <span class="c1"># take slice from any space or time axis</span>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a>            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&lt;=</span> <span class="n">ndim_need</span><span class="p">:</span>
</span><span id="L-3637"><a href="#L-3637"><span class="linenos">3637</span></a>                <span class="k">break</span>
</span><span id="L-3638"><a href="#L-3638"><span class="linenos">3638</span></a>
</span><span id="L-3639"><a href="#L-3639"><span class="linenos">3639</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-3640"><a href="#L-3640"><span class="linenos">3640</span></a>            <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="L-3641"><a href="#L-3641"><span class="linenos">3641</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-3642"><a href="#L-3642"><span class="linenos">3642</span></a>                <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">SpaceInputAxis</span><span class="p">,</span> <span class="n">SpaceOutputAxis</span><span class="p">,</span> <span class="n">TimeInputAxis</span><span class="p">,</span> <span class="n">TimeOutputAxis</span><span class="p">)</span>
</span><span id="L-3643"><a href="#L-3643"><span class="linenos">3643</span></a>            <span class="p">):</span>
</span><span id="L-3644"><a href="#L-3644"><span class="linenos">3644</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="L-3645"><a href="#L-3645"><span class="linenos">3645</span></a>                <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-3646"><a href="#L-3646"><span class="linenos">3646</span></a>
</span><span id="L-3647"><a href="#L-3647"><span class="linenos">3647</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="L-3648"><a href="#L-3648"><span class="linenos">3648</span></a>
</span><span id="L-3649"><a href="#L-3649"><span class="linenos">3649</span></a>        <span class="k">del</span> <span class="n">slices</span>
</span><span id="L-3650"><a href="#L-3650"><span class="linenos">3650</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-3651"><a href="#L-3651"><span class="linenos">3651</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndim</span>
</span><span id="L-3652"><a href="#L-3652"><span class="linenos">3652</span></a>
</span><span id="L-3653"><a href="#L-3653"><span class="linenos">3653</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">has_c_axis</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">has_c_axis</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-3654"><a href="#L-3654"><span class="linenos">3654</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3655"><a href="#L-3655"><span class="linenos">3655</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to construct cover image from shape </span><span class="si">{</span><span class="n">original_shape</span><span class="si">}</span><span class="s2"> with axes </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">original_axes</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-3656"><a href="#L-3656"><span class="linenos">3656</span></a>            <span class="p">)</span>
</span><span id="L-3657"><a href="#L-3657"><span class="linenos">3657</span></a>
</span><span id="L-3658"><a href="#L-3658"><span class="linenos">3658</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_c_axis</span><span class="p">:</span>
</span><span id="L-3659"><a href="#L-3659"><span class="linenos">3659</span></a>            <span class="k">assert</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="L-3660"><a href="#L-3660"><span class="linenos">3660</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-3661"><a href="#L-3661"><span class="linenos">3661</span></a>            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChannelAxis</span><span class="p">(</span><span class="n">channel_names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="s2">&quot;RGB&quot;</span><span class="p">))))</span>
</span><span id="L-3662"><a href="#L-3662"><span class="linenos">3662</span></a>            <span class="n">ndim</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3663"><a href="#L-3663"><span class="linenos">3663</span></a>
</span><span id="L-3664"><a href="#L-3664"><span class="linenos">3664</span></a>        <span class="k">assert</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="L-3665"><a href="#L-3665"><span class="linenos">3665</span></a>
</span><span id="L-3666"><a href="#L-3666"><span class="linenos">3666</span></a>        <span class="c1"># transpose axis order such that longest axis comes first...</span>
</span><span id="L-3667"><a href="#L-3667"><span class="linenos">3667</span></a>        <span class="n">axis_order</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
</span><span id="L-3668"><a href="#L-3668"><span class="linenos">3668</span></a>        <span class="n">axis_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-3669"><a href="#L-3669"><span class="linenos">3669</span></a>        <span class="c1"># ... and channel axis is last</span>
</span><span id="L-3670"><a href="#L-3670"><span class="linenos">3670</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ChannelAxis</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3671"><a href="#L-3671"><span class="linenos">3671</span></a>        <span class="n">axis_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis_order</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span><span id="L-3672"><a href="#L-3672"><span class="linenos">3672</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">ao</span><span class="p">]</span> <span class="k">for</span> <span class="n">ao</span> <span class="ow">in</span> <span class="n">axis_order</span><span class="p">]</span>
</span><span id="L-3673"><a href="#L-3673"><span class="linenos">3673</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">axis_order</span><span class="p">)</span>
</span><span id="L-3674"><a href="#L-3674"><span class="linenos">3674</span></a>
</span><span id="L-3675"><a href="#L-3675"><span class="linenos">3675</span></a>        <span class="c1"># h, w = data.shape[:2]</span>
</span><span id="L-3676"><a href="#L-3676"><span class="linenos">3676</span></a>        <span class="c1"># if h / w  in (1.0 or 2.0):</span>
</span><span id="L-3677"><a href="#L-3677"><span class="linenos">3677</span></a>        <span class="c1">#     pass</span>
</span><span id="L-3678"><a href="#L-3678"><span class="linenos">3678</span></a>        <span class="c1"># elif h / w &lt; 2:</span>
</span><span id="L-3679"><a href="#L-3679"><span class="linenos">3679</span></a>        <span class="c1"># TODO: enforce 2:1 or 1:1 aspect ratio for generated cover images</span>
</span><span id="L-3680"><a href="#L-3680"><span class="linenos">3680</span></a>
</span><span id="L-3681"><a href="#L-3681"><span class="linenos">3681</span></a>        <span class="n">norm_along</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3682"><a href="#L-3682"><span class="linenos">3682</span></a>            <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="L-3683"><a href="#L-3683"><span class="linenos">3683</span></a>        <span class="p">)</span>
</span><span id="L-3684"><a href="#L-3684"><span class="linenos">3684</span></a>        <span class="c1"># normalize the data and map to 8 bit</span>
</span><span id="L-3685"><a href="#L-3685"><span class="linenos">3685</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">norm_along</span><span class="p">)</span>
</span><span id="L-3686"><a href="#L-3686"><span class="linenos">3686</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-3687"><a href="#L-3687"><span class="linenos">3687</span></a>
</span><span id="L-3688"><a href="#L-3688"><span class="linenos">3688</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-3689"><a href="#L-3689"><span class="linenos">3689</span></a>
</span><span id="L-3690"><a href="#L-3690"><span class="linenos">3690</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_diagonal_split_image</span><span class="p">(</span><span class="n">im0</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">im1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]):</span>
</span><span id="L-3691"><a href="#L-3691"><span class="linenos">3691</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">im1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
</span><span id="L-3692"><a href="#L-3692"><span class="linenos">3692</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">im1</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-3693"><a href="#L-3693"><span class="linenos">3693</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="L-3694"><a href="#L-3694"><span class="linenos">3694</span></a>        <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">im0</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-3695"><a href="#L-3695"><span class="linenos">3695</span></a>        <span class="k">assert</span> <span class="n">C</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="L-3696"><a href="#L-3696"><span class="linenos">3696</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-3697"><a href="#L-3697"><span class="linenos">3697</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
</span><span id="L-3698"><a href="#L-3698"><span class="linenos">3698</span></a>            <span class="n">outc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">im0</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
</span><span id="L-3699"><a href="#L-3699"><span class="linenos">3699</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">outc</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-3700"><a href="#L-3700"><span class="linenos">3700</span></a>            <span class="n">outc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">im1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-3701"><a href="#L-3701"><span class="linenos">3701</span></a>            <span class="n">out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">outc</span>
</span><span id="L-3702"><a href="#L-3702"><span class="linenos">3702</span></a>
</span><span id="L-3703"><a href="#L-3703"><span class="linenos">3703</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-3704"><a href="#L-3704"><span class="linenos">3704</span></a>
</span><span id="L-3705"><a href="#L-3705"><span class="linenos">3705</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="L-3706"><a href="#L-3706"><span class="linenos">3706</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing test input tensor for cover generation.&quot;</span><span class="p">)</span>
</span><span id="L-3707"><a href="#L-3707"><span class="linenos">3707</span></a>
</span><span id="L-3708"><a href="#L-3708"><span class="linenos">3708</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">outputs</span><span class="p">:</span>
</span><span id="L-3709"><a href="#L-3709"><span class="linenos">3709</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing test output tensor for cover generation.&quot;</span><span class="p">)</span>
</span><span id="L-3710"><a href="#L-3710"><span class="linenos">3710</span></a>
</span><span id="L-3711"><a href="#L-3711"><span class="linenos">3711</span></a>    <span class="n">ipt_descr</span><span class="p">,</span> <span class="n">ipt</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3712"><a href="#L-3712"><span class="linenos">3712</span></a>    <span class="n">out_descr</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3713"><a href="#L-3713"><span class="linenos">3713</span></a>
</span><span id="L-3714"><a href="#L-3714"><span class="linenos">3714</span></a>    <span class="n">ipt_img</span> <span class="o">=</span> <span class="n">to_2d_image</span><span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">ipt_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-3715"><a href="#L-3715"><span class="linenos">3715</span></a>    <span class="n">out_img</span> <span class="o">=</span> <span class="n">to_2d_image</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-3716"><a href="#L-3716"><span class="linenos">3716</span></a>
</span><span id="L-3717"><a href="#L-3717"><span class="linenos">3717</span></a>    <span class="n">cover_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">mkdtemp</span><span class="p">())</span>
</span><span id="L-3718"><a href="#L-3718"><span class="linenos">3718</span></a>    <span class="k">if</span> <span class="n">ipt_img</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">out_img</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="L-3719"><a href="#L-3719"><span class="linenos">3719</span></a>        <span class="n">covers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;cover.png&quot;</span><span class="p">]</span>
</span><span id="L-3720"><a href="#L-3720"><span class="linenos">3720</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">create_diagonal_split_image</span><span class="p">(</span><span class="n">ipt_img</span><span class="p">,</span> <span class="n">out_img</span><span class="p">))</span>
</span><span id="L-3721"><a href="#L-3721"><span class="linenos">3721</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3722"><a href="#L-3722"><span class="linenos">3722</span></a>        <span class="n">covers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;input.png&quot;</span><span class="p">,</span> <span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;output.png&quot;</span><span class="p">]</span>
</span><span id="L-3723"><a href="#L-3723"><span class="linenos">3723</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ipt_img</span><span class="p">)</span>
</span><span id="L-3724"><a href="#L-3724"><span class="linenos">3724</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_img</span><span class="p">)</span>
</span><span id="L-3725"><a href="#L-3725"><span class="linenos">3725</span></a>
</span><span id="L-3726"><a href="#L-3726"><span class="linenos">3726</span></a>    <span class="k">return</span> <span class="n">covers</span>
</span></pre></div>


            </section>
                <section id="SpaceUnit">
                    <div class="attr variable">
            <span class="name">SpaceUnit</span>        =
<input id="SpaceUnit-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="SpaceUnit-view-value"></label><span class="default_value">typing.Literal[&#39;attometer&#39;, &#39;angstrom&#39;, &#39;centimeter&#39;, &#39;decimeter&#39;, &#39;exameter&#39;, &#39;femtometer&#39;, &#39;foot&#39;, &#39;gigameter&#39;, &#39;hectometer&#39;, &#39;inch&#39;, &#39;kilometer&#39;, &#39;megameter&#39;, &#39;meter&#39;, &#39;micrometer&#39;, &#39;mile&#39;, &#39;millimeter&#39;, &#39;nanometer&#39;, &#39;parsec&#39;, &#39;petameter&#39;, &#39;picometer&#39;, &#39;terameter&#39;, &#39;yard&#39;, &#39;yoctometer&#39;, &#39;yottameter&#39;, &#39;zeptometer&#39;, &#39;zettameter&#39;]</span>

        
    </div>
    <a class="headerlink" href="#SpaceUnit"></a>
    
            <div class="docstring"><p>Space unit compatible to the <a href="https://ngff.openmicroscopy.org/0.5/#axes-md">OME-Zarr axes specification 0.5</a></p>
</div>


                </section>
                <section id="TimeUnit">
                    <div class="attr variable">
            <span class="name">TimeUnit</span>        =
<input id="TimeUnit-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TimeUnit-view-value"></label><span class="default_value">typing.Literal[&#39;attosecond&#39;, &#39;centisecond&#39;, &#39;day&#39;, &#39;decisecond&#39;, &#39;exasecond&#39;, &#39;femtosecond&#39;, &#39;gigasecond&#39;, &#39;hectosecond&#39;, &#39;hour&#39;, &#39;kilosecond&#39;, &#39;megasecond&#39;, &#39;microsecond&#39;, &#39;millisecond&#39;, &#39;minute&#39;, &#39;nanosecond&#39;, &#39;petasecond&#39;, &#39;picosecond&#39;, &#39;second&#39;, &#39;terasecond&#39;, &#39;yoctosecond&#39;, &#39;yottasecond&#39;, &#39;zeptosecond&#39;, &#39;zettasecond&#39;]</span>

        
    </div>
    <a class="headerlink" href="#TimeUnit"></a>
    
            <div class="docstring"><p>Time unit compatible to the <a href="https://ngff.openmicroscopy.org/0.5/#axes-md">OME-Zarr axes specification 0.5</a></p>
</div>


                </section>
                <section id="AxisType">
                    <div class="attr variable">
            <span class="name">AxisType</span>        =
<span class="default_value">typing.Literal[&#39;batch&#39;, &#39;channel&#39;, &#39;index&#39;, &#39;time&#39;, &#39;space&#39;]</span>

        
    </div>
    <a class="headerlink" href="#AxisType"></a>
    
    

                </section>
                <section id="TensorId">
                            <input id="TensorId-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorId</span><wbr>(<span class="base">bioimageio.spec._internal.types.LowerCaseIdentifier</span>):

                <label class="view-source-button" for="TensorId-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorId"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorId-230"><a href="#TensorId-230"><span class="linenos">230</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorId</span><span class="p">(</span><span class="n">LowerCaseIdentifier</span><span class="p">):</span>
</span><span id="TensorId-231"><a href="#TensorId-231"><span class="linenos">231</span></a>    <span class="n">root_model</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">RootModel</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">RootModel</span><span class="p">[</span>
</span><span id="TensorId-232"><a href="#TensorId-232"><span class="linenos">232</span></a>        <span class="n">Annotated</span><span class="p">[</span><span class="n">LowerCaseIdentifierAnno</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>
</span><span id="TensorId-233"><a href="#TensorId-233"><span class="linenos">233</span></a>    <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>str(object='') -> str
str(bytes_or_buffer[, encoding[, errors]]) -> str</p>

<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.__str__() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
</div>


                            <div id="TensorId.root_model" class="classattr">
                                <div class="attr variable">
            <span class="name">root_model</span><span class="annotation">: ClassVar[Type[pydantic.root_model.RootModel[Any]]]</span>        =
<input id="TensorId.root_model-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TensorId.root_model-view-value"></label><span class="default_value">&lt;class &#39;pydantic.root_model.RootModel[Annotated[str, MinLen, AfterValidator, AfterValidator, Annotated[TypeVar, Predicate], MaxLen]]&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#TensorId.root_model"></a>
    
            <div class="docstring"><p>the pydantic root model to validate the string</p>
</div>


                            </div>
                </section>
                <section id="AxisId">
                            <input id="AxisId-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AxisId</span><wbr>(<span class="base">bioimageio.spec._internal.types.LowerCaseIdentifier</span>):

                <label class="view-source-button" for="AxisId-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AxisId"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AxisId-246"><a href="#AxisId-246"><span class="linenos">246</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AxisId</span><span class="p">(</span><span class="n">LowerCaseIdentifier</span><span class="p">):</span>
</span><span id="AxisId-247"><a href="#AxisId-247"><span class="linenos">247</span></a>    <span class="n">root_model</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">RootModel</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">RootModel</span><span class="p">[</span>
</span><span id="AxisId-248"><a href="#AxisId-248"><span class="linenos">248</span></a>        <span class="n">Annotated</span><span class="p">[</span>
</span><span id="AxisId-249"><a href="#AxisId-249"><span class="linenos">249</span></a>            <span class="n">LowerCaseIdentifierAnno</span><span class="p">,</span>
</span><span id="AxisId-250"><a href="#AxisId-250"><span class="linenos">250</span></a>            <span class="n">MaxLen</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
</span><span id="AxisId-251"><a href="#AxisId-251"><span class="linenos">251</span></a>            <span class="n">AfterValidator</span><span class="p">(</span><span class="n">_normalize_axis_id</span><span class="p">),</span>
</span><span id="AxisId-252"><a href="#AxisId-252"><span class="linenos">252</span></a>        <span class="p">]</span>
</span><span id="AxisId-253"><a href="#AxisId-253"><span class="linenos">253</span></a>    <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>str(object='') -> str
str(bytes_or_buffer[, encoding[, errors]]) -> str</p>

<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.__str__() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
</div>


                            <div id="AxisId.root_model" class="classattr">
                                <div class="attr variable">
            <span class="name">root_model</span><span class="annotation">: ClassVar[Type[pydantic.root_model.RootModel[Any]]]</span>        =
<input id="AxisId.root_model-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="AxisId.root_model-view-value"></label><span class="default_value">&lt;class &#39;pydantic.root_model.RootModel[Annotated[str, MinLen, AfterValidator, AfterValidator, Annotated[TypeVar, Predicate], MaxLen, AfterValidator]]&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#AxisId.root_model"></a>
    
            <div class="docstring"><p>the pydantic root model to validate the string</p>
</div>


                            </div>
                </section>
                <section id="NonBatchAxisId">
                    <div class="attr variable">
            <span class="name">NonBatchAxisId</span>        =
<span class="default_value">typing.Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch)]</span>

        
    </div>
    <a class="headerlink" href="#NonBatchAxisId"></a>
    
    

                </section>
                <section id="PreprocessingId">
                    <div class="attr variable">
            <span class="name">PreprocessingId</span>        =
<input id="PreprocessingId-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="PreprocessingId-view-value"></label><span class="default_value">typing.Literal[&#39;binarize&#39;, &#39;clip&#39;, &#39;ensure_dtype&#39;, &#39;fixed_zero_mean_unit_variance&#39;, &#39;scale_linear&#39;, &#39;scale_range&#39;, &#39;sigmoid&#39;, &#39;softmax&#39;]</span>

        
    </div>
    <a class="headerlink" href="#PreprocessingId"></a>
    
    

                </section>
                <section id="PostprocessingId">
                    <div class="attr variable">
            <span class="name">PostprocessingId</span>        =
<input id="PostprocessingId-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="PostprocessingId-view-value"></label><span class="default_value">typing.Literal[&#39;binarize&#39;, &#39;clip&#39;, &#39;ensure_dtype&#39;, &#39;fixed_zero_mean_unit_variance&#39;, &#39;scale_linear&#39;, &#39;scale_mean_variance&#39;, &#39;scale_range&#39;, &#39;sigmoid&#39;, &#39;softmax&#39;, &#39;zero_mean_unit_variance&#39;]</span>

        
    </div>
    <a class="headerlink" href="#PostprocessingId"></a>
    
    

                </section>
                <section id="SAME_AS_TYPE">
                    <div class="attr variable">
            <span class="name">SAME_AS_TYPE</span>        =
<span class="default_value">&#39;&lt;same as type&gt;&#39;</span>

        
    </div>
    <a class="headerlink" href="#SAME_AS_TYPE"></a>
    
    

                </section>
                <section id="ParameterizedSize_N">
                    <div class="attr variable">
            <span class="name">ParameterizedSize_N</span>        =
<span class="default_value">&lt;class &#39;int&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ParameterizedSize_N"></a>
    
            <div class="docstring"><p>Annotates an integer to calculate a concrete axis size from a <code><a href="#ParameterizedSize">ParameterizedSize</a></code>.</p>
</div>


                </section>
                <section id="ParameterizedSize">
                            <input id="ParameterizedSize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ParameterizedSize</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="ParameterizedSize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParameterizedSize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParameterizedSize-299"><a href="#ParameterizedSize-299"><span class="linenos">299</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ParameterizedSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="ParameterizedSize-300"><a href="#ParameterizedSize-300"><span class="linenos">300</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes a range of valid tensor axis sizes as `size = min + n*step`.</span>
</span><span id="ParameterizedSize-301"><a href="#ParameterizedSize-301"><span class="linenos">301</span></a>
</span><span id="ParameterizedSize-302"><a href="#ParameterizedSize-302"><span class="linenos">302</span></a><span class="sd">    - **min** and **step** are given by the model description.</span>
</span><span id="ParameterizedSize-303"><a href="#ParameterizedSize-303"><span class="linenos">303</span></a><span class="sd">    - All blocksize paramters n = 0,1,2,... yield a valid `size`.</span>
</span><span id="ParameterizedSize-304"><a href="#ParameterizedSize-304"><span class="linenos">304</span></a><span class="sd">    - A greater blocksize paramter n = 0,1,2,... results in a greater **size**.</span>
</span><span id="ParameterizedSize-305"><a href="#ParameterizedSize-305"><span class="linenos">305</span></a><span class="sd">      This allows to adjust the axis size more generically.</span>
</span><span id="ParameterizedSize-306"><a href="#ParameterizedSize-306"><span class="linenos">306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ParameterizedSize-307"><a href="#ParameterizedSize-307"><span class="linenos">307</span></a>
</span><span id="ParameterizedSize-308"><a href="#ParameterizedSize-308"><span class="linenos">308</span></a>    <span class="n">N</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ParameterizedSize_N</span>
</span><span id="ParameterizedSize-309"><a href="#ParameterizedSize-309"><span class="linenos">309</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Positive integer to parameterize this axis&quot;&quot;&quot;</span>
</span><span id="ParameterizedSize-310"><a href="#ParameterizedSize-310"><span class="linenos">310</span></a>
</span><span id="ParameterizedSize-311"><a href="#ParameterizedSize-311"><span class="linenos">311</span></a>    <span class="nb">min</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ParameterizedSize-312"><a href="#ParameterizedSize-312"><span class="linenos">312</span></a>    <span class="n">step</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="ParameterizedSize-313"><a href="#ParameterizedSize-313"><span class="linenos">313</span></a>
</span><span id="ParameterizedSize-314"><a href="#ParameterizedSize-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ParameterizedSize-315"><a href="#ParameterizedSize-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="ParameterizedSize-316"><a href="#ParameterizedSize-316"><span class="linenos">316</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ParameterizedSize-317"><a href="#ParameterizedSize-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ParameterizedSize-318"><a href="#ParameterizedSize-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ParameterizedSize-319"><a href="#ParameterizedSize-319"><span class="linenos">319</span></a>                <span class="sa">f</span><span class="s2">&quot;axis of size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> is not parameterized by `min + n*step` =&quot;</span>
</span><span id="ParameterizedSize-320"><a href="#ParameterizedSize-320"><span class="linenos">320</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> + n*</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">`&quot;</span>
</span><span id="ParameterizedSize-321"><a href="#ParameterizedSize-321"><span class="linenos">321</span></a>            <span class="p">)</span>
</span><span id="ParameterizedSize-322"><a href="#ParameterizedSize-322"><span class="linenos">322</span></a>
</span><span id="ParameterizedSize-323"><a href="#ParameterizedSize-323"><span class="linenos">323</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="ParameterizedSize-324"><a href="#ParameterizedSize-324"><span class="linenos">324</span></a>
</span><span id="ParameterizedSize-325"><a href="#ParameterizedSize-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ParameterizedSize-326"><a href="#ParameterizedSize-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">*</span> <span class="n">n</span>
</span><span id="ParameterizedSize-327"><a href="#ParameterizedSize-327"><span class="linenos">327</span></a>
</span><span id="ParameterizedSize-328"><a href="#ParameterizedSize-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParameterizedSize_N</span><span class="p">:</span>
</span><span id="ParameterizedSize-329"><a href="#ParameterizedSize-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;return smallest n parameterizing a size greater or equal than `s`&quot;&quot;&quot;</span>
</span><span id="ParameterizedSize-330"><a href="#ParameterizedSize-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="n">ceil</span><span class="p">((</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Describes a range of valid tensor axis sizes as <code>size = min + n*step</code>.</p>

<ul>
<li><strong>min</strong> and <strong>step</strong> are given by the model description.</li>
<li>All blocksize paramters n = 0,1,2,... yield a valid <code>size</code>.</li>
<li>A greater blocksize paramter n = 0,1,2,... results in a greater <strong>size</strong>.
This allows to adjust the axis size more generically.</li>
</ul>
</div>


                            <div id="ParameterizedSize.N" class="classattr">
                                <div class="attr variable">
            <span class="name">N</span><span class="annotation">: ClassVar[Type[int]]</span>        =
<span class="default_value">&lt;class &#39;int&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ParameterizedSize.N"></a>
    
            <div class="docstring"><p>Positive integer to parameterize this axis</p>
</div>


                            </div>
                            <div id="ParameterizedSize.min" class="classattr">
                                <div class="attr variable">
            <span class="name">min</span><span class="annotation">: Annotated[int, Gt(gt=0)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ParameterizedSize.min"></a>
    
    

                            </div>
                            <div id="ParameterizedSize.step" class="classattr">
                                <div class="attr variable">
            <span class="name">step</span><span class="annotation">: Annotated[int, Gt(gt=0)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ParameterizedSize.step"></a>
    
    

                            </div>
                            <div id="ParameterizedSize.validate_size" class="classattr">
                                        <input id="ParameterizedSize.validate_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ParameterizedSize.validate_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParameterizedSize.validate_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParameterizedSize.validate_size-314"><a href="#ParameterizedSize.validate_size-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ParameterizedSize.validate_size-315"><a href="#ParameterizedSize.validate_size-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="ParameterizedSize.validate_size-316"><a href="#ParameterizedSize.validate_size-316"><span class="linenos">316</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ParameterizedSize.validate_size-317"><a href="#ParameterizedSize.validate_size-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ParameterizedSize.validate_size-318"><a href="#ParameterizedSize.validate_size-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ParameterizedSize.validate_size-319"><a href="#ParameterizedSize.validate_size-319"><span class="linenos">319</span></a>                <span class="sa">f</span><span class="s2">&quot;axis of size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> is not parameterized by `min + n*step` =&quot;</span>
</span><span id="ParameterizedSize.validate_size-320"><a href="#ParameterizedSize.validate_size-320"><span class="linenos">320</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> + n*</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="si">}</span><span class="s2">`&quot;</span>
</span><span id="ParameterizedSize.validate_size-321"><a href="#ParameterizedSize.validate_size-321"><span class="linenos">321</span></a>            <span class="p">)</span>
</span><span id="ParameterizedSize.validate_size-322"><a href="#ParameterizedSize.validate_size-322"><span class="linenos">322</span></a>
</span><span id="ParameterizedSize.validate_size-323"><a href="#ParameterizedSize.validate_size-323"><span class="linenos">323</span></a>        <span class="k">return</span> <span class="n">size</span>
</span></pre></div>


    

                            </div>
                            <div id="ParameterizedSize.get_size" class="classattr">
                                        <input id="ParameterizedSize.get_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ParameterizedSize.get_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParameterizedSize.get_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParameterizedSize.get_size-325"><a href="#ParameterizedSize.get_size-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ParameterizedSize.get_size-326"><a href="#ParameterizedSize.get_size-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">*</span> <span class="n">n</span>
</span></pre></div>


    

                            </div>
                            <div id="ParameterizedSize.get_n" class="classattr">
                                        <input id="ParameterizedSize.get_n-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_n</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ParameterizedSize.get_n-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParameterizedSize.get_n"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParameterizedSize.get_n-328"><a href="#ParameterizedSize.get_n-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParameterizedSize_N</span><span class="p">:</span>
</span><span id="ParameterizedSize.get_n-329"><a href="#ParameterizedSize.get_n-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;return smallest n parameterizing a size greater or equal than `s`&quot;&quot;&quot;</span>
</span><span id="ParameterizedSize.get_n-330"><a href="#ParameterizedSize.get_n-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="n">ceil</span><span class="p">((</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>return smallest n parameterizing a size greater or equal than <code>s</code></p>
</div>


                            </div>
                </section>
                <section id="DataDependentSize">
                            <input id="DataDependentSize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DataDependentSize</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="DataDependentSize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataDependentSize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataDependentSize-333"><a href="#DataDependentSize-333"><span class="linenos">333</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DataDependentSize</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="DataDependentSize-334"><a href="#DataDependentSize-334"><span class="linenos">334</span></a>    <span class="nb">min</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="DataDependentSize-335"><a href="#DataDependentSize-335"><span class="linenos">335</span></a>    <span class="nb">max</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DataDependentSize-336"><a href="#DataDependentSize-336"><span class="linenos">336</span></a>
</span><span id="DataDependentSize-337"><a href="#DataDependentSize-337"><span class="linenos">337</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize-338"><a href="#DataDependentSize-338"><span class="linenos">338</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_max_gt_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DataDependentSize-339"><a href="#DataDependentSize-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="DataDependentSize-340"><a href="#DataDependentSize-340"><span class="linenos">340</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;expected `min` &lt; `max`, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize-341"><a href="#DataDependentSize-341"><span class="linenos">341</span></a>
</span><span id="DataDependentSize-342"><a href="#DataDependentSize-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="DataDependentSize-343"><a href="#DataDependentSize-343"><span class="linenos">343</span></a>
</span><span id="DataDependentSize-344"><a href="#DataDependentSize-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DataDependentSize-345"><a href="#DataDependentSize-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="DataDependentSize-346"><a href="#DataDependentSize-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize-347"><a href="#DataDependentSize-347"><span class="linenos">347</span></a>
</span><span id="DataDependentSize-348"><a href="#DataDependentSize-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="DataDependentSize-349"><a href="#DataDependentSize-349"><span class="linenos">349</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize-350"><a href="#DataDependentSize-350"><span class="linenos">350</span></a>
</span><span id="DataDependentSize-351"><a href="#DataDependentSize-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="n">size</span>
</span></pre></div>


    

                            <div id="DataDependentSize.min" class="classattr">
                                <div class="attr variable">
            <span class="name">min</span><span class="annotation">: Annotated[int, Gt(gt=0)]</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#DataDependentSize.min"></a>
    
    

                            </div>
                            <div id="DataDependentSize.max" class="classattr">
                                <div class="attr variable">
            <span class="name">max</span><span class="annotation">: Annotated[Optional[int], Gt(gt=1)]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#DataDependentSize.max"></a>
    
    

                            </div>
                            <div id="DataDependentSize.validate_size" class="classattr">
                                        <input id="DataDependentSize.validate_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="DataDependentSize.validate_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataDependentSize.validate_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataDependentSize.validate_size-344"><a href="#DataDependentSize.validate_size-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DataDependentSize.validate_size-345"><a href="#DataDependentSize.validate_size-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="DataDependentSize.validate_size-346"><a href="#DataDependentSize.validate_size-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize.validate_size-347"><a href="#DataDependentSize.validate_size-347"><span class="linenos">347</span></a>
</span><span id="DataDependentSize.validate_size-348"><a href="#DataDependentSize.validate_size-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="DataDependentSize.validate_size-349"><a href="#DataDependentSize.validate_size-349"><span class="linenos">349</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataDependentSize.validate_size-350"><a href="#DataDependentSize.validate_size-350"><span class="linenos">350</span></a>
</span><span id="DataDependentSize.validate_size-351"><a href="#DataDependentSize.validate_size-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="n">size</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="SizeReference">
                            <input id="SizeReference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SizeReference</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="SizeReference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SizeReference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SizeReference-354"><a href="#SizeReference-354"><span class="linenos">354</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SizeReference</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="SizeReference-355"><a href="#SizeReference-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A tensor axis size (extent in pixels/frames) defined in relation to a reference axis.</span>
</span><span id="SizeReference-356"><a href="#SizeReference-356"><span class="linenos">356</span></a>
</span><span id="SizeReference-357"><a href="#SizeReference-357"><span class="linenos">357</span></a><span class="sd">    `axis.size = reference.size * reference.scale / axis.scale + offset`</span>
</span><span id="SizeReference-358"><a href="#SizeReference-358"><span class="linenos">358</span></a>
</span><span id="SizeReference-359"><a href="#SizeReference-359"><span class="linenos">359</span></a><span class="sd">    Note:</span>
</span><span id="SizeReference-360"><a href="#SizeReference-360"><span class="linenos">360</span></a><span class="sd">    1. The axis and the referenced axis need to have the same unit (or no unit).</span>
</span><span id="SizeReference-361"><a href="#SizeReference-361"><span class="linenos">361</span></a><span class="sd">    2. Batch axes may not be referenced.</span>
</span><span id="SizeReference-362"><a href="#SizeReference-362"><span class="linenos">362</span></a><span class="sd">    3. Fractions are rounded down.</span>
</span><span id="SizeReference-363"><a href="#SizeReference-363"><span class="linenos">363</span></a><span class="sd">    4. If the reference axis is `concatenable` the referencing axis is assumed to be</span>
</span><span id="SizeReference-364"><a href="#SizeReference-364"><span class="linenos">364</span></a><span class="sd">        `concatenable` as well with the same block order.</span>
</span><span id="SizeReference-365"><a href="#SizeReference-365"><span class="linenos">365</span></a>
</span><span id="SizeReference-366"><a href="#SizeReference-366"><span class="linenos">366</span></a><span class="sd">    Example:</span>
</span><span id="SizeReference-367"><a href="#SizeReference-367"><span class="linenos">367</span></a><span class="sd">    An unisotropic input image of w*h=100*49 pixels depicts a phsical space of 200*196mm.</span>
</span><span id="SizeReference-368"><a href="#SizeReference-368"><span class="linenos">368</span></a><span class="sd">    Let&#39;s assume that we want to express the image height h in relation to its width w</span>
</span><span id="SizeReference-369"><a href="#SizeReference-369"><span class="linenos">369</span></a><span class="sd">    instead of only accepting input images of exactly 100*49 pixels</span>
</span><span id="SizeReference-370"><a href="#SizeReference-370"><span class="linenos">370</span></a><span class="sd">    (for example to express a range of valid image shapes by parametrizing w, see `ParameterizedSize`).</span>
</span><span id="SizeReference-371"><a href="#SizeReference-371"><span class="linenos">371</span></a>
</span><span id="SizeReference-372"><a href="#SizeReference-372"><span class="linenos">372</span></a><span class="sd">    &gt;&gt;&gt; w = SpaceInputAxis(id=AxisId(&quot;w&quot;), size=100, unit=&quot;millimeter&quot;, scale=2)</span>
</span><span id="SizeReference-373"><a href="#SizeReference-373"><span class="linenos">373</span></a><span class="sd">    &gt;&gt;&gt; h = SpaceInputAxis(</span>
</span><span id="SizeReference-374"><a href="#SizeReference-374"><span class="linenos">374</span></a><span class="sd">    ...     id=AxisId(&quot;h&quot;),</span>
</span><span id="SizeReference-375"><a href="#SizeReference-375"><span class="linenos">375</span></a><span class="sd">    ...     size=SizeReference(tensor_id=TensorId(&quot;input&quot;), axis_id=AxisId(&quot;w&quot;), offset=-1),</span>
</span><span id="SizeReference-376"><a href="#SizeReference-376"><span class="linenos">376</span></a><span class="sd">    ...     unit=&quot;millimeter&quot;,</span>
</span><span id="SizeReference-377"><a href="#SizeReference-377"><span class="linenos">377</span></a><span class="sd">    ...     scale=4,</span>
</span><span id="SizeReference-378"><a href="#SizeReference-378"><span class="linenos">378</span></a><span class="sd">    ... )</span>
</span><span id="SizeReference-379"><a href="#SizeReference-379"><span class="linenos">379</span></a><span class="sd">    &gt;&gt;&gt; print(h.size.get_size(h, w))</span>
</span><span id="SizeReference-380"><a href="#SizeReference-380"><span class="linenos">380</span></a><span class="sd">    49</span>
</span><span id="SizeReference-381"><a href="#SizeReference-381"><span class="linenos">381</span></a>
</span><span id="SizeReference-382"><a href="#SizeReference-382"><span class="linenos">382</span></a><span class="sd">     h = w * w.scale / h.scale + offset = 100 * 2mm / 4mm - 1 = 49</span>
</span><span id="SizeReference-383"><a href="#SizeReference-383"><span class="linenos">383</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SizeReference-384"><a href="#SizeReference-384"><span class="linenos">384</span></a>
</span><span id="SizeReference-385"><a href="#SizeReference-385"><span class="linenos">385</span></a>    <span class="n">tensor_id</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="SizeReference-386"><a href="#SizeReference-386"><span class="linenos">386</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;tensor id of the reference axis&quot;&quot;&quot;</span>
</span><span id="SizeReference-387"><a href="#SizeReference-387"><span class="linenos">387</span></a>
</span><span id="SizeReference-388"><a href="#SizeReference-388"><span class="linenos">388</span></a>    <span class="n">axis_id</span><span class="p">:</span> <span class="n">AxisId</span>
</span><span id="SizeReference-389"><a href="#SizeReference-389"><span class="linenos">389</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;axis id of the reference axis&quot;&quot;&quot;</span>
</span><span id="SizeReference-390"><a href="#SizeReference-390"><span class="linenos">390</span></a>
</span><span id="SizeReference-391"><a href="#SizeReference-391"><span class="linenos">391</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">StrictInt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SizeReference-392"><a href="#SizeReference-392"><span class="linenos">392</span></a>
</span><span id="SizeReference-393"><a href="#SizeReference-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span>
</span><span id="SizeReference-394"><a href="#SizeReference-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SizeReference-395"><a href="#SizeReference-395"><span class="linenos">395</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="SizeReference-396"><a href="#SizeReference-396"><span class="linenos">396</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="SizeReference-397"><a href="#SizeReference-397"><span class="linenos">397</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-398"><a href="#SizeReference-398"><span class="linenos">398</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-399"><a href="#SizeReference-399"><span class="linenos">399</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-400"><a href="#SizeReference-400"><span class="linenos">400</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-401"><a href="#SizeReference-401"><span class="linenos">401</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-402"><a href="#SizeReference-402"><span class="linenos">402</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-403"><a href="#SizeReference-403"><span class="linenos">403</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-404"><a href="#SizeReference-404"><span class="linenos">404</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-405"><a href="#SizeReference-405"><span class="linenos">405</span></a>        <span class="p">],</span>
</span><span id="SizeReference-406"><a href="#SizeReference-406"><span class="linenos">406</span></a>        <span class="n">ref_axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="SizeReference-407"><a href="#SizeReference-407"><span class="linenos">407</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="SizeReference-408"><a href="#SizeReference-408"><span class="linenos">408</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-409"><a href="#SizeReference-409"><span class="linenos">409</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-410"><a href="#SizeReference-410"><span class="linenos">410</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-411"><a href="#SizeReference-411"><span class="linenos">411</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-412"><a href="#SizeReference-412"><span class="linenos">412</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-413"><a href="#SizeReference-413"><span class="linenos">413</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-414"><a href="#SizeReference-414"><span class="linenos">414</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-415"><a href="#SizeReference-415"><span class="linenos">415</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-416"><a href="#SizeReference-416"><span class="linenos">416</span></a>        <span class="p">],</span>
</span><span id="SizeReference-417"><a href="#SizeReference-417"><span class="linenos">417</span></a>        <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SizeReference-418"><a href="#SizeReference-418"><span class="linenos">418</span></a>        <span class="n">ref_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SizeReference-419"><a href="#SizeReference-419"><span class="linenos">419</span></a>    <span class="p">):</span>
</span><span id="SizeReference-420"><a href="#SizeReference-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the concrete size for a given axis and its reference axis.</span>
</span><span id="SizeReference-421"><a href="#SizeReference-421"><span class="linenos">421</span></a>
</span><span id="SizeReference-422"><a href="#SizeReference-422"><span class="linenos">422</span></a><span class="sd">        Args:</span>
</span><span id="SizeReference-423"><a href="#SizeReference-423"><span class="linenos">423</span></a><span class="sd">            axis: The axis this `SizeReference` is the size of.</span>
</span><span id="SizeReference-424"><a href="#SizeReference-424"><span class="linenos">424</span></a><span class="sd">            ref_axis: The reference axis to compute the size from.</span>
</span><span id="SizeReference-425"><a href="#SizeReference-425"><span class="linenos">425</span></a><span class="sd">            n: If the **ref_axis** is parameterized (of type `ParameterizedSize`)</span>
</span><span id="SizeReference-426"><a href="#SizeReference-426"><span class="linenos">426</span></a><span class="sd">                and no fixed **ref_size** is given,</span>
</span><span id="SizeReference-427"><a href="#SizeReference-427"><span class="linenos">427</span></a><span class="sd">                **n** is used to compute the size of the parameterized **ref_axis**.</span>
</span><span id="SizeReference-428"><a href="#SizeReference-428"><span class="linenos">428</span></a><span class="sd">            ref_size: Overwrite the reference size instead of deriving it from</span>
</span><span id="SizeReference-429"><a href="#SizeReference-429"><span class="linenos">429</span></a><span class="sd">                **ref_axis**</span>
</span><span id="SizeReference-430"><a href="#SizeReference-430"><span class="linenos">430</span></a><span class="sd">                (**ref_axis.scale** is still used; any given **n** is ignored).</span>
</span><span id="SizeReference-431"><a href="#SizeReference-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SizeReference-432"><a href="#SizeReference-432"><span class="linenos">432</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference-433"><a href="#SizeReference-433"><span class="linenos">433</span></a>            <span class="s2">&quot;Given `axis.size` is not defined by this `SizeReference`&quot;</span>
</span><span id="SizeReference-434"><a href="#SizeReference-434"><span class="linenos">434</span></a>        <span class="p">)</span>
</span><span id="SizeReference-435"><a href="#SizeReference-435"><span class="linenos">435</span></a>
</span><span id="SizeReference-436"><a href="#SizeReference-436"><span class="linenos">436</span></a>        <span class="k">assert</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference-437"><a href="#SizeReference-437"><span class="linenos">437</span></a>            <span class="sa">f</span><span class="s2">&quot;Expected `ref_axis.id` to be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="SizeReference-438"><a href="#SizeReference-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="SizeReference-439"><a href="#SizeReference-439"><span class="linenos">439</span></a>
</span><span id="SizeReference-440"><a href="#SizeReference-440"><span class="linenos">440</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference-441"><a href="#SizeReference-441"><span class="linenos">441</span></a>            <span class="s2">&quot;`SizeReference` requires `axis` and `ref_axis` to have the same `unit`,&quot;</span>
</span><span id="SizeReference-442"><a href="#SizeReference-442"><span class="linenos">442</span></a>            <span class="sa">f</span><span class="s2">&quot; but </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SizeReference-443"><a href="#SizeReference-443"><span class="linenos">443</span></a>        <span class="p">)</span>
</span><span id="SizeReference-444"><a href="#SizeReference-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SizeReference-445"><a href="#SizeReference-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span><span id="SizeReference-446"><a href="#SizeReference-446"><span class="linenos">446</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span>
</span><span id="SizeReference-447"><a href="#SizeReference-447"><span class="linenos">447</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="SizeReference-448"><a href="#SizeReference-448"><span class="linenos">448</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="SizeReference-449"><a href="#SizeReference-449"><span class="linenos">449</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="SizeReference-450"><a href="#SizeReference-450"><span class="linenos">450</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SizeReference-451"><a href="#SizeReference-451"><span class="linenos">451</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be a `DataDependentSize`.&quot;</span>
</span><span id="SizeReference-452"><a href="#SizeReference-452"><span class="linenos">452</span></a>                <span class="p">)</span>
</span><span id="SizeReference-453"><a href="#SizeReference-453"><span class="linenos">453</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="SizeReference-454"><a href="#SizeReference-454"><span class="linenos">454</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SizeReference-455"><a href="#SizeReference-455"><span class="linenos">455</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be sized by a&quot;</span>
</span><span id="SizeReference-456"><a href="#SizeReference-456"><span class="linenos">456</span></a>                    <span class="o">+</span> <span class="s2">&quot; `SizeReference` itself.&quot;</span>
</span><span id="SizeReference-457"><a href="#SizeReference-457"><span class="linenos">457</span></a>                <span class="p">)</span>
</span><span id="SizeReference-458"><a href="#SizeReference-458"><span class="linenos">458</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SizeReference-459"><a href="#SizeReference-459"><span class="linenos">459</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="SizeReference-460"><a href="#SizeReference-460"><span class="linenos">460</span></a>
</span><span id="SizeReference-461"><a href="#SizeReference-461"><span class="linenos">461</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref_size</span> <span class="o">*</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="SizeReference-462"><a href="#SizeReference-462"><span class="linenos">462</span></a>
</span><span id="SizeReference-463"><a href="#SizeReference-463"><span class="linenos">463</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SizeReference-464"><a href="#SizeReference-464"><span class="linenos">464</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_unit</span><span class="p">(</span>
</span><span id="SizeReference-465"><a href="#SizeReference-465"><span class="linenos">465</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="SizeReference-466"><a href="#SizeReference-466"><span class="linenos">466</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="SizeReference-467"><a href="#SizeReference-467"><span class="linenos">467</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-468"><a href="#SizeReference-468"><span class="linenos">468</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-469"><a href="#SizeReference-469"><span class="linenos">469</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-470"><a href="#SizeReference-470"><span class="linenos">470</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="SizeReference-471"><a href="#SizeReference-471"><span class="linenos">471</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-472"><a href="#SizeReference-472"><span class="linenos">472</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-473"><a href="#SizeReference-473"><span class="linenos">473</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference-474"><a href="#SizeReference-474"><span class="linenos">474</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference-475"><a href="#SizeReference-475"><span class="linenos">475</span></a>        <span class="p">],</span>
</span><span id="SizeReference-476"><a href="#SizeReference-476"><span class="linenos">476</span></a>    <span class="p">):</span>
</span><span id="SizeReference-477"><a href="#SizeReference-477"><span class="linenos">477</span></a>        <span class="k">return</span> <span class="n">axis</span><span class="o">.</span><span class="n">unit</span>
</span></pre></div>


            <div class="docstring"><p>A tensor axis size (extent in pixels/frames) defined in relation to a reference axis.</p>

<p><code>axis.size = reference.size * reference.scale / axis.scale + offset</code></p>

<p>Note:</p>

<ol>
<li>The axis and the referenced axis need to have the same unit (or no unit).</li>
<li>Batch axes may not be referenced.</li>
<li>Fractions are rounded down.</li>
<li>If the reference axis is <code>concatenable</code> the referencing axis is assumed to be
<code>concatenable</code> as well with the same block order.</li>
</ol>

<p>Example:
An unisotropic input image of w<em>h=100</em>49 pixels depicts a phsical space of 200<em>196mm.
Let's assume that we want to express the image height h in relation to its width w
instead of only accepting input images of exactly 100</em>49 pixels
(for example to express a range of valid image shapes by parametrizing w, see <code><a href="#ParameterizedSize">ParameterizedSize</a></code>).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">SpaceInputAxis</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;millimeter&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">SpaceInputAxis</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">size</span><span class="o">=</span><span class="n">SizeReference</span><span class="p">(</span><span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;millimeter&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">scale</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
<span class="go">49</span>
</code></pre>
</div>

<p> h = w * w.scale / h.scale + offset = 100 * 2mm / 4mm - 1 = 49</p>
</div>


                            <div id="SizeReference.tensor_id" class="classattr">
                                <div class="attr variable">
            <span class="name">tensor_id</span><span class="annotation">: <a href="#TensorId">TensorId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SizeReference.tensor_id"></a>
    
            <div class="docstring"><p>tensor id of the reference axis</p>
</div>


                            </div>
                            <div id="SizeReference.axis_id" class="classattr">
                                <div class="attr variable">
            <span class="name">axis_id</span><span class="annotation">: <a href="#AxisId">AxisId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SizeReference.axis_id"></a>
    
            <div class="docstring"><p>axis id of the reference axis</p>
</div>


                            </div>
                            <div id="SizeReference.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: Annotated[int, Strict(strict=True)]</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#SizeReference.offset"></a>
    
    

                            </div>
                            <div id="SizeReference.get_size" class="classattr">
                                        <input id="SizeReference.get_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_size</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#ChannelAxis">ChannelAxis</a></span><span class="p">,</span> <span class="n"><a href="#IndexInputAxis">IndexInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#IndexOutputAxis">IndexOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeInputAxis">TimeInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#SpaceInputAxis">SpaceInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeOutputAxis">TimeOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a></span><span class="p">,</span> <span class="n"><a href="#SpaceOutputAxis">SpaceOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">ref_axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#ChannelAxis">ChannelAxis</a></span><span class="p">,</span> <span class="n"><a href="#IndexInputAxis">IndexInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#IndexOutputAxis">IndexOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeInputAxis">TimeInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#SpaceInputAxis">SpaceInputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeOutputAxis">TimeOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a></span><span class="p">,</span> <span class="n"><a href="#SpaceOutputAxis">SpaceOutputAxis</a></span><span class="p">,</span> <span class="n"><a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">ref_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SizeReference.get_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SizeReference.get_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SizeReference.get_size-393"><a href="#SizeReference.get_size-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_size</span><span class="p">(</span>
</span><span id="SizeReference.get_size-394"><a href="#SizeReference.get_size-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SizeReference.get_size-395"><a href="#SizeReference.get_size-395"><span class="linenos">395</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="SizeReference.get_size-396"><a href="#SizeReference.get_size-396"><span class="linenos">396</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-397"><a href="#SizeReference.get_size-397"><span class="linenos">397</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-398"><a href="#SizeReference.get_size-398"><span class="linenos">398</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-399"><a href="#SizeReference.get_size-399"><span class="linenos">399</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-400"><a href="#SizeReference.get_size-400"><span class="linenos">400</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-401"><a href="#SizeReference.get_size-401"><span class="linenos">401</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-402"><a href="#SizeReference.get_size-402"><span class="linenos">402</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference.get_size-403"><a href="#SizeReference.get_size-403"><span class="linenos">403</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-404"><a href="#SizeReference.get_size-404"><span class="linenos">404</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference.get_size-405"><a href="#SizeReference.get_size-405"><span class="linenos">405</span></a>        <span class="p">],</span>
</span><span id="SizeReference.get_size-406"><a href="#SizeReference.get_size-406"><span class="linenos">406</span></a>        <span class="n">ref_axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="SizeReference.get_size-407"><a href="#SizeReference.get_size-407"><span class="linenos">407</span></a>            <span class="n">ChannelAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-408"><a href="#SizeReference.get_size-408"><span class="linenos">408</span></a>            <span class="n">IndexInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-409"><a href="#SizeReference.get_size-409"><span class="linenos">409</span></a>            <span class="n">IndexOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-410"><a href="#SizeReference.get_size-410"><span class="linenos">410</span></a>            <span class="n">TimeInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-411"><a href="#SizeReference.get_size-411"><span class="linenos">411</span></a>            <span class="n">SpaceInputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-412"><a href="#SizeReference.get_size-412"><span class="linenos">412</span></a>            <span class="n">TimeOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-413"><a href="#SizeReference.get_size-413"><span class="linenos">413</span></a>            <span class="n">TimeOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference.get_size-414"><a href="#SizeReference.get_size-414"><span class="linenos">414</span></a>            <span class="n">SpaceOutputAxis</span><span class="p">,</span>
</span><span id="SizeReference.get_size-415"><a href="#SizeReference.get_size-415"><span class="linenos">415</span></a>            <span class="n">SpaceOutputAxisWithHalo</span><span class="p">,</span>
</span><span id="SizeReference.get_size-416"><a href="#SizeReference.get_size-416"><span class="linenos">416</span></a>        <span class="p">],</span>
</span><span id="SizeReference.get_size-417"><a href="#SizeReference.get_size-417"><span class="linenos">417</span></a>        <span class="n">n</span><span class="p">:</span> <span class="n">ParameterizedSize_N</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SizeReference.get_size-418"><a href="#SizeReference.get_size-418"><span class="linenos">418</span></a>        <span class="n">ref_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SizeReference.get_size-419"><a href="#SizeReference.get_size-419"><span class="linenos">419</span></a>    <span class="p">):</span>
</span><span id="SizeReference.get_size-420"><a href="#SizeReference.get_size-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the concrete size for a given axis and its reference axis.</span>
</span><span id="SizeReference.get_size-421"><a href="#SizeReference.get_size-421"><span class="linenos">421</span></a>
</span><span id="SizeReference.get_size-422"><a href="#SizeReference.get_size-422"><span class="linenos">422</span></a><span class="sd">        Args:</span>
</span><span id="SizeReference.get_size-423"><a href="#SizeReference.get_size-423"><span class="linenos">423</span></a><span class="sd">            axis: The axis this `SizeReference` is the size of.</span>
</span><span id="SizeReference.get_size-424"><a href="#SizeReference.get_size-424"><span class="linenos">424</span></a><span class="sd">            ref_axis: The reference axis to compute the size from.</span>
</span><span id="SizeReference.get_size-425"><a href="#SizeReference.get_size-425"><span class="linenos">425</span></a><span class="sd">            n: If the **ref_axis** is parameterized (of type `ParameterizedSize`)</span>
</span><span id="SizeReference.get_size-426"><a href="#SizeReference.get_size-426"><span class="linenos">426</span></a><span class="sd">                and no fixed **ref_size** is given,</span>
</span><span id="SizeReference.get_size-427"><a href="#SizeReference.get_size-427"><span class="linenos">427</span></a><span class="sd">                **n** is used to compute the size of the parameterized **ref_axis**.</span>
</span><span id="SizeReference.get_size-428"><a href="#SizeReference.get_size-428"><span class="linenos">428</span></a><span class="sd">            ref_size: Overwrite the reference size instead of deriving it from</span>
</span><span id="SizeReference.get_size-429"><a href="#SizeReference.get_size-429"><span class="linenos">429</span></a><span class="sd">                **ref_axis**</span>
</span><span id="SizeReference.get_size-430"><a href="#SizeReference.get_size-430"><span class="linenos">430</span></a><span class="sd">                (**ref_axis.scale** is still used; any given **n** is ignored).</span>
</span><span id="SizeReference.get_size-431"><a href="#SizeReference.get_size-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SizeReference.get_size-432"><a href="#SizeReference.get_size-432"><span class="linenos">432</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference.get_size-433"><a href="#SizeReference.get_size-433"><span class="linenos">433</span></a>            <span class="s2">&quot;Given `axis.size` is not defined by this `SizeReference`&quot;</span>
</span><span id="SizeReference.get_size-434"><a href="#SizeReference.get_size-434"><span class="linenos">434</span></a>        <span class="p">)</span>
</span><span id="SizeReference.get_size-435"><a href="#SizeReference.get_size-435"><span class="linenos">435</span></a>
</span><span id="SizeReference.get_size-436"><a href="#SizeReference.get_size-436"><span class="linenos">436</span></a>        <span class="k">assert</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference.get_size-437"><a href="#SizeReference.get_size-437"><span class="linenos">437</span></a>            <span class="sa">f</span><span class="s2">&quot;Expected `ref_axis.id` to be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_id</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="SizeReference.get_size-438"><a href="#SizeReference.get_size-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="SizeReference.get_size-439"><a href="#SizeReference.get_size-439"><span class="linenos">439</span></a>
</span><span id="SizeReference.get_size-440"><a href="#SizeReference.get_size-440"><span class="linenos">440</span></a>        <span class="k">assert</span> <span class="n">axis</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="p">(</span>
</span><span id="SizeReference.get_size-441"><a href="#SizeReference.get_size-441"><span class="linenos">441</span></a>            <span class="s2">&quot;`SizeReference` requires `axis` and `ref_axis` to have the same `unit`,&quot;</span>
</span><span id="SizeReference.get_size-442"><a href="#SizeReference.get_size-442"><span class="linenos">442</span></a>            <span class="sa">f</span><span class="s2">&quot; but </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SizeReference.get_size-443"><a href="#SizeReference.get_size-443"><span class="linenos">443</span></a>        <span class="p">)</span>
</span><span id="SizeReference.get_size-444"><a href="#SizeReference.get_size-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SizeReference.get_size-445"><a href="#SizeReference.get_size-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span><span id="SizeReference.get_size-446"><a href="#SizeReference.get_size-446"><span class="linenos">446</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span>
</span><span id="SizeReference.get_size-447"><a href="#SizeReference.get_size-447"><span class="linenos">447</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="SizeReference.get_size-448"><a href="#SizeReference.get_size-448"><span class="linenos">448</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="SizeReference.get_size-449"><a href="#SizeReference.get_size-449"><span class="linenos">449</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="SizeReference.get_size-450"><a href="#SizeReference.get_size-450"><span class="linenos">450</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SizeReference.get_size-451"><a href="#SizeReference.get_size-451"><span class="linenos">451</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be a `DataDependentSize`.&quot;</span>
</span><span id="SizeReference.get_size-452"><a href="#SizeReference.get_size-452"><span class="linenos">452</span></a>                <span class="p">)</span>
</span><span id="SizeReference.get_size-453"><a href="#SizeReference.get_size-453"><span class="linenos">453</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="SizeReference.get_size-454"><a href="#SizeReference.get_size-454"><span class="linenos">454</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SizeReference.get_size-455"><a href="#SizeReference.get_size-455"><span class="linenos">455</span></a>                    <span class="s2">&quot;Reference axis referenced in `SizeReference` may not be sized by a&quot;</span>
</span><span id="SizeReference.get_size-456"><a href="#SizeReference.get_size-456"><span class="linenos">456</span></a>                    <span class="o">+</span> <span class="s2">&quot; `SizeReference` itself.&quot;</span>
</span><span id="SizeReference.get_size-457"><a href="#SizeReference.get_size-457"><span class="linenos">457</span></a>                <span class="p">)</span>
</span><span id="SizeReference.get_size-458"><a href="#SizeReference.get_size-458"><span class="linenos">458</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SizeReference.get_size-459"><a href="#SizeReference.get_size-459"><span class="linenos">459</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="SizeReference.get_size-460"><a href="#SizeReference.get_size-460"><span class="linenos">460</span></a>
</span><span id="SizeReference.get_size-461"><a href="#SizeReference.get_size-461"><span class="linenos">461</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref_size</span> <span class="o">*</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the concrete size for a given axis and its reference axis.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>axis:</strong>  The axis this <code><a href="#SizeReference">SizeReference</a></code> is the size of.</li>
<li><strong>ref_axis:</strong>  The reference axis to compute the size from.</li>
<li><strong>n:</strong>  If the <strong>ref_axis</strong> is parameterized (of type <code><a href="#ParameterizedSize">ParameterizedSize</a></code>)
and no fixed <strong>ref_size</strong> is given,
<strong>n</strong> is used to compute the size of the parameterized <strong>ref_axis</strong>.</li>
<li><strong>ref_size:</strong>  Overwrite the reference size instead of deriving it from
<strong>ref_axis</strong>
(<strong>ref_axis.scale</strong> is still used; any given <strong>n</strong> is ignored).</li>
</ul>
</div>


                            </div>
                </section>
                <section id="AxisBase">
                            <input id="AxisBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AxisBase</span><wbr>(<span class="base">bioimageio.spec._internal.common_nodes.NodeWithExplicitlySetFields</span>):

                <label class="view-source-button" for="AxisBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AxisBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AxisBase-480"><a href="#AxisBase-480"><span class="linenos">480</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AxisBase</span><span class="p">(</span><span class="n">NodeWithExplicitlySetFields</span><span class="p">):</span>
</span><span id="AxisBase-481"><a href="#AxisBase-481"><span class="linenos">481</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">AxisId</span>
</span><span id="AxisBase-482"><a href="#AxisBase-482"><span class="linenos">482</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An axis id unique across all axes of one tensor.&quot;&quot;&quot;</span>
</span><span id="AxisBase-483"><a href="#AxisBase-483"><span class="linenos">483</span></a>
</span><span id="AxisBase-484"><a href="#AxisBase-484"><span class="linenos">484</span></a>    <span class="n">description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="AxisBase-485"><a href="#AxisBase-485"><span class="linenos">485</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A short description of this axis beyond its type and id.&quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="AxisBase.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: <a href="#AxisId">AxisId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#AxisBase.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="AxisBase.description" class="classattr">
                                <div class="attr variable">
            <span class="name">description</span><span class="annotation">: Annotated[str, MaxLen(max_length=128)]</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#AxisBase.description"></a>
    
            <div class="docstring"><p>A short description of this axis beyond its type and id.</p>
</div>


                            </div>
                </section>
                <section id="WithHalo">
                            <input id="WithHalo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WithHalo</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="WithHalo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WithHalo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WithHalo-488"><a href="#WithHalo-488"><span class="linenos">488</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WithHalo</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="WithHalo-489"><a href="#WithHalo-489"><span class="linenos">489</span></a>    <span class="n">halo</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="WithHalo-490"><a href="#WithHalo-490"><span class="linenos">490</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The halo should be cropped from the output tensor to avoid boundary effects.</span>
</span><span id="WithHalo-491"><a href="#WithHalo-491"><span class="linenos">491</span></a><span class="sd">    It is to be cropped from both sides, i.e. `size_after_crop = size - 2 * halo`.</span>
</span><span id="WithHalo-492"><a href="#WithHalo-492"><span class="linenos">492</span></a><span class="sd">    To document a halo that is already cropped by the model use `size.offset` instead.&quot;&quot;&quot;</span>
</span><span id="WithHalo-493"><a href="#WithHalo-493"><span class="linenos">493</span></a>
</span><span id="WithHalo-494"><a href="#WithHalo-494"><span class="linenos">494</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="WithHalo-495"><a href="#WithHalo-495"><span class="linenos">495</span></a>        <span class="n">SizeReference</span><span class="p">,</span>
</span><span id="WithHalo-496"><a href="#WithHalo-496"><span class="linenos">496</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="WithHalo-497"><a href="#WithHalo-497"><span class="linenos">497</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="WithHalo-498"><a href="#WithHalo-498"><span class="linenos">498</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="WithHalo-499"><a href="#WithHalo-499"><span class="linenos">499</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="WithHalo-500"><a href="#WithHalo-500"><span class="linenos">500</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="WithHalo-501"><a href="#WithHalo-501"><span class="linenos">501</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="WithHalo-502"><a href="#WithHalo-502"><span class="linenos">502</span></a>            <span class="p">]</span>
</span><span id="WithHalo-503"><a href="#WithHalo-503"><span class="linenos">503</span></a>        <span class="p">),</span>
</span><span id="WithHalo-504"><a href="#WithHalo-504"><span class="linenos">504</span></a>    <span class="p">]</span>
</span><span id="WithHalo-505"><a href="#WithHalo-505"><span class="linenos">505</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;reference to another axis with an optional offset (see `SizeReference`)&quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="WithHalo.halo" class="classattr">
                                <div class="attr variable">
            <span class="name">halo</span><span class="annotation">: Annotated[int, Ge(ge=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#WithHalo.halo"></a>
    
            <div class="docstring"><p>The halo should be cropped from the output tensor to avoid boundary effects.
It is to be cropped from both sides, i.e. <code>size_after_crop = size - 2 * halo</code>.
To document a halo that is already cropped by the model use <code>size.offset</code> instead.</p>
</div>


                            </div>
                            <div id="WithHalo.size" class="classattr">
                                <div class="attr variable">
            <span class="name">size</span><span class="annotation">: Annotated[<a href="#SizeReference">SizeReference</a>, FieldInfo(annotation=NoneType, required=True, examples=[10, {&#39;tensor_id&#39;: &#39;t&#39;, &#39;axis_id&#39;: &#39;a&#39;, &#39;offset&#39;: 5}])]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#WithHalo.size"></a>
    
            <div class="docstring"><p>reference to another axis with an optional offset (see <code><a href="#SizeReference">SizeReference</a></code>)</p>
</div>


                            </div>
                </section>
                <section id="BATCH_AXIS_ID">
                    <div class="attr variable">
            <span class="name">BATCH_AXIS_ID</span>        =
<span class="default_value">&#39;batch&#39;</span>

        
    </div>
    <a class="headerlink" href="#BATCH_AXIS_ID"></a>
    
    

                </section>
                <section id="BatchAxis">
                            <input id="BatchAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BatchAxis</span><wbr>(<span class="base"><a href="#AxisBase">AxisBase</a></span>):

                <label class="view-source-button" for="BatchAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchAxis-511"><a href="#BatchAxis-511"><span class="linenos">511</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BatchAxis</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="BatchAxis-512"><a href="#BatchAxis-512"><span class="linenos">512</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;batch&quot;</span>
</span><span id="BatchAxis-513"><a href="#BatchAxis-513"><span class="linenos">513</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="BatchAxis-514"><a href="#BatchAxis-514"><span class="linenos">514</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;batch&quot;</span>
</span><span id="BatchAxis-515"><a href="#BatchAxis-515"><span class="linenos">515</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="BatchAxis-516"><a href="#BatchAxis-516"><span class="linenos">516</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span>
</span><span id="BatchAxis-517"><a href="#BatchAxis-517"><span class="linenos">517</span></a>
</span><span id="BatchAxis-518"><a href="#BatchAxis-518"><span class="linenos">518</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">_is_batch</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BATCH_AXIS_ID</span>
</span><span id="BatchAxis-519"><a href="#BatchAxis-519"><span class="linenos">519</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BatchAxis-520"><a href="#BatchAxis-520"><span class="linenos">520</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The batch size may be fixed to 1,</span>
</span><span id="BatchAxis-521"><a href="#BatchAxis-521"><span class="linenos">521</span></a><span class="sd">    otherwise (the default) it may be chosen arbitrarily depending on available memory&quot;&quot;&quot;</span>
</span><span id="BatchAxis-522"><a href="#BatchAxis-522"><span class="linenos">522</span></a>
</span><span id="BatchAxis-523"><a href="#BatchAxis-523"><span class="linenos">523</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis-524"><a href="#BatchAxis-524"><span class="linenos">524</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis-525"><a href="#BatchAxis-525"><span class="linenos">525</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="BatchAxis-526"><a href="#BatchAxis-526"><span class="linenos">526</span></a>
</span><span id="BatchAxis-527"><a href="#BatchAxis-527"><span class="linenos">527</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis-528"><a href="#BatchAxis-528"><span class="linenos">528</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis-529"><a href="#BatchAxis-529"><span class="linenos">529</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="BatchAxis-530"><a href="#BatchAxis-530"><span class="linenos">530</span></a>
</span><span id="BatchAxis-531"><a href="#BatchAxis-531"><span class="linenos">531</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis-532"><a href="#BatchAxis-532"><span class="linenos">532</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis-533"><a href="#BatchAxis-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            <div id="BatchAxis.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;batch&#39;]]</span>        =
<span class="default_value">&#39;batch&#39;</span>

        
    </div>
    <a class="headerlink" href="#BatchAxis.implemented_type"></a>
    
    

                            </div>
                            <div id="BatchAxis.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_batch)]</span>        =
<span class="default_value">&#39;batch&#39;</span>

        
    </div>
    <a class="headerlink" href="#BatchAxis.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="BatchAxis.size" class="classattr">
                                <div class="attr variable">
            <span class="name">size</span><span class="annotation">: Optional[Literal[1]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#BatchAxis.size"></a>
    
            <div class="docstring"><p>The batch size may be fixed to 1,
otherwise (the default) it may be chosen arbitrarily depending on available memory</p>
</div>


                            </div>
                            <div id="BatchAxis.scale" class="classattr">
                                        <input id="BatchAxis.scale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">scale</span>

                <label class="view-source-button" for="BatchAxis.scale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchAxis.scale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchAxis.scale-523"><a href="#BatchAxis.scale-523"><span class="linenos">523</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis.scale-524"><a href="#BatchAxis.scale-524"><span class="linenos">524</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis.scale-525"><a href="#BatchAxis.scale-525"><span class="linenos">525</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span></pre></div>


    

                            </div>
                            <div id="BatchAxis.concatenable" class="classattr">
                                        <input id="BatchAxis.concatenable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">concatenable</span>

                <label class="view-source-button" for="BatchAxis.concatenable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchAxis.concatenable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchAxis.concatenable-527"><a href="#BatchAxis.concatenable-527"><span class="linenos">527</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis.concatenable-528"><a href="#BatchAxis.concatenable-528"><span class="linenos">528</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis.concatenable-529"><a href="#BatchAxis.concatenable-529"><span class="linenos">529</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="BatchAxis.unit" class="classattr">
                                        <input id="BatchAxis.unit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">unit</span>

                <label class="view-source-button" for="BatchAxis.unit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BatchAxis.unit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BatchAxis.unit-531"><a href="#BatchAxis.unit-531"><span class="linenos">531</span></a>    <span class="nd">@property</span>
</span><span id="BatchAxis.unit-532"><a href="#BatchAxis.unit-532"><span class="linenos">532</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="BatchAxis.unit-533"><a href="#BatchAxis.unit-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="BatchAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;batch&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BatchAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="BatchAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ChannelAxis">
                            <input id="ChannelAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChannelAxis</span><wbr>(<span class="base"><a href="#AxisBase">AxisBase</a></span>):

                <label class="view-source-button" for="ChannelAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChannelAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChannelAxis-536"><a href="#ChannelAxis-536"><span class="linenos">536</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChannelAxis</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="ChannelAxis-537"><a href="#ChannelAxis-537"><span class="linenos">537</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;channel&quot;</span>
</span><span id="ChannelAxis-538"><a href="#ChannelAxis-538"><span class="linenos">538</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ChannelAxis-539"><a href="#ChannelAxis-539"><span class="linenos">539</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;channel&quot;</span>
</span><span id="ChannelAxis-540"><a href="#ChannelAxis-540"><span class="linenos">540</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ChannelAxis-541"><a href="#ChannelAxis-541"><span class="linenos">541</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">]</span>
</span><span id="ChannelAxis-542"><a href="#ChannelAxis-542"><span class="linenos">542</span></a>
</span><span id="ChannelAxis-543"><a href="#ChannelAxis-543"><span class="linenos">543</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">)</span>
</span><span id="ChannelAxis-544"><a href="#ChannelAxis-544"><span class="linenos">544</span></a>
</span><span id="ChannelAxis-545"><a href="#ChannelAxis-545"><span class="linenos">545</span></a>    <span class="n">channel_names</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]]</span>
</span><span id="ChannelAxis-546"><a href="#ChannelAxis-546"><span class="linenos">546</span></a>
</span><span id="ChannelAxis-547"><a href="#ChannelAxis-547"><span class="linenos">547</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis-548"><a href="#ChannelAxis-548"><span class="linenos">548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChannelAxis-549"><a href="#ChannelAxis-549"><span class="linenos">549</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_names</span><span class="p">)</span>
</span><span id="ChannelAxis-550"><a href="#ChannelAxis-550"><span class="linenos">550</span></a>
</span><span id="ChannelAxis-551"><a href="#ChannelAxis-551"><span class="linenos">551</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis-552"><a href="#ChannelAxis-552"><span class="linenos">552</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ChannelAxis-553"><a href="#ChannelAxis-553"><span class="linenos">553</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ChannelAxis-554"><a href="#ChannelAxis-554"><span class="linenos">554</span></a>
</span><span id="ChannelAxis-555"><a href="#ChannelAxis-555"><span class="linenos">555</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis-556"><a href="#ChannelAxis-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ChannelAxis-557"><a href="#ChannelAxis-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="ChannelAxis-558"><a href="#ChannelAxis-558"><span class="linenos">558</span></a>
</span><span id="ChannelAxis-559"><a href="#ChannelAxis-559"><span class="linenos">559</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis-560"><a href="#ChannelAxis-560"><span class="linenos">560</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ChannelAxis-561"><a href="#ChannelAxis-561"><span class="linenos">561</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            <div id="ChannelAxis.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;channel&#39;]]</span>        =
<span class="default_value">&#39;channel&#39;</span>

        
    </div>
    <a class="headerlink" href="#ChannelAxis.implemented_type"></a>
    
    

                            </div>
                            <div id="ChannelAxis.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch)]</span>        =
<span class="default_value">&#39;channel&#39;</span>

        
    </div>
    <a class="headerlink" href="#ChannelAxis.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="ChannelAxis.channel_names" class="classattr">
                                <div class="attr variable">
            <span class="name">channel_names</span><span class="annotation">: Annotated[List[bioimageio.spec._internal.types.Identifier], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ChannelAxis.channel_names"></a>
    
    

                            </div>
                            <div id="ChannelAxis.size" class="classattr">
                                        <input id="ChannelAxis.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ChannelAxis.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChannelAxis.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChannelAxis.size-547"><a href="#ChannelAxis.size-547"><span class="linenos">547</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis.size-548"><a href="#ChannelAxis.size-548"><span class="linenos">548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChannelAxis.size-549"><a href="#ChannelAxis.size-549"><span class="linenos">549</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_names</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ChannelAxis.concatenable" class="classattr">
                                        <input id="ChannelAxis.concatenable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">concatenable</span>

                <label class="view-source-button" for="ChannelAxis.concatenable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChannelAxis.concatenable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChannelAxis.concatenable-551"><a href="#ChannelAxis.concatenable-551"><span class="linenos">551</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis.concatenable-552"><a href="#ChannelAxis.concatenable-552"><span class="linenos">552</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">concatenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ChannelAxis.concatenable-553"><a href="#ChannelAxis.concatenable-553"><span class="linenos">553</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


    

                            </div>
                            <div id="ChannelAxis.scale" class="classattr">
                                        <input id="ChannelAxis.scale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">scale</span><span class="annotation">: float</span>

                <label class="view-source-button" for="ChannelAxis.scale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChannelAxis.scale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChannelAxis.scale-555"><a href="#ChannelAxis.scale-555"><span class="linenos">555</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis.scale-556"><a href="#ChannelAxis.scale-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ChannelAxis.scale-557"><a href="#ChannelAxis.scale-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span></pre></div>


    

                            </div>
                            <div id="ChannelAxis.unit" class="classattr">
                                        <input id="ChannelAxis.unit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">unit</span>

                <label class="view-source-button" for="ChannelAxis.unit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChannelAxis.unit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChannelAxis.unit-559"><a href="#ChannelAxis.unit-559"><span class="linenos">559</span></a>    <span class="nd">@property</span>
</span><span id="ChannelAxis.unit-560"><a href="#ChannelAxis.unit-560"><span class="linenos">560</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ChannelAxis.unit-561"><a href="#ChannelAxis.unit-561"><span class="linenos">561</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="ChannelAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;channel&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ChannelAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="ChannelAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IndexAxisBase">
                            <input id="IndexAxisBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IndexAxisBase</span><wbr>(<span class="base"><a href="#AxisBase">AxisBase</a></span>):

                <label class="view-source-button" for="IndexAxisBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexAxisBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexAxisBase-564"><a href="#IndexAxisBase-564"><span class="linenos">564</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="IndexAxisBase-565"><a href="#IndexAxisBase-565"><span class="linenos">565</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span id="IndexAxisBase-566"><a href="#IndexAxisBase-566"><span class="linenos">566</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="IndexAxisBase-567"><a href="#IndexAxisBase-567"><span class="linenos">567</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span id="IndexAxisBase-568"><a href="#IndexAxisBase-568"><span class="linenos">568</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="IndexAxisBase-569"><a href="#IndexAxisBase-569"><span class="linenos">569</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
</span><span id="IndexAxisBase-570"><a href="#IndexAxisBase-570"><span class="linenos">570</span></a>
</span><span id="IndexAxisBase-571"><a href="#IndexAxisBase-571"><span class="linenos">571</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="IndexAxisBase-572"><a href="#IndexAxisBase-572"><span class="linenos">572</span></a>
</span><span id="IndexAxisBase-573"><a href="#IndexAxisBase-573"><span class="linenos">573</span></a>    <span class="nd">@property</span>
</span><span id="IndexAxisBase-574"><a href="#IndexAxisBase-574"><span class="linenos">574</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="IndexAxisBase-575"><a href="#IndexAxisBase-575"><span class="linenos">575</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span><span id="IndexAxisBase-576"><a href="#IndexAxisBase-576"><span class="linenos">576</span></a>
</span><span id="IndexAxisBase-577"><a href="#IndexAxisBase-577"><span class="linenos">577</span></a>    <span class="nd">@property</span>
</span><span id="IndexAxisBase-578"><a href="#IndexAxisBase-578"><span class="linenos">578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="IndexAxisBase-579"><a href="#IndexAxisBase-579"><span class="linenos">579</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            <div id="IndexAxisBase.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;index&#39;]]</span>        =
<span class="default_value">&#39;index&#39;</span>

        
    </div>
    <a class="headerlink" href="#IndexAxisBase.implemented_type"></a>
    
    

                            </div>
                            <div id="IndexAxisBase.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch)]</span>        =
<span class="default_value">&#39;index&#39;</span>

        
    </div>
    <a class="headerlink" href="#IndexAxisBase.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="IndexAxisBase.scale" class="classattr">
                                        <input id="IndexAxisBase.scale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">scale</span><span class="annotation">: float</span>

                <label class="view-source-button" for="IndexAxisBase.scale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexAxisBase.scale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexAxisBase.scale-573"><a href="#IndexAxisBase.scale-573"><span class="linenos">573</span></a>    <span class="nd">@property</span>
</span><span id="IndexAxisBase.scale-574"><a href="#IndexAxisBase.scale-574"><span class="linenos">574</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="IndexAxisBase.scale-575"><a href="#IndexAxisBase.scale-575"><span class="linenos">575</span></a>        <span class="k">return</span> <span class="mf">1.0</span>
</span></pre></div>


    

                            </div>
                            <div id="IndexAxisBase.unit" class="classattr">
                                        <input id="IndexAxisBase.unit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">unit</span>

                <label class="view-source-button" for="IndexAxisBase.unit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexAxisBase.unit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexAxisBase.unit-577"><a href="#IndexAxisBase.unit-577"><span class="linenos">577</span></a>    <span class="nd">@property</span>
</span><span id="IndexAxisBase.unit-578"><a href="#IndexAxisBase.unit-578"><span class="linenos">578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="IndexAxisBase.unit-579"><a href="#IndexAxisBase.unit-579"><span class="linenos">579</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="IndexAxisBase.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;index&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#IndexAxisBase.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="IndexAxisBase.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IndexInputAxis">
                            <input id="IndexInputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IndexInputAxis</span><wbr>(<span class="base"><a href="#IndexAxisBase">IndexAxisBase</a></span>, <span class="base"><a href="#_WithInputAxisSize">_WithInputAxisSize</a></span>):

                <label class="view-source-button" for="IndexInputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexInputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexInputAxis-602"><a href="#IndexInputAxis-602"><span class="linenos">602</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexInputAxis</span><span class="p">(</span><span class="n">IndexAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="IndexInputAxis-603"><a href="#IndexInputAxis-603"><span class="linenos">603</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="IndexInputAxis-604"><a href="#IndexInputAxis-604"><span class="linenos">604</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="IndexInputAxis-605"><a href="#IndexInputAxis-605"><span class="linenos">605</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="IndexInputAxis-606"><a href="#IndexInputAxis-606"><span class="linenos">606</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="IndexInputAxis-607"><a href="#IndexInputAxis-607"><span class="linenos">607</span></a><span class="sd">    input axis.</span>
</span><span id="IndexInputAxis-608"><a href="#IndexInputAxis-608"><span class="linenos">608</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="IndexInputAxis.concatenable" class="classattr">
                                <div class="attr variable">
            <span class="name">concatenable</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#IndexInputAxis.concatenable"></a>
    
            <div class="docstring"><p>If a model has a <code><a href="#IndexInputAxis.concatenable">concatenable</a></code> input axis, it can be processed blockwise,
splitting a longer sample axis into blocks matching its input tensor description.
Output axes are concatenable if they have a <code><a href="#SizeReference">SizeReference</a></code> to a concatenable
input axis.</p>
</div>


                            </div>
                            <div id="IndexInputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;index&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#IndexInputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#IndexAxisBase">IndexAxisBase</a></dt>
                                <dd id="IndexInputAxis.implemented_type" class="variable"><a href="#IndexAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="IndexInputAxis.id" class="variable"><a href="#IndexAxisBase.id">id</a></dd>
                <dd id="IndexInputAxis.scale" class="variable"><a href="#IndexAxisBase.scale">scale</a></dd>
                <dd id="IndexInputAxis.unit" class="variable"><a href="#IndexAxisBase.unit">unit</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="IndexInputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#_WithInputAxisSize">_WithInputAxisSize</a></dt>
                                <dd id="IndexInputAxis.size" class="variable"><a href="#_WithInputAxisSize.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IndexOutputAxis">
                            <input id="IndexOutputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IndexOutputAxis</span><wbr>(<span class="base"><a href="#IndexAxisBase">IndexAxisBase</a></span>):

                <label class="view-source-button" for="IndexOutputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexOutputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexOutputAxis-611"><a href="#IndexOutputAxis-611"><span class="linenos">611</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexOutputAxis</span><span class="p">(</span><span class="n">IndexAxisBase</span><span class="p">):</span>
</span><span id="IndexOutputAxis-612"><a href="#IndexOutputAxis-612"><span class="linenos">612</span></a>    <span class="n">size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="IndexOutputAxis-613"><a href="#IndexOutputAxis-613"><span class="linenos">613</span></a>        <span class="n">Union</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">SizeReference</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">],</span>
</span><span id="IndexOutputAxis-614"><a href="#IndexOutputAxis-614"><span class="linenos">614</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="IndexOutputAxis-615"><a href="#IndexOutputAxis-615"><span class="linenos">615</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="IndexOutputAxis-616"><a href="#IndexOutputAxis-616"><span class="linenos">616</span></a>                <span class="mi">10</span><span class="p">,</span>
</span><span id="IndexOutputAxis-617"><a href="#IndexOutputAxis-617"><span class="linenos">617</span></a>                <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="IndexOutputAxis-618"><a href="#IndexOutputAxis-618"><span class="linenos">618</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">),</span> <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span>
</span><span id="IndexOutputAxis-619"><a href="#IndexOutputAxis-619"><span class="linenos">619</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span>
</span><span id="IndexOutputAxis-620"><a href="#IndexOutputAxis-620"><span class="linenos">620</span></a>            <span class="p">]</span>
</span><span id="IndexOutputAxis-621"><a href="#IndexOutputAxis-621"><span class="linenos">621</span></a>        <span class="p">),</span>
</span><span id="IndexOutputAxis-622"><a href="#IndexOutputAxis-622"><span class="linenos">622</span></a>    <span class="p">]</span>
</span><span id="IndexOutputAxis-623"><a href="#IndexOutputAxis-623"><span class="linenos">623</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The size/length of this axis can be specified as</span>
</span><span id="IndexOutputAxis-624"><a href="#IndexOutputAxis-624"><span class="linenos">624</span></a><span class="sd">    - fixed integer</span>
</span><span id="IndexOutputAxis-625"><a href="#IndexOutputAxis-625"><span class="linenos">625</span></a><span class="sd">    - reference to another axis with an optional offset (`SizeReference`)</span>
</span><span id="IndexOutputAxis-626"><a href="#IndexOutputAxis-626"><span class="linenos">626</span></a><span class="sd">    - data dependent size using `DataDependentSize` (size is only known after model inference)</span>
</span><span id="IndexOutputAxis-627"><a href="#IndexOutputAxis-627"><span class="linenos">627</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="IndexOutputAxis.size" class="classattr">
                                <div class="attr variable">
            <span class="name">size</span><span class="annotation">: Annotated[Union[Annotated[int, Gt(gt=0)], <a href="#SizeReference">SizeReference</a>, <a href="#DataDependentSize">DataDependentSize</a>], FieldInfo(annotation=NoneType, required=True, examples=[10, {&#39;tensor_id&#39;: &#39;t&#39;, &#39;axis_id&#39;: &#39;a&#39;, &#39;offset&#39;: 5}])]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#IndexOutputAxis.size"></a>
    
            <div class="docstring"><p>The size/length of this axis can be specified as</p>

<ul>
<li>fixed integer</li>
<li>reference to another axis with an optional offset (<code><a href="#SizeReference">SizeReference</a></code>)</li>
<li>data dependent size using <code><a href="#DataDependentSize">DataDependentSize</a></code> (size is only known after model inference)</li>
</ul>
</div>


                            </div>
                            <div id="IndexOutputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;index&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#IndexOutputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#IndexAxisBase">IndexAxisBase</a></dt>
                                <dd id="IndexOutputAxis.implemented_type" class="variable"><a href="#IndexAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="IndexOutputAxis.id" class="variable"><a href="#IndexAxisBase.id">id</a></dd>
                <dd id="IndexOutputAxis.scale" class="variable"><a href="#IndexAxisBase.scale">scale</a></dd>
                <dd id="IndexOutputAxis.unit" class="variable"><a href="#IndexAxisBase.unit">unit</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="IndexOutputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TimeAxisBase">
                            <input id="TimeAxisBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeAxisBase</span><wbr>(<span class="base"><a href="#AxisBase">AxisBase</a></span>):

                <label class="view-source-button" for="TimeAxisBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeAxisBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeAxisBase-630"><a href="#TimeAxisBase-630"><span class="linenos">630</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="TimeAxisBase-631"><a href="#TimeAxisBase-631"><span class="linenos">631</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="TimeAxisBase-632"><a href="#TimeAxisBase-632"><span class="linenos">632</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="TimeAxisBase-633"><a href="#TimeAxisBase-633"><span class="linenos">633</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="TimeAxisBase-634"><a href="#TimeAxisBase-634"><span class="linenos">634</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="TimeAxisBase-635"><a href="#TimeAxisBase-635"><span class="linenos">635</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="TimeAxisBase-636"><a href="#TimeAxisBase-636"><span class="linenos">636</span></a>
</span><span id="TimeAxisBase-637"><a href="#TimeAxisBase-637"><span class="linenos">637</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NonBatchAxisId</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="TimeAxisBase-638"><a href="#TimeAxisBase-638"><span class="linenos">638</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TimeUnit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TimeAxisBase-639"><a href="#TimeAxisBase-639"><span class="linenos">639</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span></pre></div>


    

                            <div id="TimeAxisBase.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;time&#39;]]</span>        =
<span class="default_value">&#39;time&#39;</span>

        
    </div>
    <a class="headerlink" href="#TimeAxisBase.implemented_type"></a>
    
    

                            </div>
                            <div id="TimeAxisBase.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch)]</span>        =
<span class="default_value">&#39;time&#39;</span>

        
    </div>
    <a class="headerlink" href="#TimeAxisBase.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="TimeAxisBase.unit" class="classattr">
                                <div class="attr variable">
            <span class="name">unit</span><span class="annotation">: Optional[Literal[&#39;attosecond&#39;, &#39;centisecond&#39;, &#39;day&#39;, &#39;decisecond&#39;, &#39;exasecond&#39;, &#39;femtosecond&#39;, &#39;gigasecond&#39;, &#39;hectosecond&#39;, &#39;hour&#39;, &#39;kilosecond&#39;, &#39;megasecond&#39;, &#39;microsecond&#39;, &#39;millisecond&#39;, &#39;minute&#39;, &#39;nanosecond&#39;, &#39;petasecond&#39;, &#39;picosecond&#39;, &#39;second&#39;, &#39;terasecond&#39;, &#39;yoctosecond&#39;, &#39;yottasecond&#39;, &#39;zeptosecond&#39;, &#39;zettasecond&#39;]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#TimeAxisBase.unit"></a>
    
    

                            </div>
                            <div id="TimeAxisBase.scale" class="classattr">
                                <div class="attr variable">
            <span class="name">scale</span><span class="annotation">: Annotated[float, Gt(gt=0)]</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#TimeAxisBase.scale"></a>
    
    

                            </div>
                            <div id="TimeAxisBase.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;time&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TimeAxisBase.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="TimeAxisBase.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TimeInputAxis">
                            <input id="TimeInputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeInputAxis</span><wbr>(<span class="base"><a href="#TimeAxisBase">TimeAxisBase</a></span>, <span class="base"><a href="#_WithInputAxisSize">_WithInputAxisSize</a></span>):

                <label class="view-source-button" for="TimeInputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeInputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeInputAxis-642"><a href="#TimeInputAxis-642"><span class="linenos">642</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeInputAxis</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="TimeInputAxis-643"><a href="#TimeInputAxis-643"><span class="linenos">643</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TimeInputAxis-644"><a href="#TimeInputAxis-644"><span class="linenos">644</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="TimeInputAxis-645"><a href="#TimeInputAxis-645"><span class="linenos">645</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="TimeInputAxis-646"><a href="#TimeInputAxis-646"><span class="linenos">646</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="TimeInputAxis-647"><a href="#TimeInputAxis-647"><span class="linenos">647</span></a><span class="sd">    input axis.</span>
</span><span id="TimeInputAxis-648"><a href="#TimeInputAxis-648"><span class="linenos">648</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="TimeInputAxis.concatenable" class="classattr">
                                <div class="attr variable">
            <span class="name">concatenable</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#TimeInputAxis.concatenable"></a>
    
            <div class="docstring"><p>If a model has a <code><a href="#TimeInputAxis.concatenable">concatenable</a></code> input axis, it can be processed blockwise,
splitting a longer sample axis into blocks matching its input tensor description.
Output axes are concatenable if they have a <code><a href="#SizeReference">SizeReference</a></code> to a concatenable
input axis.</p>
</div>


                            </div>
                            <div id="TimeInputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;time&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TimeInputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TimeAxisBase">TimeAxisBase</a></dt>
                                <dd id="TimeInputAxis.implemented_type" class="variable"><a href="#TimeAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="TimeInputAxis.id" class="variable"><a href="#TimeAxisBase.id">id</a></dd>
                <dd id="TimeInputAxis.unit" class="variable"><a href="#TimeAxisBase.unit">unit</a></dd>
                <dd id="TimeInputAxis.scale" class="variable"><a href="#TimeAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="TimeInputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#_WithInputAxisSize">_WithInputAxisSize</a></dt>
                                <dd id="TimeInputAxis.size" class="variable"><a href="#_WithInputAxisSize.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SpaceAxisBase">
                            <input id="SpaceAxisBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SpaceAxisBase</span><wbr>(<span class="base"><a href="#AxisBase">AxisBase</a></span>):

                <label class="view-source-button" for="SpaceAxisBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpaceAxisBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpaceAxisBase-651"><a href="#SpaceAxisBase-651"><span class="linenos">651</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceAxisBase</span><span class="p">(</span><span class="n">AxisBase</span><span class="p">):</span>
</span><span id="SpaceAxisBase-652"><a href="#SpaceAxisBase-652"><span class="linenos">652</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;space&quot;</span>
</span><span id="SpaceAxisBase-653"><a href="#SpaceAxisBase-653"><span class="linenos">653</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="SpaceAxisBase-654"><a href="#SpaceAxisBase-654"><span class="linenos">654</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;space&quot;</span>
</span><span id="SpaceAxisBase-655"><a href="#SpaceAxisBase-655"><span class="linenos">655</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="SpaceAxisBase-656"><a href="#SpaceAxisBase-656"><span class="linenos">656</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">]</span>
</span><span id="SpaceAxisBase-657"><a href="#SpaceAxisBase-657"><span class="linenos">657</span></a>
</span><span id="SpaceAxisBase-658"><a href="#SpaceAxisBase-658"><span class="linenos">658</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="SpaceAxisBase-659"><a href="#SpaceAxisBase-659"><span class="linenos">659</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SpaceUnit</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SpaceAxisBase-660"><a href="#SpaceAxisBase-660"><span class="linenos">660</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span></pre></div>


    

                            <div id="SpaceAxisBase.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;space&#39;]]</span>        =
<span class="default_value">&#39;space&#39;</span>

        
    </div>
    <a class="headerlink" href="#SpaceAxisBase.implemented_type"></a>
    
    

                            </div>
                            <div id="SpaceAxisBase.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch), FieldInfo(annotation=NoneType, required=True, examples=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;])]</span>        =
<span class="default_value">&#39;x&#39;</span>

        
    </div>
    <a class="headerlink" href="#SpaceAxisBase.id"></a>
    
            <div class="docstring"><p>An axis id unique across all axes of one tensor.</p>
</div>


                            </div>
                            <div id="SpaceAxisBase.unit" class="classattr">
                                <div class="attr variable">
            <span class="name">unit</span><span class="annotation">: Optional[Literal[&#39;attometer&#39;, &#39;angstrom&#39;, &#39;centimeter&#39;, &#39;decimeter&#39;, &#39;exameter&#39;, &#39;femtometer&#39;, &#39;foot&#39;, &#39;gigameter&#39;, &#39;hectometer&#39;, &#39;inch&#39;, &#39;kilometer&#39;, &#39;megameter&#39;, &#39;meter&#39;, &#39;micrometer&#39;, &#39;mile&#39;, &#39;millimeter&#39;, &#39;nanometer&#39;, &#39;parsec&#39;, &#39;petameter&#39;, &#39;picometer&#39;, &#39;terameter&#39;, &#39;yard&#39;, &#39;yoctometer&#39;, &#39;yottameter&#39;, &#39;zeptometer&#39;, &#39;zettameter&#39;]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#SpaceAxisBase.unit"></a>
    
    

                            </div>
                            <div id="SpaceAxisBase.scale" class="classattr">
                                <div class="attr variable">
            <span class="name">scale</span><span class="annotation">: Annotated[float, Gt(gt=0)]</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#SpaceAxisBase.scale"></a>
    
    

                            </div>
                            <div id="SpaceAxisBase.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;space&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SpaceAxisBase.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="SpaceAxisBase.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SpaceInputAxis">
                            <input id="SpaceInputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SpaceInputAxis</span><wbr>(<span class="base"><a href="#SpaceAxisBase">SpaceAxisBase</a></span>, <span class="base"><a href="#_WithInputAxisSize">_WithInputAxisSize</a></span>):

                <label class="view-source-button" for="SpaceInputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpaceInputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpaceInputAxis-663"><a href="#SpaceInputAxis-663"><span class="linenos">663</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceInputAxis</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">_WithInputAxisSize</span><span class="p">):</span>
</span><span id="SpaceInputAxis-664"><a href="#SpaceInputAxis-664"><span class="linenos">664</span></a>    <span class="n">concatenable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SpaceInputAxis-665"><a href="#SpaceInputAxis-665"><span class="linenos">665</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;If a model has a `concatenable` input axis, it can be processed blockwise,</span>
</span><span id="SpaceInputAxis-666"><a href="#SpaceInputAxis-666"><span class="linenos">666</span></a><span class="sd">    splitting a longer sample axis into blocks matching its input tensor description.</span>
</span><span id="SpaceInputAxis-667"><a href="#SpaceInputAxis-667"><span class="linenos">667</span></a><span class="sd">    Output axes are concatenable if they have a `SizeReference` to a concatenable</span>
</span><span id="SpaceInputAxis-668"><a href="#SpaceInputAxis-668"><span class="linenos">668</span></a><span class="sd">    input axis.</span>
</span><span id="SpaceInputAxis-669"><a href="#SpaceInputAxis-669"><span class="linenos">669</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="SpaceInputAxis.concatenable" class="classattr">
                                <div class="attr variable">
            <span class="name">concatenable</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#SpaceInputAxis.concatenable"></a>
    
            <div class="docstring"><p>If a model has a <code><a href="#SpaceInputAxis.concatenable">concatenable</a></code> input axis, it can be processed blockwise,
splitting a longer sample axis into blocks matching its input tensor description.
Output axes are concatenable if they have a <code><a href="#SizeReference">SizeReference</a></code> to a concatenable
input axis.</p>
</div>


                            </div>
                            <div id="SpaceInputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;space&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SpaceInputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#SpaceAxisBase">SpaceAxisBase</a></dt>
                                <dd id="SpaceInputAxis.implemented_type" class="variable"><a href="#SpaceAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="SpaceInputAxis.id" class="variable"><a href="#SpaceAxisBase.id">id</a></dd>
                <dd id="SpaceInputAxis.unit" class="variable"><a href="#SpaceAxisBase.unit">unit</a></dd>
                <dd id="SpaceInputAxis.scale" class="variable"><a href="#SpaceAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="SpaceInputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#_WithInputAxisSize">_WithInputAxisSize</a></dt>
                                <dd id="SpaceInputAxis.size" class="variable"><a href="#_WithInputAxisSize.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="INPUT_AXIS_TYPES">
                    <div class="attr variable">
            <span class="name">INPUT_AXIS_TYPES</span>        =
<input id="INPUT_AXIS_TYPES-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="INPUT_AXIS_TYPES-view-value"></label><span class="default_value">(&lt;class &#39;<a href="#BatchAxis">BatchAxis</a>&#39;&gt;, &lt;class &#39;<a href="#ChannelAxis">ChannelAxis</a>&#39;&gt;, &lt;class &#39;<a href="#IndexInputAxis">IndexInputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeInputAxis">TimeInputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceInputAxis">SpaceInputAxis</a>&#39;&gt;)</span>

        
    </div>
    <a class="headerlink" href="#INPUT_AXIS_TYPES"></a>
    
            <div class="docstring"><p>intended for isinstance comparisons in py&lt;3.10</p>
</div>


                </section>
                <section id="InputAxis">
                    <div class="attr variable">
            <span class="name">InputAxis</span>        =
<input id="InputAxis-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="InputAxis-view-value"></label><span class="default_value">typing.Annotated[typing.Union[<a href="#BatchAxis">BatchAxis</a>, <a href="#ChannelAxis">ChannelAxis</a>, <a href="#IndexInputAxis">IndexInputAxis</a>, <a href="#TimeInputAxis">TimeInputAxis</a>, <a href="#SpaceInputAxis">SpaceInputAxis</a>], Discriminator(discriminator=&#39;type&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]</span>

        
    </div>
    <a class="headerlink" href="#InputAxis"></a>
    
    

                </section>
                <section id="TimeOutputAxis">
                            <input id="TimeOutputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeOutputAxis</span><wbr>(<span class="base"><a href="#TimeAxisBase">TimeAxisBase</a></span>, <span class="base"><a href="#_WithOutputAxisSize">_WithOutputAxisSize</a></span>):

                <label class="view-source-button" for="TimeOutputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeOutputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeOutputAxis-705"><a href="#TimeOutputAxis-705"><span class="linenos">705</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeOutputAxis</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">_WithOutputAxisSize</span><span class="p">):</span>
</span><span id="TimeOutputAxis-706"><a href="#TimeOutputAxis-706"><span class="linenos">706</span></a>    <span class="k">pass</span>
</span></pre></div>


    

                            <div id="TimeOutputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;time&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TimeOutputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TimeAxisBase">TimeAxisBase</a></dt>
                                <dd id="TimeOutputAxis.implemented_type" class="variable"><a href="#TimeAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="TimeOutputAxis.id" class="variable"><a href="#TimeAxisBase.id">id</a></dd>
                <dd id="TimeOutputAxis.unit" class="variable"><a href="#TimeAxisBase.unit">unit</a></dd>
                <dd id="TimeOutputAxis.scale" class="variable"><a href="#TimeAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="TimeOutputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#_WithOutputAxisSize">_WithOutputAxisSize</a></dt>
                                <dd id="TimeOutputAxis.size" class="variable"><a href="#_WithOutputAxisSize.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TimeOutputAxisWithHalo">
                            <input id="TimeOutputAxisWithHalo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeOutputAxisWithHalo</span><wbr>(<span class="base"><a href="#TimeAxisBase">TimeAxisBase</a></span>, <span class="base"><a href="#WithHalo">WithHalo</a></span>):

                <label class="view-source-button" for="TimeOutputAxisWithHalo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeOutputAxisWithHalo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeOutputAxisWithHalo-709"><a href="#TimeOutputAxisWithHalo-709"><span class="linenos">709</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeOutputAxisWithHalo</span><span class="p">(</span><span class="n">TimeAxisBase</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="TimeOutputAxisWithHalo-710"><a href="#TimeOutputAxisWithHalo-710"><span class="linenos">710</span></a>    <span class="k">pass</span>
</span></pre></div>


    

                            <div id="TimeOutputAxisWithHalo.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;time&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TimeOutputAxisWithHalo.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TimeAxisBase">TimeAxisBase</a></dt>
                                <dd id="TimeOutputAxisWithHalo.implemented_type" class="variable"><a href="#TimeAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="TimeOutputAxisWithHalo.id" class="variable"><a href="#TimeAxisBase.id">id</a></dd>
                <dd id="TimeOutputAxisWithHalo.unit" class="variable"><a href="#TimeAxisBase.unit">unit</a></dd>
                <dd id="TimeOutputAxisWithHalo.scale" class="variable"><a href="#TimeAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="TimeOutputAxisWithHalo.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#WithHalo">WithHalo</a></dt>
                                <dd id="TimeOutputAxisWithHalo.halo" class="variable"><a href="#WithHalo.halo">halo</a></dd>
                <dd id="TimeOutputAxisWithHalo.size" class="variable"><a href="#WithHalo.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SpaceOutputAxis">
                            <input id="SpaceOutputAxis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SpaceOutputAxis</span><wbr>(<span class="base"><a href="#SpaceAxisBase">SpaceAxisBase</a></span>, <span class="base"><a href="#_WithOutputAxisSize">_WithOutputAxisSize</a></span>):

                <label class="view-source-button" for="SpaceOutputAxis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpaceOutputAxis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpaceOutputAxis-729"><a href="#SpaceOutputAxis-729"><span class="linenos">729</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceOutputAxis</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">_WithOutputAxisSize</span><span class="p">):</span>
</span><span id="SpaceOutputAxis-730"><a href="#SpaceOutputAxis-730"><span class="linenos">730</span></a>    <span class="k">pass</span>
</span></pre></div>


    

                            <div id="SpaceOutputAxis.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;space&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SpaceOutputAxis.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#SpaceAxisBase">SpaceAxisBase</a></dt>
                                <dd id="SpaceOutputAxis.implemented_type" class="variable"><a href="#SpaceAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="SpaceOutputAxis.id" class="variable"><a href="#SpaceAxisBase.id">id</a></dd>
                <dd id="SpaceOutputAxis.unit" class="variable"><a href="#SpaceAxisBase.unit">unit</a></dd>
                <dd id="SpaceOutputAxis.scale" class="variable"><a href="#SpaceAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="SpaceOutputAxis.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#_WithOutputAxisSize">_WithOutputAxisSize</a></dt>
                                <dd id="SpaceOutputAxis.size" class="variable"><a href="#_WithOutputAxisSize.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SpaceOutputAxisWithHalo">
                            <input id="SpaceOutputAxisWithHalo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SpaceOutputAxisWithHalo</span><wbr>(<span class="base"><a href="#SpaceAxisBase">SpaceAxisBase</a></span>, <span class="base"><a href="#WithHalo">WithHalo</a></span>):

                <label class="view-source-button" for="SpaceOutputAxisWithHalo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SpaceOutputAxisWithHalo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SpaceOutputAxisWithHalo-733"><a href="#SpaceOutputAxisWithHalo-733"><span class="linenos">733</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SpaceOutputAxisWithHalo</span><span class="p">(</span><span class="n">SpaceAxisBase</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="SpaceOutputAxisWithHalo-734"><a href="#SpaceOutputAxisWithHalo-734"><span class="linenos">734</span></a>    <span class="k">pass</span>
</span></pre></div>


    

                            <div id="SpaceOutputAxisWithHalo.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;space&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SpaceOutputAxisWithHalo.type"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#SpaceAxisBase">SpaceAxisBase</a></dt>
                                <dd id="SpaceOutputAxisWithHalo.implemented_type" class="variable"><a href="#SpaceAxisBase.implemented_type">implemented_type</a></dd>
                <dd id="SpaceOutputAxisWithHalo.id" class="variable"><a href="#SpaceAxisBase.id">id</a></dd>
                <dd id="SpaceOutputAxisWithHalo.unit" class="variable"><a href="#SpaceAxisBase.unit">unit</a></dd>
                <dd id="SpaceOutputAxisWithHalo.scale" class="variable"><a href="#SpaceAxisBase.scale">scale</a></dd>

            </div>
            <div><dt><a href="#AxisBase">AxisBase</a></dt>
                                <dd id="SpaceOutputAxisWithHalo.description" class="variable"><a href="#AxisBase.description">description</a></dd>

            </div>
            <div><dt><a href="#WithHalo">WithHalo</a></dt>
                                <dd id="SpaceOutputAxisWithHalo.halo" class="variable"><a href="#WithHalo.halo">halo</a></dd>
                <dd id="SpaceOutputAxisWithHalo.size" class="variable"><a href="#WithHalo.size">size</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="OutputAxis">
                    <div class="attr variable">
            <span class="name">OutputAxis</span>        =
<input id="OutputAxis-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="OutputAxis-view-value"></label><span class="default_value">typing.Annotated[typing.Union[<a href="#BatchAxis">BatchAxis</a>, <a href="#ChannelAxis">ChannelAxis</a>, <a href="#IndexOutputAxis">IndexOutputAxis</a>, typing.Annotated[typing.Union[typing.Annotated[<a href="#TimeOutputAxis">TimeOutputAxis</a>, Tag(tag=&#39;wo_halo&#39;)], typing.Annotated[<a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a>, Tag(tag=&#39;with_halo&#39;)]], Discriminator(discriminator=&lt;function _get_halo_axis_discriminator_value&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None)], typing.Annotated[typing.Union[typing.Annotated[<a href="#SpaceOutputAxis">SpaceOutputAxis</a>, Tag(tag=&#39;wo_halo&#39;)], typing.Annotated[<a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a>, Tag(tag=&#39;with_halo&#39;)]], Discriminator(discriminator=&lt;function _get_halo_axis_discriminator_value&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]], Discriminator(discriminator=&#39;type&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]</span>

        
    </div>
    <a class="headerlink" href="#OutputAxis"></a>
    
    

                </section>
                <section id="OUTPUT_AXIS_TYPES">
                    <div class="attr variable">
            <span class="name">OUTPUT_AXIS_TYPES</span>        =
<input id="OUTPUT_AXIS_TYPES-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="OUTPUT_AXIS_TYPES-view-value"></label><span class="default_value">(&lt;class &#39;<a href="#BatchAxis">BatchAxis</a>&#39;&gt;, &lt;class &#39;<a href="#ChannelAxis">ChannelAxis</a>&#39;&gt;, &lt;class &#39;<a href="#IndexOutputAxis">IndexOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeOutputAxis">TimeOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceOutputAxis">SpaceOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a>&#39;&gt;)</span>

        
    </div>
    <a class="headerlink" href="#OUTPUT_AXIS_TYPES"></a>
    
            <div class="docstring"><p>intended for isinstance comparisons in py&lt;3.10</p>
</div>


                </section>
                <section id="AnyAxis">
                    <div class="attr variable">
            <span class="name">AnyAxis</span>        =
<input id="AnyAxis-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="AnyAxis-view-value"></label><span class="default_value">typing.Union[typing.Annotated[typing.Union[<a href="#BatchAxis">BatchAxis</a>, <a href="#ChannelAxis">ChannelAxis</a>, <a href="#IndexInputAxis">IndexInputAxis</a>, <a href="#TimeInputAxis">TimeInputAxis</a>, <a href="#SpaceInputAxis">SpaceInputAxis</a>], Discriminator(discriminator=&#39;type&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)], typing.Annotated[typing.Union[<a href="#BatchAxis">BatchAxis</a>, <a href="#ChannelAxis">ChannelAxis</a>, <a href="#IndexOutputAxis">IndexOutputAxis</a>, typing.Annotated[typing.Union[typing.Annotated[<a href="#TimeOutputAxis">TimeOutputAxis</a>, Tag(tag=&#39;wo_halo&#39;)], typing.Annotated[<a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a>, Tag(tag=&#39;with_halo&#39;)]], Discriminator(discriminator=&lt;function _get_halo_axis_discriminator_value&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None)], typing.Annotated[typing.Union[typing.Annotated[<a href="#SpaceOutputAxis">SpaceOutputAxis</a>, Tag(tag=&#39;wo_halo&#39;)], typing.Annotated[<a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a>, Tag(tag=&#39;with_halo&#39;)]], Discriminator(discriminator=&lt;function _get_halo_axis_discriminator_value&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]], Discriminator(discriminator=&#39;type&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]]</span>

        
    </div>
    <a class="headerlink" href="#AnyAxis"></a>
    
    

                </section>
                <section id="ANY_AXIS_TYPES">
                    <div class="attr variable">
            <span class="name">ANY_AXIS_TYPES</span>        =
<input id="ANY_AXIS_TYPES-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="ANY_AXIS_TYPES-view-value"></label><span class="default_value">(&lt;class &#39;<a href="#BatchAxis">BatchAxis</a>&#39;&gt;, &lt;class &#39;<a href="#ChannelAxis">ChannelAxis</a>&#39;&gt;, &lt;class &#39;<a href="#IndexInputAxis">IndexInputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeInputAxis">TimeInputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceInputAxis">SpaceInputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#BatchAxis">BatchAxis</a>&#39;&gt;, &lt;class &#39;<a href="#ChannelAxis">ChannelAxis</a>&#39;&gt;, &lt;class &#39;<a href="#IndexOutputAxis">IndexOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeOutputAxis">TimeOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#TimeOutputAxisWithHalo">TimeOutputAxisWithHalo</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceOutputAxis">SpaceOutputAxis</a>&#39;&gt;, &lt;class &#39;<a href="#SpaceOutputAxisWithHalo">SpaceOutputAxisWithHalo</a>&#39;&gt;)</span>

        
    </div>
    <a class="headerlink" href="#ANY_AXIS_TYPES"></a>
    
            <div class="docstring"><p>intended for isinstance comparisons in py&lt;3.10</p>
</div>


                </section>
                <section id="TVs">
                    <div class="attr variable">
            <span class="name">TVs</span>        =
<input id="TVs-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TVs-view-value"></label><span class="default_value">typing.Union[typing.Annotated[typing.List[int], MinLen(min_length=1)], typing.Annotated[typing.List[float], MinLen(min_length=1)], typing.Annotated[typing.List[bool], MinLen(min_length=1)], typing.Annotated[typing.List[str], MinLen(min_length=1)]]</span>

        
    </div>
    <a class="headerlink" href="#TVs"></a>
    
    

                </section>
                <section id="NominalOrOrdinalDType">
                    <div class="attr variable">
            <span class="name">NominalOrOrdinalDType</span>        =
<input id="NominalOrOrdinalDType-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="NominalOrOrdinalDType-view-value"></label><span class="default_value">typing.Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;, &#39;bool&#39;]</span>

        
    </div>
    <a class="headerlink" href="#NominalOrOrdinalDType"></a>
    
    

                </section>
                <section id="NominalOrOrdinalDataDescr">
                            <input id="NominalOrOrdinalDataDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NominalOrOrdinalDataDescr</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="NominalOrOrdinalDataDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NominalOrOrdinalDataDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NominalOrOrdinalDataDescr-791"><a href="#NominalOrOrdinalDataDescr-791"><span class="linenos">791</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NominalOrOrdinalDataDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr-792"><a href="#NominalOrOrdinalDataDescr-792"><span class="linenos">792</span></a>    <span class="n">values</span><span class="p">:</span> <span class="n">TVs</span>
</span><span id="NominalOrOrdinalDataDescr-793"><a href="#NominalOrOrdinalDataDescr-793"><span class="linenos">793</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A fixed set of nominal or an ascending sequence of ordinal values.</span>
</span><span id="NominalOrOrdinalDataDescr-794"><a href="#NominalOrOrdinalDataDescr-794"><span class="linenos">794</span></a><span class="sd">    In this case `data.type` is required to be an unsigend integer type, e.g. &#39;uint8&#39;.</span>
</span><span id="NominalOrOrdinalDataDescr-795"><a href="#NominalOrOrdinalDataDescr-795"><span class="linenos">795</span></a><span class="sd">    String `values` are interpreted as labels for tensor values 0, ..., N.</span>
</span><span id="NominalOrOrdinalDataDescr-796"><a href="#NominalOrOrdinalDataDescr-796"><span class="linenos">796</span></a><span class="sd">    Note: as YAML 1.2 does not natively support a &quot;set&quot; datatype,</span>
</span><span id="NominalOrOrdinalDataDescr-797"><a href="#NominalOrOrdinalDataDescr-797"><span class="linenos">797</span></a><span class="sd">    nominal values should be given as a sequence (aka list/array) as well.</span>
</span><span id="NominalOrOrdinalDataDescr-798"><a href="#NominalOrOrdinalDataDescr-798"><span class="linenos">798</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NominalOrOrdinalDataDescr-799"><a href="#NominalOrOrdinalDataDescr-799"><span class="linenos">799</span></a>
</span><span id="NominalOrOrdinalDataDescr-800"><a href="#NominalOrOrdinalDataDescr-800"><span class="linenos">800</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="NominalOrOrdinalDataDescr-801"><a href="#NominalOrOrdinalDataDescr-801"><span class="linenos">801</span></a>        <span class="n">NominalOrOrdinalDType</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-802"><a href="#NominalOrOrdinalDataDescr-802"><span class="linenos">802</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="NominalOrOrdinalDataDescr-803"><a href="#NominalOrOrdinalDataDescr-803"><span class="linenos">803</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span>
</span><span id="NominalOrOrdinalDataDescr-804"><a href="#NominalOrOrdinalDataDescr-804"><span class="linenos">804</span></a>                <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-805"><a href="#NominalOrOrdinalDataDescr-805"><span class="linenos">805</span></a>                <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-806"><a href="#NominalOrOrdinalDataDescr-806"><span class="linenos">806</span></a>                <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-807"><a href="#NominalOrOrdinalDataDescr-807"><span class="linenos">807</span></a>                <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-808"><a href="#NominalOrOrdinalDataDescr-808"><span class="linenos">808</span></a>                <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-809"><a href="#NominalOrOrdinalDataDescr-809"><span class="linenos">809</span></a>            <span class="p">],</span>
</span><span id="NominalOrOrdinalDataDescr-810"><a href="#NominalOrOrdinalDataDescr-810"><span class="linenos">810</span></a>        <span class="p">),</span>
</span><span id="NominalOrOrdinalDataDescr-811"><a href="#NominalOrOrdinalDataDescr-811"><span class="linenos">811</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;uint8&quot;</span>
</span><span id="NominalOrOrdinalDataDescr-812"><a href="#NominalOrOrdinalDataDescr-812"><span class="linenos">812</span></a>
</span><span id="NominalOrOrdinalDataDescr-813"><a href="#NominalOrOrdinalDataDescr-813"><span class="linenos">813</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-814"><a href="#NominalOrOrdinalDataDescr-814"><span class="linenos">814</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_values_match_type</span><span class="p">(</span>
</span><span id="NominalOrOrdinalDataDescr-815"><a href="#NominalOrOrdinalDataDescr-815"><span class="linenos">815</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NominalOrOrdinalDataDescr-816"><a href="#NominalOrOrdinalDataDescr-816"><span class="linenos">816</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-817"><a href="#NominalOrOrdinalDataDescr-817"><span class="linenos">817</span></a>        <span class="n">incompatible</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NominalOrOrdinalDataDescr-818"><a href="#NominalOrOrdinalDataDescr-818"><span class="linenos">818</span></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-819"><a href="#NominalOrOrdinalDataDescr-819"><span class="linenos">819</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-820"><a href="#NominalOrOrdinalDataDescr-820"><span class="linenos">820</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr-821"><a href="#NominalOrOrdinalDataDescr-821"><span class="linenos">821</span></a>                    <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-822"><a href="#NominalOrOrdinalDataDescr-822"><span class="linenos">822</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">DTYPE_LIMITS</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-823"><a href="#NominalOrOrdinalDataDescr-823"><span class="linenos">823</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="NominalOrOrdinalDataDescr-824"><a href="#NominalOrOrdinalDataDescr-824"><span class="linenos">824</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
</span><span id="NominalOrOrdinalDataDescr-825"><a href="#NominalOrOrdinalDataDescr-825"><span class="linenos">825</span></a>                    <span class="ow">and</span> <span class="p">(</span>
</span><span id="NominalOrOrdinalDataDescr-826"><a href="#NominalOrOrdinalDataDescr-826"><span class="linenos">826</span></a>                        <span class="n">v</span> <span class="o">&lt;</span> <span class="n">DTYPE_LIMITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
</span><span id="NominalOrOrdinalDataDescr-827"><a href="#NominalOrOrdinalDataDescr-827"><span class="linenos">827</span></a>                        <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">DTYPE_LIMITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
</span><span id="NominalOrOrdinalDataDescr-828"><a href="#NominalOrOrdinalDataDescr-828"><span class="linenos">828</span></a>                    <span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-829"><a href="#NominalOrOrdinalDataDescr-829"><span class="linenos">829</span></a>                    <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;uint&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-830"><a href="#NominalOrOrdinalDataDescr-830"><span class="linenos">830</span></a>                    <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;int&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-831"><a href="#NominalOrOrdinalDataDescr-831"><span class="linenos">831</span></a>                <span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr-832"><a href="#NominalOrOrdinalDataDescr-832"><span class="linenos">832</span></a>                    <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-833"><a href="#NominalOrOrdinalDataDescr-833"><span class="linenos">833</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-834"><a href="#NominalOrOrdinalDataDescr-834"><span class="linenos">834</span></a>                <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-835"><a href="#NominalOrOrdinalDataDescr-835"><span class="linenos">835</span></a>
</span><span id="NominalOrOrdinalDataDescr-836"><a href="#NominalOrOrdinalDataDescr-836"><span class="linenos">836</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">incompatible</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-837"><a href="#NominalOrOrdinalDataDescr-837"><span class="linenos">837</span></a>                <span class="n">incompatible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-838"><a href="#NominalOrOrdinalDataDescr-838"><span class="linenos">838</span></a>                <span class="k">break</span>
</span><span id="NominalOrOrdinalDataDescr-839"><a href="#NominalOrOrdinalDataDescr-839"><span class="linenos">839</span></a>
</span><span id="NominalOrOrdinalDataDescr-840"><a href="#NominalOrOrdinalDataDescr-840"><span class="linenos">840</span></a>        <span class="k">if</span> <span class="n">incompatible</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-841"><a href="#NominalOrOrdinalDataDescr-841"><span class="linenos">841</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="NominalOrOrdinalDataDescr-842"><a href="#NominalOrOrdinalDataDescr-842"><span class="linenos">842</span></a>                <span class="sa">f</span><span class="s2">&quot;data type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&#39; incompatible with values </span><span class="si">{</span><span class="n">incompatible</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="NominalOrOrdinalDataDescr-843"><a href="#NominalOrOrdinalDataDescr-843"><span class="linenos">843</span></a>            <span class="p">)</span>
</span><span id="NominalOrOrdinalDataDescr-844"><a href="#NominalOrOrdinalDataDescr-844"><span class="linenos">844</span></a>
</span><span id="NominalOrOrdinalDataDescr-845"><a href="#NominalOrOrdinalDataDescr-845"><span class="linenos">845</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="NominalOrOrdinalDataDescr-846"><a href="#NominalOrOrdinalDataDescr-846"><span class="linenos">846</span></a>
</span><span id="NominalOrOrdinalDataDescr-847"><a href="#NominalOrOrdinalDataDescr-847"><span class="linenos">847</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;arbitrary unit&quot;</span><span class="p">],</span> <span class="n">SiUnit</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NominalOrOrdinalDataDescr-848"><a href="#NominalOrOrdinalDataDescr-848"><span class="linenos">848</span></a>
</span><span id="NominalOrOrdinalDataDescr-849"><a href="#NominalOrOrdinalDataDescr-849"><span class="linenos">849</span></a>    <span class="nd">@property</span>
</span><span id="NominalOrOrdinalDataDescr-850"><a href="#NominalOrOrdinalDataDescr-850"><span class="linenos">850</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr-851"><a href="#NominalOrOrdinalDataDescr-851"><span class="linenos">851</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr-852"><a href="#NominalOrOrdinalDataDescr-852"><span class="linenos">852</span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="NominalOrOrdinalDataDescr-853"><a href="#NominalOrOrdinalDataDescr-853"><span class="linenos">853</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr-854"><a href="#NominalOrOrdinalDataDescr-854"><span class="linenos">854</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="NominalOrOrdinalDataDescr.values" class="classattr">
                                <div class="attr variable">
            <span class="name">values</span><span class="annotation">: Union[Annotated[List[int], MinLen(min_length=1)], Annotated[List[float], MinLen(min_length=1)], Annotated[List[bool], MinLen(min_length=1)], Annotated[List[str], MinLen(min_length=1)]]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#NominalOrOrdinalDataDescr.values"></a>
    
            <div class="docstring"><p>A fixed set of nominal or an ascending sequence of ordinal values.
In this case <code>data.type</code> is required to be an unsigend integer type, e.g. 'uint8'.
String <code><a href="#NominalOrOrdinalDataDescr.values">values</a></code> are interpreted as labels for tensor values 0, ..., N.
Note: as YAML 1.2 does not natively support a "set" datatype,
nominal values should be given as a sequence (aka list/array) as well.</p>
</div>


                            </div>
                            <div id="NominalOrOrdinalDataDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Annotated[Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;, &#39;bool&#39;], FieldInfo(annotation=NoneType, required=True, examples=[&#39;float32&#39;, &#39;uint8&#39;, &#39;uint16&#39;, &#39;int64&#39;, &#39;bool&#39;])]</span>        =
<span class="default_value">&#39;uint8&#39;</span>

        
    </div>
    <a class="headerlink" href="#NominalOrOrdinalDataDescr.type"></a>
    
    

                            </div>
                            <div id="NominalOrOrdinalDataDescr.unit" class="classattr">
                                <div class="attr variable">
            <span class="name">unit</span><span class="annotation">: Union[Literal[&#39;arbitrary unit&#39;], bioimageio.spec._internal.types.SiUnit, NoneType]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#NominalOrOrdinalDataDescr.unit"></a>
    
    

                            </div>
                            <div id="NominalOrOrdinalDataDescr.range" class="classattr">
                                        <input id="NominalOrOrdinalDataDescr.range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">range</span>

                <label class="view-source-button" for="NominalOrOrdinalDataDescr.range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NominalOrOrdinalDataDescr.range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NominalOrOrdinalDataDescr.range-849"><a href="#NominalOrOrdinalDataDescr.range-849"><span class="linenos">849</span></a>    <span class="nd">@property</span>
</span><span id="NominalOrOrdinalDataDescr.range-850"><a href="#NominalOrOrdinalDataDescr.range-850"><span class="linenos">850</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr.range-851"><a href="#NominalOrOrdinalDataDescr.range-851"><span class="linenos">851</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NominalOrOrdinalDataDescr.range-852"><a href="#NominalOrOrdinalDataDescr.range-852"><span class="linenos">852</span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="NominalOrOrdinalDataDescr.range-853"><a href="#NominalOrOrdinalDataDescr.range-853"><span class="linenos">853</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NominalOrOrdinalDataDescr.range-854"><a href="#NominalOrOrdinalDataDescr.range-854"><span class="linenos">854</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="IntervalOrRatioDType">
                    <div class="attr variable">
            <span class="name">IntervalOrRatioDType</span>        =
<input id="IntervalOrRatioDType-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="IntervalOrRatioDType-view-value"></label><span class="default_value">typing.Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;]</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDType"></a>
    
    

                </section>
                <section id="IntervalOrRatioDataDescr">
                            <input id="IntervalOrRatioDataDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IntervalOrRatioDataDescr</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="IntervalOrRatioDataDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IntervalOrRatioDataDescr-871"><a href="#IntervalOrRatioDataDescr-871"><span class="linenos">871</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IntervalOrRatioDataDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="IntervalOrRatioDataDescr-872"><a href="#IntervalOrRatioDataDescr-872"><span class="linenos">872</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>  <span class="c1"># TODO: rename to dtype</span>
</span><span id="IntervalOrRatioDataDescr-873"><a href="#IntervalOrRatioDataDescr-873"><span class="linenos">873</span></a>        <span class="n">IntervalOrRatioDType</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-874"><a href="#IntervalOrRatioDataDescr-874"><span class="linenos">874</span></a>        <span class="n">Field</span><span class="p">(</span>
</span><span id="IntervalOrRatioDataDescr-875"><a href="#IntervalOrRatioDataDescr-875"><span class="linenos">875</span></a>            <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;uint8&quot;</span><span class="p">,</span> <span class="s2">&quot;uint16&quot;</span><span class="p">],</span>
</span><span id="IntervalOrRatioDataDescr-876"><a href="#IntervalOrRatioDataDescr-876"><span class="linenos">876</span></a>        <span class="p">),</span>
</span><span id="IntervalOrRatioDataDescr-877"><a href="#IntervalOrRatioDataDescr-877"><span class="linenos">877</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;float32&quot;</span>
</span><span id="IntervalOrRatioDataDescr-878"><a href="#IntervalOrRatioDataDescr-878"><span class="linenos">878</span></a>    <span class="nb">range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IntervalOrRatioDataDescr-879"><a href="#IntervalOrRatioDataDescr-879"><span class="linenos">879</span></a>        <span class="kc">None</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-880"><a href="#IntervalOrRatioDataDescr-880"><span class="linenos">880</span></a>        <span class="kc">None</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-881"><a href="#IntervalOrRatioDataDescr-881"><span class="linenos">881</span></a>    <span class="p">)</span>
</span><span id="IntervalOrRatioDataDescr-882"><a href="#IntervalOrRatioDataDescr-882"><span class="linenos">882</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tuple `(minimum, maximum)` specifying the allowed range of the data in this tensor.</span>
</span><span id="IntervalOrRatioDataDescr-883"><a href="#IntervalOrRatioDataDescr-883"><span class="linenos">883</span></a><span class="sd">    `None` corresponds to min/max of what can be expressed by **type**.&quot;&quot;&quot;</span>
</span><span id="IntervalOrRatioDataDescr-884"><a href="#IntervalOrRatioDataDescr-884"><span class="linenos">884</span></a>    <span class="n">unit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;arbitrary unit&quot;</span><span class="p">],</span> <span class="n">SiUnit</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;arbitrary unit&quot;</span>
</span><span id="IntervalOrRatioDataDescr-885"><a href="#IntervalOrRatioDataDescr-885"><span class="linenos">885</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="IntervalOrRatioDataDescr-886"><a href="#IntervalOrRatioDataDescr-886"><span class="linenos">886</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale for data on an interval (or ratio) scale.&quot;&quot;&quot;</span>
</span><span id="IntervalOrRatioDataDescr-887"><a href="#IntervalOrRatioDataDescr-887"><span class="linenos">887</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="IntervalOrRatioDataDescr-888"><a href="#IntervalOrRatioDataDescr-888"><span class="linenos">888</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Offset for data on a ratio scale.&quot;&quot;&quot;</span>
</span><span id="IntervalOrRatioDataDescr-889"><a href="#IntervalOrRatioDataDescr-889"><span class="linenos">889</span></a>
</span><span id="IntervalOrRatioDataDescr-890"><a href="#IntervalOrRatioDataDescr-890"><span class="linenos">890</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
</span><span id="IntervalOrRatioDataDescr-891"><a href="#IntervalOrRatioDataDescr-891"><span class="linenos">891</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_replace_inf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="IntervalOrRatioDataDescr-892"><a href="#IntervalOrRatioDataDescr-892"><span class="linenos">892</span></a>        <span class="k">if</span> <span class="n">is_dict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="IntervalOrRatioDataDescr-893"><a href="#IntervalOrRatioDataDescr-893"><span class="linenos">893</span></a>            <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]):</span>
</span><span id="IntervalOrRatioDataDescr-894"><a href="#IntervalOrRatioDataDescr-894"><span class="linenos">894</span></a>                <span class="n">forbidden</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IntervalOrRatioDataDescr-895"><a href="#IntervalOrRatioDataDescr-895"><span class="linenos">895</span></a>                    <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-896"><a href="#IntervalOrRatioDataDescr-896"><span class="linenos">896</span></a>                    <span class="s2">&quot;-inf&quot;</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-897"><a href="#IntervalOrRatioDataDescr-897"><span class="linenos">897</span></a>                    <span class="s2">&quot;.inf&quot;</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-898"><a href="#IntervalOrRatioDataDescr-898"><span class="linenos">898</span></a>                    <span class="s2">&quot;-.inf&quot;</span><span class="p">,</span>
</span><span id="IntervalOrRatioDataDescr-899"><a href="#IntervalOrRatioDataDescr-899"><span class="linenos">899</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
</span><span id="IntervalOrRatioDataDescr-900"><a href="#IntervalOrRatioDataDescr-900"><span class="linenos">900</span></a>                    <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">),</span>
</span><span id="IntervalOrRatioDataDescr-901"><a href="#IntervalOrRatioDataDescr-901"><span class="linenos">901</span></a>                <span class="p">)</span>
</span><span id="IntervalOrRatioDataDescr-902"><a href="#IntervalOrRatioDataDescr-902"><span class="linenos">902</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">forbidden</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]):</span>
</span><span id="IntervalOrRatioDataDescr-903"><a href="#IntervalOrRatioDataDescr-903"><span class="linenos">903</span></a>                    <span class="n">issue_warning</span><span class="p">(</span><span class="s2">&quot;replaced &#39;inf&#39; value&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">])</span>
</span><span id="IntervalOrRatioDataDescr-904"><a href="#IntervalOrRatioDataDescr-904"><span class="linenos">904</span></a>
</span><span id="IntervalOrRatioDataDescr-905"><a href="#IntervalOrRatioDataDescr-905"><span class="linenos">905</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="IntervalOrRatioDataDescr-906"><a href="#IntervalOrRatioDataDescr-906"><span class="linenos">906</span></a>                    <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">forbidden</span> <span class="k">else</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span>
</span><span id="IntervalOrRatioDataDescr-907"><a href="#IntervalOrRatioDataDescr-907"><span class="linenos">907</span></a>                <span class="p">)</span>
</span><span id="IntervalOrRatioDataDescr-908"><a href="#IntervalOrRatioDataDescr-908"><span class="linenos">908</span></a>
</span><span id="IntervalOrRatioDataDescr-909"><a href="#IntervalOrRatioDataDescr-909"><span class="linenos">909</span></a>        <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


    

                            <div id="IntervalOrRatioDataDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Annotated[Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;], FieldInfo(annotation=NoneType, required=True, examples=[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;uint16&#39;])]</span>        =
<span class="default_value">&#39;float32&#39;</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr.type"></a>
    
    

                            </div>
                            <div id="IntervalOrRatioDataDescr.range" class="classattr">
                                <div class="attr variable">
            <span class="name">range</span><span class="annotation">: Tuple[Optional[float], Optional[float]]</span>        =
<span class="default_value">(None, None)</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr.range"></a>
    
            <div class="docstring"><p>Tuple <code>(minimum, maximum)</code> specifying the allowed range of the data in this tensor.
<code>None</code> corresponds to min/max of what can be expressed by <strong>type</strong>.</p>
</div>


                            </div>
                            <div id="IntervalOrRatioDataDescr.unit" class="classattr">
                                <div class="attr variable">
            <span class="name">unit</span><span class="annotation">: Union[Literal[&#39;arbitrary unit&#39;], bioimageio.spec._internal.types.SiUnit]</span>        =
<span class="default_value">&#39;arbitrary unit&#39;</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr.unit"></a>
    
    

                            </div>
                            <div id="IntervalOrRatioDataDescr.scale" class="classattr">
                                <div class="attr variable">
            <span class="name">scale</span><span class="annotation">: float</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr.scale"></a>
    
            <div class="docstring"><p>Scale for data on an interval (or ratio) scale.</p>
</div>


                            </div>
                            <div id="IntervalOrRatioDataDescr.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: Optional[float]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#IntervalOrRatioDataDescr.offset"></a>
    
            <div class="docstring"><p>Offset for data on a ratio scale.</p>
</div>


                            </div>
                </section>
                <section id="TensorDataDescr">
                    <div class="attr variable">
            <span class="name">TensorDataDescr</span>        =
<input id="TensorDataDescr-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TensorDataDescr-view-value"></label><span class="default_value">typing.Union[<a href="#NominalOrOrdinalDataDescr">NominalOrOrdinalDataDescr</a>, <a href="#IntervalOrRatioDataDescr">IntervalOrRatioDataDescr</a>]</span>

        
    </div>
    <a class="headerlink" href="#TensorDataDescr"></a>
    
    

                </section>
                <section id="ProcessingDescrBase">
                            <input id="ProcessingDescrBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProcessingDescrBase</span><wbr>(<span class="base">bioimageio.spec._internal.common_nodes.NodeWithExplicitlySetFields</span>, <span class="base">abc.ABC</span>):

                <label class="view-source-button" for="ProcessingDescrBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProcessingDescrBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProcessingDescrBase-915"><a href="#ProcessingDescrBase-915"><span class="linenos">915</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ProcessingDescrBase</span><span class="p">(</span><span class="n">NodeWithExplicitlySetFields</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="ProcessingDescrBase-916"><a href="#ProcessingDescrBase-916"><span class="linenos">916</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;processing base class&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>processing base class</p>
</div>


                </section>
                <section id="BinarizeKwargs">
                            <input id="BinarizeKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BinarizeKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="BinarizeKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BinarizeKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BinarizeKwargs-919"><a href="#BinarizeKwargs-919"><span class="linenos">919</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="BinarizeKwargs-920"><a href="#BinarizeKwargs-920"><span class="linenos">920</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `BinarizeDescr`&quot;&quot;&quot;</span>
</span><span id="BinarizeKwargs-921"><a href="#BinarizeKwargs-921"><span class="linenos">921</span></a>
</span><span id="BinarizeKwargs-922"><a href="#BinarizeKwargs-922"><span class="linenos">922</span></a>    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="BinarizeKwargs-923"><a href="#BinarizeKwargs-923"><span class="linenos">923</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The fixed threshold&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#BinarizeDescr">BinarizeDescr</a></code></p>
</div>


                            <div id="BinarizeKwargs.threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">threshold</span><span class="annotation">: float</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BinarizeKwargs.threshold"></a>
    
            <div class="docstring"><p>The fixed threshold</p>
</div>


                            </div>
                </section>
                <section id="BinarizeAlongAxisKwargs">
                            <input id="BinarizeAlongAxisKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BinarizeAlongAxisKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="BinarizeAlongAxisKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BinarizeAlongAxisKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BinarizeAlongAxisKwargs-926"><a href="#BinarizeAlongAxisKwargs-926"><span class="linenos">926</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="BinarizeAlongAxisKwargs-927"><a href="#BinarizeAlongAxisKwargs-927"><span class="linenos">927</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `BinarizeDescr`&quot;&quot;&quot;</span>
</span><span id="BinarizeAlongAxisKwargs-928"><a href="#BinarizeAlongAxisKwargs-928"><span class="linenos">928</span></a>
</span><span id="BinarizeAlongAxisKwargs-929"><a href="#BinarizeAlongAxisKwargs-929"><span class="linenos">929</span></a>    <span class="n">threshold</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
</span><span id="BinarizeAlongAxisKwargs-930"><a href="#BinarizeAlongAxisKwargs-930"><span class="linenos">930</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The fixed threshold values along `axis`&quot;&quot;&quot;</span>
</span><span id="BinarizeAlongAxisKwargs-931"><a href="#BinarizeAlongAxisKwargs-931"><span class="linenos">931</span></a>
</span><span id="BinarizeAlongAxisKwargs-932"><a href="#BinarizeAlongAxisKwargs-932"><span class="linenos">932</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span>
</span><span id="BinarizeAlongAxisKwargs-933"><a href="#BinarizeAlongAxisKwargs-933"><span class="linenos">933</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The `threshold` axis&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#BinarizeDescr">BinarizeDescr</a></code></p>
</div>


                            <div id="BinarizeAlongAxisKwargs.threshold" class="classattr">
                                <div class="attr variable">
            <span class="name">threshold</span><span class="annotation">: Annotated[List[float], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BinarizeAlongAxisKwargs.threshold"></a>
    
            <div class="docstring"><p>The fixed threshold values along <code><a href="#BinarizeAlongAxisKwargs.axis">axis</a></code></p>
</div>


                            </div>
                            <div id="BinarizeAlongAxisKwargs.axis" class="classattr">
                                <div class="attr variable">
            <span class="name">axis</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch), FieldInfo(annotation=NoneType, required=True, examples=[&#39;channel&#39;])]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BinarizeAlongAxisKwargs.axis"></a>
    
            <div class="docstring"><p>The <code><a href="#BinarizeAlongAxisKwargs.threshold">threshold</a></code> axis</p>
</div>


                            </div>
                </section>
                <section id="BinarizeDescr">
                            <input id="BinarizeDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BinarizeDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="BinarizeDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BinarizeDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BinarizeDescr-936"><a href="#BinarizeDescr-936"><span class="linenos">936</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BinarizeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="BinarizeDescr-937"><a href="#BinarizeDescr-937"><span class="linenos">937</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Binarize the tensor with a fixed threshold.</span>
</span><span id="BinarizeDescr-938"><a href="#BinarizeDescr-938"><span class="linenos">938</span></a>
</span><span id="BinarizeDescr-939"><a href="#BinarizeDescr-939"><span class="linenos">939</span></a><span class="sd">    Values above `BinarizeKwargs.threshold`/`BinarizeAlongAxisKwargs.threshold`</span>
</span><span id="BinarizeDescr-940"><a href="#BinarizeDescr-940"><span class="linenos">940</span></a><span class="sd">    will be set to one, values below the threshold to zero.</span>
</span><span id="BinarizeDescr-941"><a href="#BinarizeDescr-941"><span class="linenos">941</span></a>
</span><span id="BinarizeDescr-942"><a href="#BinarizeDescr-942"><span class="linenos">942</span></a><span class="sd">    Examples:</span>
</span><span id="BinarizeDescr-943"><a href="#BinarizeDescr-943"><span class="linenos">943</span></a><span class="sd">    - in YAML</span>
</span><span id="BinarizeDescr-944"><a href="#BinarizeDescr-944"><span class="linenos">944</span></a><span class="sd">        ```yaml</span>
</span><span id="BinarizeDescr-945"><a href="#BinarizeDescr-945"><span class="linenos">945</span></a><span class="sd">        postprocessing:</span>
</span><span id="BinarizeDescr-946"><a href="#BinarizeDescr-946"><span class="linenos">946</span></a><span class="sd">          - id: binarize</span>
</span><span id="BinarizeDescr-947"><a href="#BinarizeDescr-947"><span class="linenos">947</span></a><span class="sd">            kwargs:</span>
</span><span id="BinarizeDescr-948"><a href="#BinarizeDescr-948"><span class="linenos">948</span></a><span class="sd">              axis: &#39;channel&#39;</span>
</span><span id="BinarizeDescr-949"><a href="#BinarizeDescr-949"><span class="linenos">949</span></a><span class="sd">              threshold: [0.25, 0.5, 0.75]</span>
</span><span id="BinarizeDescr-950"><a href="#BinarizeDescr-950"><span class="linenos">950</span></a><span class="sd">        ```</span>
</span><span id="BinarizeDescr-951"><a href="#BinarizeDescr-951"><span class="linenos">951</span></a><span class="sd">    - in Python:</span>
</span><span id="BinarizeDescr-952"><a href="#BinarizeDescr-952"><span class="linenos">952</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [BinarizeDescr(</span>
</span><span id="BinarizeDescr-953"><a href="#BinarizeDescr-953"><span class="linenos">953</span></a><span class="sd">        ...   kwargs=BinarizeAlongAxisKwargs(</span>
</span><span id="BinarizeDescr-954"><a href="#BinarizeDescr-954"><span class="linenos">954</span></a><span class="sd">        ...       axis=AxisId(&#39;channel&#39;),</span>
</span><span id="BinarizeDescr-955"><a href="#BinarizeDescr-955"><span class="linenos">955</span></a><span class="sd">        ...       threshold=[0.25, 0.5, 0.75],</span>
</span><span id="BinarizeDescr-956"><a href="#BinarizeDescr-956"><span class="linenos">956</span></a><span class="sd">        ...   )</span>
</span><span id="BinarizeDescr-957"><a href="#BinarizeDescr-957"><span class="linenos">957</span></a><span class="sd">        ... )]</span>
</span><span id="BinarizeDescr-958"><a href="#BinarizeDescr-958"><span class="linenos">958</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BinarizeDescr-959"><a href="#BinarizeDescr-959"><span class="linenos">959</span></a>
</span><span id="BinarizeDescr-960"><a href="#BinarizeDescr-960"><span class="linenos">960</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;binarize&quot;</span>
</span><span id="BinarizeDescr-961"><a href="#BinarizeDescr-961"><span class="linenos">961</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="BinarizeDescr-962"><a href="#BinarizeDescr-962"><span class="linenos">962</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;binarize&quot;</span>
</span><span id="BinarizeDescr-963"><a href="#BinarizeDescr-963"><span class="linenos">963</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="BinarizeDescr-964"><a href="#BinarizeDescr-964"><span class="linenos">964</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;binarize&quot;</span><span class="p">]</span>
</span><span id="BinarizeDescr-965"><a href="#BinarizeDescr-965"><span class="linenos">965</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BinarizeKwargs</span><span class="p">,</span> <span class="n">BinarizeAlongAxisKwargs</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Binarize the tensor with a fixed threshold.</p>

<p>Values above <code><a href="#BinarizeKwargs.threshold">BinarizeKwargs.threshold</a></code>/<code><a href="#BinarizeAlongAxisKwargs.threshold">BinarizeAlongAxisKwargs.threshold</a></code>
will be set to one, values below the threshold to zero.</p>

<p>Examples:</p>

<ul>
<li>in YAML</li>
</ul>

<pre><code><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">postprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">binarize</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axis</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;channel&#39;</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.25</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.75</span><span class="p p-Indicator">]</span>
</code></pre>
</div>
</code></pre>

<ul>
<li>in Python:

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">postprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">BinarizeDescr</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">kwargs</span><span class="o">=</span><span class="n">BinarizeAlongAxisKwargs</span><span class="p">(</span>
<span class="gp">... </span>      <span class="n">axis</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s1">&#39;channel&#39;</span><span class="p">),</span>
<span class="gp">... </span>      <span class="n">threshold</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
<span class="gp">... </span>  <span class="p">)</span>
<span class="gp">... </span><span class="p">)]</span>
</code></pre>
</div>
</li>
</ul>
</div>


                            <div id="BinarizeDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;binarize&#39;]]</span>        =
<span class="default_value">&#39;binarize&#39;</span>

        
    </div>
    <a class="headerlink" href="#BinarizeDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="BinarizeDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: Union[<a href="#BinarizeKwargs">BinarizeKwargs</a>, <a href="#BinarizeAlongAxisKwargs">BinarizeAlongAxisKwargs</a>]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BinarizeDescr.kwargs"></a>
    
    

                            </div>
                            <div id="BinarizeDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;binarize&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#BinarizeDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="ClipDescr">
                            <input id="ClipDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ClipDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="ClipDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ClipDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ClipDescr-968"><a href="#ClipDescr-968"><span class="linenos">968</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ClipDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="ClipDescr-969"><a href="#ClipDescr-969"><span class="linenos">969</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set tensor values below min to min and above max to max.</span>
</span><span id="ClipDescr-970"><a href="#ClipDescr-970"><span class="linenos">970</span></a>
</span><span id="ClipDescr-971"><a href="#ClipDescr-971"><span class="linenos">971</span></a><span class="sd">    See `ScaleRangeDescr` for examples.</span>
</span><span id="ClipDescr-972"><a href="#ClipDescr-972"><span class="linenos">972</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ClipDescr-973"><a href="#ClipDescr-973"><span class="linenos">973</span></a>
</span><span id="ClipDescr-974"><a href="#ClipDescr-974"><span class="linenos">974</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;clip&quot;</span>
</span><span id="ClipDescr-975"><a href="#ClipDescr-975"><span class="linenos">975</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ClipDescr-976"><a href="#ClipDescr-976"><span class="linenos">976</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;clip&quot;</span>
</span><span id="ClipDescr-977"><a href="#ClipDescr-977"><span class="linenos">977</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ClipDescr-978"><a href="#ClipDescr-978"><span class="linenos">978</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]</span>
</span><span id="ClipDescr-979"><a href="#ClipDescr-979"><span class="linenos">979</span></a>
</span><span id="ClipDescr-980"><a href="#ClipDescr-980"><span class="linenos">980</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ClipKwargs</span>
</span></pre></div>


            <div class="docstring"><p>Set tensor values below min to min and above max to max.</p>

<p>See <code><a href="#ScaleRangeDescr">ScaleRangeDescr</a></code> for examples.</p>
</div>


                            <div id="ClipDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;clip&#39;]]</span>        =
<span class="default_value">&#39;clip&#39;</span>

        
    </div>
    <a class="headerlink" href="#ClipDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="ClipDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="v0_4.html#ClipKwargs">bioimageio.spec.model.v0_4.ClipKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ClipDescr.kwargs"></a>
    
    

                            </div>
                            <div id="ClipDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;clip&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ClipDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="EnsureDtypeKwargs">
                            <input id="EnsureDtypeKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EnsureDtypeKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="EnsureDtypeKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EnsureDtypeKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EnsureDtypeKwargs-983"><a href="#EnsureDtypeKwargs-983"><span class="linenos">983</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="EnsureDtypeKwargs-984"><a href="#EnsureDtypeKwargs-984"><span class="linenos">984</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `EnsureDtypeDescr`&quot;&quot;&quot;</span>
</span><span id="EnsureDtypeKwargs-985"><a href="#EnsureDtypeKwargs-985"><span class="linenos">985</span></a>
</span><span id="EnsureDtypeKwargs-986"><a href="#EnsureDtypeKwargs-986"><span class="linenos">986</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="EnsureDtypeKwargs-987"><a href="#EnsureDtypeKwargs-987"><span class="linenos">987</span></a>        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-988"><a href="#EnsureDtypeKwargs-988"><span class="linenos">988</span></a>        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-989"><a href="#EnsureDtypeKwargs-989"><span class="linenos">989</span></a>        <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-990"><a href="#EnsureDtypeKwargs-990"><span class="linenos">990</span></a>        <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-991"><a href="#EnsureDtypeKwargs-991"><span class="linenos">991</span></a>        <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-992"><a href="#EnsureDtypeKwargs-992"><span class="linenos">992</span></a>        <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-993"><a href="#EnsureDtypeKwargs-993"><span class="linenos">993</span></a>        <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-994"><a href="#EnsureDtypeKwargs-994"><span class="linenos">994</span></a>        <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-995"><a href="#EnsureDtypeKwargs-995"><span class="linenos">995</span></a>        <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-996"><a href="#EnsureDtypeKwargs-996"><span class="linenos">996</span></a>        <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-997"><a href="#EnsureDtypeKwargs-997"><span class="linenos">997</span></a>        <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="EnsureDtypeKwargs-998"><a href="#EnsureDtypeKwargs-998"><span class="linenos">998</span></a>    <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#EnsureDtypeDescr">EnsureDtypeDescr</a></code></p>
</div>


                            <div id="EnsureDtypeKwargs.dtype" class="classattr">
                                <div class="attr variable">
            <span class="name">dtype</span><span class="annotation">: Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;, &#39;bool&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#EnsureDtypeKwargs.dtype"></a>
    
    

                            </div>
                </section>
                <section id="EnsureDtypeDescr">
                            <input id="EnsureDtypeDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EnsureDtypeDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="EnsureDtypeDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EnsureDtypeDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EnsureDtypeDescr-1001"><a href="#EnsureDtypeDescr-1001"><span class="linenos">1001</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnsureDtypeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="EnsureDtypeDescr-1002"><a href="#EnsureDtypeDescr-1002"><span class="linenos">1002</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cast the tensor data type to `EnsureDtypeKwargs.dtype` (if not matching).</span>
</span><span id="EnsureDtypeDescr-1003"><a href="#EnsureDtypeDescr-1003"><span class="linenos">1003</span></a>
</span><span id="EnsureDtypeDescr-1004"><a href="#EnsureDtypeDescr-1004"><span class="linenos">1004</span></a><span class="sd">    This can for example be used to ensure the inner neural network model gets a</span>
</span><span id="EnsureDtypeDescr-1005"><a href="#EnsureDtypeDescr-1005"><span class="linenos">1005</span></a><span class="sd">    different input tensor data type than the fully described bioimage.io model does.</span>
</span><span id="EnsureDtypeDescr-1006"><a href="#EnsureDtypeDescr-1006"><span class="linenos">1006</span></a>
</span><span id="EnsureDtypeDescr-1007"><a href="#EnsureDtypeDescr-1007"><span class="linenos">1007</span></a><span class="sd">    Examples:</span>
</span><span id="EnsureDtypeDescr-1008"><a href="#EnsureDtypeDescr-1008"><span class="linenos">1008</span></a><span class="sd">        The described bioimage.io model (incl. preprocessing) accepts any</span>
</span><span id="EnsureDtypeDescr-1009"><a href="#EnsureDtypeDescr-1009"><span class="linenos">1009</span></a><span class="sd">        float32-compatible tensor, normalizes it with percentiles and clipping and then</span>
</span><span id="EnsureDtypeDescr-1010"><a href="#EnsureDtypeDescr-1010"><span class="linenos">1010</span></a><span class="sd">        casts it to uint8, which is what the neural network in this example expects.</span>
</span><span id="EnsureDtypeDescr-1011"><a href="#EnsureDtypeDescr-1011"><span class="linenos">1011</span></a><span class="sd">        - in YAML</span>
</span><span id="EnsureDtypeDescr-1012"><a href="#EnsureDtypeDescr-1012"><span class="linenos">1012</span></a><span class="sd">            ```yaml</span>
</span><span id="EnsureDtypeDescr-1013"><a href="#EnsureDtypeDescr-1013"><span class="linenos">1013</span></a><span class="sd">            inputs:</span>
</span><span id="EnsureDtypeDescr-1014"><a href="#EnsureDtypeDescr-1014"><span class="linenos">1014</span></a><span class="sd">            - data:</span>
</span><span id="EnsureDtypeDescr-1015"><a href="#EnsureDtypeDescr-1015"><span class="linenos">1015</span></a><span class="sd">                type: float32  # described bioimage.io model is compatible with any float32 input tensor</span>
</span><span id="EnsureDtypeDescr-1016"><a href="#EnsureDtypeDescr-1016"><span class="linenos">1016</span></a><span class="sd">              preprocessing:</span>
</span><span id="EnsureDtypeDescr-1017"><a href="#EnsureDtypeDescr-1017"><span class="linenos">1017</span></a><span class="sd">              - id: scale_range</span>
</span><span id="EnsureDtypeDescr-1018"><a href="#EnsureDtypeDescr-1018"><span class="linenos">1018</span></a><span class="sd">                  kwargs:</span>
</span><span id="EnsureDtypeDescr-1019"><a href="#EnsureDtypeDescr-1019"><span class="linenos">1019</span></a><span class="sd">                  axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="EnsureDtypeDescr-1020"><a href="#EnsureDtypeDescr-1020"><span class="linenos">1020</span></a><span class="sd">                  max_percentile: 99.8</span>
</span><span id="EnsureDtypeDescr-1021"><a href="#EnsureDtypeDescr-1021"><span class="linenos">1021</span></a><span class="sd">                  min_percentile: 5.0</span>
</span><span id="EnsureDtypeDescr-1022"><a href="#EnsureDtypeDescr-1022"><span class="linenos">1022</span></a><span class="sd">              - id: clip</span>
</span><span id="EnsureDtypeDescr-1023"><a href="#EnsureDtypeDescr-1023"><span class="linenos">1023</span></a><span class="sd">                  kwargs:</span>
</span><span id="EnsureDtypeDescr-1024"><a href="#EnsureDtypeDescr-1024"><span class="linenos">1024</span></a><span class="sd">                  min: 0.0</span>
</span><span id="EnsureDtypeDescr-1025"><a href="#EnsureDtypeDescr-1025"><span class="linenos">1025</span></a><span class="sd">                  max: 1.0</span>
</span><span id="EnsureDtypeDescr-1026"><a href="#EnsureDtypeDescr-1026"><span class="linenos">1026</span></a><span class="sd">              - id: ensure_dtype  # the neural network of the model requires uint8</span>
</span><span id="EnsureDtypeDescr-1027"><a href="#EnsureDtypeDescr-1027"><span class="linenos">1027</span></a><span class="sd">                  kwargs:</span>
</span><span id="EnsureDtypeDescr-1028"><a href="#EnsureDtypeDescr-1028"><span class="linenos">1028</span></a><span class="sd">                  dtype: uint8</span>
</span><span id="EnsureDtypeDescr-1029"><a href="#EnsureDtypeDescr-1029"><span class="linenos">1029</span></a><span class="sd">            ```</span>
</span><span id="EnsureDtypeDescr-1030"><a href="#EnsureDtypeDescr-1030"><span class="linenos">1030</span></a><span class="sd">        - in Python:</span>
</span><span id="EnsureDtypeDescr-1031"><a href="#EnsureDtypeDescr-1031"><span class="linenos">1031</span></a><span class="sd">            &gt;&gt;&gt; preprocessing = [</span>
</span><span id="EnsureDtypeDescr-1032"><a href="#EnsureDtypeDescr-1032"><span class="linenos">1032</span></a><span class="sd">            ...     ScaleRangeDescr(</span>
</span><span id="EnsureDtypeDescr-1033"><a href="#EnsureDtypeDescr-1033"><span class="linenos">1033</span></a><span class="sd">            ...         kwargs=ScaleRangeKwargs(</span>
</span><span id="EnsureDtypeDescr-1034"><a href="#EnsureDtypeDescr-1034"><span class="linenos">1034</span></a><span class="sd">            ...           axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="EnsureDtypeDescr-1035"><a href="#EnsureDtypeDescr-1035"><span class="linenos">1035</span></a><span class="sd">            ...           max_percentile= 99.8,</span>
</span><span id="EnsureDtypeDescr-1036"><a href="#EnsureDtypeDescr-1036"><span class="linenos">1036</span></a><span class="sd">            ...           min_percentile= 5.0,</span>
</span><span id="EnsureDtypeDescr-1037"><a href="#EnsureDtypeDescr-1037"><span class="linenos">1037</span></a><span class="sd">            ...         )</span>
</span><span id="EnsureDtypeDescr-1038"><a href="#EnsureDtypeDescr-1038"><span class="linenos">1038</span></a><span class="sd">            ...     ),</span>
</span><span id="EnsureDtypeDescr-1039"><a href="#EnsureDtypeDescr-1039"><span class="linenos">1039</span></a><span class="sd">            ...     ClipDescr(kwargs=ClipKwargs(min=0.0, max=1.0)),</span>
</span><span id="EnsureDtypeDescr-1040"><a href="#EnsureDtypeDescr-1040"><span class="linenos">1040</span></a><span class="sd">            ...     EnsureDtypeDescr(kwargs=EnsureDtypeKwargs(dtype=&quot;uint8&quot;)),</span>
</span><span id="EnsureDtypeDescr-1041"><a href="#EnsureDtypeDescr-1041"><span class="linenos">1041</span></a><span class="sd">            ... ]</span>
</span><span id="EnsureDtypeDescr-1042"><a href="#EnsureDtypeDescr-1042"><span class="linenos">1042</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EnsureDtypeDescr-1043"><a href="#EnsureDtypeDescr-1043"><span class="linenos">1043</span></a>
</span><span id="EnsureDtypeDescr-1044"><a href="#EnsureDtypeDescr-1044"><span class="linenos">1044</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ensure_dtype&quot;</span>
</span><span id="EnsureDtypeDescr-1045"><a href="#EnsureDtypeDescr-1045"><span class="linenos">1045</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="EnsureDtypeDescr-1046"><a href="#EnsureDtypeDescr-1046"><span class="linenos">1046</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ensure_dtype&quot;</span>
</span><span id="EnsureDtypeDescr-1047"><a href="#EnsureDtypeDescr-1047"><span class="linenos">1047</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="EnsureDtypeDescr-1048"><a href="#EnsureDtypeDescr-1048"><span class="linenos">1048</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ensure_dtype&quot;</span><span class="p">]</span>
</span><span id="EnsureDtypeDescr-1049"><a href="#EnsureDtypeDescr-1049"><span class="linenos">1049</span></a>
</span><span id="EnsureDtypeDescr-1050"><a href="#EnsureDtypeDescr-1050"><span class="linenos">1050</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">EnsureDtypeKwargs</span>
</span></pre></div>


            <div class="docstring"><p>Cast the tensor data type to <code><a href="#EnsureDtypeKwargs.dtype">EnsureDtypeKwargs.dtype</a></code> (if not matching).</p>

<p>This can for example be used to ensure the inner neural network model gets a
different input tensor data type than the fully described bioimage.io model does.</p>

<h6 id="examples">Examples:</h6>

<blockquote>
  <p>The described bioimage.io model (incl. preprocessing) accepts any
  float32-compatible tensor, normalizes it with percentiles and clipping and then
  casts it to uint8, which is what the neural network in this example expects.</p>
  
  <ul>
  <li>in YAML</li>
  </ul>
  
  <p><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">inputs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">float32</span><span class="w">  </span><span class="c1"># described bioimage.io model is compatible with any float32 input tensor</span>
<span class="w">  </span><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_range</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">kwargs</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">axes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;y&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;x&#39;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">max_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">99.8</span>
<span class="w">      </span><span class="nt">min_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clip</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">kwargs</span><span class="p p-Indicator">:</span>
<span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ensure_dtype</span><span class="w">  </span><span class="c1"># the neural network of the model requires uint8</span>
<span class="w">      </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">dtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uint8</span>
</code></pre>
</div></p>
  
  <ul>
  <li>in Python:
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">ScaleRangeDescr</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleRangeKwargs</span><span class="p">(</span>
<span class="gp">... </span>          <span class="n">axes</span><span class="o">=</span> <span class="p">(</span><span class="n">AxisId</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">AxisId</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)),</span>
<span class="gp">... </span>          <span class="n">max_percentile</span><span class="o">=</span> <span class="mf">99.8</span><span class="p">,</span>
<span class="gp">... </span>          <span class="n">min_percentile</span><span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">ClipDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">ClipKwargs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)),</span>
<span class="gp">... </span><span class="p">]</span>
</code></pre>
  </div>
  </li>
  </ul>
</blockquote>
</div>


                            <div id="EnsureDtypeDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;ensure_dtype&#39;]]</span>        =
<span class="default_value">&#39;ensure_dtype&#39;</span>

        
    </div>
    <a class="headerlink" href="#EnsureDtypeDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="EnsureDtypeDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="#EnsureDtypeKwargs">EnsureDtypeKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#EnsureDtypeDescr.kwargs"></a>
    
    

                            </div>
                            <div id="EnsureDtypeDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;ensure_dtype&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#EnsureDtypeDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="ScaleLinearKwargs">
                            <input id="ScaleLinearKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleLinearKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="ScaleLinearKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleLinearKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleLinearKwargs-1053"><a href="#ScaleLinearKwargs-1053"><span class="linenos">1053</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="ScaleLinearKwargs-1054"><a href="#ScaleLinearKwargs-1054"><span class="linenos">1054</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Key word arguments for `ScaleLinearDescr`&quot;&quot;&quot;</span>
</span><span id="ScaleLinearKwargs-1055"><a href="#ScaleLinearKwargs-1055"><span class="linenos">1055</span></a>
</span><span id="ScaleLinearKwargs-1056"><a href="#ScaleLinearKwargs-1056"><span class="linenos">1056</span></a>    <span class="n">gain</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ScaleLinearKwargs-1057"><a href="#ScaleLinearKwargs-1057"><span class="linenos">1057</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;multiplicative factor&quot;&quot;&quot;</span>
</span><span id="ScaleLinearKwargs-1058"><a href="#ScaleLinearKwargs-1058"><span class="linenos">1058</span></a>
</span><span id="ScaleLinearKwargs-1059"><a href="#ScaleLinearKwargs-1059"><span class="linenos">1059</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ScaleLinearKwargs-1060"><a href="#ScaleLinearKwargs-1060"><span class="linenos">1060</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;additive term&quot;&quot;&quot;</span>
</span><span id="ScaleLinearKwargs-1061"><a href="#ScaleLinearKwargs-1061"><span class="linenos">1061</span></a>
</span><span id="ScaleLinearKwargs-1062"><a href="#ScaleLinearKwargs-1062"><span class="linenos">1062</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ScaleLinearKwargs-1063"><a href="#ScaleLinearKwargs-1063"><span class="linenos">1063</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ScaleLinearKwargs-1064"><a href="#ScaleLinearKwargs-1064"><span class="linenos">1064</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="ScaleLinearKwargs-1065"><a href="#ScaleLinearKwargs-1065"><span class="linenos">1065</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ScaleLinearKwargs-1066"><a href="#ScaleLinearKwargs-1066"><span class="linenos">1066</span></a>                <span class="s2">&quot;Redundant linear scaling not allowd. Set `gain` != 1.0 and/or `offset`&quot;</span>
</span><span id="ScaleLinearKwargs-1067"><a href="#ScaleLinearKwargs-1067"><span class="linenos">1067</span></a>                <span class="o">+</span> <span class="s2">&quot; != 0.0.&quot;</span>
</span><span id="ScaleLinearKwargs-1068"><a href="#ScaleLinearKwargs-1068"><span class="linenos">1068</span></a>            <span class="p">)</span>
</span><span id="ScaleLinearKwargs-1069"><a href="#ScaleLinearKwargs-1069"><span class="linenos">1069</span></a>
</span><span id="ScaleLinearKwargs-1070"><a href="#ScaleLinearKwargs-1070"><span class="linenos">1070</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Key word arguments for <code><a href="#ScaleLinearDescr">ScaleLinearDescr</a></code></p>
</div>


                            <div id="ScaleLinearKwargs.gain" class="classattr">
                                <div class="attr variable">
            <span class="name">gain</span><span class="annotation">: float</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearKwargs.gain"></a>
    
            <div class="docstring"><p>multiplicative factor</p>
</div>


                            </div>
                            <div id="ScaleLinearKwargs.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearKwargs.offset"></a>
    
            <div class="docstring"><p>additive term</p>
</div>


                            </div>
                </section>
                <section id="ScaleLinearAlongAxisKwargs">
                            <input id="ScaleLinearAlongAxisKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleLinearAlongAxisKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="ScaleLinearAlongAxisKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleLinearAlongAxisKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleLinearAlongAxisKwargs-1073"><a href="#ScaleLinearAlongAxisKwargs-1073"><span class="linenos">1073</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1074"><a href="#ScaleLinearAlongAxisKwargs-1074"><span class="linenos">1074</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Key word arguments for `ScaleLinearDescr`&quot;&quot;&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1075"><a href="#ScaleLinearAlongAxisKwargs-1075"><span class="linenos">1075</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1076"><a href="#ScaleLinearAlongAxisKwargs-1076"><span class="linenos">1076</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span>
</span><span id="ScaleLinearAlongAxisKwargs-1077"><a href="#ScaleLinearAlongAxisKwargs-1077"><span class="linenos">1077</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis of gain and offset values.&quot;&quot;&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1078"><a href="#ScaleLinearAlongAxisKwargs-1078"><span class="linenos">1078</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1079"><a href="#ScaleLinearAlongAxisKwargs-1079"><span class="linenos">1079</span></a>    <span class="n">gain</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ScaleLinearAlongAxisKwargs-1080"><a href="#ScaleLinearAlongAxisKwargs-1080"><span class="linenos">1080</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;multiplicative factor&quot;&quot;&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1081"><a href="#ScaleLinearAlongAxisKwargs-1081"><span class="linenos">1081</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1082"><a href="#ScaleLinearAlongAxisKwargs-1082"><span class="linenos">1082</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ScaleLinearAlongAxisKwargs-1083"><a href="#ScaleLinearAlongAxisKwargs-1083"><span class="linenos">1083</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;additive term&quot;&quot;&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1084"><a href="#ScaleLinearAlongAxisKwargs-1084"><span class="linenos">1084</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1085"><a href="#ScaleLinearAlongAxisKwargs-1085"><span class="linenos">1085</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1086"><a href="#ScaleLinearAlongAxisKwargs-1086"><span class="linenos">1086</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ScaleLinearAlongAxisKwargs-1087"><a href="#ScaleLinearAlongAxisKwargs-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1088"><a href="#ScaleLinearAlongAxisKwargs-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1089"><a href="#ScaleLinearAlongAxisKwargs-1089"><span class="linenos">1089</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1090"><a href="#ScaleLinearAlongAxisKwargs-1090"><span class="linenos">1090</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ScaleLinearAlongAxisKwargs-1091"><a href="#ScaleLinearAlongAxisKwargs-1091"><span class="linenos">1091</span></a>                        <span class="sa">f</span><span class="s2">&quot;Size of `gain` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span><span class="si">}</span><span class="s2">) and `offset` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span><span class="si">}</span><span class="s2">) must match.&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1092"><a href="#ScaleLinearAlongAxisKwargs-1092"><span class="linenos">1092</span></a>                    <span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1093"><a href="#ScaleLinearAlongAxisKwargs-1093"><span class="linenos">1093</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ScaleLinearAlongAxisKwargs-1094"><a href="#ScaleLinearAlongAxisKwargs-1094"><span class="linenos">1094</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1095"><a href="#ScaleLinearAlongAxisKwargs-1095"><span class="linenos">1095</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1096"><a href="#ScaleLinearAlongAxisKwargs-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1097"><a href="#ScaleLinearAlongAxisKwargs-1097"><span class="linenos">1097</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ScaleLinearAlongAxisKwargs-1098"><a href="#ScaleLinearAlongAxisKwargs-1098"><span class="linenos">1098</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ScaleLinearAlongAxisKwargs-1099"><a href="#ScaleLinearAlongAxisKwargs-1099"><span class="linenos">1099</span></a>                <span class="s2">&quot;Do not specify an `axis` for scalar gain and offset values.&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1100"><a href="#ScaleLinearAlongAxisKwargs-1100"><span class="linenos">1100</span></a>            <span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1101"><a href="#ScaleLinearAlongAxisKwargs-1101"><span class="linenos">1101</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1102"><a href="#ScaleLinearAlongAxisKwargs-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">off</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">):</span>
</span><span id="ScaleLinearAlongAxisKwargs-1103"><a href="#ScaleLinearAlongAxisKwargs-1103"><span class="linenos">1103</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ScaleLinearAlongAxisKwargs-1104"><a href="#ScaleLinearAlongAxisKwargs-1104"><span class="linenos">1104</span></a>                <span class="s2">&quot;Redundant linear scaling not allowd. Set `gain` != 1.0 and/or `offset`&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1105"><a href="#ScaleLinearAlongAxisKwargs-1105"><span class="linenos">1105</span></a>                <span class="o">+</span> <span class="s2">&quot; != 0.0.&quot;</span>
</span><span id="ScaleLinearAlongAxisKwargs-1106"><a href="#ScaleLinearAlongAxisKwargs-1106"><span class="linenos">1106</span></a>            <span class="p">)</span>
</span><span id="ScaleLinearAlongAxisKwargs-1107"><a href="#ScaleLinearAlongAxisKwargs-1107"><span class="linenos">1107</span></a>
</span><span id="ScaleLinearAlongAxisKwargs-1108"><a href="#ScaleLinearAlongAxisKwargs-1108"><span class="linenos">1108</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Key word arguments for <code><a href="#ScaleLinearDescr">ScaleLinearDescr</a></code></p>
</div>


                            <div id="ScaleLinearAlongAxisKwargs.axis" class="classattr">
                                <div class="attr variable">
            <span class="name">axis</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch), FieldInfo(annotation=NoneType, required=True, examples=[&#39;channel&#39;])]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearAlongAxisKwargs.axis"></a>
    
            <div class="docstring"><p>The axis of gain and offset values.</p>
</div>


                            </div>
                            <div id="ScaleLinearAlongAxisKwargs.gain" class="classattr">
                                <div class="attr variable">
            <span class="name">gain</span><span class="annotation">: Union[float, Annotated[List[float], MinLen(min_length=1)]]</span>        =
<span class="default_value">1.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearAlongAxisKwargs.gain"></a>
    
            <div class="docstring"><p>multiplicative factor</p>
</div>


                            </div>
                            <div id="ScaleLinearAlongAxisKwargs.offset" class="classattr">
                                <div class="attr variable">
            <span class="name">offset</span><span class="annotation">: Union[float, Annotated[List[float], MinLen(min_length=1)]]</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearAlongAxisKwargs.offset"></a>
    
            <div class="docstring"><p>additive term</p>
</div>


                            </div>
                </section>
                <section id="ScaleLinearDescr">
                            <input id="ScaleLinearDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleLinearDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="ScaleLinearDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleLinearDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleLinearDescr-1111"><a href="#ScaleLinearDescr-1111"><span class="linenos">1111</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleLinearDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="ScaleLinearDescr-1112"><a href="#ScaleLinearDescr-1112"><span class="linenos">1112</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixed linear scaling.</span>
</span><span id="ScaleLinearDescr-1113"><a href="#ScaleLinearDescr-1113"><span class="linenos">1113</span></a>
</span><span id="ScaleLinearDescr-1114"><a href="#ScaleLinearDescr-1114"><span class="linenos">1114</span></a><span class="sd">    Examples:</span>
</span><span id="ScaleLinearDescr-1115"><a href="#ScaleLinearDescr-1115"><span class="linenos">1115</span></a><span class="sd">      1. Scale with scalar gain and offset</span>
</span><span id="ScaleLinearDescr-1116"><a href="#ScaleLinearDescr-1116"><span class="linenos">1116</span></a><span class="sd">        - in YAML</span>
</span><span id="ScaleLinearDescr-1117"><a href="#ScaleLinearDescr-1117"><span class="linenos">1117</span></a><span class="sd">        ```yaml</span>
</span><span id="ScaleLinearDescr-1118"><a href="#ScaleLinearDescr-1118"><span class="linenos">1118</span></a><span class="sd">        preprocessing:</span>
</span><span id="ScaleLinearDescr-1119"><a href="#ScaleLinearDescr-1119"><span class="linenos">1119</span></a><span class="sd">          - id: scale_linear</span>
</span><span id="ScaleLinearDescr-1120"><a href="#ScaleLinearDescr-1120"><span class="linenos">1120</span></a><span class="sd">            kwargs:</span>
</span><span id="ScaleLinearDescr-1121"><a href="#ScaleLinearDescr-1121"><span class="linenos">1121</span></a><span class="sd">              gain: 2.0</span>
</span><span id="ScaleLinearDescr-1122"><a href="#ScaleLinearDescr-1122"><span class="linenos">1122</span></a><span class="sd">              offset: 3.0</span>
</span><span id="ScaleLinearDescr-1123"><a href="#ScaleLinearDescr-1123"><span class="linenos">1123</span></a><span class="sd">        ```</span>
</span><span id="ScaleLinearDescr-1124"><a href="#ScaleLinearDescr-1124"><span class="linenos">1124</span></a><span class="sd">        - in Python:</span>
</span><span id="ScaleLinearDescr-1125"><a href="#ScaleLinearDescr-1125"><span class="linenos">1125</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="ScaleLinearDescr-1126"><a href="#ScaleLinearDescr-1126"><span class="linenos">1126</span></a><span class="sd">        ...     ScaleLinearDescr(kwargs=ScaleLinearKwargs(gain= 2.0, offset=3.0))</span>
</span><span id="ScaleLinearDescr-1127"><a href="#ScaleLinearDescr-1127"><span class="linenos">1127</span></a><span class="sd">        ... ]</span>
</span><span id="ScaleLinearDescr-1128"><a href="#ScaleLinearDescr-1128"><span class="linenos">1128</span></a>
</span><span id="ScaleLinearDescr-1129"><a href="#ScaleLinearDescr-1129"><span class="linenos">1129</span></a><span class="sd">      2. Independent scaling along an axis</span>
</span><span id="ScaleLinearDescr-1130"><a href="#ScaleLinearDescr-1130"><span class="linenos">1130</span></a><span class="sd">        - in YAML</span>
</span><span id="ScaleLinearDescr-1131"><a href="#ScaleLinearDescr-1131"><span class="linenos">1131</span></a><span class="sd">        ```yaml</span>
</span><span id="ScaleLinearDescr-1132"><a href="#ScaleLinearDescr-1132"><span class="linenos">1132</span></a><span class="sd">        preprocessing:</span>
</span><span id="ScaleLinearDescr-1133"><a href="#ScaleLinearDescr-1133"><span class="linenos">1133</span></a><span class="sd">          - id: scale_linear</span>
</span><span id="ScaleLinearDescr-1134"><a href="#ScaleLinearDescr-1134"><span class="linenos">1134</span></a><span class="sd">            kwargs:</span>
</span><span id="ScaleLinearDescr-1135"><a href="#ScaleLinearDescr-1135"><span class="linenos">1135</span></a><span class="sd">              axis: &#39;channel&#39;</span>
</span><span id="ScaleLinearDescr-1136"><a href="#ScaleLinearDescr-1136"><span class="linenos">1136</span></a><span class="sd">              gain: [1.0, 2.0, 3.0]</span>
</span><span id="ScaleLinearDescr-1137"><a href="#ScaleLinearDescr-1137"><span class="linenos">1137</span></a><span class="sd">        ```</span>
</span><span id="ScaleLinearDescr-1138"><a href="#ScaleLinearDescr-1138"><span class="linenos">1138</span></a><span class="sd">        - in Python:</span>
</span><span id="ScaleLinearDescr-1139"><a href="#ScaleLinearDescr-1139"><span class="linenos">1139</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="ScaleLinearDescr-1140"><a href="#ScaleLinearDescr-1140"><span class="linenos">1140</span></a><span class="sd">        ...     ScaleLinearDescr(</span>
</span><span id="ScaleLinearDescr-1141"><a href="#ScaleLinearDescr-1141"><span class="linenos">1141</span></a><span class="sd">        ...         kwargs=ScaleLinearAlongAxisKwargs(</span>
</span><span id="ScaleLinearDescr-1142"><a href="#ScaleLinearDescr-1142"><span class="linenos">1142</span></a><span class="sd">        ...             axis=AxisId(&quot;channel&quot;),</span>
</span><span id="ScaleLinearDescr-1143"><a href="#ScaleLinearDescr-1143"><span class="linenos">1143</span></a><span class="sd">        ...             gain=[1.0, 2.0, 3.0],</span>
</span><span id="ScaleLinearDescr-1144"><a href="#ScaleLinearDescr-1144"><span class="linenos">1144</span></a><span class="sd">        ...         )</span>
</span><span id="ScaleLinearDescr-1145"><a href="#ScaleLinearDescr-1145"><span class="linenos">1145</span></a><span class="sd">        ...     )</span>
</span><span id="ScaleLinearDescr-1146"><a href="#ScaleLinearDescr-1146"><span class="linenos">1146</span></a><span class="sd">        ... ]</span>
</span><span id="ScaleLinearDescr-1147"><a href="#ScaleLinearDescr-1147"><span class="linenos">1147</span></a>
</span><span id="ScaleLinearDescr-1148"><a href="#ScaleLinearDescr-1148"><span class="linenos">1148</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ScaleLinearDescr-1149"><a href="#ScaleLinearDescr-1149"><span class="linenos">1149</span></a>
</span><span id="ScaleLinearDescr-1150"><a href="#ScaleLinearDescr-1150"><span class="linenos">1150</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_linear&quot;</span>
</span><span id="ScaleLinearDescr-1151"><a href="#ScaleLinearDescr-1151"><span class="linenos">1151</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ScaleLinearDescr-1152"><a href="#ScaleLinearDescr-1152"><span class="linenos">1152</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_linear&quot;</span>
</span><span id="ScaleLinearDescr-1153"><a href="#ScaleLinearDescr-1153"><span class="linenos">1153</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ScaleLinearDescr-1154"><a href="#ScaleLinearDescr-1154"><span class="linenos">1154</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_linear&quot;</span><span class="p">]</span>
</span><span id="ScaleLinearDescr-1155"><a href="#ScaleLinearDescr-1155"><span class="linenos">1155</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScaleLinearKwargs</span><span class="p">,</span> <span class="n">ScaleLinearAlongAxisKwargs</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Fixed linear scaling.</p>

<h6 id="examples">Examples:</h6>

<blockquote>
  <ol>
  <li><p>Scale with scalar gain and offset</p>
  
  <ul>
  <li><p>in YAML</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_linear</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">gain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.0</span>
<span class="w">      </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0</span>
</code></pre>
  </div></li>
  <li><p>in Python:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">ScaleLinearDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleLinearKwargs</span><span class="p">(</span><span class="n">gain</span><span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">3.0</span><span class="p">))</span>
<span class="gp">... </span><span class="p">]</span>
</code></pre>
  </div></li>
  </ul></li>
  <li><p>Independent scaling along an axis</p>
  
  <ul>
  <li><p>in YAML</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_linear</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axis</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;channel&#39;</span>
<span class="w">      </span><span class="nt">gain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3.0</span><span class="p p-Indicator">]</span>
</code></pre>
  </div></li>
  <li><p>in Python:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">ScaleLinearDescr</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleLinearAlongAxisKwargs</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">axis</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">gain</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span><span class="p">]</span>
</code></pre>
  </div></li>
  </ul></li>
  </ol>
</blockquote>
</div>


                            <div id="ScaleLinearDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;scale_linear&#39;]]</span>        =
<span class="default_value">&#39;scale_linear&#39;</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="ScaleLinearDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: Union[<a href="#ScaleLinearKwargs">ScaleLinearKwargs</a>, <a href="#ScaleLinearAlongAxisKwargs">ScaleLinearAlongAxisKwargs</a>]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearDescr.kwargs"></a>
    
    

                            </div>
                            <div id="ScaleLinearDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;scale_linear&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleLinearDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="SigmoidDescr">
                            <input id="SigmoidDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SigmoidDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="SigmoidDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SigmoidDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SigmoidDescr-1158"><a href="#SigmoidDescr-1158"><span class="linenos">1158</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SigmoidDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="SigmoidDescr-1159"><a href="#SigmoidDescr-1159"><span class="linenos">1159</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The logistic sigmoid function, a.k.a. expit function.</span>
</span><span id="SigmoidDescr-1160"><a href="#SigmoidDescr-1160"><span class="linenos">1160</span></a>
</span><span id="SigmoidDescr-1161"><a href="#SigmoidDescr-1161"><span class="linenos">1161</span></a><span class="sd">    Examples:</span>
</span><span id="SigmoidDescr-1162"><a href="#SigmoidDescr-1162"><span class="linenos">1162</span></a><span class="sd">    - in YAML</span>
</span><span id="SigmoidDescr-1163"><a href="#SigmoidDescr-1163"><span class="linenos">1163</span></a><span class="sd">        ```yaml</span>
</span><span id="SigmoidDescr-1164"><a href="#SigmoidDescr-1164"><span class="linenos">1164</span></a><span class="sd">        postprocessing:</span>
</span><span id="SigmoidDescr-1165"><a href="#SigmoidDescr-1165"><span class="linenos">1165</span></a><span class="sd">          - id: sigmoid</span>
</span><span id="SigmoidDescr-1166"><a href="#SigmoidDescr-1166"><span class="linenos">1166</span></a><span class="sd">        ```</span>
</span><span id="SigmoidDescr-1167"><a href="#SigmoidDescr-1167"><span class="linenos">1167</span></a><span class="sd">    - in Python:</span>
</span><span id="SigmoidDescr-1168"><a href="#SigmoidDescr-1168"><span class="linenos">1168</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [SigmoidDescr()]</span>
</span><span id="SigmoidDescr-1169"><a href="#SigmoidDescr-1169"><span class="linenos">1169</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SigmoidDescr-1170"><a href="#SigmoidDescr-1170"><span class="linenos">1170</span></a>
</span><span id="SigmoidDescr-1171"><a href="#SigmoidDescr-1171"><span class="linenos">1171</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;sigmoid&quot;</span>
</span><span id="SigmoidDescr-1172"><a href="#SigmoidDescr-1172"><span class="linenos">1172</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="SigmoidDescr-1173"><a href="#SigmoidDescr-1173"><span class="linenos">1173</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sigmoid&quot;</span>
</span><span id="SigmoidDescr-1174"><a href="#SigmoidDescr-1174"><span class="linenos">1174</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="SigmoidDescr-1175"><a href="#SigmoidDescr-1175"><span class="linenos">1175</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sigmoid&quot;</span><span class="p">]</span>
</span><span id="SigmoidDescr-1176"><a href="#SigmoidDescr-1176"><span class="linenos">1176</span></a>
</span><span id="SigmoidDescr-1177"><a href="#SigmoidDescr-1177"><span class="linenos">1177</span></a>    <span class="nd">@property</span>
</span><span id="SigmoidDescr-1178"><a href="#SigmoidDescr-1178"><span class="linenos">1178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessingKwargs</span><span class="p">:</span>
</span><span id="SigmoidDescr-1179"><a href="#SigmoidDescr-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;empty kwargs&quot;&quot;&quot;</span>
</span><span id="SigmoidDescr-1180"><a href="#SigmoidDescr-1180"><span class="linenos">1180</span></a>        <span class="k">return</span> <span class="n">ProcessingKwargs</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The logistic sigmoid function, a.k.a. expit function.</p>

<p>Examples:</p>

<ul>
<li>in YAML</li>
</ul>

<pre><code><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">postprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sigmoid</span>
</code></pre>
</div>
</code></pre>

<ul>
<li>in Python:

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">postprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">SigmoidDescr</span><span class="p">()]</span>
</code></pre>
</div>
</li>
</ul>
</div>


                            <div id="SigmoidDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;sigmoid&#39;]]</span>        =
<span class="default_value">&#39;sigmoid&#39;</span>

        
    </div>
    <a class="headerlink" href="#SigmoidDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="SigmoidDescr.kwargs" class="classattr">
                                        <input id="SigmoidDescr.kwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>

                <label class="view-source-button" for="SigmoidDescr.kwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SigmoidDescr.kwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SigmoidDescr.kwargs-1177"><a href="#SigmoidDescr.kwargs-1177"><span class="linenos">1177</span></a>    <span class="nd">@property</span>
</span><span id="SigmoidDescr.kwargs-1178"><a href="#SigmoidDescr.kwargs-1178"><span class="linenos">1178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProcessingKwargs</span><span class="p">:</span>
</span><span id="SigmoidDescr.kwargs-1179"><a href="#SigmoidDescr.kwargs-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;empty kwargs&quot;&quot;&quot;</span>
</span><span id="SigmoidDescr.kwargs-1180"><a href="#SigmoidDescr.kwargs-1180"><span class="linenos">1180</span></a>        <span class="k">return</span> <span class="n">ProcessingKwargs</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>empty kwargs</p>
</div>


                            </div>
                            <div id="SigmoidDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;sigmoid&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SigmoidDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="SoftmaxKwargs">
                            <input id="SoftmaxKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SoftmaxKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="SoftmaxKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SoftmaxKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SoftmaxKwargs-1183"><a href="#SoftmaxKwargs-1183"><span class="linenos">1183</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SoftmaxKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="SoftmaxKwargs-1184"><a href="#SoftmaxKwargs-1184"><span class="linenos">1184</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `SoftmaxDescr`&quot;&quot;&quot;</span>
</span><span id="SoftmaxKwargs-1185"><a href="#SoftmaxKwargs-1185"><span class="linenos">1185</span></a>
</span><span id="SoftmaxKwargs-1186"><a href="#SoftmaxKwargs-1186"><span class="linenos">1186</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">)</span>
</span><span id="SoftmaxKwargs-1187"><a href="#SoftmaxKwargs-1187"><span class="linenos">1187</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis to apply the softmax function along.</span>
</span><span id="SoftmaxKwargs-1188"><a href="#SoftmaxKwargs-1188"><span class="linenos">1188</span></a><span class="sd">    Note:</span>
</span><span id="SoftmaxKwargs-1189"><a href="#SoftmaxKwargs-1189"><span class="linenos">1189</span></a><span class="sd">        Defaults to &#39;channel&#39; axis</span>
</span><span id="SoftmaxKwargs-1190"><a href="#SoftmaxKwargs-1190"><span class="linenos">1190</span></a><span class="sd">        (which may not exist, in which case</span>
</span><span id="SoftmaxKwargs-1191"><a href="#SoftmaxKwargs-1191"><span class="linenos">1191</span></a><span class="sd">        a different axis id has to be specified).</span>
</span><span id="SoftmaxKwargs-1192"><a href="#SoftmaxKwargs-1192"><span class="linenos">1192</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#SoftmaxDescr">SoftmaxDescr</a></code></p>
</div>


                            <div id="SoftmaxKwargs.axis" class="classattr">
                                <div class="attr variable">
            <span class="name">axis</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch), FieldInfo(annotation=NoneType, required=True, examples=[&#39;channel&#39;])]</span>        =
<span class="default_value">&#39;channel&#39;</span>

        
    </div>
    <a class="headerlink" href="#SoftmaxKwargs.axis"></a>
    
            <div class="docstring"><p>The axis to apply the softmax function along.</p>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Defaults to 'channel' axis
  (which may not exist, in which case
  a different axis id has to be specified).</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="SoftmaxDescr">
                            <input id="SoftmaxDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SoftmaxDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="SoftmaxDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SoftmaxDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SoftmaxDescr-1195"><a href="#SoftmaxDescr-1195"><span class="linenos">1195</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SoftmaxDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="SoftmaxDescr-1196"><a href="#SoftmaxDescr-1196"><span class="linenos">1196</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The softmax function.</span>
</span><span id="SoftmaxDescr-1197"><a href="#SoftmaxDescr-1197"><span class="linenos">1197</span></a>
</span><span id="SoftmaxDescr-1198"><a href="#SoftmaxDescr-1198"><span class="linenos">1198</span></a><span class="sd">    Examples:</span>
</span><span id="SoftmaxDescr-1199"><a href="#SoftmaxDescr-1199"><span class="linenos">1199</span></a><span class="sd">    - in YAML</span>
</span><span id="SoftmaxDescr-1200"><a href="#SoftmaxDescr-1200"><span class="linenos">1200</span></a><span class="sd">        ```yaml</span>
</span><span id="SoftmaxDescr-1201"><a href="#SoftmaxDescr-1201"><span class="linenos">1201</span></a><span class="sd">        postprocessing:</span>
</span><span id="SoftmaxDescr-1202"><a href="#SoftmaxDescr-1202"><span class="linenos">1202</span></a><span class="sd">          - id: softmax</span>
</span><span id="SoftmaxDescr-1203"><a href="#SoftmaxDescr-1203"><span class="linenos">1203</span></a><span class="sd">            kwargs:</span>
</span><span id="SoftmaxDescr-1204"><a href="#SoftmaxDescr-1204"><span class="linenos">1204</span></a><span class="sd">              axis: channel</span>
</span><span id="SoftmaxDescr-1205"><a href="#SoftmaxDescr-1205"><span class="linenos">1205</span></a><span class="sd">        ```</span>
</span><span id="SoftmaxDescr-1206"><a href="#SoftmaxDescr-1206"><span class="linenos">1206</span></a><span class="sd">    - in Python:</span>
</span><span id="SoftmaxDescr-1207"><a href="#SoftmaxDescr-1207"><span class="linenos">1207</span></a><span class="sd">        &gt;&gt;&gt; postprocessing = [SoftmaxDescr(kwargs=SoftmaxKwargs(axis=AxisId(&quot;channel&quot;)))]</span>
</span><span id="SoftmaxDescr-1208"><a href="#SoftmaxDescr-1208"><span class="linenos">1208</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SoftmaxDescr-1209"><a href="#SoftmaxDescr-1209"><span class="linenos">1209</span></a>
</span><span id="SoftmaxDescr-1210"><a href="#SoftmaxDescr-1210"><span class="linenos">1210</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;softmax&quot;</span>
</span><span id="SoftmaxDescr-1211"><a href="#SoftmaxDescr-1211"><span class="linenos">1211</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="SoftmaxDescr-1212"><a href="#SoftmaxDescr-1212"><span class="linenos">1212</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;softmax&quot;</span>
</span><span id="SoftmaxDescr-1213"><a href="#SoftmaxDescr-1213"><span class="linenos">1213</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="SoftmaxDescr-1214"><a href="#SoftmaxDescr-1214"><span class="linenos">1214</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;softmax&quot;</span><span class="p">]</span>
</span><span id="SoftmaxDescr-1215"><a href="#SoftmaxDescr-1215"><span class="linenos">1215</span></a>
</span><span id="SoftmaxDescr-1216"><a href="#SoftmaxDescr-1216"><span class="linenos">1216</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">SoftmaxKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">SoftmaxKwargs</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The softmax function.</p>

<p>Examples:</p>

<ul>
<li>in YAML</li>
</ul>

<pre><code><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">postprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">softmax</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">channel</span>
</code></pre>
</div>
</code></pre>

<ul>
<li>in Python:

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">postprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">SoftmaxDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">SoftmaxKwargs</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">)))]</span>
</code></pre>
</div>
</li>
</ul>
</div>


                            <div id="SoftmaxDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;softmax&#39;]]</span>        =
<span class="default_value">&#39;softmax&#39;</span>

        
    </div>
    <a class="headerlink" href="#SoftmaxDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="SoftmaxDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="#SoftmaxKwargs">SoftmaxKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SoftmaxDescr.kwargs"></a>
    
    

                            </div>
                            <div id="SoftmaxDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;softmax&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#SoftmaxDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="FixedZeroMeanUnitVarianceKwargs">
                            <input id="FixedZeroMeanUnitVarianceKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FixedZeroMeanUnitVarianceKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="FixedZeroMeanUnitVarianceKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FixedZeroMeanUnitVarianceKwargs-1219"><a href="#FixedZeroMeanUnitVarianceKwargs-1219"><span class="linenos">1219</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1220"><a href="#FixedZeroMeanUnitVarianceKwargs-1220"><span class="linenos">1220</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `FixedZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1221"><a href="#FixedZeroMeanUnitVarianceKwargs-1221"><span class="linenos">1221</span></a>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1222"><a href="#FixedZeroMeanUnitVarianceKwargs-1222"><span class="linenos">1222</span></a>    <span class="n">mean</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1223"><a href="#FixedZeroMeanUnitVarianceKwargs-1223"><span class="linenos">1223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The mean value to normalize with.&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1224"><a href="#FixedZeroMeanUnitVarianceKwargs-1224"><span class="linenos">1224</span></a>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1225"><a href="#FixedZeroMeanUnitVarianceKwargs-1225"><span class="linenos">1225</span></a>    <span class="n">std</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)]</span>
</span><span id="FixedZeroMeanUnitVarianceKwargs-1226"><a href="#FixedZeroMeanUnitVarianceKwargs-1226"><span class="linenos">1226</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard deviation value to normalize with.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a></code></p>
</div>


                            <div id="FixedZeroMeanUnitVarianceKwargs.mean" class="classattr">
                                <div class="attr variable">
            <span class="name">mean</span><span class="annotation">: float</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceKwargs.mean"></a>
    
            <div class="docstring"><p>The mean value to normalize with.</p>
</div>


                            </div>
                            <div id="FixedZeroMeanUnitVarianceKwargs.std" class="classattr">
                                <div class="attr variable">
            <span class="name">std</span><span class="annotation">: Annotated[float, Ge(ge=1e-06)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceKwargs.std"></a>
    
            <div class="docstring"><p>The standard deviation value to normalize with.</p>
</div>


                            </div>
                </section>
                <section id="FixedZeroMeanUnitVarianceAlongAxisKwargs">
                            <input id="FixedZeroMeanUnitVarianceAlongAxisKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FixedZeroMeanUnitVarianceAlongAxisKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="FixedZeroMeanUnitVarianceAlongAxisKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1229"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1229"><span class="linenos">1229</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceAlongAxisKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1230"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1230"><span class="linenos">1230</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `FixedZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1231"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1231"><span class="linenos">1231</span></a>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1232"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1232"><span class="linenos">1232</span></a>    <span class="n">mean</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1233"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1233"><span class="linenos">1233</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The mean value(s) to normalize with.&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1234"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1234"><span class="linenos">1234</span></a>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1235"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1235"><span class="linenos">1235</span></a>    <span class="n">std</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)]]]</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1236"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1236"><span class="linenos">1236</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard deviation value(s) to normalize with.</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1237"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1237"><span class="linenos">1237</span></a><span class="sd">    Size must match `mean` values.&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1238"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1238"><span class="linenos">1238</span></a>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1239"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1239"><span class="linenos">1239</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">NonBatchAxisId</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">])]</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1240"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1240"><span class="linenos">1240</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The axis of the mean/std values to normalize each entry along that dimension</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1241"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1241"><span class="linenos">1241</span></a><span class="sd">    separately.&quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1242"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1242"><span class="linenos">1242</span></a>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1243"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1243"><span class="linenos">1243</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1244"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1244"><span class="linenos">1244</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_mean_and_std_match</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1245"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1245"><span class="linenos">1245</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">):</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1246"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1246"><span class="linenos">1246</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1247"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1247"><span class="linenos">1247</span></a>                <span class="sa">f</span><span class="s2">&quot;Size of `mean` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span><span class="si">}</span><span class="s2">) and `std` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1248"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1248"><span class="linenos">1248</span></a>                <span class="o">+</span> <span class="s2">&quot; must match.&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1249"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1249"><span class="linenos">1249</span></a>            <span class="p">)</span>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1250"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1250"><span class="linenos">1250</span></a>
</span><span id="FixedZeroMeanUnitVarianceAlongAxisKwargs-1251"><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs-1251"><span class="linenos">1251</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a></code></p>
</div>


                            <div id="FixedZeroMeanUnitVarianceAlongAxisKwargs.mean" class="classattr">
                                <div class="attr variable">
            <span class="name">mean</span><span class="annotation">: Annotated[List[float], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.mean"></a>
    
            <div class="docstring"><p>The mean value(s) to normalize with.</p>
</div>


                            </div>
                            <div id="FixedZeroMeanUnitVarianceAlongAxisKwargs.std" class="classattr">
                                <div class="attr variable">
            <span class="name">std</span><span class="annotation">: Annotated[List[Annotated[float, Ge(ge=1e-06)]], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.std"></a>
    
            <div class="docstring"><p>The standard deviation value(s) to normalize with.
Size must match <code><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.mean">mean</a></code> values.</p>
</div>


                            </div>
                            <div id="FixedZeroMeanUnitVarianceAlongAxisKwargs.axis" class="classattr">
                                <div class="attr variable">
            <span class="name">axis</span><span class="annotation">: Annotated[<a href="#AxisId">AxisId</a>, Predicate(_is_not_batch), FieldInfo(annotation=NoneType, required=True, examples=[&#39;channel&#39;, &#39;index&#39;])]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceAlongAxisKwargs.axis"></a>
    
            <div class="docstring"><p>The axis of the mean/std values to normalize each entry along that dimension
separately.</p>
</div>


                            </div>
                </section>
                <section id="FixedZeroMeanUnitVarianceDescr">
                            <input id="FixedZeroMeanUnitVarianceDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FixedZeroMeanUnitVarianceDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="FixedZeroMeanUnitVarianceDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FixedZeroMeanUnitVarianceDescr-1254"><a href="#FixedZeroMeanUnitVarianceDescr-1254"><span class="linenos">1254</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FixedZeroMeanUnitVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1255"><a href="#FixedZeroMeanUnitVarianceDescr-1255"><span class="linenos">1255</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Subtract a given mean and divide by the standard deviation.</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1256"><a href="#FixedZeroMeanUnitVarianceDescr-1256"><span class="linenos">1256</span></a>
</span><span id="FixedZeroMeanUnitVarianceDescr-1257"><a href="#FixedZeroMeanUnitVarianceDescr-1257"><span class="linenos">1257</span></a><span class="sd">    Normalize with fixed, precomputed values for</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1258"><a href="#FixedZeroMeanUnitVarianceDescr-1258"><span class="linenos">1258</span></a><span class="sd">    `FixedZeroMeanUnitVarianceKwargs.mean` and `FixedZeroMeanUnitVarianceKwargs.std`</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1259"><a href="#FixedZeroMeanUnitVarianceDescr-1259"><span class="linenos">1259</span></a><span class="sd">    Use `FixedZeroMeanUnitVarianceAlongAxisKwargs` for independent scaling along given</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1260"><a href="#FixedZeroMeanUnitVarianceDescr-1260"><span class="linenos">1260</span></a><span class="sd">    axes.</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1261"><a href="#FixedZeroMeanUnitVarianceDescr-1261"><span class="linenos">1261</span></a>
</span><span id="FixedZeroMeanUnitVarianceDescr-1262"><a href="#FixedZeroMeanUnitVarianceDescr-1262"><span class="linenos">1262</span></a><span class="sd">    Examples:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1263"><a href="#FixedZeroMeanUnitVarianceDescr-1263"><span class="linenos">1263</span></a><span class="sd">    1. scalar value for whole tensor</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1264"><a href="#FixedZeroMeanUnitVarianceDescr-1264"><span class="linenos">1264</span></a><span class="sd">        - in YAML</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1265"><a href="#FixedZeroMeanUnitVarianceDescr-1265"><span class="linenos">1265</span></a><span class="sd">        ```yaml</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1266"><a href="#FixedZeroMeanUnitVarianceDescr-1266"><span class="linenos">1266</span></a><span class="sd">        preprocessing:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1267"><a href="#FixedZeroMeanUnitVarianceDescr-1267"><span class="linenos">1267</span></a><span class="sd">          - id: fixed_zero_mean_unit_variance</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1268"><a href="#FixedZeroMeanUnitVarianceDescr-1268"><span class="linenos">1268</span></a><span class="sd">            kwargs:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1269"><a href="#FixedZeroMeanUnitVarianceDescr-1269"><span class="linenos">1269</span></a><span class="sd">              mean: 103.5</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1270"><a href="#FixedZeroMeanUnitVarianceDescr-1270"><span class="linenos">1270</span></a><span class="sd">              std: 13.7</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1271"><a href="#FixedZeroMeanUnitVarianceDescr-1271"><span class="linenos">1271</span></a><span class="sd">        ```</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1272"><a href="#FixedZeroMeanUnitVarianceDescr-1272"><span class="linenos">1272</span></a><span class="sd">        - in Python</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1273"><a href="#FixedZeroMeanUnitVarianceDescr-1273"><span class="linenos">1273</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [FixedZeroMeanUnitVarianceDescr(</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1274"><a href="#FixedZeroMeanUnitVarianceDescr-1274"><span class="linenos">1274</span></a><span class="sd">        ...   kwargs=FixedZeroMeanUnitVarianceKwargs(mean=103.5, std=13.7)</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1275"><a href="#FixedZeroMeanUnitVarianceDescr-1275"><span class="linenos">1275</span></a><span class="sd">        ... )]</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1276"><a href="#FixedZeroMeanUnitVarianceDescr-1276"><span class="linenos">1276</span></a>
</span><span id="FixedZeroMeanUnitVarianceDescr-1277"><a href="#FixedZeroMeanUnitVarianceDescr-1277"><span class="linenos">1277</span></a><span class="sd">    2. independently along an axis</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1278"><a href="#FixedZeroMeanUnitVarianceDescr-1278"><span class="linenos">1278</span></a><span class="sd">        - in YAML</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1279"><a href="#FixedZeroMeanUnitVarianceDescr-1279"><span class="linenos">1279</span></a><span class="sd">        ```yaml</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1280"><a href="#FixedZeroMeanUnitVarianceDescr-1280"><span class="linenos">1280</span></a><span class="sd">        preprocessing:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1281"><a href="#FixedZeroMeanUnitVarianceDescr-1281"><span class="linenos">1281</span></a><span class="sd">          - id: fixed_zero_mean_unit_variance</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1282"><a href="#FixedZeroMeanUnitVarianceDescr-1282"><span class="linenos">1282</span></a><span class="sd">            kwargs:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1283"><a href="#FixedZeroMeanUnitVarianceDescr-1283"><span class="linenos">1283</span></a><span class="sd">              axis: channel</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1284"><a href="#FixedZeroMeanUnitVarianceDescr-1284"><span class="linenos">1284</span></a><span class="sd">              mean: [101.5, 102.5, 103.5]</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1285"><a href="#FixedZeroMeanUnitVarianceDescr-1285"><span class="linenos">1285</span></a><span class="sd">              std: [11.7, 12.7, 13.7]</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1286"><a href="#FixedZeroMeanUnitVarianceDescr-1286"><span class="linenos">1286</span></a><span class="sd">        ```</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1287"><a href="#FixedZeroMeanUnitVarianceDescr-1287"><span class="linenos">1287</span></a><span class="sd">        - in Python</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1288"><a href="#FixedZeroMeanUnitVarianceDescr-1288"><span class="linenos">1288</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [FixedZeroMeanUnitVarianceDescr(</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1289"><a href="#FixedZeroMeanUnitVarianceDescr-1289"><span class="linenos">1289</span></a><span class="sd">        ...   kwargs=FixedZeroMeanUnitVarianceAlongAxisKwargs(</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1290"><a href="#FixedZeroMeanUnitVarianceDescr-1290"><span class="linenos">1290</span></a><span class="sd">        ...     axis=AxisId(&quot;channel&quot;),</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1291"><a href="#FixedZeroMeanUnitVarianceDescr-1291"><span class="linenos">1291</span></a><span class="sd">        ...     mean=[101.5, 102.5, 103.5],</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1292"><a href="#FixedZeroMeanUnitVarianceDescr-1292"><span class="linenos">1292</span></a><span class="sd">        ...     std=[11.7, 12.7, 13.7],</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1293"><a href="#FixedZeroMeanUnitVarianceDescr-1293"><span class="linenos">1293</span></a><span class="sd">        ...   )</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1294"><a href="#FixedZeroMeanUnitVarianceDescr-1294"><span class="linenos">1294</span></a><span class="sd">        ... )]</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1295"><a href="#FixedZeroMeanUnitVarianceDescr-1295"><span class="linenos">1295</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1296"><a href="#FixedZeroMeanUnitVarianceDescr-1296"><span class="linenos">1296</span></a>
</span><span id="FixedZeroMeanUnitVarianceDescr-1297"><a href="#FixedZeroMeanUnitVarianceDescr-1297"><span class="linenos">1297</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1298"><a href="#FixedZeroMeanUnitVarianceDescr-1298"><span class="linenos">1298</span></a>        <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1299"><a href="#FixedZeroMeanUnitVarianceDescr-1299"><span class="linenos">1299</span></a>    <span class="p">)</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1300"><a href="#FixedZeroMeanUnitVarianceDescr-1300"><span class="linenos">1300</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1301"><a href="#FixedZeroMeanUnitVarianceDescr-1301"><span class="linenos">1301</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1302"><a href="#FixedZeroMeanUnitVarianceDescr-1302"><span class="linenos">1302</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1303"><a href="#FixedZeroMeanUnitVarianceDescr-1303"><span class="linenos">1303</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed_zero_mean_unit_variance&quot;</span><span class="p">]</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1304"><a href="#FixedZeroMeanUnitVarianceDescr-1304"><span class="linenos">1304</span></a>
</span><span id="FixedZeroMeanUnitVarianceDescr-1305"><a href="#FixedZeroMeanUnitVarianceDescr-1305"><span class="linenos">1305</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1306"><a href="#FixedZeroMeanUnitVarianceDescr-1306"><span class="linenos">1306</span></a>        <span class="n">FixedZeroMeanUnitVarianceKwargs</span><span class="p">,</span> <span class="n">FixedZeroMeanUnitVarianceAlongAxisKwargs</span>
</span><span id="FixedZeroMeanUnitVarianceDescr-1307"><a href="#FixedZeroMeanUnitVarianceDescr-1307"><span class="linenos">1307</span></a>    <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Subtract a given mean and divide by the standard deviation.</p>

<p>Normalize with fixed, precomputed values for
<code><a href="#FixedZeroMeanUnitVarianceKwargs.mean">FixedZeroMeanUnitVarianceKwargs.mean</a></code> and <code><a href="#FixedZeroMeanUnitVarianceKwargs.std">FixedZeroMeanUnitVarianceKwargs.std</a></code>
Use <code><a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs">FixedZeroMeanUnitVarianceAlongAxisKwargs</a></code> for independent scaling along given
axes.</p>

<p>Examples:</p>

<ol>
<li>scalar value for whole tensor
<ul>
<li>in YAML</li>
</ul></li>
</ol>

<pre><code><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fixed_zero_mean_unit_variance</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">mean</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">103.5</span>
<span class="w">      </span><span class="nt">std</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13.7</span>
</code></pre>
</div>


- in Python
&gt;&gt;&gt; preprocessing = [FixedZeroMeanUnitVarianceDescr(
...   kwargs=FixedZeroMeanUnitVarianceKwargs(mean=103.5, std=13.7)
... )]
</code></pre>

<ol start="2">
<li><p>independently along an axis</p>

<ul>
<li>in YAML</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fixed_zero_mean_unit_variance</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">channel</span>
<span class="w">      </span><span class="nt">mean</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">101.5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">102.5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">103.5</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">std</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">11.7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12.7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">13.7</span><span class="p p-Indicator">]</span>
</code></pre>
</div>

<ul>
<li>in Python

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">FixedZeroMeanUnitVarianceDescr</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">kwargs</span><span class="o">=</span><span class="n">FixedZeroMeanUnitVarianceAlongAxisKwargs</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">axis</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">101.5</span><span class="p">,</span> <span class="mf">102.5</span><span class="p">,</span> <span class="mf">103.5</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">12.7</span><span class="p">,</span> <span class="mf">13.7</span><span class="p">],</span>
<span class="gp">... </span>  <span class="p">)</span>
<span class="gp">... </span><span class="p">)]</span>
</code></pre>
</div>
</li>
</ul></li>
</ol>
</div>


                            <div id="FixedZeroMeanUnitVarianceDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;fixed_zero_mean_unit_variance&#39;]]</span>        =
<span class="default_value">&#39;fixed_zero_mean_unit_variance&#39;</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="FixedZeroMeanUnitVarianceDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: Union[<a href="#FixedZeroMeanUnitVarianceKwargs">FixedZeroMeanUnitVarianceKwargs</a>, <a href="#FixedZeroMeanUnitVarianceAlongAxisKwargs">FixedZeroMeanUnitVarianceAlongAxisKwargs</a>]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceDescr.kwargs"></a>
    
    

                            </div>
                            <div id="FixedZeroMeanUnitVarianceDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;fixed_zero_mean_unit_variance&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#FixedZeroMeanUnitVarianceDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="ZeroMeanUnitVarianceKwargs">
                            <input id="ZeroMeanUnitVarianceKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ZeroMeanUnitVarianceKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="ZeroMeanUnitVarianceKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZeroMeanUnitVarianceKwargs-1310"><a href="#ZeroMeanUnitVarianceKwargs-1310"><span class="linenos">1310</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZeroMeanUnitVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1311"><a href="#ZeroMeanUnitVarianceKwargs-1311"><span class="linenos">1311</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ZeroMeanUnitVarianceDescr`&quot;&quot;&quot;</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1312"><a href="#ZeroMeanUnitVarianceKwargs-1312"><span class="linenos">1312</span></a>
</span><span id="ZeroMeanUnitVarianceKwargs-1313"><a href="#ZeroMeanUnitVarianceKwargs-1313"><span class="linenos">1313</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1314"><a href="#ZeroMeanUnitVarianceKwargs-1314"><span class="linenos">1314</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1315"><a href="#ZeroMeanUnitVarianceKwargs-1315"><span class="linenos">1315</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1316"><a href="#ZeroMeanUnitVarianceKwargs-1316"><span class="linenos">1316</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1317"><a href="#ZeroMeanUnitVarianceKwargs-1317"><span class="linenos">1317</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1318"><a href="#ZeroMeanUnitVarianceKwargs-1318"><span class="linenos">1318</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1319"><a href="#ZeroMeanUnitVarianceKwargs-1319"><span class="linenos">1319</span></a><span class="sd">    To normalize each sample independently leave out the &#39;batch&#39; axis.</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1320"><a href="#ZeroMeanUnitVarianceKwargs-1320"><span class="linenos">1320</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1321"><a href="#ZeroMeanUnitVarianceKwargs-1321"><span class="linenos">1321</span></a>
</span><span id="ZeroMeanUnitVarianceKwargs-1322"><a href="#ZeroMeanUnitVarianceKwargs-1322"><span class="linenos">1322</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="ZeroMeanUnitVarianceKwargs-1323"><a href="#ZeroMeanUnitVarianceKwargs-1323"><span class="linenos">1323</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;epsilon for numeric stability: `out = (tensor - mean) / (std + eps)`.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a></code></p>
</div>


                            <div id="ZeroMeanUnitVarianceKwargs.axes" class="classattr">
                                <div class="attr variable">
            <span class="name">axes</span><span class="annotation">: Annotated[Optional[Sequence[<a href="#AxisId">AxisId</a>]], FieldInfo(annotation=NoneType, required=True, examples=[(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)])]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceKwargs.axes"></a>
    
            <div class="docstring"><p>The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.
For example to normalize 'batch', 'x' and 'y' jointly in a tensor ('batch', 'channel', 'y', 'x')
resulting in a tensor of equal shape normalized per channel, specify <code>axes=('batch', 'x', 'y')</code>.
To normalize each sample independently leave out the 'batch' axis.
Default: Scale all axes jointly.</p>
</div>


                            </div>
                            <div id="ZeroMeanUnitVarianceKwargs.eps" class="classattr">
                                <div class="attr variable">
            <span class="name">eps</span><span class="annotation">: Annotated[float, Interval(gt=0, ge=None, lt=None, le=0.1)]</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceKwargs.eps"></a>
    
            <div class="docstring"><p>epsilon for numeric stability: <code>out = (tensor - mean) / (std + eps)</code>.</p>
</div>


                            </div>
                </section>
                <section id="ZeroMeanUnitVarianceDescr">
                            <input id="ZeroMeanUnitVarianceDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ZeroMeanUnitVarianceDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="ZeroMeanUnitVarianceDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZeroMeanUnitVarianceDescr-1326"><a href="#ZeroMeanUnitVarianceDescr-1326"><span class="linenos">1326</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZeroMeanUnitVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="ZeroMeanUnitVarianceDescr-1327"><a href="#ZeroMeanUnitVarianceDescr-1327"><span class="linenos">1327</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Subtract mean and divide by variance.</span>
</span><span id="ZeroMeanUnitVarianceDescr-1328"><a href="#ZeroMeanUnitVarianceDescr-1328"><span class="linenos">1328</span></a>
</span><span id="ZeroMeanUnitVarianceDescr-1329"><a href="#ZeroMeanUnitVarianceDescr-1329"><span class="linenos">1329</span></a><span class="sd">    Examples:</span>
</span><span id="ZeroMeanUnitVarianceDescr-1330"><a href="#ZeroMeanUnitVarianceDescr-1330"><span class="linenos">1330</span></a><span class="sd">        Subtract tensor mean and variance</span>
</span><span id="ZeroMeanUnitVarianceDescr-1331"><a href="#ZeroMeanUnitVarianceDescr-1331"><span class="linenos">1331</span></a><span class="sd">        - in YAML</span>
</span><span id="ZeroMeanUnitVarianceDescr-1332"><a href="#ZeroMeanUnitVarianceDescr-1332"><span class="linenos">1332</span></a><span class="sd">        ```yaml</span>
</span><span id="ZeroMeanUnitVarianceDescr-1333"><a href="#ZeroMeanUnitVarianceDescr-1333"><span class="linenos">1333</span></a><span class="sd">        preprocessing:</span>
</span><span id="ZeroMeanUnitVarianceDescr-1334"><a href="#ZeroMeanUnitVarianceDescr-1334"><span class="linenos">1334</span></a><span class="sd">          - id: zero_mean_unit_variance</span>
</span><span id="ZeroMeanUnitVarianceDescr-1335"><a href="#ZeroMeanUnitVarianceDescr-1335"><span class="linenos">1335</span></a><span class="sd">        ```</span>
</span><span id="ZeroMeanUnitVarianceDescr-1336"><a href="#ZeroMeanUnitVarianceDescr-1336"><span class="linenos">1336</span></a><span class="sd">        - in Python</span>
</span><span id="ZeroMeanUnitVarianceDescr-1337"><a href="#ZeroMeanUnitVarianceDescr-1337"><span class="linenos">1337</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [ZeroMeanUnitVarianceDescr()]</span>
</span><span id="ZeroMeanUnitVarianceDescr-1338"><a href="#ZeroMeanUnitVarianceDescr-1338"><span class="linenos">1338</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ZeroMeanUnitVarianceDescr-1339"><a href="#ZeroMeanUnitVarianceDescr-1339"><span class="linenos">1339</span></a>
</span><span id="ZeroMeanUnitVarianceDescr-1340"><a href="#ZeroMeanUnitVarianceDescr-1340"><span class="linenos">1340</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ZeroMeanUnitVarianceDescr-1341"><a href="#ZeroMeanUnitVarianceDescr-1341"><span class="linenos">1341</span></a>        <span class="s2">&quot;zero_mean_unit_variance&quot;</span>
</span><span id="ZeroMeanUnitVarianceDescr-1342"><a href="#ZeroMeanUnitVarianceDescr-1342"><span class="linenos">1342</span></a>    <span class="p">)</span>
</span><span id="ZeroMeanUnitVarianceDescr-1343"><a href="#ZeroMeanUnitVarianceDescr-1343"><span class="linenos">1343</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ZeroMeanUnitVarianceDescr-1344"><a href="#ZeroMeanUnitVarianceDescr-1344"><span class="linenos">1344</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zero_mean_unit_variance&quot;</span>
</span><span id="ZeroMeanUnitVarianceDescr-1345"><a href="#ZeroMeanUnitVarianceDescr-1345"><span class="linenos">1345</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ZeroMeanUnitVarianceDescr-1346"><a href="#ZeroMeanUnitVarianceDescr-1346"><span class="linenos">1346</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;zero_mean_unit_variance&quot;</span><span class="p">]</span>
</span><span id="ZeroMeanUnitVarianceDescr-1347"><a href="#ZeroMeanUnitVarianceDescr-1347"><span class="linenos">1347</span></a>
</span><span id="ZeroMeanUnitVarianceDescr-1348"><a href="#ZeroMeanUnitVarianceDescr-1348"><span class="linenos">1348</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ZeroMeanUnitVarianceKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ZeroMeanUnitVarianceDescr-1349"><a href="#ZeroMeanUnitVarianceDescr-1349"><span class="linenos">1349</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">ZeroMeanUnitVarianceKwargs</span><span class="o">.</span><span class="n">model_construct</span>
</span><span id="ZeroMeanUnitVarianceDescr-1350"><a href="#ZeroMeanUnitVarianceDescr-1350"><span class="linenos">1350</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Subtract mean and divide by variance.</p>

<h6 id="examples">Examples:</h6>

<blockquote>
  <p>Subtract tensor mean and variance</p>
  
  <ul>
  <li>in YAML</li>
  </ul>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zero_mean_unit_variance</span>
</code></pre>
  </div>
  
  <ul>
  <li>in Python
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">ZeroMeanUnitVarianceDescr</span><span class="p">()]</span>
</code></pre>
  </div>
  </li>
  </ul>
</blockquote>
</div>


                            <div id="ZeroMeanUnitVarianceDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;zero_mean_unit_variance&#39;]]</span>        =
<span class="default_value">&#39;zero_mean_unit_variance&#39;</span>

        
    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="ZeroMeanUnitVarianceDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="#ZeroMeanUnitVarianceKwargs">ZeroMeanUnitVarianceKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceDescr.kwargs"></a>
    
    

                            </div>
                            <div id="ZeroMeanUnitVarianceDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;zero_mean_unit_variance&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ZeroMeanUnitVarianceDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="ScaleRangeKwargs">
                            <input id="ScaleRangeKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleRangeKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="ScaleRangeKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleRangeKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleRangeKwargs-1353"><a href="#ScaleRangeKwargs-1353"><span class="linenos">1353</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleRangeKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="ScaleRangeKwargs-1354"><a href="#ScaleRangeKwargs-1354"><span class="linenos">1354</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ScaleRangeDescr`</span>
</span><span id="ScaleRangeKwargs-1355"><a href="#ScaleRangeKwargs-1355"><span class="linenos">1355</span></a>
</span><span id="ScaleRangeKwargs-1356"><a href="#ScaleRangeKwargs-1356"><span class="linenos">1356</span></a><span class="sd">    For `min_percentile`=0.0 (the default) and `max_percentile`=100 (the default)</span>
</span><span id="ScaleRangeKwargs-1357"><a href="#ScaleRangeKwargs-1357"><span class="linenos">1357</span></a><span class="sd">    this processing step normalizes data to the [0, 1] intervall.</span>
</span><span id="ScaleRangeKwargs-1358"><a href="#ScaleRangeKwargs-1358"><span class="linenos">1358</span></a><span class="sd">    For other percentiles the normalized values will partially be outside the [0, 1]</span>
</span><span id="ScaleRangeKwargs-1359"><a href="#ScaleRangeKwargs-1359"><span class="linenos">1359</span></a><span class="sd">    intervall. Use `ScaleRange` followed by `ClipDescr` if you want to limit the</span>
</span><span id="ScaleRangeKwargs-1360"><a href="#ScaleRangeKwargs-1360"><span class="linenos">1360</span></a><span class="sd">    normalized values to a range.</span>
</span><span id="ScaleRangeKwargs-1361"><a href="#ScaleRangeKwargs-1361"><span class="linenos">1361</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1362"><a href="#ScaleRangeKwargs-1362"><span class="linenos">1362</span></a>
</span><span id="ScaleRangeKwargs-1363"><a href="#ScaleRangeKwargs-1363"><span class="linenos">1363</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ScaleRangeKwargs-1364"><a href="#ScaleRangeKwargs-1364"><span class="linenos">1364</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="ScaleRangeKwargs-1365"><a href="#ScaleRangeKwargs-1365"><span class="linenos">1365</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ScaleRangeKwargs-1366"><a href="#ScaleRangeKwargs-1366"><span class="linenos">1366</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute the min/max percentile value.</span>
</span><span id="ScaleRangeKwargs-1367"><a href="#ScaleRangeKwargs-1367"><span class="linenos">1367</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="ScaleRangeKwargs-1368"><a href="#ScaleRangeKwargs-1368"><span class="linenos">1368</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="ScaleRangeKwargs-1369"><a href="#ScaleRangeKwargs-1369"><span class="linenos">1369</span></a><span class="sd">    To normalize samples independently, leave out the &quot;batch&quot; axis.</span>
</span><span id="ScaleRangeKwargs-1370"><a href="#ScaleRangeKwargs-1370"><span class="linenos">1370</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1371"><a href="#ScaleRangeKwargs-1371"><span class="linenos">1371</span></a>
</span><span id="ScaleRangeKwargs-1372"><a href="#ScaleRangeKwargs-1372"><span class="linenos">1372</span></a>    <span class="n">min_percentile</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ScaleRangeKwargs-1373"><a href="#ScaleRangeKwargs-1373"><span class="linenos">1373</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The lower percentile used to determine the value to align with zero.&quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1374"><a href="#ScaleRangeKwargs-1374"><span class="linenos">1374</span></a>
</span><span id="ScaleRangeKwargs-1375"><a href="#ScaleRangeKwargs-1375"><span class="linenos">1375</span></a>    <span class="n">max_percentile</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">100.0</span>
</span><span id="ScaleRangeKwargs-1376"><a href="#ScaleRangeKwargs-1376"><span class="linenos">1376</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The upper percentile used to determine the value to align with one.</span>
</span><span id="ScaleRangeKwargs-1377"><a href="#ScaleRangeKwargs-1377"><span class="linenos">1377</span></a><span class="sd">    Has to be bigger than `min_percentile`.</span>
</span><span id="ScaleRangeKwargs-1378"><a href="#ScaleRangeKwargs-1378"><span class="linenos">1378</span></a><span class="sd">    The range is 1 to 100 instead of 0 to 100 to avoid mistakenly</span>
</span><span id="ScaleRangeKwargs-1379"><a href="#ScaleRangeKwargs-1379"><span class="linenos">1379</span></a><span class="sd">    accepting percentiles specified in the range 0.0 to 1.0.&quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1380"><a href="#ScaleRangeKwargs-1380"><span class="linenos">1380</span></a>
</span><span id="ScaleRangeKwargs-1381"><a href="#ScaleRangeKwargs-1381"><span class="linenos">1381</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="ScaleRangeKwargs-1382"><a href="#ScaleRangeKwargs-1382"><span class="linenos">1382</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Epsilon for numeric stability.</span>
</span><span id="ScaleRangeKwargs-1383"><a href="#ScaleRangeKwargs-1383"><span class="linenos">1383</span></a><span class="sd">    `out = (tensor - v_lower) / (v_upper - v_lower + eps)`;</span>
</span><span id="ScaleRangeKwargs-1384"><a href="#ScaleRangeKwargs-1384"><span class="linenos">1384</span></a><span class="sd">    with `v_lower,v_upper` values at the respective percentiles.&quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1385"><a href="#ScaleRangeKwargs-1385"><span class="linenos">1385</span></a>
</span><span id="ScaleRangeKwargs-1386"><a href="#ScaleRangeKwargs-1386"><span class="linenos">1386</span></a>    <span class="n">reference_tensor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ScaleRangeKwargs-1387"><a href="#ScaleRangeKwargs-1387"><span class="linenos">1387</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tensor ID to compute the percentiles from. Default: The tensor itself.</span>
</span><span id="ScaleRangeKwargs-1388"><a href="#ScaleRangeKwargs-1388"><span class="linenos">1388</span></a><span class="sd">    For any tensor in `inputs` only input tensor references are allowed.&quot;&quot;&quot;</span>
</span><span id="ScaleRangeKwargs-1389"><a href="#ScaleRangeKwargs-1389"><span class="linenos">1389</span></a>
</span><span id="ScaleRangeKwargs-1390"><a href="#ScaleRangeKwargs-1390"><span class="linenos">1390</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;max_percentile&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ScaleRangeKwargs-1391"><a href="#ScaleRangeKwargs-1391"><span class="linenos">1391</span></a>    <span class="nd">@classmethod</span>
</span><span id="ScaleRangeKwargs-1392"><a href="#ScaleRangeKwargs-1392"><span class="linenos">1392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">min_smaller_max</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ScaleRangeKwargs-1393"><a href="#ScaleRangeKwargs-1393"><span class="linenos">1393</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">min_p</span> <span class="o">:=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;min_percentile&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">:</span>
</span><span id="ScaleRangeKwargs-1394"><a href="#ScaleRangeKwargs-1394"><span class="linenos">1394</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;min_percentile </span><span class="si">{</span><span class="n">min_p</span><span class="si">}</span><span class="s2"> &gt;= max_percentile </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ScaleRangeKwargs-1395"><a href="#ScaleRangeKwargs-1395"><span class="linenos">1395</span></a>
</span><span id="ScaleRangeKwargs-1396"><a href="#ScaleRangeKwargs-1396"><span class="linenos">1396</span></a>        <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#ScaleRangeDescr">ScaleRangeDescr</a></code></p>

<p>For <code><a href="#ScaleRangeKwargs.min_percentile">min_percentile</a></code>=0.0 (the default) and <code><a href="#ScaleRangeKwargs.max_percentile">max_percentile</a></code>=100 (the default)
this processing step normalizes data to the [0, 1] intervall.
For other percentiles the normalized values will partially be outside the [0, 1]
intervall. Use <code>ScaleRange</code> followed by <code><a href="#ClipDescr">ClipDescr</a></code> if you want to limit the
normalized values to a range.</p>
</div>


                            <div id="ScaleRangeKwargs.axes" class="classattr">
                                <div class="attr variable">
            <span class="name">axes</span><span class="annotation">: Annotated[Optional[Sequence[<a href="#AxisId">AxisId</a>]], FieldInfo(annotation=NoneType, required=True, examples=[(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)])]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.axes"></a>
    
            <div class="docstring"><p>The subset of axes to normalize jointly, i.e. axes to reduce to compute the min/max percentile value.
For example to normalize 'batch', 'x' and 'y' jointly in a tensor ('batch', 'channel', 'y', 'x')
resulting in a tensor of equal shape normalized per channel, specify <code>axes=('batch', 'x', 'y')</code>.
To normalize samples independently, leave out the "batch" axis.
Default: Scale all axes jointly.</p>
</div>


                            </div>
                            <div id="ScaleRangeKwargs.min_percentile" class="classattr">
                                <div class="attr variable">
            <span class="name">min_percentile</span><span class="annotation">: Annotated[float, Interval(gt=None, ge=0, lt=100, le=None)]</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.min_percentile"></a>
    
            <div class="docstring"><p>The lower percentile used to determine the value to align with zero.</p>
</div>


                            </div>
                            <div id="ScaleRangeKwargs.max_percentile" class="classattr">
                                <div class="attr variable">
            <span class="name">max_percentile</span><span class="annotation">: Annotated[float, Interval(gt=1, ge=None, lt=None, le=100)]</span>        =
<span class="default_value">100.0</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.max_percentile"></a>
    
            <div class="docstring"><p>The upper percentile used to determine the value to align with one.
Has to be bigger than <code><a href="#ScaleRangeKwargs.min_percentile">min_percentile</a></code>.
The range is 1 to 100 instead of 0 to 100 to avoid mistakenly
accepting percentiles specified in the range 0.0 to 1.0.</p>
</div>


                            </div>
                            <div id="ScaleRangeKwargs.eps" class="classattr">
                                <div class="attr variable">
            <span class="name">eps</span><span class="annotation">: Annotated[float, Interval(gt=0, ge=None, lt=None, le=0.1)]</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.eps"></a>
    
            <div class="docstring"><p>Epsilon for numeric stability.
<code>out = (tensor - v_lower) / (v_upper - v_lower + eps)</code>;
with <code>v_lower,v_upper</code> values at the respective percentiles.</p>
</div>


                            </div>
                            <div id="ScaleRangeKwargs.reference_tensor" class="classattr">
                                <div class="attr variable">
            <span class="name">reference_tensor</span><span class="annotation">: Optional[<a href="#TensorId">TensorId</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.reference_tensor"></a>
    
            <div class="docstring"><p>Tensor ID to compute the percentiles from. Default: The tensor itself.
For any tensor in <code>inputs</code> only input tensor references are allowed.</p>
</div>


                            </div>
                            <div id="ScaleRangeKwargs.min_smaller_max" class="classattr">
                                        <input id="ScaleRangeKwargs.min_smaller_max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-field_validator">@field_validator(&#39;max_percentile&#39;, mode=&#39;after&#39;)</div>
        <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">min_smaller_max</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">info</span><span class="p">:</span> <span class="n">pydantic_core</span><span class="o">.</span><span class="n">core_schema</span><span class="o">.</span><span class="n">ValidationInfo</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ScaleRangeKwargs.min_smaller_max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleRangeKwargs.min_smaller_max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleRangeKwargs.min_smaller_max-1390"><a href="#ScaleRangeKwargs.min_smaller_max-1390"><span class="linenos">1390</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;max_percentile&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ScaleRangeKwargs.min_smaller_max-1391"><a href="#ScaleRangeKwargs.min_smaller_max-1391"><span class="linenos">1391</span></a>    <span class="nd">@classmethod</span>
</span><span id="ScaleRangeKwargs.min_smaller_max-1392"><a href="#ScaleRangeKwargs.min_smaller_max-1392"><span class="linenos">1392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">min_smaller_max</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ScaleRangeKwargs.min_smaller_max-1393"><a href="#ScaleRangeKwargs.min_smaller_max-1393"><span class="linenos">1393</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">min_p</span> <span class="o">:=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;min_percentile&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">:</span>
</span><span id="ScaleRangeKwargs.min_smaller_max-1394"><a href="#ScaleRangeKwargs.min_smaller_max-1394"><span class="linenos">1394</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;min_percentile </span><span class="si">{</span><span class="n">min_p</span><span class="si">}</span><span class="s2"> &gt;= max_percentile </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ScaleRangeKwargs.min_smaller_max-1395"><a href="#ScaleRangeKwargs.min_smaller_max-1395"><span class="linenos">1395</span></a>
</span><span id="ScaleRangeKwargs.min_smaller_max-1396"><a href="#ScaleRangeKwargs.min_smaller_max-1396"><span class="linenos">1396</span></a>        <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="ScaleRangeDescr">
                            <input id="ScaleRangeDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleRangeDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="ScaleRangeDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleRangeDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleRangeDescr-1399"><a href="#ScaleRangeDescr-1399"><span class="linenos">1399</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleRangeDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="ScaleRangeDescr-1400"><a href="#ScaleRangeDescr-1400"><span class="linenos">1400</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale with percentiles.</span>
</span><span id="ScaleRangeDescr-1401"><a href="#ScaleRangeDescr-1401"><span class="linenos">1401</span></a>
</span><span id="ScaleRangeDescr-1402"><a href="#ScaleRangeDescr-1402"><span class="linenos">1402</span></a><span class="sd">    Examples:</span>
</span><span id="ScaleRangeDescr-1403"><a href="#ScaleRangeDescr-1403"><span class="linenos">1403</span></a><span class="sd">    1. Scale linearly to map 5th percentile to 0 and 99.8th percentile to 1.0</span>
</span><span id="ScaleRangeDescr-1404"><a href="#ScaleRangeDescr-1404"><span class="linenos">1404</span></a><span class="sd">        - in YAML</span>
</span><span id="ScaleRangeDescr-1405"><a href="#ScaleRangeDescr-1405"><span class="linenos">1405</span></a><span class="sd">        ```yaml</span>
</span><span id="ScaleRangeDescr-1406"><a href="#ScaleRangeDescr-1406"><span class="linenos">1406</span></a><span class="sd">        preprocessing:</span>
</span><span id="ScaleRangeDescr-1407"><a href="#ScaleRangeDescr-1407"><span class="linenos">1407</span></a><span class="sd">          - id: scale_range</span>
</span><span id="ScaleRangeDescr-1408"><a href="#ScaleRangeDescr-1408"><span class="linenos">1408</span></a><span class="sd">            kwargs:</span>
</span><span id="ScaleRangeDescr-1409"><a href="#ScaleRangeDescr-1409"><span class="linenos">1409</span></a><span class="sd">              axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="ScaleRangeDescr-1410"><a href="#ScaleRangeDescr-1410"><span class="linenos">1410</span></a><span class="sd">              max_percentile: 99.8</span>
</span><span id="ScaleRangeDescr-1411"><a href="#ScaleRangeDescr-1411"><span class="linenos">1411</span></a><span class="sd">              min_percentile: 5.0</span>
</span><span id="ScaleRangeDescr-1412"><a href="#ScaleRangeDescr-1412"><span class="linenos">1412</span></a><span class="sd">        ```</span>
</span><span id="ScaleRangeDescr-1413"><a href="#ScaleRangeDescr-1413"><span class="linenos">1413</span></a><span class="sd">        - in Python</span>
</span><span id="ScaleRangeDescr-1414"><a href="#ScaleRangeDescr-1414"><span class="linenos">1414</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [</span>
</span><span id="ScaleRangeDescr-1415"><a href="#ScaleRangeDescr-1415"><span class="linenos">1415</span></a><span class="sd">        ...     ScaleRangeDescr(</span>
</span><span id="ScaleRangeDescr-1416"><a href="#ScaleRangeDescr-1416"><span class="linenos">1416</span></a><span class="sd">        ...         kwargs=ScaleRangeKwargs(</span>
</span><span id="ScaleRangeDescr-1417"><a href="#ScaleRangeDescr-1417"><span class="linenos">1417</span></a><span class="sd">        ...           axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="ScaleRangeDescr-1418"><a href="#ScaleRangeDescr-1418"><span class="linenos">1418</span></a><span class="sd">        ...           max_percentile= 99.8,</span>
</span><span id="ScaleRangeDescr-1419"><a href="#ScaleRangeDescr-1419"><span class="linenos">1419</span></a><span class="sd">        ...           min_percentile= 5.0,</span>
</span><span id="ScaleRangeDescr-1420"><a href="#ScaleRangeDescr-1420"><span class="linenos">1420</span></a><span class="sd">        ...         )</span>
</span><span id="ScaleRangeDescr-1421"><a href="#ScaleRangeDescr-1421"><span class="linenos">1421</span></a><span class="sd">        ...     ),</span>
</span><span id="ScaleRangeDescr-1422"><a href="#ScaleRangeDescr-1422"><span class="linenos">1422</span></a><span class="sd">        ...     ClipDescr(</span>
</span><span id="ScaleRangeDescr-1423"><a href="#ScaleRangeDescr-1423"><span class="linenos">1423</span></a><span class="sd">        ...         kwargs=ClipKwargs(</span>
</span><span id="ScaleRangeDescr-1424"><a href="#ScaleRangeDescr-1424"><span class="linenos">1424</span></a><span class="sd">        ...             min=0.0,</span>
</span><span id="ScaleRangeDescr-1425"><a href="#ScaleRangeDescr-1425"><span class="linenos">1425</span></a><span class="sd">        ...             max=1.0,</span>
</span><span id="ScaleRangeDescr-1426"><a href="#ScaleRangeDescr-1426"><span class="linenos">1426</span></a><span class="sd">        ...         )</span>
</span><span id="ScaleRangeDescr-1427"><a href="#ScaleRangeDescr-1427"><span class="linenos">1427</span></a><span class="sd">        ...     ),</span>
</span><span id="ScaleRangeDescr-1428"><a href="#ScaleRangeDescr-1428"><span class="linenos">1428</span></a><span class="sd">        ... ]</span>
</span><span id="ScaleRangeDescr-1429"><a href="#ScaleRangeDescr-1429"><span class="linenos">1429</span></a>
</span><span id="ScaleRangeDescr-1430"><a href="#ScaleRangeDescr-1430"><span class="linenos">1430</span></a><span class="sd">      2. Combine the above scaling with additional clipping to clip values outside the range given by the percentiles.</span>
</span><span id="ScaleRangeDescr-1431"><a href="#ScaleRangeDescr-1431"><span class="linenos">1431</span></a><span class="sd">        - in YAML</span>
</span><span id="ScaleRangeDescr-1432"><a href="#ScaleRangeDescr-1432"><span class="linenos">1432</span></a><span class="sd">        ```yaml</span>
</span><span id="ScaleRangeDescr-1433"><a href="#ScaleRangeDescr-1433"><span class="linenos">1433</span></a><span class="sd">        preprocessing:</span>
</span><span id="ScaleRangeDescr-1434"><a href="#ScaleRangeDescr-1434"><span class="linenos">1434</span></a><span class="sd">          - id: scale_range</span>
</span><span id="ScaleRangeDescr-1435"><a href="#ScaleRangeDescr-1435"><span class="linenos">1435</span></a><span class="sd">            kwargs:</span>
</span><span id="ScaleRangeDescr-1436"><a href="#ScaleRangeDescr-1436"><span class="linenos">1436</span></a><span class="sd">              axes: [&#39;y&#39;, &#39;x&#39;]</span>
</span><span id="ScaleRangeDescr-1437"><a href="#ScaleRangeDescr-1437"><span class="linenos">1437</span></a><span class="sd">              max_percentile: 99.8</span>
</span><span id="ScaleRangeDescr-1438"><a href="#ScaleRangeDescr-1438"><span class="linenos">1438</span></a><span class="sd">              min_percentile: 5.0</span>
</span><span id="ScaleRangeDescr-1439"><a href="#ScaleRangeDescr-1439"><span class="linenos">1439</span></a><span class="sd">                  - id: scale_range</span>
</span><span id="ScaleRangeDescr-1440"><a href="#ScaleRangeDescr-1440"><span class="linenos">1440</span></a><span class="sd">           - id: clip</span>
</span><span id="ScaleRangeDescr-1441"><a href="#ScaleRangeDescr-1441"><span class="linenos">1441</span></a><span class="sd">             kwargs:</span>
</span><span id="ScaleRangeDescr-1442"><a href="#ScaleRangeDescr-1442"><span class="linenos">1442</span></a><span class="sd">              min: 0.0</span>
</span><span id="ScaleRangeDescr-1443"><a href="#ScaleRangeDescr-1443"><span class="linenos">1443</span></a><span class="sd">              max: 1.0</span>
</span><span id="ScaleRangeDescr-1444"><a href="#ScaleRangeDescr-1444"><span class="linenos">1444</span></a><span class="sd">        ```</span>
</span><span id="ScaleRangeDescr-1445"><a href="#ScaleRangeDescr-1445"><span class="linenos">1445</span></a><span class="sd">        - in Python</span>
</span><span id="ScaleRangeDescr-1446"><a href="#ScaleRangeDescr-1446"><span class="linenos">1446</span></a><span class="sd">        &gt;&gt;&gt; preprocessing = [ScaleRangeDescr(</span>
</span><span id="ScaleRangeDescr-1447"><a href="#ScaleRangeDescr-1447"><span class="linenos">1447</span></a><span class="sd">        ...   kwargs=ScaleRangeKwargs(</span>
</span><span id="ScaleRangeDescr-1448"><a href="#ScaleRangeDescr-1448"><span class="linenos">1448</span></a><span class="sd">        ...       axes= (AxisId(&#39;y&#39;), AxisId(&#39;x&#39;)),</span>
</span><span id="ScaleRangeDescr-1449"><a href="#ScaleRangeDescr-1449"><span class="linenos">1449</span></a><span class="sd">        ...       max_percentile= 99.8,</span>
</span><span id="ScaleRangeDescr-1450"><a href="#ScaleRangeDescr-1450"><span class="linenos">1450</span></a><span class="sd">        ...       min_percentile= 5.0,</span>
</span><span id="ScaleRangeDescr-1451"><a href="#ScaleRangeDescr-1451"><span class="linenos">1451</span></a><span class="sd">        ...   )</span>
</span><span id="ScaleRangeDescr-1452"><a href="#ScaleRangeDescr-1452"><span class="linenos">1452</span></a><span class="sd">        ... )]</span>
</span><span id="ScaleRangeDescr-1453"><a href="#ScaleRangeDescr-1453"><span class="linenos">1453</span></a>
</span><span id="ScaleRangeDescr-1454"><a href="#ScaleRangeDescr-1454"><span class="linenos">1454</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ScaleRangeDescr-1455"><a href="#ScaleRangeDescr-1455"><span class="linenos">1455</span></a>
</span><span id="ScaleRangeDescr-1456"><a href="#ScaleRangeDescr-1456"><span class="linenos">1456</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_range&quot;</span>
</span><span id="ScaleRangeDescr-1457"><a href="#ScaleRangeDescr-1457"><span class="linenos">1457</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ScaleRangeDescr-1458"><a href="#ScaleRangeDescr-1458"><span class="linenos">1458</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_range&quot;</span>
</span><span id="ScaleRangeDescr-1459"><a href="#ScaleRangeDescr-1459"><span class="linenos">1459</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ScaleRangeDescr-1460"><a href="#ScaleRangeDescr-1460"><span class="linenos">1460</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_range&quot;</span><span class="p">]</span>
</span><span id="ScaleRangeDescr-1461"><a href="#ScaleRangeDescr-1461"><span class="linenos">1461</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ScaleRangeKwargs</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">ScaleRangeKwargs</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Scale with percentiles.</p>

<p>Examples:</p>

<ol>
<li>Scale linearly to map 5th percentile to 0 and 99.8th percentile to 1.0
<ul>
<li>in YAML</li>
</ul></li>
</ol>

<pre><code><div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_range</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;y&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;x&#39;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">max_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">99.8</span>
<span class="w">      </span><span class="nt">min_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
</code></pre>
</div>


- in Python
&gt;&gt;&gt; preprocessing = [
...     ScaleRangeDescr(
...         kwargs=ScaleRangeKwargs(
...           axes= (AxisId('y'), AxisId('x')),
...           max_percentile= 99.8,
...           min_percentile= 5.0,
...         )
...     ),
...     ClipDescr(
...         kwargs=ClipKwargs(
...             min=0.0,
...             max=1.0,
...         )
...     ),
... ]
</code></pre>

<ol start="2">
<li><p>Combine the above scaling with additional clipping to clip values outside the range given by the percentiles.</p>

<ul>
<li>in YAML</li>
</ul>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_range</span>
<span class="w">    </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">axes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;y&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;x&#39;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">max_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">99.8</span>
<span class="w">      </span><span class="nt">min_percentile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">- id</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scale_range</span>
<span class="w">  </span><span class="w w-Error"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clip</span>
<span class="w">     </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</code></pre>
</div>

<ul>
<li>in Python

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">ScaleRangeDescr</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">kwargs</span><span class="o">=</span><span class="n">ScaleRangeKwargs</span><span class="p">(</span>
<span class="gp">... </span>      <span class="n">axes</span><span class="o">=</span> <span class="p">(</span><span class="n">AxisId</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">AxisId</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)),</span>
<span class="gp">... </span>      <span class="n">max_percentile</span><span class="o">=</span> <span class="mf">99.8</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">min_percentile</span><span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<span class="gp">... </span>  <span class="p">)</span>
<span class="gp">... </span><span class="p">)]</span>
</code></pre>
</div>
</li>
</ul></li>
</ol>
</div>


                            <div id="ScaleRangeDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;scale_range&#39;]]</span>        =
<span class="default_value">&#39;scale_range&#39;</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="ScaleRangeDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="#ScaleRangeKwargs">ScaleRangeKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeDescr.kwargs"></a>
    
    

                            </div>
                            <div id="ScaleRangeDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;scale_range&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleRangeDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="ScaleMeanVarianceKwargs">
                            <input id="ScaleMeanVarianceKwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleMeanVarianceKwargs</span><wbr>(<span class="base"><a href="v0_4.html#ProcessingKwargs">bioimageio.spec.model.v0_4.ProcessingKwargs</a></span>):

                <label class="view-source-button" for="ScaleMeanVarianceKwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleMeanVarianceKwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleMeanVarianceKwargs-1464"><a href="#ScaleMeanVarianceKwargs-1464"><span class="linenos">1464</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleMeanVarianceKwargs</span><span class="p">(</span><span class="n">ProcessingKwargs</span><span class="p">):</span>
</span><span id="ScaleMeanVarianceKwargs-1465"><a href="#ScaleMeanVarianceKwargs-1465"><span class="linenos">1465</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;key word arguments for `ScaleMeanVarianceKwargs`&quot;&quot;&quot;</span>
</span><span id="ScaleMeanVarianceKwargs-1466"><a href="#ScaleMeanVarianceKwargs-1466"><span class="linenos">1466</span></a>
</span><span id="ScaleMeanVarianceKwargs-1467"><a href="#ScaleMeanVarianceKwargs-1467"><span class="linenos">1467</span></a>    <span class="n">reference_tensor</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="ScaleMeanVarianceKwargs-1468"><a href="#ScaleMeanVarianceKwargs-1468"><span class="linenos">1468</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of tensor to match.&quot;&quot;&quot;</span>
</span><span id="ScaleMeanVarianceKwargs-1469"><a href="#ScaleMeanVarianceKwargs-1469"><span class="linenos">1469</span></a>
</span><span id="ScaleMeanVarianceKwargs-1470"><a href="#ScaleMeanVarianceKwargs-1470"><span class="linenos">1470</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ScaleMeanVarianceKwargs-1471"><a href="#ScaleMeanVarianceKwargs-1471"><span class="linenos">1471</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)])</span>
</span><span id="ScaleMeanVarianceKwargs-1472"><a href="#ScaleMeanVarianceKwargs-1472"><span class="linenos">1472</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ScaleMeanVarianceKwargs-1473"><a href="#ScaleMeanVarianceKwargs-1473"><span class="linenos">1473</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.</span>
</span><span id="ScaleMeanVarianceKwargs-1474"><a href="#ScaleMeanVarianceKwargs-1474"><span class="linenos">1474</span></a><span class="sd">    For example to normalize &#39;batch&#39;, &#39;x&#39; and &#39;y&#39; jointly in a tensor (&#39;batch&#39;, &#39;channel&#39;, &#39;y&#39;, &#39;x&#39;)</span>
</span><span id="ScaleMeanVarianceKwargs-1475"><a href="#ScaleMeanVarianceKwargs-1475"><span class="linenos">1475</span></a><span class="sd">    resulting in a tensor of equal shape normalized per channel, specify `axes=(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)`.</span>
</span><span id="ScaleMeanVarianceKwargs-1476"><a href="#ScaleMeanVarianceKwargs-1476"><span class="linenos">1476</span></a><span class="sd">    To normalize samples independently, leave out the &#39;batch&#39; axis.</span>
</span><span id="ScaleMeanVarianceKwargs-1477"><a href="#ScaleMeanVarianceKwargs-1477"><span class="linenos">1477</span></a><span class="sd">    Default: Scale all axes jointly.&quot;&quot;&quot;</span>
</span><span id="ScaleMeanVarianceKwargs-1478"><a href="#ScaleMeanVarianceKwargs-1478"><span class="linenos">1478</span></a>
</span><span id="ScaleMeanVarianceKwargs-1479"><a href="#ScaleMeanVarianceKwargs-1479"><span class="linenos">1479</span></a>    <span class="n">eps</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="ScaleMeanVarianceKwargs-1480"><a href="#ScaleMeanVarianceKwargs-1480"><span class="linenos">1480</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Epsilon for numeric stability:</span>
</span><span id="ScaleMeanVarianceKwargs-1481"><a href="#ScaleMeanVarianceKwargs-1481"><span class="linenos">1481</span></a><span class="sd">    `out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.`&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>key word arguments for <code><a href="#ScaleMeanVarianceKwargs">ScaleMeanVarianceKwargs</a></code></p>
</div>


                            <div id="ScaleMeanVarianceKwargs.reference_tensor" class="classattr">
                                <div class="attr variable">
            <span class="name">reference_tensor</span><span class="annotation">: <a href="#TensorId">TensorId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceKwargs.reference_tensor"></a>
    
            <div class="docstring"><p>Name of tensor to match.</p>
</div>


                            </div>
                            <div id="ScaleMeanVarianceKwargs.axes" class="classattr">
                                <div class="attr variable">
            <span class="name">axes</span><span class="annotation">: Annotated[Optional[Sequence[<a href="#AxisId">AxisId</a>]], FieldInfo(annotation=NoneType, required=True, examples=[(&#39;batch&#39;, &#39;x&#39;, &#39;y&#39;)])]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceKwargs.axes"></a>
    
            <div class="docstring"><p>The subset of axes to normalize jointly, i.e. axes to reduce to compute mean/std.
For example to normalize 'batch', 'x' and 'y' jointly in a tensor ('batch', 'channel', 'y', 'x')
resulting in a tensor of equal shape normalized per channel, specify <code>axes=('batch', 'x', 'y')</code>.
To normalize samples independently, leave out the 'batch' axis.
Default: Scale all axes jointly.</p>
</div>


                            </div>
                            <div id="ScaleMeanVarianceKwargs.eps" class="classattr">
                                <div class="attr variable">
            <span class="name">eps</span><span class="annotation">: Annotated[float, Interval(gt=0, ge=None, lt=None, le=0.1)]</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceKwargs.eps"></a>
    
            <div class="docstring"><p>Epsilon for numeric stability:
<code>out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.</code></p>
</div>


                            </div>
                </section>
                <section id="ScaleMeanVarianceDescr">
                            <input id="ScaleMeanVarianceDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ScaleMeanVarianceDescr</span><wbr>(<span class="base"><a href="#ProcessingDescrBase">ProcessingDescrBase</a></span>):

                <label class="view-source-button" for="ScaleMeanVarianceDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ScaleMeanVarianceDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ScaleMeanVarianceDescr-1484"><a href="#ScaleMeanVarianceDescr-1484"><span class="linenos">1484</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ScaleMeanVarianceDescr</span><span class="p">(</span><span class="n">ProcessingDescrBase</span><span class="p">):</span>
</span><span id="ScaleMeanVarianceDescr-1485"><a href="#ScaleMeanVarianceDescr-1485"><span class="linenos">1485</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale a tensor&#39;s data distribution to match another tensor&#39;s mean/std.</span>
</span><span id="ScaleMeanVarianceDescr-1486"><a href="#ScaleMeanVarianceDescr-1486"><span class="linenos">1486</span></a><span class="sd">    `out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.`</span>
</span><span id="ScaleMeanVarianceDescr-1487"><a href="#ScaleMeanVarianceDescr-1487"><span class="linenos">1487</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ScaleMeanVarianceDescr-1488"><a href="#ScaleMeanVarianceDescr-1488"><span class="linenos">1488</span></a>
</span><span id="ScaleMeanVarianceDescr-1489"><a href="#ScaleMeanVarianceDescr-1489"><span class="linenos">1489</span></a>    <span class="n">implemented_id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;scale_mean_variance&quot;</span>
</span><span id="ScaleMeanVarianceDescr-1490"><a href="#ScaleMeanVarianceDescr-1490"><span class="linenos">1490</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ScaleMeanVarianceDescr-1491"><a href="#ScaleMeanVarianceDescr-1491"><span class="linenos">1491</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale_mean_variance&quot;</span>
</span><span id="ScaleMeanVarianceDescr-1492"><a href="#ScaleMeanVarianceDescr-1492"><span class="linenos">1492</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ScaleMeanVarianceDescr-1493"><a href="#ScaleMeanVarianceDescr-1493"><span class="linenos">1493</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;scale_mean_variance&quot;</span><span class="p">]</span>
</span><span id="ScaleMeanVarianceDescr-1494"><a href="#ScaleMeanVarianceDescr-1494"><span class="linenos">1494</span></a>    <span class="n">kwargs</span><span class="p">:</span> <span class="n">ScaleMeanVarianceKwargs</span>
</span></pre></div>


            <div class="docstring"><p>Scale a tensor's data distribution to match another tensor's mean/std.
<code>out  = (tensor - mean) / (std + eps) * (ref_std + eps) + ref_mean.</code></p>
</div>


                            <div id="ScaleMeanVarianceDescr.implemented_id" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_id</span><span class="annotation">: ClassVar[Literal[&#39;scale_mean_variance&#39;]]</span>        =
<span class="default_value">&#39;scale_mean_variance&#39;</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceDescr.implemented_id"></a>
    
    

                            </div>
                            <div id="ScaleMeanVarianceDescr.kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">kwargs</span><span class="annotation">: <a href="#ScaleMeanVarianceKwargs">ScaleMeanVarianceKwargs</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceDescr.kwargs"></a>
    
    

                            </div>
                            <div id="ScaleMeanVarianceDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Literal[&#39;scale_mean_variance&#39;]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ScaleMeanVarianceDescr.id"></a>
    
    

                            </div>
                </section>
                <section id="PreprocessingDescr">
                    <div class="attr variable">
            <span class="name">PreprocessingDescr</span>        =
<input id="PreprocessingDescr-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="PreprocessingDescr-view-value"></label><span class="default_value">typing.Annotated[typing.Union[<a href="#BinarizeDescr">BinarizeDescr</a>, <a href="#ClipDescr">ClipDescr</a>, <a href="#EnsureDtypeDescr">EnsureDtypeDescr</a>, <a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a>, <a href="#ScaleLinearDescr">ScaleLinearDescr</a>, <a href="#ScaleRangeDescr">ScaleRangeDescr</a>, <a href="#SigmoidDescr">SigmoidDescr</a>, <a href="#SoftmaxDescr">SoftmaxDescr</a>, <a href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a>], Discriminator(discriminator=&#39;id&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]</span>

        
    </div>
    <a class="headerlink" href="#PreprocessingDescr"></a>
    
    

                </section>
                <section id="PostprocessingDescr">
                    <div class="attr variable">
            <span class="name">PostprocessingDescr</span>        =
<input id="PostprocessingDescr-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="PostprocessingDescr-view-value"></label><span class="default_value">typing.Annotated[typing.Union[<a href="#BinarizeDescr">BinarizeDescr</a>, <a href="#ClipDescr">ClipDescr</a>, <a href="#EnsureDtypeDescr">EnsureDtypeDescr</a>, <a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a>, <a href="#ScaleLinearDescr">ScaleLinearDescr</a>, <a href="#ScaleMeanVarianceDescr">ScaleMeanVarianceDescr</a>, <a href="#ScaleRangeDescr">ScaleRangeDescr</a>, <a href="#SigmoidDescr">SigmoidDescr</a>, <a href="#SoftmaxDescr">SoftmaxDescr</a>, <a href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a>], Discriminator(discriminator=&#39;id&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]</span>

        
    </div>
    <a class="headerlink" href="#PostprocessingDescr"></a>
    
    

                </section>
                <section id="TensorDescrBase">
                            <input id="TensorDescrBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorDescrBase</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>, <span class="base">typing.Generic[~IO_AxisT]</span>):

                <label class="view-source-button" for="TensorDescrBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorDescrBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorDescrBase-1530"><a href="#TensorDescrBase-1530"><span class="linenos">1530</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorDescrBase</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">IO_AxisT</span><span class="p">]):</span>
</span><span id="TensorDescrBase-1531"><a href="#TensorDescrBase-1531"><span class="linenos">1531</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span>
</span><span id="TensorDescrBase-1532"><a href="#TensorDescrBase-1532"><span class="linenos">1532</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tensor id. No duplicates are allowed.&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1533"><a href="#TensorDescrBase-1533"><span class="linenos">1533</span></a>
</span><span id="TensorDescrBase-1534"><a href="#TensorDescrBase-1534"><span class="linenos">1534</span></a>    <span class="n">description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="TensorDescrBase-1535"><a href="#TensorDescrBase-1535"><span class="linenos">1535</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;free text description&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1536"><a href="#TensorDescrBase-1536"><span class="linenos">1536</span></a>
</span><span id="TensorDescrBase-1537"><a href="#TensorDescrBase-1537"><span class="linenos">1537</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">IO_AxisT</span><span class="p">]]</span>
</span><span id="TensorDescrBase-1538"><a href="#TensorDescrBase-1538"><span class="linenos">1538</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;tensor axes&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1539"><a href="#TensorDescrBase-1539"><span class="linenos">1539</span></a>
</span><span id="TensorDescrBase-1540"><a href="#TensorDescrBase-1540"><span class="linenos">1540</span></a>    <span class="nd">@property</span>
</span><span id="TensorDescrBase-1541"><a href="#TensorDescrBase-1541"><span class="linenos">1541</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TensorDescrBase-1542"><a href="#TensorDescrBase-1542"><span class="linenos">1542</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="TensorDescrBase-1543"><a href="#TensorDescrBase-1543"><span class="linenos">1543</span></a>
</span><span id="TensorDescrBase-1544"><a href="#TensorDescrBase-1544"><span class="linenos">1544</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">,</span> <span class="n">check_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="TensorDescrBase-1545"><a href="#TensorDescrBase-1545"><span class="linenos">1545</span></a>    <span class="nd">@classmethod</span>
</span><span id="TensorDescrBase-1546"><a href="#TensorDescrBase-1546"><span class="linenos">1546</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_axes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]:</span>
</span><span id="TensorDescrBase-1547"><a href="#TensorDescrBase-1547"><span class="linenos">1547</span></a>        <span class="n">batch_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span><span class="p">]</span>
</span><span id="TensorDescrBase-1548"><a href="#TensorDescrBase-1548"><span class="linenos">1548</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TensorDescrBase-1549"><a href="#TensorDescrBase-1549"><span class="linenos">1549</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase-1550"><a href="#TensorDescrBase-1550"><span class="linenos">1550</span></a>                <span class="sa">f</span><span class="s2">&quot;Only one batch axis (per tensor) allowed, but got </span><span class="si">{</span><span class="n">batch_axes</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TensorDescrBase-1551"><a href="#TensorDescrBase-1551"><span class="linenos">1551</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase-1552"><a href="#TensorDescrBase-1552"><span class="linenos">1552</span></a>
</span><span id="TensorDescrBase-1553"><a href="#TensorDescrBase-1553"><span class="linenos">1553</span></a>        <span class="n">seen_ids</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="TensorDescrBase-1554"><a href="#TensorDescrBase-1554"><span class="linenos">1554</span></a>        <span class="n">duplicate_axes_ids</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">AxisId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="TensorDescrBase-1555"><a href="#TensorDescrBase-1555"><span class="linenos">1555</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="TensorDescrBase-1556"><a href="#TensorDescrBase-1556"><span class="linenos">1556</span></a>            <span class="p">(</span><span class="n">duplicate_axes_ids</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">seen_ids</span> <span class="k">else</span> <span class="n">seen_ids</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="TensorDescrBase-1557"><a href="#TensorDescrBase-1557"><span class="linenos">1557</span></a>
</span><span id="TensorDescrBase-1558"><a href="#TensorDescrBase-1558"><span class="linenos">1558</span></a>        <span class="k">if</span> <span class="n">duplicate_axes_ids</span><span class="p">:</span>
</span><span id="TensorDescrBase-1559"><a href="#TensorDescrBase-1559"><span class="linenos">1559</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate axis ids: </span><span class="si">{</span><span class="n">duplicate_axes_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TensorDescrBase-1560"><a href="#TensorDescrBase-1560"><span class="linenos">1560</span></a>
</span><span id="TensorDescrBase-1561"><a href="#TensorDescrBase-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="n">axes</span>
</span><span id="TensorDescrBase-1562"><a href="#TensorDescrBase-1562"><span class="linenos">1562</span></a>
</span><span id="TensorDescrBase-1563"><a href="#TensorDescrBase-1563"><span class="linenos">1563</span></a>    <span class="n">test_tensor</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TensorDescrBase-1564"><a href="#TensorDescrBase-1564"><span class="linenos">1564</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An example tensor to use for testing.</span>
</span><span id="TensorDescrBase-1565"><a href="#TensorDescrBase-1565"><span class="linenos">1565</span></a><span class="sd">    Using the model with the test input tensors is expected to yield the test output tensors.</span>
</span><span id="TensorDescrBase-1566"><a href="#TensorDescrBase-1566"><span class="linenos">1566</span></a><span class="sd">    Each test tensor has be a an ndarray in the</span>
</span><span id="TensorDescrBase-1567"><a href="#TensorDescrBase-1567"><span class="linenos">1567</span></a><span class="sd">    [numpy.lib file format](https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html#module-numpy.lib.format).</span>
</span><span id="TensorDescrBase-1568"><a href="#TensorDescrBase-1568"><span class="linenos">1568</span></a><span class="sd">    The file extension must be &#39;.npy&#39;.&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1569"><a href="#TensorDescrBase-1569"><span class="linenos">1569</span></a>
</span><span id="TensorDescrBase-1570"><a href="#TensorDescrBase-1570"><span class="linenos">1570</span></a>    <span class="n">sample_tensor</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TensorDescrBase-1571"><a href="#TensorDescrBase-1571"><span class="linenos">1571</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A sample tensor to illustrate a possible input/output for the model,</span>
</span><span id="TensorDescrBase-1572"><a href="#TensorDescrBase-1572"><span class="linenos">1572</span></a><span class="sd">    The sample image primarily serves to inform a human user about an example use case</span>
</span><span id="TensorDescrBase-1573"><a href="#TensorDescrBase-1573"><span class="linenos">1573</span></a><span class="sd">    and is typically stored as .hdf5, .png or .tiff.</span>
</span><span id="TensorDescrBase-1574"><a href="#TensorDescrBase-1574"><span class="linenos">1574</span></a><span class="sd">    It has to be readable by the [imageio library](https://imageio.readthedocs.io/en/stable/formats/index.html#supported-formats)</span>
</span><span id="TensorDescrBase-1575"><a href="#TensorDescrBase-1575"><span class="linenos">1575</span></a><span class="sd">    (numpy&#39;s `.npy` format is not supported).</span>
</span><span id="TensorDescrBase-1576"><a href="#TensorDescrBase-1576"><span class="linenos">1576</span></a><span class="sd">    The image dimensionality has to match the number of axes specified in this tensor description.</span>
</span><span id="TensorDescrBase-1577"><a href="#TensorDescrBase-1577"><span class="linenos">1577</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1578"><a href="#TensorDescrBase-1578"><span class="linenos">1578</span></a>
</span><span id="TensorDescrBase-1579"><a href="#TensorDescrBase-1579"><span class="linenos">1579</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="TensorDescrBase-1580"><a href="#TensorDescrBase-1580"><span class="linenos">1580</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_sample_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="TensorDescrBase-1581"><a href="#TensorDescrBase-1581"><span class="linenos">1581</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span><span class="p">:</span>
</span><span id="TensorDescrBase-1582"><a href="#TensorDescrBase-1582"><span class="linenos">1582</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="TensorDescrBase-1583"><a href="#TensorDescrBase-1583"><span class="linenos">1583</span></a>
</span><span id="TensorDescrBase-1584"><a href="#TensorDescrBase-1584"><span class="linenos">1584</span></a>        <span class="n">reader</span> <span class="o">=</span> <span class="n">get_reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">sha256</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_tensor</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span>
</span><span id="TensorDescrBase-1585"><a href="#TensorDescrBase-1585"><span class="linenos">1585</span></a>        <span class="n">tensor</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span>  <span class="c1"># pyright: ignore[reportUnknownVariableType]</span>
</span><span id="TensorDescrBase-1586"><a href="#TensorDescrBase-1586"><span class="linenos">1586</span></a>            <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
</span><span id="TensorDescrBase-1587"><a href="#TensorDescrBase-1587"><span class="linenos">1587</span></a>            <span class="n">extension</span><span class="o">=</span><span class="n">PurePosixPath</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">original_file_name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span>
</span><span id="TensorDescrBase-1588"><a href="#TensorDescrBase-1588"><span class="linenos">1588</span></a>        <span class="p">)</span>
</span><span id="TensorDescrBase-1589"><a href="#TensorDescrBase-1589"><span class="linenos">1589</span></a>        <span class="n">n_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tensor</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="TensorDescrBase-1590"><a href="#TensorDescrBase-1590"><span class="linenos">1590</span></a>        <span class="n">n_dims_min</span> <span class="o">=</span> <span class="n">n_dims_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="TensorDescrBase-1591"><a href="#TensorDescrBase-1591"><span class="linenos">1591</span></a>
</span><span id="TensorDescrBase-1592"><a href="#TensorDescrBase-1592"><span class="linenos">1592</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="TensorDescrBase-1593"><a href="#TensorDescrBase-1593"><span class="linenos">1593</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="TensorDescrBase-1594"><a href="#TensorDescrBase-1594"><span class="linenos">1594</span></a>                <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="TensorDescrBase-1595"><a href="#TensorDescrBase-1595"><span class="linenos">1595</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="TensorDescrBase-1596"><a href="#TensorDescrBase-1596"><span class="linenos">1596</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TensorDescrBase-1597"><a href="#TensorDescrBase-1597"><span class="linenos">1597</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="TensorDescrBase-1598"><a href="#TensorDescrBase-1598"><span class="linenos">1598</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="n">ParameterizedSize</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">)):</span>
</span><span id="TensorDescrBase-1599"><a href="#TensorDescrBase-1599"><span class="linenos">1599</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">min</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TensorDescrBase-1600"><a href="#TensorDescrBase-1600"><span class="linenos">1600</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="TensorDescrBase-1601"><a href="#TensorDescrBase-1601"><span class="linenos">1601</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="TensorDescrBase-1602"><a href="#TensorDescrBase-1602"><span class="linenos">1602</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TensorDescrBase-1603"><a href="#TensorDescrBase-1603"><span class="linenos">1603</span></a>                    <span class="c1"># size reference may result in singleton axis</span>
</span><span id="TensorDescrBase-1604"><a href="#TensorDescrBase-1604"><span class="linenos">1604</span></a>                    <span class="n">n_dims_min</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="TensorDescrBase-1605"><a href="#TensorDescrBase-1605"><span class="linenos">1605</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TensorDescrBase-1606"><a href="#TensorDescrBase-1606"><span class="linenos">1606</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="TensorDescrBase-1607"><a href="#TensorDescrBase-1607"><span class="linenos">1607</span></a>
</span><span id="TensorDescrBase-1608"><a href="#TensorDescrBase-1608"><span class="linenos">1608</span></a>        <span class="n">n_dims_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_dims_min</span><span class="p">)</span>
</span><span id="TensorDescrBase-1609"><a href="#TensorDescrBase-1609"><span class="linenos">1609</span></a>        <span class="k">if</span> <span class="n">n_dims</span> <span class="o">&lt;</span> <span class="n">n_dims_min</span> <span class="ow">or</span> <span class="n">n_dims</span> <span class="o">&gt;</span> <span class="n">n_dims_max</span><span class="p">:</span>
</span><span id="TensorDescrBase-1610"><a href="#TensorDescrBase-1610"><span class="linenos">1610</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase-1611"><a href="#TensorDescrBase-1611"><span class="linenos">1611</span></a>                <span class="sa">f</span><span class="s2">&quot;Expected sample tensor to have </span><span class="si">{</span><span class="n">n_dims_min</span><span class="si">}</span><span class="s2"> to&quot;</span>
</span><span id="TensorDescrBase-1612"><a href="#TensorDescrBase-1612"><span class="linenos">1612</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">n_dims_max</span><span class="si">}</span><span class="s2"> dimensions, but found </span><span class="si">{</span><span class="n">n_dims</span><span class="si">}</span><span class="s2"> (shape: </span><span class="si">{</span><span class="n">tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span id="TensorDescrBase-1613"><a href="#TensorDescrBase-1613"><span class="linenos">1613</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase-1614"><a href="#TensorDescrBase-1614"><span class="linenos">1614</span></a>
</span><span id="TensorDescrBase-1615"><a href="#TensorDescrBase-1615"><span class="linenos">1615</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TensorDescrBase-1616"><a href="#TensorDescrBase-1616"><span class="linenos">1616</span></a>
</span><span id="TensorDescrBase-1617"><a href="#TensorDescrBase-1617"><span class="linenos">1617</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TensorDescrBase-1618"><a href="#TensorDescrBase-1618"><span class="linenos">1618</span></a>        <span class="n">IntervalOrRatioDataDescr</span><span class="p">()</span>
</span><span id="TensorDescrBase-1619"><a href="#TensorDescrBase-1619"><span class="linenos">1619</span></a>    <span class="p">)</span>
</span><span id="TensorDescrBase-1620"><a href="#TensorDescrBase-1620"><span class="linenos">1620</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of the tensor&#39;s data values, optionally per channel.</span>
</span><span id="TensorDescrBase-1621"><a href="#TensorDescrBase-1621"><span class="linenos">1621</span></a><span class="sd">    If specified per channel, the data `type` needs to match across channels.&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1622"><a href="#TensorDescrBase-1622"><span class="linenos">1622</span></a>
</span><span id="TensorDescrBase-1623"><a href="#TensorDescrBase-1623"><span class="linenos">1623</span></a>    <span class="nd">@property</span>
</span><span id="TensorDescrBase-1624"><a href="#TensorDescrBase-1624"><span class="linenos">1624</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span>
</span><span id="TensorDescrBase-1625"><a href="#TensorDescrBase-1625"><span class="linenos">1625</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TensorDescrBase-1626"><a href="#TensorDescrBase-1626"><span class="linenos">1626</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="TensorDescrBase-1627"><a href="#TensorDescrBase-1627"><span class="linenos">1627</span></a>        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1628"><a href="#TensorDescrBase-1628"><span class="linenos">1628</span></a>        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1629"><a href="#TensorDescrBase-1629"><span class="linenos">1629</span></a>        <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1630"><a href="#TensorDescrBase-1630"><span class="linenos">1630</span></a>        <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1631"><a href="#TensorDescrBase-1631"><span class="linenos">1631</span></a>        <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1632"><a href="#TensorDescrBase-1632"><span class="linenos">1632</span></a>        <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1633"><a href="#TensorDescrBase-1633"><span class="linenos">1633</span></a>        <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1634"><a href="#TensorDescrBase-1634"><span class="linenos">1634</span></a>        <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1635"><a href="#TensorDescrBase-1635"><span class="linenos">1635</span></a>        <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1636"><a href="#TensorDescrBase-1636"><span class="linenos">1636</span></a>        <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1637"><a href="#TensorDescrBase-1637"><span class="linenos">1637</span></a>        <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase-1638"><a href="#TensorDescrBase-1638"><span class="linenos">1638</span></a>    <span class="p">]:</span>
</span><span id="TensorDescrBase-1639"><a href="#TensorDescrBase-1639"><span class="linenos">1639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;dtype as specified under `data.type` or `data[i].type`&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase-1640"><a href="#TensorDescrBase-1640"><span class="linenos">1640</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="TensorDescrBase-1641"><a href="#TensorDescrBase-1641"><span class="linenos">1641</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="TensorDescrBase-1642"><a href="#TensorDescrBase-1642"><span class="linenos">1642</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TensorDescrBase-1643"><a href="#TensorDescrBase-1643"><span class="linenos">1643</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="TensorDescrBase-1644"><a href="#TensorDescrBase-1644"><span class="linenos">1644</span></a>
</span><span id="TensorDescrBase-1645"><a href="#TensorDescrBase-1645"><span class="linenos">1645</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="TensorDescrBase-1646"><a href="#TensorDescrBase-1646"><span class="linenos">1646</span></a>    <span class="nd">@classmethod</span>
</span><span id="TensorDescrBase-1647"><a href="#TensorDescrBase-1647"><span class="linenos">1647</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_type_across_channels</span><span class="p">(</span>
</span><span id="TensorDescrBase-1648"><a href="#TensorDescrBase-1648"><span class="linenos">1648</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]</span>
</span><span id="TensorDescrBase-1649"><a href="#TensorDescrBase-1649"><span class="linenos">1649</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">,</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TensorDataDescr</span><span class="p">]]]:</span>
</span><span id="TensorDescrBase-1650"><a href="#TensorDescrBase-1650"><span class="linenos">1650</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TensorDescrBase-1651"><a href="#TensorDescrBase-1651"><span class="linenos">1651</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="TensorDescrBase-1652"><a href="#TensorDescrBase-1652"><span class="linenos">1652</span></a>
</span><span id="TensorDescrBase-1653"><a href="#TensorDescrBase-1653"><span class="linenos">1653</span></a>        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">value</span><span class="p">}</span>
</span><span id="TensorDescrBase-1654"><a href="#TensorDescrBase-1654"><span class="linenos">1654</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TensorDescrBase-1655"><a href="#TensorDescrBase-1655"><span class="linenos">1655</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase-1656"><a href="#TensorDescrBase-1656"><span class="linenos">1656</span></a>                <span class="s2">&quot;Tensor data descriptions per channel need to agree in their data&quot;</span>
</span><span id="TensorDescrBase-1657"><a href="#TensorDescrBase-1657"><span class="linenos">1657</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; `type`, but found </span><span class="si">{</span><span class="n">dtypes</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="TensorDescrBase-1658"><a href="#TensorDescrBase-1658"><span class="linenos">1658</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase-1659"><a href="#TensorDescrBase-1659"><span class="linenos">1659</span></a>
</span><span id="TensorDescrBase-1660"><a href="#TensorDescrBase-1660"><span class="linenos">1660</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="TensorDescrBase-1661"><a href="#TensorDescrBase-1661"><span class="linenos">1661</span></a>
</span><span id="TensorDescrBase-1662"><a href="#TensorDescrBase-1662"><span class="linenos">1662</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="TensorDescrBase-1663"><a href="#TensorDescrBase-1663"><span class="linenos">1663</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_matches_channelaxis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="TensorDescrBase-1664"><a href="#TensorDescrBase-1664"><span class="linenos">1664</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="TensorDescrBase-1665"><a href="#TensorDescrBase-1665"><span class="linenos">1665</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="TensorDescrBase-1666"><a href="#TensorDescrBase-1666"><span class="linenos">1666</span></a>
</span><span id="TensorDescrBase-1667"><a href="#TensorDescrBase-1667"><span class="linenos">1667</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="TensorDescrBase-1668"><a href="#TensorDescrBase-1668"><span class="linenos">1668</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">):</span>
</span><span id="TensorDescrBase-1669"><a href="#TensorDescrBase-1669"><span class="linenos">1669</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span>
</span><span id="TensorDescrBase-1670"><a href="#TensorDescrBase-1670"><span class="linenos">1670</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="TensorDescrBase-1671"><a href="#TensorDescrBase-1671"><span class="linenos">1671</span></a>                <span class="k">break</span>
</span><span id="TensorDescrBase-1672"><a href="#TensorDescrBase-1672"><span class="linenos">1672</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TensorDescrBase-1673"><a href="#TensorDescrBase-1673"><span class="linenos">1673</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="TensorDescrBase-1674"><a href="#TensorDescrBase-1674"><span class="linenos">1674</span></a>
</span><span id="TensorDescrBase-1675"><a href="#TensorDescrBase-1675"><span class="linenos">1675</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
</span><span id="TensorDescrBase-1676"><a href="#TensorDescrBase-1676"><span class="linenos">1676</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase-1677"><a href="#TensorDescrBase-1677"><span class="linenos">1677</span></a>                <span class="sa">f</span><span class="s2">&quot;Got tensor data descriptions for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> channels, but&quot;</span>
</span><span id="TensorDescrBase-1678"><a href="#TensorDescrBase-1678"><span class="linenos">1678</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; axis has size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="TensorDescrBase-1679"><a href="#TensorDescrBase-1679"><span class="linenos">1679</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase-1680"><a href="#TensorDescrBase-1680"><span class="linenos">1680</span></a>
</span><span id="TensorDescrBase-1681"><a href="#TensorDescrBase-1681"><span class="linenos">1681</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TensorDescrBase-1682"><a href="#TensorDescrBase-1682"><span class="linenos">1682</span></a>
</span><span id="TensorDescrBase-1683"><a href="#TensorDescrBase-1683"><span class="linenos">1683</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes_for_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TensorDescrBase-1684"><a href="#TensorDescrBase-1684"><span class="linenos">1684</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="TensorDescrBase-1685"><a href="#TensorDescrBase-1685"><span class="linenos">1685</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase-1686"><a href="#TensorDescrBase-1686"><span class="linenos">1686</span></a>                <span class="sa">f</span><span class="s2">&quot;Dimension mismatch: array shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (#</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="TensorDescrBase-1687"><a href="#TensorDescrBase-1687"><span class="linenos">1687</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; incompatible with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes.&quot;</span>
</span><span id="TensorDescrBase-1688"><a href="#TensorDescrBase-1688"><span class="linenos">1688</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase-1689"><a href="#TensorDescrBase-1689"><span class="linenos">1689</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)}</span>
</span></pre></div>


    

                            <div id="TensorDescrBase.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: <a href="#TensorId">TensorId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.id"></a>
    
            <div class="docstring"><p>Tensor id. No duplicates are allowed.</p>
</div>


                            </div>
                            <div id="TensorDescrBase.description" class="classattr">
                                <div class="attr variable">
            <span class="name">description</span><span class="annotation">: Annotated[str, MaxLen(max_length=128)]</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.description"></a>
    
            <div class="docstring"><p>free text description</p>
</div>


                            </div>
                            <div id="TensorDescrBase.axes" class="classattr">
                                <div class="attr variable">
            <span class="name">axes</span><span class="annotation">: Annotated[Sequence[~IO_AxisT], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.axes"></a>
    
            <div class="docstring"><p>tensor axes</p>
</div>


                            </div>
                            <div id="TensorDescrBase.shape" class="classattr">
                                        <input id="TensorDescrBase.shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">shape</span>

                <label class="view-source-button" for="TensorDescrBase.shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorDescrBase.shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorDescrBase.shape-1540"><a href="#TensorDescrBase.shape-1540"><span class="linenos">1540</span></a>    <span class="nd">@property</span>
</span><span id="TensorDescrBase.shape-1541"><a href="#TensorDescrBase.shape-1541"><span class="linenos">1541</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TensorDescrBase.shape-1542"><a href="#TensorDescrBase.shape-1542"><span class="linenos">1542</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="TensorDescrBase.test_tensor" class="classattr">
                                <div class="attr variable">
            <span class="name">test_tensor</span><span class="annotation">: Annotated[Optional[Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer at 0x7fc593b72020&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;)]], AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc593b73a60&gt;, severity=35, msg=None, context=None)]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.test_tensor"></a>
    
            <div class="docstring"><p>An example tensor to use for testing.
Using the model with the test input tensors is expected to yield the test output tensors.
Each test tensor has be a an ndarray in the
<a href="https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html#module-numpy.lib.format">numpy.lib file format</a>.
The file extension must be '.npy'.</p>
</div>


                            </div>
                            <div id="TensorDescrBase.sample_tensor" class="classattr">
                                <div class="attr variable">
            <span class="name">sample_tensor</span><span class="annotation">: Annotated[Optional[Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer at 0x7fc593b72020&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;)]], AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc593b73a60&gt;, severity=35, msg=None, context=None)]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.sample_tensor"></a>
    
            <div class="docstring"><p>A sample tensor to illustrate a possible input/output for the model,
The sample image primarily serves to inform a human user about an example use case
and is typically stored as .hdf5, .png or .tiff.
It has to be readable by the <a href="https://imageio.readthedocs.io/en/stable/formats/index.html#supported-formats">imageio library</a>
(numpy's <code>.npy</code> format is not supported).
The image dimensionality has to match the number of axes specified in this tensor description.</p>
</div>


                            </div>
                            <div id="TensorDescrBase.data" class="classattr">
                                <div class="attr variable">
            <span class="name">data</span><span class="annotation">: Union[<a href="#NominalOrOrdinalDataDescr">NominalOrOrdinalDataDescr</a>, <a href="#IntervalOrRatioDataDescr">IntervalOrRatioDataDescr</a>, Annotated[Sequence[Union[<a href="#NominalOrOrdinalDataDescr">NominalOrOrdinalDataDescr</a>, <a href="#IntervalOrRatioDataDescr">IntervalOrRatioDataDescr</a>]], MinLen(min_length=1)]]</span>        =
<input id="TensorDescrBase.data-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TensorDescrBase.data-view-value"></label><span class="default_value">IntervalOrRatioDataDescr(type=&#39;float32&#39;, range=(None, None), unit=&#39;arbitrary unit&#39;, scale=1.0, offset=None)</span>

        
    </div>
    <a class="headerlink" href="#TensorDescrBase.data"></a>
    
            <div class="docstring"><p>Description of the tensor's data values, optionally per channel.
If specified per channel, the data <code>type</code> needs to match across channels.</p>
</div>


                            </div>
                            <div id="TensorDescrBase.dtype" class="classattr">
                                        <input id="TensorDescrBase.dtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">dtype</span><span class="annotation">: Literal[&#39;float32&#39;, &#39;float64&#39;, &#39;uint8&#39;, &#39;int8&#39;, &#39;uint16&#39;, &#39;int16&#39;, &#39;uint32&#39;, &#39;int32&#39;, &#39;uint64&#39;, &#39;int64&#39;, &#39;bool&#39;]</span>

                <label class="view-source-button" for="TensorDescrBase.dtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorDescrBase.dtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorDescrBase.dtype-1623"><a href="#TensorDescrBase.dtype-1623"><span class="linenos">1623</span></a>    <span class="nd">@property</span>
</span><span id="TensorDescrBase.dtype-1624"><a href="#TensorDescrBase.dtype-1624"><span class="linenos">1624</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span>
</span><span id="TensorDescrBase.dtype-1625"><a href="#TensorDescrBase.dtype-1625"><span class="linenos">1625</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1626"><a href="#TensorDescrBase.dtype-1626"><span class="linenos">1626</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="TensorDescrBase.dtype-1627"><a href="#TensorDescrBase.dtype-1627"><span class="linenos">1627</span></a>        <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1628"><a href="#TensorDescrBase.dtype-1628"><span class="linenos">1628</span></a>        <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1629"><a href="#TensorDescrBase.dtype-1629"><span class="linenos">1629</span></a>        <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1630"><a href="#TensorDescrBase.dtype-1630"><span class="linenos">1630</span></a>        <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1631"><a href="#TensorDescrBase.dtype-1631"><span class="linenos">1631</span></a>        <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1632"><a href="#TensorDescrBase.dtype-1632"><span class="linenos">1632</span></a>        <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1633"><a href="#TensorDescrBase.dtype-1633"><span class="linenos">1633</span></a>        <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1634"><a href="#TensorDescrBase.dtype-1634"><span class="linenos">1634</span></a>        <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1635"><a href="#TensorDescrBase.dtype-1635"><span class="linenos">1635</span></a>        <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1636"><a href="#TensorDescrBase.dtype-1636"><span class="linenos">1636</span></a>        <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1637"><a href="#TensorDescrBase.dtype-1637"><span class="linenos">1637</span></a>        <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
</span><span id="TensorDescrBase.dtype-1638"><a href="#TensorDescrBase.dtype-1638"><span class="linenos">1638</span></a>    <span class="p">]:</span>
</span><span id="TensorDescrBase.dtype-1639"><a href="#TensorDescrBase.dtype-1639"><span class="linenos">1639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;dtype as specified under `data.type` or `data[i].type`&quot;&quot;&quot;</span>
</span><span id="TensorDescrBase.dtype-1640"><a href="#TensorDescrBase.dtype-1640"><span class="linenos">1640</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="TensorDescrBase.dtype-1641"><a href="#TensorDescrBase.dtype-1641"><span class="linenos">1641</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="TensorDescrBase.dtype-1642"><a href="#TensorDescrBase.dtype-1642"><span class="linenos">1642</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TensorDescrBase.dtype-1643"><a href="#TensorDescrBase.dtype-1643"><span class="linenos">1643</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span></pre></div>


            <div class="docstring"><p>dtype as specified under <code>data.type</code> or <code>data[i].type</code></p>
</div>


                            </div>
                            <div id="TensorDescrBase.get_axis_sizes_for_array" class="classattr">
                                        <input id="TensorDescrBase.get_axis_sizes_for_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_axis_sizes_for_array</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#AxisId">AxisId</a></span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TensorDescrBase.get_axis_sizes_for_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorDescrBase.get_axis_sizes_for_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorDescrBase.get_axis_sizes_for_array-1683"><a href="#TensorDescrBase.get_axis_sizes_for_array-1683"><span class="linenos">1683</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes_for_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1684"><a href="#TensorDescrBase.get_axis_sizes_for_array-1684"><span class="linenos">1684</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1685"><a href="#TensorDescrBase.get_axis_sizes_for_array-1685"><span class="linenos">1685</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1686"><a href="#TensorDescrBase.get_axis_sizes_for_array-1686"><span class="linenos">1686</span></a>                <span class="sa">f</span><span class="s2">&quot;Dimension mismatch: array shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (#</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1687"><a href="#TensorDescrBase.get_axis_sizes_for_array-1687"><span class="linenos">1687</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; incompatible with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> axes.&quot;</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1688"><a href="#TensorDescrBase.get_axis_sizes_for_array-1688"><span class="linenos">1688</span></a>            <span class="p">)</span>
</span><span id="TensorDescrBase.get_axis_sizes_for_array-1689"><a href="#TensorDescrBase.get_axis_sizes_for_array-1689"><span class="linenos">1689</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)}</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="InputTensorDescr">
                            <input id="InputTensorDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InputTensorDescr</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>, <span class="base">typing.Generic[~IO_AxisT]</span>):

                <label class="view-source-button" for="InputTensorDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InputTensorDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InputTensorDescr-1692"><a href="#InputTensorDescr-1692"><span class="linenos">1692</span></a><span class="k">class</span><span class="w"> </span><span class="nc">InputTensorDescr</span><span class="p">(</span><span class="n">TensorDescrBase</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">]):</span>
</span><span id="InputTensorDescr-1693"><a href="#InputTensorDescr-1693"><span class="linenos">1693</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span> <span class="o">=</span> <span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
</span><span id="InputTensorDescr-1694"><a href="#InputTensorDescr-1694"><span class="linenos">1694</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Input tensor id.</span>
</span><span id="InputTensorDescr-1695"><a href="#InputTensorDescr-1695"><span class="linenos">1695</span></a><span class="sd">    No duplicates are allowed across all inputs and outputs.&quot;&quot;&quot;</span>
</span><span id="InputTensorDescr-1696"><a href="#InputTensorDescr-1696"><span class="linenos">1696</span></a>
</span><span id="InputTensorDescr-1697"><a href="#InputTensorDescr-1697"><span class="linenos">1697</span></a>    <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="InputTensorDescr-1698"><a href="#InputTensorDescr-1698"><span class="linenos">1698</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;indicates that this tensor may be `None`&quot;&quot;&quot;</span>
</span><span id="InputTensorDescr-1699"><a href="#InputTensorDescr-1699"><span class="linenos">1699</span></a>
</span><span id="InputTensorDescr-1700"><a href="#InputTensorDescr-1700"><span class="linenos">1700</span></a>    <span class="n">preprocessing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="InputTensorDescr-1701"><a href="#InputTensorDescr-1701"><span class="linenos">1701</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">PreprocessingDescr</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="InputTensorDescr-1702"><a href="#InputTensorDescr-1702"><span class="linenos">1702</span></a>    <span class="p">)</span>
</span><span id="InputTensorDescr-1703"><a href="#InputTensorDescr-1703"><span class="linenos">1703</span></a>
</span><span id="InputTensorDescr-1704"><a href="#InputTensorDescr-1704"><span class="linenos">1704</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of how this input should be preprocessed.</span>
</span><span id="InputTensorDescr-1705"><a href="#InputTensorDescr-1705"><span class="linenos">1705</span></a>
</span><span id="InputTensorDescr-1706"><a href="#InputTensorDescr-1706"><span class="linenos">1706</span></a><span class="sd">    notes:</span>
</span><span id="InputTensorDescr-1707"><a href="#InputTensorDescr-1707"><span class="linenos">1707</span></a><span class="sd">    - If preprocessing does not start with an &#39;ensure_dtype&#39; entry, it is added</span>
</span><span id="InputTensorDescr-1708"><a href="#InputTensorDescr-1708"><span class="linenos">1708</span></a><span class="sd">      to ensure an input tensor&#39;s data type matches the input tensor&#39;s data description.</span>
</span><span id="InputTensorDescr-1709"><a href="#InputTensorDescr-1709"><span class="linenos">1709</span></a><span class="sd">    - If preprocessing does not end with an &#39;ensure_dtype&#39; or &#39;binarize&#39; entry, an</span>
</span><span id="InputTensorDescr-1710"><a href="#InputTensorDescr-1710"><span class="linenos">1710</span></a><span class="sd">      &#39;ensure_dtype&#39; step is added to ensure preprocessing steps are not unintentionally</span>
</span><span id="InputTensorDescr-1711"><a href="#InputTensorDescr-1711"><span class="linenos">1711</span></a><span class="sd">      changing the data type.</span>
</span><span id="InputTensorDescr-1712"><a href="#InputTensorDescr-1712"><span class="linenos">1712</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="InputTensorDescr-1713"><a href="#InputTensorDescr-1713"><span class="linenos">1713</span></a>
</span><span id="InputTensorDescr-1714"><a href="#InputTensorDescr-1714"><span class="linenos">1714</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="InputTensorDescr-1715"><a href="#InputTensorDescr-1715"><span class="linenos">1715</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_preprocessing_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="InputTensorDescr-1716"><a href="#InputTensorDescr-1716"><span class="linenos">1716</span></a>        <span class="n">axes_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
</span><span id="InputTensorDescr-1717"><a href="#InputTensorDescr-1717"><span class="linenos">1717</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
</span><span id="InputTensorDescr-1718"><a href="#InputTensorDescr-1718"><span class="linenos">1718</span></a>            <span class="n">kwargs_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">)</span>
</span><span id="InputTensorDescr-1719"><a href="#InputTensorDescr-1719"><span class="linenos">1719</span></a>            <span class="k">if</span> <span class="n">kwargs_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InputTensorDescr-1720"><a href="#InputTensorDescr-1720"><span class="linenos">1720</span></a>                <span class="k">continue</span>
</span><span id="InputTensorDescr-1721"><a href="#InputTensorDescr-1721"><span class="linenos">1721</span></a>
</span><span id="InputTensorDescr-1722"><a href="#InputTensorDescr-1722"><span class="linenos">1722</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="InputTensorDescr-1723"><a href="#InputTensorDescr-1723"><span class="linenos">1723</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="InputTensorDescr-1724"><a href="#InputTensorDescr-1724"><span class="linenos">1724</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected `preprocessing.i.kwargs.axes` to be a sequence, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="InputTensorDescr-1725"><a href="#InputTensorDescr-1725"><span class="linenos">1725</span></a>                <span class="p">)</span>
</span><span id="InputTensorDescr-1726"><a href="#InputTensorDescr-1726"><span class="linenos">1726</span></a>
</span><span id="InputTensorDescr-1727"><a href="#InputTensorDescr-1727"><span class="linenos">1727</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_ids</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs_axes</span><span class="p">):</span>
</span><span id="InputTensorDescr-1728"><a href="#InputTensorDescr-1728"><span class="linenos">1728</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="InputTensorDescr-1729"><a href="#InputTensorDescr-1729"><span class="linenos">1729</span></a>                    <span class="s2">&quot;`preprocessing.i.kwargs.axes` needs to be subset of axes ids&quot;</span>
</span><span id="InputTensorDescr-1730"><a href="#InputTensorDescr-1730"><span class="linenos">1730</span></a>                <span class="p">)</span>
</span><span id="InputTensorDescr-1731"><a href="#InputTensorDescr-1731"><span class="linenos">1731</span></a>
</span><span id="InputTensorDescr-1732"><a href="#InputTensorDescr-1732"><span class="linenos">1732</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">NominalOrOrdinalDataDescr</span><span class="p">,</span> <span class="n">IntervalOrRatioDataDescr</span><span class="p">)):</span>
</span><span id="InputTensorDescr-1733"><a href="#InputTensorDescr-1733"><span class="linenos">1733</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="InputTensorDescr-1734"><a href="#InputTensorDescr-1734"><span class="linenos">1734</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InputTensorDescr-1735"><a href="#InputTensorDescr-1735"><span class="linenos">1735</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="InputTensorDescr-1736"><a href="#InputTensorDescr-1736"><span class="linenos">1736</span></a>
</span><span id="InputTensorDescr-1737"><a href="#InputTensorDescr-1737"><span class="linenos">1737</span></a>        <span class="c1"># ensure `preprocessing` begins with `EnsureDtypeDescr`</span>
</span><span id="InputTensorDescr-1738"><a href="#InputTensorDescr-1738"><span class="linenos">1738</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="InputTensorDescr-1739"><a href="#InputTensorDescr-1739"><span class="linenos">1739</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">EnsureDtypeDescr</span>
</span><span id="InputTensorDescr-1740"><a href="#InputTensorDescr-1740"><span class="linenos">1740</span></a>        <span class="p">):</span>
</span><span id="InputTensorDescr-1741"><a href="#InputTensorDescr-1741"><span class="linenos">1741</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
</span><span id="InputTensorDescr-1742"><a href="#InputTensorDescr-1742"><span class="linenos">1742</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="InputTensorDescr-1743"><a href="#InputTensorDescr-1743"><span class="linenos">1743</span></a>            <span class="p">)</span>
</span><span id="InputTensorDescr-1744"><a href="#InputTensorDescr-1744"><span class="linenos">1744</span></a>
</span><span id="InputTensorDescr-1745"><a href="#InputTensorDescr-1745"><span class="linenos">1745</span></a>        <span class="c1"># ensure `preprocessing` ends with `EnsureDtypeDescr` or `BinarizeDescr`</span>
</span><span id="InputTensorDescr-1746"><a href="#InputTensorDescr-1746"><span class="linenos">1746</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">EnsureDtypeDescr</span><span class="p">,</span> <span class="n">BinarizeDescr</span><span class="p">)):</span>
</span><span id="InputTensorDescr-1747"><a href="#InputTensorDescr-1747"><span class="linenos">1747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="InputTensorDescr-1748"><a href="#InputTensorDescr-1748"><span class="linenos">1748</span></a>                <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="InputTensorDescr-1749"><a href="#InputTensorDescr-1749"><span class="linenos">1749</span></a>            <span class="p">)</span>
</span><span id="InputTensorDescr-1750"><a href="#InputTensorDescr-1750"><span class="linenos">1750</span></a>
</span><span id="InputTensorDescr-1751"><a href="#InputTensorDescr-1751"><span class="linenos">1751</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            <div id="InputTensorDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: <a href="#TensorId">TensorId</a></span>        =
<span class="default_value">&#39;input&#39;</span>

        
    </div>
    <a class="headerlink" href="#InputTensorDescr.id"></a>
    
            <div class="docstring"><p>Input tensor id.
No duplicates are allowed across all inputs and outputs.</p>
</div>


                            </div>
                            <div id="InputTensorDescr.optional" class="classattr">
                                <div class="attr variable">
            <span class="name">optional</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#InputTensorDescr.optional"></a>
    
            <div class="docstring"><p>indicates that this tensor may be <code>None</code></p>
</div>


                            </div>
                            <div id="InputTensorDescr.preprocessing" class="classattr">
                                <div class="attr variable">
            <span class="name">preprocessing</span><span class="annotation">: List[Annotated[Union[<a href="#BinarizeDescr">BinarizeDescr</a>, <a href="#ClipDescr">ClipDescr</a>, <a href="#EnsureDtypeDescr">EnsureDtypeDescr</a>, <a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a>, <a href="#ScaleLinearDescr">ScaleLinearDescr</a>, <a href="#ScaleRangeDescr">ScaleRangeDescr</a>, <a href="#SigmoidDescr">SigmoidDescr</a>, <a href="#SoftmaxDescr">SoftmaxDescr</a>, <a href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a>], Discriminator(discriminator=&#39;id&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#InputTensorDescr.preprocessing"></a>
    
            <div class="docstring"><p>Description of how this input should be preprocessed.</p>

<p>notes:</p>

<ul>
<li>If preprocessing does not start with an 'ensure_dtype' entry, it is added
to ensure an input tensor's data type matches the input tensor's data description.</li>
<li>If preprocessing does not end with an 'ensure_dtype' or 'binarize' entry, an
'ensure_dtype' step is added to ensure preprocessing steps are not unintentionally
changing the data type.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TensorDescrBase">TensorDescrBase</a></dt>
                                <dd id="InputTensorDescr.description" class="variable"><a href="#TensorDescrBase.description">description</a></dd>
                <dd id="InputTensorDescr.axes" class="variable"><a href="#TensorDescrBase.axes">axes</a></dd>
                <dd id="InputTensorDescr.shape" class="variable"><a href="#TensorDescrBase.shape">shape</a></dd>
                <dd id="InputTensorDescr.test_tensor" class="variable"><a href="#TensorDescrBase.test_tensor">test_tensor</a></dd>
                <dd id="InputTensorDescr.sample_tensor" class="variable"><a href="#TensorDescrBase.sample_tensor">sample_tensor</a></dd>
                <dd id="InputTensorDescr.data" class="variable"><a href="#TensorDescrBase.data">data</a></dd>
                <dd id="InputTensorDescr.dtype" class="variable"><a href="#TensorDescrBase.dtype">dtype</a></dd>
                <dd id="InputTensorDescr.get_axis_sizes_for_array" class="function"><a href="#TensorDescrBase.get_axis_sizes_for_array">get_axis_sizes_for_array</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="convert_axes">
                            <input id="convert_axes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_axes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">axes</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n"><a href="v0_4.html#ParameterizedInputShape">bioimageio.spec.model.v0_4.ParameterizedInputShape</a></span><span class="p">,</span> <span class="n"><a href="v0_4.html#ImplicitOutputShape">bioimageio.spec.model.v0_4.ImplicitOutputShape</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">tensor_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">halo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">size_refs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="v0_4.html#TensorName">bioimageio.spec.model.v0_4.TensorName</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="convert_axes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert_axes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert_axes-1754"><a href="#convert_axes-1754"><span class="linenos">1754</span></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_axes</span><span class="p">(</span>
</span><span id="convert_axes-1755"><a href="#convert_axes-1755"><span class="linenos">1755</span></a>    <span class="n">axes</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="convert_axes-1756"><a href="#convert_axes-1756"><span class="linenos">1756</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="convert_axes-1757"><a href="#convert_axes-1757"><span class="linenos">1757</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="convert_axes-1758"><a href="#convert_axes-1758"><span class="linenos">1758</span></a>        <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">_ParameterizedInputShape_v0_4</span><span class="p">,</span> <span class="n">_ImplicitOutputShape_v0_4</span>
</span><span id="convert_axes-1759"><a href="#convert_axes-1759"><span class="linenos">1759</span></a>    <span class="p">],</span>
</span><span id="convert_axes-1760"><a href="#convert_axes-1760"><span class="linenos">1760</span></a>    <span class="n">tensor_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">],</span>
</span><span id="convert_axes-1761"><a href="#convert_axes-1761"><span class="linenos">1761</span></a>    <span class="n">halo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="convert_axes-1762"><a href="#convert_axes-1762"><span class="linenos">1762</span></a>    <span class="n">size_refs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">_TensorName_v0_4</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="convert_axes-1763"><a href="#convert_axes-1763"><span class="linenos">1763</span></a><span class="p">):</span>
</span><span id="convert_axes-1764"><a href="#convert_axes-1764"><span class="linenos">1764</span></a>    <span class="n">ret</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_axes-1765"><a href="#convert_axes-1765"><span class="linenos">1765</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="convert_axes-1766"><a href="#convert_axes-1766"><span class="linenos">1766</span></a>        <span class="n">axis_type</span> <span class="o">=</span> <span class="n">_AXIS_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="convert_axes-1767"><a href="#convert_axes-1767"><span class="linenos">1767</span></a>        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1768"><a href="#convert_axes-1768"><span class="linenos">1768</span></a>            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BatchAxis</span><span class="p">())</span>
</span><span id="convert_axes-1769"><a href="#convert_axes-1769"><span class="linenos">1769</span></a>            <span class="k">continue</span>
</span><span id="convert_axes-1770"><a href="#convert_axes-1770"><span class="linenos">1770</span></a>
</span><span id="convert_axes-1771"><a href="#convert_axes-1771"><span class="linenos">1771</span></a>        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="convert_axes-1772"><a href="#convert_axes-1772"><span class="linenos">1772</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ParameterizedInputShape_v0_4</span><span class="p">):</span>
</span><span id="convert_axes-1773"><a href="#convert_axes-1773"><span class="linenos">1773</span></a>            <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="convert_axes-1774"><a href="#convert_axes-1774"><span class="linenos">1774</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="convert_axes-1775"><a href="#convert_axes-1775"><span class="linenos">1775</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1776"><a href="#convert_axes-1776"><span class="linenos">1776</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">ParameterizedSize</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">shape</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="convert_axes-1777"><a href="#convert_axes-1777"><span class="linenos">1777</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">_ImplicitOutputShape_v0_4</span><span class="p">):</span>
</span><span id="convert_axes-1778"><a href="#convert_axes-1778"><span class="linenos">1778</span></a>            <span class="n">ref_t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">reference_tensor</span><span class="p">)</span>
</span><span id="convert_axes-1779"><a href="#convert_axes-1779"><span class="linenos">1779</span></a>            <span class="k">if</span> <span class="n">ref_t</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="convert_axes-1780"><a href="#convert_axes-1780"><span class="linenos">1780</span></a>                <span class="n">t_id</span><span class="p">,</span> <span class="n">orig_a_id</span> <span class="o">=</span> <span class="n">ref_t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="convert_axes-1781"><a href="#convert_axes-1781"><span class="linenos">1781</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1782"><a href="#convert_axes-1782"><span class="linenos">1782</span></a>                <span class="n">t_id</span> <span class="o">=</span> <span class="n">ref_t</span>
</span><span id="convert_axes-1783"><a href="#convert_axes-1783"><span class="linenos">1783</span></a>                <span class="n">orig_a_id</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="convert_axes-1784"><a href="#convert_axes-1784"><span class="linenos">1784</span></a>
</span><span id="convert_axes-1785"><a href="#convert_axes-1785"><span class="linenos">1785</span></a>            <span class="n">a_id</span> <span class="o">=</span> <span class="n">_AXIS_ID_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig_a_id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="convert_axes-1786"><a href="#convert_axes-1786"><span class="linenos">1786</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">orig_scale</span> <span class="o">:=</span> <span class="n">shape</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="convert_axes-1787"><a href="#convert_axes-1787"><span class="linenos">1787</span></a>                <span class="c1"># old way to insert a new axis dimension</span>
</span><span id="convert_axes-1788"><a href="#convert_axes-1788"><span class="linenos">1788</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="convert_axes-1789"><a href="#convert_axes-1789"><span class="linenos">1789</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1790"><a href="#convert_axes-1790"><span class="linenos">1790</span></a>                <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">orig_scale</span>
</span><span id="convert_axes-1791"><a href="#convert_axes-1791"><span class="linenos">1791</span></a>                <span class="k">if</span> <span class="n">axis_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">):</span>
</span><span id="convert_axes-1792"><a href="#convert_axes-1792"><span class="linenos">1792</span></a>                    <span class="c1"># these axes no longer have a scale</span>
</span><span id="convert_axes-1793"><a href="#convert_axes-1793"><span class="linenos">1793</span></a>                    <span class="n">offset_from_scale</span> <span class="o">=</span> <span class="n">orig_scale</span> <span class="o">*</span> <span class="n">size_refs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="convert_axes-1794"><a href="#convert_axes-1794"><span class="linenos">1794</span></a>                        <span class="n">_TensorName_v0_4</span><span class="p">(</span><span class="n">t_id</span><span class="p">),</span> <span class="p">{}</span>
</span><span id="convert_axes-1795"><a href="#convert_axes-1795"><span class="linenos">1795</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig_a_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="convert_axes-1796"><a href="#convert_axes-1796"><span class="linenos">1796</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1797"><a href="#convert_axes-1797"><span class="linenos">1797</span></a>                    <span class="n">offset_from_scale</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="convert_axes-1798"><a href="#convert_axes-1798"><span class="linenos">1798</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">SizeReference</span><span class="p">(</span>
</span><span id="convert_axes-1799"><a href="#convert_axes-1799"><span class="linenos">1799</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">TensorId</span><span class="p">(</span><span class="n">t_id</span><span class="p">),</span>
</span><span id="convert_axes-1800"><a href="#convert_axes-1800"><span class="linenos">1800</span></a>                    <span class="n">axis_id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a_id</span><span class="p">),</span>
</span><span id="convert_axes-1801"><a href="#convert_axes-1801"><span class="linenos">1801</span></a>                    <span class="n">offset</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">offset_from_scale</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="convert_axes-1802"><a href="#convert_axes-1802"><span class="linenos">1802</span></a>                <span class="p">)</span>
</span><span id="convert_axes-1803"><a href="#convert_axes-1803"><span class="linenos">1803</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1804"><a href="#convert_axes-1804"><span class="linenos">1804</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="convert_axes-1805"><a href="#convert_axes-1805"><span class="linenos">1805</span></a>
</span><span id="convert_axes-1806"><a href="#convert_axes-1806"><span class="linenos">1806</span></a>        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1807"><a href="#convert_axes-1807"><span class="linenos">1807</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1808"><a href="#convert_axes-1808"><span class="linenos">1808</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TimeInputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="convert_axes-1809"><a href="#convert_axes-1809"><span class="linenos">1809</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1810"><a href="#convert_axes-1810"><span class="linenos">1810</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="convert_axes-1811"><a href="#convert_axes-1811"><span class="linenos">1811</span></a>                <span class="k">if</span> <span class="n">halo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="convert_axes-1812"><a href="#convert_axes-1812"><span class="linenos">1812</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TimeOutputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="convert_axes-1813"><a href="#convert_axes-1813"><span class="linenos">1813</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1814"><a href="#convert_axes-1814"><span class="linenos">1814</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="convert_axes-1815"><a href="#convert_axes-1815"><span class="linenos">1815</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="convert_axes-1816"><a href="#convert_axes-1816"><span class="linenos">1816</span></a>                        <span class="n">TimeOutputAxisWithHalo</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="convert_axes-1817"><a href="#convert_axes-1817"><span class="linenos">1817</span></a>                    <span class="p">)</span>
</span><span id="convert_axes-1818"><a href="#convert_axes-1818"><span class="linenos">1818</span></a>
</span><span id="convert_axes-1819"><a href="#convert_axes-1819"><span class="linenos">1819</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1820"><a href="#convert_axes-1820"><span class="linenos">1820</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1821"><a href="#convert_axes-1821"><span class="linenos">1821</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexInputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
</span><span id="convert_axes-1822"><a href="#convert_axes-1822"><span class="linenos">1822</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1823"><a href="#convert_axes-1823"><span class="linenos">1823</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="convert_axes-1824"><a href="#convert_axes-1824"><span class="linenos">1824</span></a>                    <span class="n">size</span> <span class="o">=</span> <span class="n">DataDependentSize</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">size</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
</span><span id="convert_axes-1825"><a href="#convert_axes-1825"><span class="linenos">1825</span></a>
</span><span id="convert_axes-1826"><a href="#convert_axes-1826"><span class="linenos">1826</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexOutputAxis</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
</span><span id="convert_axes-1827"><a href="#convert_axes-1827"><span class="linenos">1827</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1828"><a href="#convert_axes-1828"><span class="linenos">1828</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="convert_axes-1829"><a href="#convert_axes-1829"><span class="linenos">1829</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="convert_axes-1830"><a href="#convert_axes-1830"><span class="linenos">1830</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="convert_axes-1831"><a href="#convert_axes-1831"><span class="linenos">1831</span></a>                    <span class="s2">&quot;Conversion of channel size from an implicit output shape may be&quot;</span>
</span><span id="convert_axes-1832"><a href="#convert_axes-1832"><span class="linenos">1832</span></a>                    <span class="o">+</span> <span class="s2">&quot; wrong&quot;</span>
</span><span id="convert_axes-1833"><a href="#convert_axes-1833"><span class="linenos">1833</span></a>                <span class="p">)</span>
</span><span id="convert_axes-1834"><a href="#convert_axes-1834"><span class="linenos">1834</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="convert_axes-1835"><a href="#convert_axes-1835"><span class="linenos">1835</span></a>                    <span class="n">ChannelAxis</span><span class="p">(</span>
</span><span id="convert_axes-1836"><a href="#convert_axes-1836"><span class="linenos">1836</span></a>                        <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span>
</span><span id="convert_axes-1837"><a href="#convert_axes-1837"><span class="linenos">1837</span></a>                            <span class="n">Identifier</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;channel</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
</span><span id="convert_axes-1838"><a href="#convert_axes-1838"><span class="linenos">1838</span></a>                        <span class="p">]</span>
</span><span id="convert_axes-1839"><a href="#convert_axes-1839"><span class="linenos">1839</span></a>                    <span class="p">)</span>
</span><span id="convert_axes-1840"><a href="#convert_axes-1840"><span class="linenos">1840</span></a>                <span class="p">)</span>
</span><span id="convert_axes-1841"><a href="#convert_axes-1841"><span class="linenos">1841</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1842"><a href="#convert_axes-1842"><span class="linenos">1842</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="convert_axes-1843"><a href="#convert_axes-1843"><span class="linenos">1843</span></a>                    <span class="n">ChannelAxis</span><span class="p">(</span>
</span><span id="convert_axes-1844"><a href="#convert_axes-1844"><span class="linenos">1844</span></a>                        <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span><span class="n">Identifier</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;channel</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
</span><span id="convert_axes-1845"><a href="#convert_axes-1845"><span class="linenos">1845</span></a>                    <span class="p">)</span>
</span><span id="convert_axes-1846"><a href="#convert_axes-1846"><span class="linenos">1846</span></a>                <span class="p">)</span>
</span><span id="convert_axes-1847"><a href="#convert_axes-1847"><span class="linenos">1847</span></a>        <span class="k">elif</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;space&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1848"><a href="#convert_axes-1848"><span class="linenos">1848</span></a>            <span class="k">if</span> <span class="n">tensor_type</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
</span><span id="convert_axes-1849"><a href="#convert_axes-1849"><span class="linenos">1849</span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpaceInputAxis</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="convert_axes-1850"><a href="#convert_axes-1850"><span class="linenos">1850</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1851"><a href="#convert_axes-1851"><span class="linenos">1851</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="convert_axes-1852"><a href="#convert_axes-1852"><span class="linenos">1852</span></a>                <span class="k">if</span> <span class="n">halo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="convert_axes-1853"><a href="#convert_axes-1853"><span class="linenos">1853</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpaceOutputAxis</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>
</span><span id="convert_axes-1854"><a href="#convert_axes-1854"><span class="linenos">1854</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="convert_axes-1855"><a href="#convert_axes-1855"><span class="linenos">1855</span></a>                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="convert_axes-1856"><a href="#convert_axes-1856"><span class="linenos">1856</span></a>                        <span class="sa">f</span><span class="s2">&quot;output axis with halo and fixed size (here </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">) not allowed&quot;</span>
</span><span id="convert_axes-1857"><a href="#convert_axes-1857"><span class="linenos">1857</span></a>                    <span class="p">)</span>
</span><span id="convert_axes-1858"><a href="#convert_axes-1858"><span class="linenos">1858</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="convert_axes-1859"><a href="#convert_axes-1859"><span class="linenos">1859</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="convert_axes-1860"><a href="#convert_axes-1860"><span class="linenos">1860</span></a>                        <span class="n">SpaceOutputAxisWithHalo</span><span class="p">(</span>
</span><span id="convert_axes-1861"><a href="#convert_axes-1861"><span class="linenos">1861</span></a>                            <span class="nb">id</span><span class="o">=</span><span class="n">AxisId</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="convert_axes-1862"><a href="#convert_axes-1862"><span class="linenos">1862</span></a>                        <span class="p">)</span>
</span><span id="convert_axes-1863"><a href="#convert_axes-1863"><span class="linenos">1863</span></a>                    <span class="p">)</span>
</span><span id="convert_axes-1864"><a href="#convert_axes-1864"><span class="linenos">1864</span></a>
</span><span id="convert_axes-1865"><a href="#convert_axes-1865"><span class="linenos">1865</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


    

                </section>
                <section id="OutputTensorDescr">
                            <input id="OutputTensorDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">OutputTensorDescr</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>, <span class="base">typing.Generic[~IO_AxisT]</span>):

                <label class="view-source-button" for="OutputTensorDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutputTensorDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutputTensorDescr-2030"><a href="#OutputTensorDescr-2030"><span class="linenos">2030</span></a><span class="k">class</span><span class="w"> </span><span class="nc">OutputTensorDescr</span><span class="p">(</span><span class="n">TensorDescrBase</span><span class="p">[</span><span class="n">OutputAxis</span><span class="p">]):</span>
</span><span id="OutputTensorDescr-2031"><a href="#OutputTensorDescr-2031"><span class="linenos">2031</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">TensorId</span> <span class="o">=</span> <span class="n">TensorId</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2032"><a href="#OutputTensorDescr-2032"><span class="linenos">2032</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Output tensor id.</span>
</span><span id="OutputTensorDescr-2033"><a href="#OutputTensorDescr-2033"><span class="linenos">2033</span></a><span class="sd">    No duplicates are allowed across all inputs and outputs.&quot;&quot;&quot;</span>
</span><span id="OutputTensorDescr-2034"><a href="#OutputTensorDescr-2034"><span class="linenos">2034</span></a>
</span><span id="OutputTensorDescr-2035"><a href="#OutputTensorDescr-2035"><span class="linenos">2035</span></a>    <span class="n">postprocessing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingDescr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="OutputTensorDescr-2036"><a href="#OutputTensorDescr-2036"><span class="linenos">2036</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingDescr</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2037"><a href="#OutputTensorDescr-2037"><span class="linenos">2037</span></a>    <span class="p">)</span>
</span><span id="OutputTensorDescr-2038"><a href="#OutputTensorDescr-2038"><span class="linenos">2038</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of how this output should be postprocessed.</span>
</span><span id="OutputTensorDescr-2039"><a href="#OutputTensorDescr-2039"><span class="linenos">2039</span></a>
</span><span id="OutputTensorDescr-2040"><a href="#OutputTensorDescr-2040"><span class="linenos">2040</span></a><span class="sd">    note: `postprocessing` always ends with an &#39;ensure_dtype&#39; operation.</span>
</span><span id="OutputTensorDescr-2041"><a href="#OutputTensorDescr-2041"><span class="linenos">2041</span></a><span class="sd">          If not given this is added to cast to this tensor&#39;s `data.type`.</span>
</span><span id="OutputTensorDescr-2042"><a href="#OutputTensorDescr-2042"><span class="linenos">2042</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="OutputTensorDescr-2043"><a href="#OutputTensorDescr-2043"><span class="linenos">2043</span></a>
</span><span id="OutputTensorDescr-2044"><a href="#OutputTensorDescr-2044"><span class="linenos">2044</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2045"><a href="#OutputTensorDescr-2045"><span class="linenos">2045</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_postprocessing_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="OutputTensorDescr-2046"><a href="#OutputTensorDescr-2046"><span class="linenos">2046</span></a>        <span class="n">axes_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
</span><span id="OutputTensorDescr-2047"><a href="#OutputTensorDescr-2047"><span class="linenos">2047</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">:</span>
</span><span id="OutputTensorDescr-2048"><a href="#OutputTensorDescr-2048"><span class="linenos">2048</span></a>            <span class="n">kwargs_axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2049"><a href="#OutputTensorDescr-2049"><span class="linenos">2049</span></a>            <span class="k">if</span> <span class="n">kwargs_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OutputTensorDescr-2050"><a href="#OutputTensorDescr-2050"><span class="linenos">2050</span></a>                <span class="k">continue</span>
</span><span id="OutputTensorDescr-2051"><a href="#OutputTensorDescr-2051"><span class="linenos">2051</span></a>
</span><span id="OutputTensorDescr-2052"><a href="#OutputTensorDescr-2052"><span class="linenos">2052</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="OutputTensorDescr-2053"><a href="#OutputTensorDescr-2053"><span class="linenos">2053</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="OutputTensorDescr-2054"><a href="#OutputTensorDescr-2054"><span class="linenos">2054</span></a>                    <span class="sa">f</span><span class="s2">&quot;expected `axes` sequence, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">kwargs_axes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="OutputTensorDescr-2055"><a href="#OutputTensorDescr-2055"><span class="linenos">2055</span></a>                <span class="p">)</span>
</span><span id="OutputTensorDescr-2056"><a href="#OutputTensorDescr-2056"><span class="linenos">2056</span></a>
</span><span id="OutputTensorDescr-2057"><a href="#OutputTensorDescr-2057"><span class="linenos">2057</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_ids</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs_axes</span><span class="p">):</span>
</span><span id="OutputTensorDescr-2058"><a href="#OutputTensorDescr-2058"><span class="linenos">2058</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`kwargs.axes` needs to be subset of axes ids&quot;</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2059"><a href="#OutputTensorDescr-2059"><span class="linenos">2059</span></a>
</span><span id="OutputTensorDescr-2060"><a href="#OutputTensorDescr-2060"><span class="linenos">2060</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">NominalOrOrdinalDataDescr</span><span class="p">,</span> <span class="n">IntervalOrRatioDataDescr</span><span class="p">)):</span>
</span><span id="OutputTensorDescr-2061"><a href="#OutputTensorDescr-2061"><span class="linenos">2061</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span>
</span><span id="OutputTensorDescr-2062"><a href="#OutputTensorDescr-2062"><span class="linenos">2062</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutputTensorDescr-2063"><a href="#OutputTensorDescr-2063"><span class="linenos">2063</span></a>            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>
</span><span id="OutputTensorDescr-2064"><a href="#OutputTensorDescr-2064"><span class="linenos">2064</span></a>
</span><span id="OutputTensorDescr-2065"><a href="#OutputTensorDescr-2065"><span class="linenos">2065</span></a>        <span class="c1"># ensure `postprocessing` ends with `EnsureDtypeDescr` or `BinarizeDescr`</span>
</span><span id="OutputTensorDescr-2066"><a href="#OutputTensorDescr-2066"><span class="linenos">2066</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="OutputTensorDescr-2067"><a href="#OutputTensorDescr-2067"><span class="linenos">2067</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">EnsureDtypeDescr</span><span class="p">,</span> <span class="n">BinarizeDescr</span><span class="p">)</span>
</span><span id="OutputTensorDescr-2068"><a href="#OutputTensorDescr-2068"><span class="linenos">2068</span></a>        <span class="p">):</span>
</span><span id="OutputTensorDescr-2069"><a href="#OutputTensorDescr-2069"><span class="linenos">2069</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">postprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="OutputTensorDescr-2070"><a href="#OutputTensorDescr-2070"><span class="linenos">2070</span></a>                <span class="n">EnsureDtypeDescr</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">EnsureDtypeKwargs</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="OutputTensorDescr-2071"><a href="#OutputTensorDescr-2071"><span class="linenos">2071</span></a>            <span class="p">)</span>
</span><span id="OutputTensorDescr-2072"><a href="#OutputTensorDescr-2072"><span class="linenos">2072</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            <div id="OutputTensorDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: <a href="#TensorId">TensorId</a></span>        =
<span class="default_value">&#39;output&#39;</span>

        
    </div>
    <a class="headerlink" href="#OutputTensorDescr.id"></a>
    
            <div class="docstring"><p>Output tensor id.
No duplicates are allowed across all inputs and outputs.</p>
</div>


                            </div>
                            <div id="OutputTensorDescr.postprocessing" class="classattr">
                                <div class="attr variable">
            <span class="name">postprocessing</span><span class="annotation">: List[Annotated[Union[<a href="#BinarizeDescr">BinarizeDescr</a>, <a href="#ClipDescr">ClipDescr</a>, <a href="#EnsureDtypeDescr">EnsureDtypeDescr</a>, <a href="#FixedZeroMeanUnitVarianceDescr">FixedZeroMeanUnitVarianceDescr</a>, <a href="#ScaleLinearDescr">ScaleLinearDescr</a>, <a href="#ScaleMeanVarianceDescr">ScaleMeanVarianceDescr</a>, <a href="#ScaleRangeDescr">ScaleRangeDescr</a>, <a href="#SigmoidDescr">SigmoidDescr</a>, <a href="#SoftmaxDescr">SoftmaxDescr</a>, <a href="#ZeroMeanUnitVarianceDescr">ZeroMeanUnitVarianceDescr</a>], Discriminator(discriminator=&#39;id&#39;, custom_error_type=None, custom_error_message=None, custom_error_context=None)]]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#OutputTensorDescr.postprocessing"></a>
    
            <div class="docstring"><p>Description of how this output should be postprocessed.</p>

<p>note: <code><a href="#OutputTensorDescr.postprocessing">postprocessing</a></code> always ends with an 'ensure_dtype' operation.
      If not given this is added to cast to this tensor's <code>data.type</code>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TensorDescrBase">TensorDescrBase</a></dt>
                                <dd id="OutputTensorDescr.description" class="variable"><a href="#TensorDescrBase.description">description</a></dd>
                <dd id="OutputTensorDescr.axes" class="variable"><a href="#TensorDescrBase.axes">axes</a></dd>
                <dd id="OutputTensorDescr.shape" class="variable"><a href="#TensorDescrBase.shape">shape</a></dd>
                <dd id="OutputTensorDescr.test_tensor" class="variable"><a href="#TensorDescrBase.test_tensor">test_tensor</a></dd>
                <dd id="OutputTensorDescr.sample_tensor" class="variable"><a href="#TensorDescrBase.sample_tensor">sample_tensor</a></dd>
                <dd id="OutputTensorDescr.data" class="variable"><a href="#TensorDescrBase.data">data</a></dd>
                <dd id="OutputTensorDescr.dtype" class="variable"><a href="#TensorDescrBase.dtype">dtype</a></dd>
                <dd id="OutputTensorDescr.get_axis_sizes_for_array" class="function"><a href="#TensorDescrBase.get_axis_sizes_for_array">get_axis_sizes_for_array</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TensorDescr">
                    <div class="attr variable">
            <span class="name">TensorDescr</span>        =
<input id="TensorDescr-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TensorDescr-view-value"></label><span class="default_value">typing.Union[<a href="#InputTensorDescr">InputTensorDescr</a>, <a href="#OutputTensorDescr">OutputTensorDescr</a>]</span>

        
    </div>
    <a class="headerlink" href="#TensorDescr"></a>
    
    

                </section>
                <section id="validate_tensors">
                            <input id="validate_tensors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_tensors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tensors</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#InputTensorDescr">InputTensorDescr</a></span><span class="p">,</span> <span class="n"><a href="#OutputTensorDescr">OutputTensorDescr</a></span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]]</span>,</span><span class="param">	<span class="n">tensor_origin</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;test_tensor&#39;</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="validate_tensors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_tensors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_tensors-2122"><a href="#validate_tensors-2122"><span class="linenos">2122</span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_tensors</span><span class="p">(</span>
</span><span id="validate_tensors-2123"><a href="#validate_tensors-2123"><span class="linenos">2123</span></a>    <span class="n">tensors</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]],</span>
</span><span id="validate_tensors-2124"><a href="#validate_tensors-2124"><span class="linenos">2124</span></a>    <span class="n">tensor_origin</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="validate_tensors-2125"><a href="#validate_tensors-2125"><span class="linenos">2125</span></a>        <span class="s2">&quot;test_tensor&quot;</span>
</span><span id="validate_tensors-2126"><a href="#validate_tensors-2126"><span class="linenos">2126</span></a>    <span class="p">],</span>  <span class="c1"># for more precise error messages, e.g. &#39;test_tensor&#39;</span>
</span><span id="validate_tensors-2127"><a href="#validate_tensors-2127"><span class="linenos">2127</span></a><span class="p">):</span>
</span><span id="validate_tensors-2128"><a href="#validate_tensors-2128"><span class="linenos">2128</span></a>    <span class="n">all_tensor_axes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="validate_tensors-2129"><a href="#validate_tensors-2129"><span class="linenos">2129</span></a>
</span><span id="validate_tensors-2130"><a href="#validate_tensors-2130"><span class="linenos">2130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">e_msg</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">TensorDescr</span><span class="p">):</span>
</span><span id="validate_tensors-2131"><a href="#validate_tensors-2131"><span class="linenos">2131</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;inputs&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">InputTensorDescr</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;outputs&#39;</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="validate_tensors-2132"><a href="#validate_tensors-2132"><span class="linenos">2132</span></a>
</span><span id="validate_tensors-2133"><a href="#validate_tensors-2133"><span class="linenos">2133</span></a>    <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">tensors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="validate_tensors-2134"><a href="#validate_tensors-2134"><span class="linenos">2134</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2135"><a href="#validate_tensors-2135"><span class="linenos">2135</span></a>            <span class="n">axis_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span>
</span><span id="validate_tensors-2136"><a href="#validate_tensors-2136"><span class="linenos">2136</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_tensors-2137"><a href="#validate_tensors-2137"><span class="linenos">2137</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="validate_tensors-2138"><a href="#validate_tensors-2138"><span class="linenos">2138</span></a>                <span class="n">axis_sizes</span> <span class="o">=</span> <span class="n">descr</span><span class="o">.</span><span class="n">get_axis_sizes_for_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="validate_tensors-2139"><a href="#validate_tensors-2139"><span class="linenos">2139</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="validate_tensors-2140"><a href="#validate_tensors-2140"><span class="linenos">2140</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validate_tensors-2141"><a href="#validate_tensors-2141"><span class="linenos">2141</span></a>
</span><span id="validate_tensors-2142"><a href="#validate_tensors-2142"><span class="linenos">2142</span></a>        <span class="n">all_tensor_axes</span><span class="p">[</span><span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis_sizes</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span>
</span><span id="validate_tensors-2143"><a href="#validate_tensors-2143"><span class="linenos">2143</span></a>
</span><span id="validate_tensors-2144"><a href="#validate_tensors-2144"><span class="linenos">2144</span></a>    <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">tensors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="validate_tensors-2145"><a href="#validate_tensors-2145"><span class="linenos">2145</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2146"><a href="#validate_tensors-2146"><span class="linenos">2146</span></a>            <span class="k">continue</span>
</span><span id="validate_tensors-2147"><a href="#validate_tensors-2147"><span class="linenos">2147</span></a>
</span><span id="validate_tensors-2148"><a href="#validate_tensors-2148"><span class="linenos">2148</span></a>        <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">):</span>
</span><span id="validate_tensors-2149"><a href="#validate_tensors-2149"><span class="linenos">2149</span></a>            <span class="n">invalid_test_tensor_dtype</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="validate_tensors-2150"><a href="#validate_tensors-2150"><span class="linenos">2150</span></a>                <span class="s2">&quot;float32&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2151"><a href="#validate_tensors-2151"><span class="linenos">2151</span></a>                <span class="s2">&quot;float64&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2152"><a href="#validate_tensors-2152"><span class="linenos">2152</span></a>                <span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2153"><a href="#validate_tensors-2153"><span class="linenos">2153</span></a>                <span class="s2">&quot;int8&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2154"><a href="#validate_tensors-2154"><span class="linenos">2154</span></a>                <span class="s2">&quot;uint16&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2155"><a href="#validate_tensors-2155"><span class="linenos">2155</span></a>                <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2156"><a href="#validate_tensors-2156"><span class="linenos">2156</span></a>                <span class="s2">&quot;uint32&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2157"><a href="#validate_tensors-2157"><span class="linenos">2157</span></a>                <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2158"><a href="#validate_tensors-2158"><span class="linenos">2158</span></a>                <span class="s2">&quot;uint64&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2159"><a href="#validate_tensors-2159"><span class="linenos">2159</span></a>                <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
</span><span id="validate_tensors-2160"><a href="#validate_tensors-2160"><span class="linenos">2160</span></a>            <span class="p">)</span>
</span><span id="validate_tensors-2161"><a href="#validate_tensors-2161"><span class="linenos">2161</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_tensors-2162"><a href="#validate_tensors-2162"><span class="linenos">2162</span></a>            <span class="n">invalid_test_tensor_dtype</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">descr</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="validate_tensors-2163"><a href="#validate_tensors-2163"><span class="linenos">2163</span></a>
</span><span id="validate_tensors-2164"><a href="#validate_tensors-2164"><span class="linenos">2164</span></a>        <span class="k">if</span> <span class="n">invalid_test_tensor_dtype</span><span class="p">:</span>
</span><span id="validate_tensors-2165"><a href="#validate_tensors-2165"><span class="linenos">2165</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2166"><a href="#validate_tensors-2166"><span class="linenos">2166</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">.dtype &#39;</span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not&quot;</span>
</span><span id="validate_tensors-2167"><a href="#validate_tensors-2167"><span class="linenos">2167</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; match described dtype &#39;</span><span class="si">{</span><span class="n">descr</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="validate_tensors-2168"><a href="#validate_tensors-2168"><span class="linenos">2168</span></a>            <span class="p">)</span>
</span><span id="validate_tensors-2169"><a href="#validate_tensors-2169"><span class="linenos">2169</span></a>
</span><span id="validate_tensors-2170"><a href="#validate_tensors-2170"><span class="linenos">2170</span></a>        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1e-4</span> <span class="ow">and</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">:</span>
</span><span id="validate_tensors-2171"><a href="#validate_tensors-2171"><span class="linenos">2171</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2172"><a href="#validate_tensors-2172"><span class="linenos">2172</span></a>                <span class="s2">&quot;Output values are too small for reliable testing.&quot;</span>
</span><span id="validate_tensors-2173"><a href="#validate_tensors-2173"><span class="linenos">2173</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Values &lt;-1e5 or &gt;=1e5 must be present in </span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_tensors-2174"><a href="#validate_tensors-2174"><span class="linenos">2174</span></a>            <span class="p">)</span>
</span><span id="validate_tensors-2175"><a href="#validate_tensors-2175"><span class="linenos">2175</span></a>
</span><span id="validate_tensors-2176"><a href="#validate_tensors-2176"><span class="linenos">2176</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="validate_tensors-2177"><a href="#validate_tensors-2177"><span class="linenos">2177</span></a>            <span class="n">actual_size</span> <span class="o">=</span> <span class="n">all_tensor_axes</span><span class="p">[</span><span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="validate_tensors-2178"><a href="#validate_tensors-2178"><span class="linenos">2178</span></a>            <span class="k">if</span> <span class="n">actual_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2179"><a href="#validate_tensors-2179"><span class="linenos">2179</span></a>                <span class="k">continue</span>
</span><span id="validate_tensors-2180"><a href="#validate_tensors-2180"><span class="linenos">2180</span></a>
</span><span id="validate_tensors-2181"><a href="#validate_tensors-2181"><span class="linenos">2181</span></a>            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2182"><a href="#validate_tensors-2182"><span class="linenos">2182</span></a>                <span class="k">continue</span>
</span><span id="validate_tensors-2183"><a href="#validate_tensors-2183"><span class="linenos">2183</span></a>
</span><span id="validate_tensors-2184"><a href="#validate_tensors-2184"><span class="linenos">2184</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="validate_tensors-2185"><a href="#validate_tensors-2185"><span class="linenos">2185</span></a>                <span class="k">if</span> <span class="n">actual_size</span> <span class="o">!=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="validate_tensors-2186"><a href="#validate_tensors-2186"><span class="linenos">2186</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2187"><a href="#validate_tensors-2187"><span class="linenos">2187</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">: axis &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span id="validate_tensors-2188"><a href="#validate_tensors-2188"><span class="linenos">2188</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;has incompatible size </span><span class="si">{</span><span class="n">actual_size</span><span class="si">}</span><span class="s2">, expected </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_tensors-2189"><a href="#validate_tensors-2189"><span class="linenos">2189</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2190"><a href="#validate_tensors-2190"><span class="linenos">2190</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="validate_tensors-2191"><a href="#validate_tensors-2191"><span class="linenos">2191</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">validate_size</span><span class="p">(</span><span class="n">actual_size</span><span class="p">)</span>
</span><span id="validate_tensors-2192"><a href="#validate_tensors-2192"><span class="linenos">2192</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="validate_tensors-2193"><a href="#validate_tensors-2193"><span class="linenos">2193</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">validate_size</span><span class="p">(</span><span class="n">actual_size</span><span class="p">)</span>
</span><span id="validate_tensors-2194"><a href="#validate_tensors-2194"><span class="linenos">2194</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="validate_tensors-2195"><a href="#validate_tensors-2195"><span class="linenos">2195</span></a>                <span class="n">ref_tensor_axes</span> <span class="o">=</span> <span class="n">all_tensor_axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">)</span>
</span><span id="validate_tensors-2196"><a href="#validate_tensors-2196"><span class="linenos">2196</span></a>                <span class="k">if</span> <span class="n">ref_tensor_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2197"><a href="#validate_tensors-2197"><span class="linenos">2197</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2198"><a href="#validate_tensors-2198"><span class="linenos">2198</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size.tensor_id: Unknown tensor&quot;</span>
</span><span id="validate_tensors-2199"><a href="#validate_tensors-2199"><span class="linenos">2199</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; reference &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="validate_tensors-2200"><a href="#validate_tensors-2200"><span class="linenos">2200</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2201"><a href="#validate_tensors-2201"><span class="linenos">2201</span></a>
</span><span id="validate_tensors-2202"><a href="#validate_tensors-2202"><span class="linenos">2202</span></a>                <span class="n">ref_axis</span><span class="p">,</span> <span class="n">ref_size</span> <span class="o">=</span> <span class="n">ref_tensor_axes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="validate_tensors-2203"><a href="#validate_tensors-2203"><span class="linenos">2203</span></a>                <span class="k">if</span> <span class="n">ref_axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_tensors-2204"><a href="#validate_tensors-2204"><span class="linenos">2204</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2205"><a href="#validate_tensors-2205"><span class="linenos">2205</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size.axis_id: Unknown tensor axis&quot;</span>
</span><span id="validate_tensors-2206"><a href="#validate_tensors-2206"><span class="linenos">2206</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; reference &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_tensors-2207"><a href="#validate_tensors-2207"><span class="linenos">2207</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2208"><a href="#validate_tensors-2208"><span class="linenos">2208</span></a>
</span><span id="validate_tensors-2209"><a href="#validate_tensors-2209"><span class="linenos">2209</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
</span><span id="validate_tensors-2210"><a href="#validate_tensors-2210"><span class="linenos">2210</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2211"><a href="#validate_tensors-2211"><span class="linenos">2211</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.axes[</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">].size: `SizeReference` requires&quot;</span>
</span><span id="validate_tensors-2212"><a href="#validate_tensors-2212"><span class="linenos">2212</span></a>                        <span class="o">+</span> <span class="s2">&quot; axis and reference axis to have the same `unit`, but&quot;</span>
</span><span id="validate_tensors-2213"><a href="#validate_tensors-2213"><span class="linenos">2213</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_tensors-2214"><a href="#validate_tensors-2214"><span class="linenos">2214</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2215"><a href="#validate_tensors-2215"><span class="linenos">2215</span></a>
</span><span id="validate_tensors-2216"><a href="#validate_tensors-2216"><span class="linenos">2216</span></a>                <span class="k">if</span> <span class="n">actual_size</span> <span class="o">!=</span> <span class="p">(</span>
</span><span id="validate_tensors-2217"><a href="#validate_tensors-2217"><span class="linenos">2217</span></a>                    <span class="n">expected_size</span> <span class="o">:=</span> <span class="p">(</span>
</span><span id="validate_tensors-2218"><a href="#validate_tensors-2218"><span class="linenos">2218</span></a>                        <span class="n">ref_size</span> <span class="o">*</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">offset</span>
</span><span id="validate_tensors-2219"><a href="#validate_tensors-2219"><span class="linenos">2219</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2220"><a href="#validate_tensors-2220"><span class="linenos">2220</span></a>                <span class="p">):</span>
</span><span id="validate_tensors-2221"><a href="#validate_tensors-2221"><span class="linenos">2221</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_tensors-2222"><a href="#validate_tensors-2222"><span class="linenos">2222</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e_msg</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">tensor_origin</span><span class="si">}</span><span class="s2">: axis &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; of size&quot;</span>
</span><span id="validate_tensors-2223"><a href="#validate_tensors-2223"><span class="linenos">2223</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">actual_size</span><span class="si">}</span><span class="s2"> invalid for referenced size </span><span class="si">{</span><span class="n">ref_size</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span id="validate_tensors-2224"><a href="#validate_tensors-2224"><span class="linenos">2224</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; expected </span><span class="si">{</span><span class="n">expected_size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_tensors-2225"><a href="#validate_tensors-2225"><span class="linenos">2225</span></a>                    <span class="p">)</span>
</span><span id="validate_tensors-2226"><a href="#validate_tensors-2226"><span class="linenos">2226</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="validate_tensors-2227"><a href="#validate_tensors-2227"><span class="linenos">2227</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="FileDescr_dependencies">
                    <div class="attr variable">
            <span class="name">FileDescr_dependencies</span>        =
<input id="FileDescr_dependencies-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="FileDescr_dependencies-view-value"></label><span class="default_value">typing.Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=(&#39;.yaml&#39;, &#39;.yml&#39;), case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[{&#39;source&#39;: &#39;environment.yaml&#39;}])]</span>

        
    </div>
    <a class="headerlink" href="#FileDescr_dependencies"></a>
    
    

                </section>
                <section id="ArchitectureFromFileDescr">
                            <input id="ArchitectureFromFileDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArchitectureFromFileDescr</span><wbr>(<span class="base"><a href="#_ArchitectureCallableDescr">_ArchitectureCallableDescr</a></span>, <span class="base">bioimageio.spec._internal.io.FileDescr</span>):

                <label class="view-source-button" for="ArchitectureFromFileDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchitectureFromFileDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchitectureFromFileDescr-2247"><a href="#ArchitectureFromFileDescr-2247"><span class="linenos">2247</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchitectureFromFileDescr</span><span class="p">(</span><span class="n">_ArchitectureCallableDescr</span><span class="p">,</span> <span class="n">FileDescr</span><span class="p">):</span>
</span><span id="ArchitectureFromFileDescr-2248"><a href="#ArchitectureFromFileDescr-2248"><span class="linenos">2248</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="ArchitectureFromFileDescr-2249"><a href="#ArchitectureFromFileDescr-2249"><span class="linenos">2249</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Architecture source file&quot;&quot;&quot;</span>
</span><span id="ArchitectureFromFileDescr-2250"><a href="#ArchitectureFromFileDescr-2250"><span class="linenos">2250</span></a>
</span><span id="ArchitectureFromFileDescr-2251"><a href="#ArchitectureFromFileDescr-2251"><span class="linenos">2251</span></a>    <span class="nd">@model_serializer</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">when_used</span><span class="o">=</span><span class="s2">&quot;unless-none&quot;</span><span class="p">)</span>
</span><span id="ArchitectureFromFileDescr-2252"><a href="#ArchitectureFromFileDescr-2252"><span class="linenos">2252</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">:</span> <span class="n">SerializerFunctionWrapHandler</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">SerializationInfo</span><span class="p">):</span>
</span><span id="ArchitectureFromFileDescr-2253"><a href="#ArchitectureFromFileDescr-2253"><span class="linenos">2253</span></a>        <span class="k">return</span> <span class="n">package_file_descr_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="ArchitectureFromFileDescr.source" class="classattr">
                                <div class="attr variable">
            <span class="name">source</span><span class="annotation">: Annotated[Union[bioimageio.spec._internal.url.HttpUrl, bioimageio.spec._internal.io.RelativeFilePath, Annotated[pathlib.Path, PathType(path_type=&#39;file&#39;), FieldInfo(annotation=NoneType, required=True, title=&#39;FilePath&#39;)]], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)]), AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ArchitectureFromFileDescr.source"></a>
    
            <div class="docstring"><p>Architecture source file</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#_ArchitectureCallableDescr">_ArchitectureCallableDescr</a></dt>
                                <dd id="ArchitectureFromFileDescr.callable" class="variable"><a href="#_ArchitectureCallableDescr.callable">callable</a></dd>
                <dd id="ArchitectureFromFileDescr.kwargs" class="variable"><a href="#_ArchitectureCallableDescr.kwargs">kwargs</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ArchitectureFromLibraryDescr">
                            <input id="ArchitectureFromLibraryDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArchitectureFromLibraryDescr</span><wbr>(<span class="base"><a href="#_ArchitectureCallableDescr">_ArchitectureCallableDescr</a></span>):

                <label class="view-source-button" for="ArchitectureFromLibraryDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchitectureFromLibraryDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchitectureFromLibraryDescr-2256"><a href="#ArchitectureFromLibraryDescr-2256"><span class="linenos">2256</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchitectureFromLibraryDescr</span><span class="p">(</span><span class="n">_ArchitectureCallableDescr</span><span class="p">):</span>
</span><span id="ArchitectureFromLibraryDescr-2257"><a href="#ArchitectureFromLibraryDescr-2257"><span class="linenos">2257</span></a>    <span class="n">import_from</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ArchitectureFromLibraryDescr-2258"><a href="#ArchitectureFromLibraryDescr-2258"><span class="linenos">2258</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Where to import the callable from, i.e. `from &lt;import_from&gt; import &lt;callable&gt;`&quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="ArchitectureFromLibraryDescr.import_from" class="classattr">
                                <div class="attr variable">
            <span class="name">import_from</span><span class="annotation">: str</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ArchitectureFromLibraryDescr.import_from"></a>
    
            <div class="docstring"><p>Where to import the callable from, i.e. <code>from &lt;import_from&gt; import &lt;callable&gt;</code></p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#_ArchitectureCallableDescr">_ArchitectureCallableDescr</a></dt>
                                <dd id="ArchitectureFromLibraryDescr.callable" class="variable"><a href="#_ArchitectureCallableDescr.callable">callable</a></dd>
                <dd id="ArchitectureFromLibraryDescr.kwargs" class="variable"><a href="#_ArchitectureCallableDescr.kwargs">kwargs</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="WeightsEntryDescrBase">
                            <input id="WeightsEntryDescrBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeightsEntryDescrBase</span><wbr>(<span class="base">bioimageio.spec._internal.io.FileDescr</span>):

                <label class="view-source-button" for="WeightsEntryDescrBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeightsEntryDescrBase-2318"><a href="#WeightsEntryDescrBase-2318"><span class="linenos">2318</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WeightsEntryDescrBase</span><span class="p">(</span><span class="n">FileDescr</span><span class="p">):</span>
</span><span id="WeightsEntryDescrBase-2319"><a href="#WeightsEntryDescrBase-2319"><span class="linenos">2319</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">]</span>
</span><span id="WeightsEntryDescrBase-2320"><a href="#WeightsEntryDescrBase-2320"><span class="linenos">2320</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># human readable</span>
</span><span id="WeightsEntryDescrBase-2321"><a href="#WeightsEntryDescrBase-2321"><span class="linenos">2321</span></a>
</span><span id="WeightsEntryDescrBase-2322"><a href="#WeightsEntryDescrBase-2322"><span class="linenos">2322</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="WeightsEntryDescrBase-2323"><a href="#WeightsEntryDescrBase-2323"><span class="linenos">2323</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source of the weights file.&quot;&quot;&quot;</span>
</span><span id="WeightsEntryDescrBase-2324"><a href="#WeightsEntryDescrBase-2324"><span class="linenos">2324</span></a>
</span><span id="WeightsEntryDescrBase-2325"><a href="#WeightsEntryDescrBase-2325"><span class="linenos">2325</span></a>    <span class="n">authors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsEntryDescrBase-2326"><a href="#WeightsEntryDescrBase-2326"><span class="linenos">2326</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Authors</span>
</span><span id="WeightsEntryDescrBase-2327"><a href="#WeightsEntryDescrBase-2327"><span class="linenos">2327</span></a><span class="sd">    Either the person(s) that have trained this model resulting in the original weights file.</span>
</span><span id="WeightsEntryDescrBase-2328"><a href="#WeightsEntryDescrBase-2328"><span class="linenos">2328</span></a><span class="sd">        (If this is the initial weights entry, i.e. it does not have a `parent`)</span>
</span><span id="WeightsEntryDescrBase-2329"><a href="#WeightsEntryDescrBase-2329"><span class="linenos">2329</span></a><span class="sd">    Or the person(s) who have converted the weights to this weights format.</span>
</span><span id="WeightsEntryDescrBase-2330"><a href="#WeightsEntryDescrBase-2330"><span class="linenos">2330</span></a><span class="sd">        (If this is a child weight, i.e. it has a `parent` field)</span>
</span><span id="WeightsEntryDescrBase-2331"><a href="#WeightsEntryDescrBase-2331"><span class="linenos">2331</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WeightsEntryDescrBase-2332"><a href="#WeightsEntryDescrBase-2332"><span class="linenos">2332</span></a>
</span><span id="WeightsEntryDescrBase-2333"><a href="#WeightsEntryDescrBase-2333"><span class="linenos">2333</span></a>    <span class="n">parent</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="WeightsEntryDescrBase-2334"><a href="#WeightsEntryDescrBase-2334"><span class="linenos">2334</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">],</span> <span class="n">Field</span><span class="p">(</span><span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">])</span>
</span><span id="WeightsEntryDescrBase-2335"><a href="#WeightsEntryDescrBase-2335"><span class="linenos">2335</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsEntryDescrBase-2336"><a href="#WeightsEntryDescrBase-2336"><span class="linenos">2336</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The source weights these weights were converted from.</span>
</span><span id="WeightsEntryDescrBase-2337"><a href="#WeightsEntryDescrBase-2337"><span class="linenos">2337</span></a><span class="sd">    For example, if a model&#39;s weights were converted from the `pytorch_state_dict` format to `torchscript`,</span>
</span><span id="WeightsEntryDescrBase-2338"><a href="#WeightsEntryDescrBase-2338"><span class="linenos">2338</span></a><span class="sd">    The `pytorch_state_dict` weights entry has no `parent` and is the parent of the `torchscript` weights.</span>
</span><span id="WeightsEntryDescrBase-2339"><a href="#WeightsEntryDescrBase-2339"><span class="linenos">2339</span></a><span class="sd">    All weight entries except one (the initial set of weights resulting from training the model),</span>
</span><span id="WeightsEntryDescrBase-2340"><a href="#WeightsEntryDescrBase-2340"><span class="linenos">2340</span></a><span class="sd">    need to have this field.&quot;&quot;&quot;</span>
</span><span id="WeightsEntryDescrBase-2341"><a href="#WeightsEntryDescrBase-2341"><span class="linenos">2341</span></a>
</span><span id="WeightsEntryDescrBase-2342"><a href="#WeightsEntryDescrBase-2342"><span class="linenos">2342</span></a>    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="WeightsEntryDescrBase-2343"><a href="#WeightsEntryDescrBase-2343"><span class="linenos">2343</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A comment about this weights entry, for example how these weights were created.&quot;&quot;&quot;</span>
</span><span id="WeightsEntryDescrBase-2344"><a href="#WeightsEntryDescrBase-2344"><span class="linenos">2344</span></a>
</span><span id="WeightsEntryDescrBase-2345"><a href="#WeightsEntryDescrBase-2345"><span class="linenos">2345</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="WeightsEntryDescrBase-2346"><a href="#WeightsEntryDescrBase-2346"><span class="linenos">2346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="WeightsEntryDescrBase-2347"><a href="#WeightsEntryDescrBase-2347"><span class="linenos">2347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
</span><span id="WeightsEntryDescrBase-2348"><a href="#WeightsEntryDescrBase-2348"><span class="linenos">2348</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Weights entry can&#39;t be it&#39;s own parent.&quot;</span><span class="p">)</span>
</span><span id="WeightsEntryDescrBase-2349"><a href="#WeightsEntryDescrBase-2349"><span class="linenos">2349</span></a>
</span><span id="WeightsEntryDescrBase-2350"><a href="#WeightsEntryDescrBase-2350"><span class="linenos">2350</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="WeightsEntryDescrBase-2351"><a href="#WeightsEntryDescrBase-2351"><span class="linenos">2351</span></a>
</span><span id="WeightsEntryDescrBase-2352"><a href="#WeightsEntryDescrBase-2352"><span class="linenos">2352</span></a>    <span class="nd">@model_serializer</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span> <span class="n">when_used</span><span class="o">=</span><span class="s2">&quot;unless-none&quot;</span><span class="p">)</span>
</span><span id="WeightsEntryDescrBase-2353"><a href="#WeightsEntryDescrBase-2353"><span class="linenos">2353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">:</span> <span class="n">SerializerFunctionWrapHandler</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">SerializationInfo</span><span class="p">):</span>
</span><span id="WeightsEntryDescrBase-2354"><a href="#WeightsEntryDescrBase-2354"><span class="linenos">2354</span></a>        <span class="k">return</span> <span class="n">package_file_descr_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxt</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="WeightsEntryDescrBase.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: ClassVar[Literal[&#39;keras_hdf5&#39;, &#39;onnx&#39;, &#39;pytorch_state_dict&#39;, &#39;tensorflow_js&#39;, &#39;tensorflow_saved_model_bundle&#39;, &#39;torchscript&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.type"></a>
    
    

                            </div>
                            <div id="WeightsEntryDescrBase.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.weights_format_name"></a>
    
    

                            </div>
                            <div id="WeightsEntryDescrBase.source" class="classattr">
                                <div class="attr variable">
            <span class="name">source</span><span class="annotation">: Annotated[Union[bioimageio.spec._internal.url.HttpUrl, bioimageio.spec._internal.io.RelativeFilePath, Annotated[pathlib.Path, PathType(path_type=&#39;file&#39;), FieldInfo(annotation=NoneType, required=True, title=&#39;FilePath&#39;)]], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)]), AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.source"></a>
    
            <div class="docstring"><p>Source of the weights file.</p>
</div>


                            </div>
                            <div id="WeightsEntryDescrBase.authors" class="classattr">
                                <div class="attr variable">
            <span class="name">authors</span><span class="annotation">: Optional[List[<a href="../generic/v0_3.html#Author">bioimageio.spec.generic.v0_3.Author</a>]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.authors"></a>
    
            <div class="docstring"><p>Authors
Either the person(s) that have trained this model resulting in the original weights file.
    (If this is the initial weights entry, i.e. it does not have a <code><a href="#WeightsEntryDescrBase.parent">parent</a></code>)
Or the person(s) who have converted the weights to this weights format.
    (If this is a child weight, i.e. it has a <code><a href="#WeightsEntryDescrBase.parent">parent</a></code> field)</p>
</div>


                            </div>
                            <div id="WeightsEntryDescrBase.parent" class="classattr">
                                <div class="attr variable">
            <span class="name">parent</span><span class="annotation">: Annotated[Optional[Literal[&#39;keras_hdf5&#39;, &#39;onnx&#39;, &#39;pytorch_state_dict&#39;, &#39;tensorflow_js&#39;, &#39;tensorflow_saved_model_bundle&#39;, &#39;torchscript&#39;]], FieldInfo(annotation=NoneType, required=True, examples=[&#39;pytorch_state_dict&#39;])]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.parent"></a>
    
            <div class="docstring"><p>The source weights these weights were converted from.
For example, if a model's weights were converted from the <code>pytorch_state_dict</code> format to <code>torchscript</code>,
The <code>pytorch_state_dict</code> weights entry has no <code><a href="#WeightsEntryDescrBase.parent">parent</a></code> and is the parent of the <code>torchscript</code> weights.
All weight entries except one (the initial set of weights resulting from training the model),
need to have this field.</p>
</div>


                            </div>
                            <div id="WeightsEntryDescrBase.comment" class="classattr">
                                <div class="attr variable">
            <span class="name">comment</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#WeightsEntryDescrBase.comment"></a>
    
            <div class="docstring"><p>A comment about this weights entry, for example how these weights were created.</p>
</div>


                            </div>
                </section>
                <section id="KerasHdf5WeightsDescr">
                            <input id="KerasHdf5WeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KerasHdf5WeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="KerasHdf5WeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerasHdf5WeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerasHdf5WeightsDescr-2357"><a href="#KerasHdf5WeightsDescr-2357"><span class="linenos">2357</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KerasHdf5WeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="KerasHdf5WeightsDescr-2358"><a href="#KerasHdf5WeightsDescr-2358"><span class="linenos">2358</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;keras_hdf5&quot;</span>
</span><span id="KerasHdf5WeightsDescr-2359"><a href="#KerasHdf5WeightsDescr-2359"><span class="linenos">2359</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Keras HDF5&quot;</span>
</span><span id="KerasHdf5WeightsDescr-2360"><a href="#KerasHdf5WeightsDescr-2360"><span class="linenos">2360</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="KerasHdf5WeightsDescr-2361"><a href="#KerasHdf5WeightsDescr-2361"><span class="linenos">2361</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TensorFlow version used to create these weights.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="KerasHdf5WeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;keras_hdf5&#39;</span>

        
    </div>
    <a class="headerlink" href="#KerasHdf5WeightsDescr.type"></a>
    
    

                            </div>
                            <div id="KerasHdf5WeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;Keras HDF5&#39;</span>

        
    </div>
    <a class="headerlink" href="#KerasHdf5WeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="KerasHdf5WeightsDescr.tensorflow_version" class="classattr">
                                <div class="attr variable">
            <span class="name">tensorflow_version</span><span class="annotation">: bioimageio.spec._internal.version_type.Version</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#KerasHdf5WeightsDescr.tensorflow_version"></a>
    
            <div class="docstring"><p>TensorFlow version used to create these weights.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="KerasHdf5WeightsDescr.source" class="variable"><a href="#WeightsEntryDescrBase.source">source</a></dd>
                <dd id="KerasHdf5WeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="KerasHdf5WeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="KerasHdf5WeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FileDescr_external_data">
                    <div class="attr variable">
            <span class="name">FileDescr_external_data</span>        =
<input id="FileDescr_external_data-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="FileDescr_external_data-view-value"></label><span class="default_value">typing.Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=&#39;.data&#39;, case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[{&#39;source&#39;: &#39;weights.onnx.data&#39;}])]</span>

        
    </div>
    <a class="headerlink" href="#FileDescr_external_data"></a>
    
    

                </section>
                <section id="OnnxWeightsDescr">
                            <input id="OnnxWeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">OnnxWeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="OnnxWeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OnnxWeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OnnxWeightsDescr-2371"><a href="#OnnxWeightsDescr-2371"><span class="linenos">2371</span></a><span class="k">class</span><span class="w"> </span><span class="nc">OnnxWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="OnnxWeightsDescr-2372"><a href="#OnnxWeightsDescr-2372"><span class="linenos">2372</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;onnx&quot;</span>
</span><span id="OnnxWeightsDescr-2373"><a href="#OnnxWeightsDescr-2373"><span class="linenos">2373</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ONNX&quot;</span>
</span><span id="OnnxWeightsDescr-2374"><a href="#OnnxWeightsDescr-2374"><span class="linenos">2374</span></a>    <span class="n">opset_version</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
</span><span id="OnnxWeightsDescr-2375"><a href="#OnnxWeightsDescr-2375"><span class="linenos">2375</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ONNX opset version&quot;&quot;&quot;</span>
</span><span id="OnnxWeightsDescr-2376"><a href="#OnnxWeightsDescr-2376"><span class="linenos">2376</span></a>
</span><span id="OnnxWeightsDescr-2377"><a href="#OnnxWeightsDescr-2377"><span class="linenos">2377</span></a>    <span class="n">external_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_external_data</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="OnnxWeightsDescr-2378"><a href="#OnnxWeightsDescr-2378"><span class="linenos">2378</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source of the external ONNX data file holding the weights.</span>
</span><span id="OnnxWeightsDescr-2379"><a href="#OnnxWeightsDescr-2379"><span class="linenos">2379</span></a><span class="sd">    (If present **source** holds the ONNX architecture without weights).&quot;&quot;&quot;</span>
</span><span id="OnnxWeightsDescr-2380"><a href="#OnnxWeightsDescr-2380"><span class="linenos">2380</span></a>
</span><span id="OnnxWeightsDescr-2381"><a href="#OnnxWeightsDescr-2381"><span class="linenos">2381</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="OnnxWeightsDescr-2382"><a href="#OnnxWeightsDescr-2382"><span class="linenos">2382</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_external_data_unique_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="OnnxWeightsDescr-2383"><a href="#OnnxWeightsDescr-2383"><span class="linenos">2383</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="OnnxWeightsDescr-2384"><a href="#OnnxWeightsDescr-2384"><span class="linenos">2384</span></a>            <span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</span><span id="OnnxWeightsDescr-2385"><a href="#OnnxWeightsDescr-2385"><span class="linenos">2385</span></a>            <span class="o">==</span> <span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_data</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</span><span id="OnnxWeightsDescr-2386"><a href="#OnnxWeightsDescr-2386"><span class="linenos">2386</span></a>        <span class="p">):</span>
</span><span id="OnnxWeightsDescr-2387"><a href="#OnnxWeightsDescr-2387"><span class="linenos">2387</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="OnnxWeightsDescr-2388"><a href="#OnnxWeightsDescr-2388"><span class="linenos">2388</span></a>                <span class="sa">f</span><span class="s2">&quot;ONNX `external_data` file name &#39;</span><span class="si">{</span><span class="n">extract_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_data</span><span class="o">.</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="OnnxWeightsDescr-2389"><a href="#OnnxWeightsDescr-2389"><span class="linenos">2389</span></a>                <span class="o">+</span> <span class="s2">&quot; must be different from ONNX `source` file name.&quot;</span>
</span><span id="OnnxWeightsDescr-2390"><a href="#OnnxWeightsDescr-2390"><span class="linenos">2390</span></a>            <span class="p">)</span>
</span><span id="OnnxWeightsDescr-2391"><a href="#OnnxWeightsDescr-2391"><span class="linenos">2391</span></a>
</span><span id="OnnxWeightsDescr-2392"><a href="#OnnxWeightsDescr-2392"><span class="linenos">2392</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="OnnxWeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;onnx&#39;</span>

        
    </div>
    <a class="headerlink" href="#OnnxWeightsDescr.type"></a>
    
    

                            </div>
                            <div id="OnnxWeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;ONNX&#39;</span>

        
    </div>
    <a class="headerlink" href="#OnnxWeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="OnnxWeightsDescr.opset_version" class="classattr">
                                <div class="attr variable">
            <span class="name">opset_version</span><span class="annotation">: Annotated[int, Ge(ge=7)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#OnnxWeightsDescr.opset_version"></a>
    
            <div class="docstring"><p>ONNX opset version</p>
</div>


                            </div>
                            <div id="OnnxWeightsDescr.external_data" class="classattr">
                                <div class="attr variable">
            <span class="name">external_data</span><span class="annotation">: Optional[Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer at 0x7fc593b72020&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=&#39;.data&#39;, case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[{&#39;source&#39;: &#39;weights.onnx.data&#39;}])]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#OnnxWeightsDescr.external_data"></a>
    
            <div class="docstring"><p>Source of the external ONNX data file holding the weights.
(If present <strong>source</strong> holds the ONNX architecture without weights).</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="OnnxWeightsDescr.source" class="variable"><a href="#WeightsEntryDescrBase.source">source</a></dd>
                <dd id="OnnxWeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="OnnxWeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="OnnxWeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PytorchStateDictWeightsDescr">
                            <input id="PytorchStateDictWeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PytorchStateDictWeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="PytorchStateDictWeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PytorchStateDictWeightsDescr-2395"><a href="#PytorchStateDictWeightsDescr-2395"><span class="linenos">2395</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PytorchStateDictWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="PytorchStateDictWeightsDescr-2396"><a href="#PytorchStateDictWeightsDescr-2396"><span class="linenos">2396</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;pytorch_state_dict&quot;</span>
</span><span id="PytorchStateDictWeightsDescr-2397"><a href="#PytorchStateDictWeightsDescr-2397"><span class="linenos">2397</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Pytorch State Dict&quot;</span>
</span><span id="PytorchStateDictWeightsDescr-2398"><a href="#PytorchStateDictWeightsDescr-2398"><span class="linenos">2398</span></a>    <span class="n">architecture</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ArchitectureFromFileDescr</span><span class="p">,</span> <span class="n">ArchitectureFromLibraryDescr</span><span class="p">]</span>
</span><span id="PytorchStateDictWeightsDescr-2399"><a href="#PytorchStateDictWeightsDescr-2399"><span class="linenos">2399</span></a>    <span class="n">pytorch_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="PytorchStateDictWeightsDescr-2400"><a href="#PytorchStateDictWeightsDescr-2400"><span class="linenos">2400</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the PyTorch library used.</span>
</span><span id="PytorchStateDictWeightsDescr-2401"><a href="#PytorchStateDictWeightsDescr-2401"><span class="linenos">2401</span></a><span class="sd">    If `architecture.depencencies` is specified it has to include pytorch and any version pinning has to be compatible.</span>
</span><span id="PytorchStateDictWeightsDescr-2402"><a href="#PytorchStateDictWeightsDescr-2402"><span class="linenos">2402</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PytorchStateDictWeightsDescr-2403"><a href="#PytorchStateDictWeightsDescr-2403"><span class="linenos">2403</span></a>    <span class="n">dependencies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_dependencies</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PytorchStateDictWeightsDescr-2404"><a href="#PytorchStateDictWeightsDescr-2404"><span class="linenos">2404</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom depencies beyond pytorch described in a Conda environment file.</span>
</span><span id="PytorchStateDictWeightsDescr-2405"><a href="#PytorchStateDictWeightsDescr-2405"><span class="linenos">2405</span></a><span class="sd">    Allows to specify custom dependencies, see conda docs:</span>
</span><span id="PytorchStateDictWeightsDescr-2406"><a href="#PytorchStateDictWeightsDescr-2406"><span class="linenos">2406</span></a><span class="sd">    - [Exporting an environment file across platforms](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#exporting-an-environment-file-across-platforms)</span>
</span><span id="PytorchStateDictWeightsDescr-2407"><a href="#PytorchStateDictWeightsDescr-2407"><span class="linenos">2407</span></a><span class="sd">    - [Creating an environment file manually](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-file-manually)</span>
</span><span id="PytorchStateDictWeightsDescr-2408"><a href="#PytorchStateDictWeightsDescr-2408"><span class="linenos">2408</span></a>
</span><span id="PytorchStateDictWeightsDescr-2409"><a href="#PytorchStateDictWeightsDescr-2409"><span class="linenos">2409</span></a><span class="sd">    The conda environment file should include pytorch and any version pinning has to be compatible with</span>
</span><span id="PytorchStateDictWeightsDescr-2410"><a href="#PytorchStateDictWeightsDescr-2410"><span class="linenos">2410</span></a><span class="sd">    **pytorch_version**.</span>
</span><span id="PytorchStateDictWeightsDescr-2411"><a href="#PytorchStateDictWeightsDescr-2411"><span class="linenos">2411</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="PytorchStateDictWeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;pytorch_state_dict&#39;</span>

        
    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr.type"></a>
    
    

                            </div>
                            <div id="PytorchStateDictWeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;Pytorch State Dict&#39;</span>

        
    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="PytorchStateDictWeightsDescr.architecture" class="classattr">
                                <div class="attr variable">
            <span class="name">architecture</span><span class="annotation">: Union[<a href="#ArchitectureFromFileDescr">ArchitectureFromFileDescr</a>, <a href="#ArchitectureFromLibraryDescr">ArchitectureFromLibraryDescr</a>]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr.architecture"></a>
    
    

                            </div>
                            <div id="PytorchStateDictWeightsDescr.pytorch_version" class="classattr">
                                <div class="attr variable">
            <span class="name">pytorch_version</span><span class="annotation">: bioimageio.spec._internal.version_type.Version</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr.pytorch_version"></a>
    
            <div class="docstring"><p>Version of the PyTorch library used.
If <code>architecture.depencencies</code> is specified it has to include pytorch and any version pinning has to be compatible.</p>
</div>


                            </div>
                            <div id="PytorchStateDictWeightsDescr.dependencies" class="classattr">
                                <div class="attr variable">
            <span class="name">dependencies</span><span class="annotation">: Optional[Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer at 0x7fc593b72020&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=(&#39;.yaml&#39;, &#39;.yml&#39;), case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[{&#39;source&#39;: &#39;environment.yaml&#39;}])]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PytorchStateDictWeightsDescr.dependencies"></a>
    
            <div class="docstring"><p>Custom depencies beyond pytorch described in a Conda environment file.
Allows to specify custom dependencies, see conda docs:</p>

<ul>
<li><a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#exporting-an-environment-file-across-platforms">Exporting an environment file across platforms</a></li>
<li><a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-file-manually">Creating an environment file manually</a></li>
</ul>

<p>The conda environment file should include pytorch and any version pinning has to be compatible with
<strong>pytorch_version</strong>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="PytorchStateDictWeightsDescr.source" class="variable"><a href="#WeightsEntryDescrBase.source">source</a></dd>
                <dd id="PytorchStateDictWeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="PytorchStateDictWeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="PytorchStateDictWeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TensorflowJsWeightsDescr">
                            <input id="TensorflowJsWeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorflowJsWeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="TensorflowJsWeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorflowJsWeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorflowJsWeightsDescr-2414"><a href="#TensorflowJsWeightsDescr-2414"><span class="linenos">2414</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorflowJsWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="TensorflowJsWeightsDescr-2415"><a href="#TensorflowJsWeightsDescr-2415"><span class="linenos">2415</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;tensorflow_js&quot;</span>
</span><span id="TensorflowJsWeightsDescr-2416"><a href="#TensorflowJsWeightsDescr-2416"><span class="linenos">2416</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tensorflow.js&quot;</span>
</span><span id="TensorflowJsWeightsDescr-2417"><a href="#TensorflowJsWeightsDescr-2417"><span class="linenos">2417</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="TensorflowJsWeightsDescr-2418"><a href="#TensorflowJsWeightsDescr-2418"><span class="linenos">2418</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the TensorFlow library used.&quot;&quot;&quot;</span>
</span><span id="TensorflowJsWeightsDescr-2419"><a href="#TensorflowJsWeightsDescr-2419"><span class="linenos">2419</span></a>
</span><span id="TensorflowJsWeightsDescr-2420"><a href="#TensorflowJsWeightsDescr-2420"><span class="linenos">2420</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="TensorflowJsWeightsDescr-2421"><a href="#TensorflowJsWeightsDescr-2421"><span class="linenos">2421</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The multi-file weights.</span>
</span><span id="TensorflowJsWeightsDescr-2422"><a href="#TensorflowJsWeightsDescr-2422"><span class="linenos">2422</span></a><span class="sd">    All required files/folders should be a zip archive.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="TensorflowJsWeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;tensorflow_js&#39;</span>

        
    </div>
    <a class="headerlink" href="#TensorflowJsWeightsDescr.type"></a>
    
    

                            </div>
                            <div id="TensorflowJsWeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;Tensorflow.js&#39;</span>

        
    </div>
    <a class="headerlink" href="#TensorflowJsWeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="TensorflowJsWeightsDescr.tensorflow_version" class="classattr">
                                <div class="attr variable">
            <span class="name">tensorflow_version</span><span class="annotation">: bioimageio.spec._internal.version_type.Version</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorflowJsWeightsDescr.tensorflow_version"></a>
    
            <div class="docstring"><p>Version of the TensorFlow library used.</p>
</div>


                            </div>
                            <div id="TensorflowJsWeightsDescr.source" class="classattr">
                                <div class="attr variable">
            <span class="name">source</span><span class="annotation">: Annotated[Union[bioimageio.spec._internal.url.HttpUrl, bioimageio.spec._internal.io.RelativeFilePath, Annotated[pathlib.Path, PathType(path_type=&#39;file&#39;), FieldInfo(annotation=NoneType, required=True, title=&#39;FilePath&#39;)]], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)]), AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorflowJsWeightsDescr.source"></a>
    
            <div class="docstring"><p>The multi-file weights.
All required files/folders should be a zip archive.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="TensorflowJsWeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="TensorflowJsWeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="TensorflowJsWeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TensorflowSavedModelBundleWeightsDescr">
                            <input id="TensorflowSavedModelBundleWeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorflowSavedModelBundleWeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="TensorflowSavedModelBundleWeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TensorflowSavedModelBundleWeightsDescr-2425"><a href="#TensorflowSavedModelBundleWeightsDescr-2425"><span class="linenos">2425</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TensorflowSavedModelBundleWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2426"><a href="#TensorflowSavedModelBundleWeightsDescr-2426"><span class="linenos">2426</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2427"><a href="#TensorflowSavedModelBundleWeightsDescr-2427"><span class="linenos">2427</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tensorflow Saved Model&quot;</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2428"><a href="#TensorflowSavedModelBundleWeightsDescr-2428"><span class="linenos">2428</span></a>    <span class="n">tensorflow_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2429"><a href="#TensorflowSavedModelBundleWeightsDescr-2429"><span class="linenos">2429</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the TensorFlow library used.&quot;&quot;&quot;</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2430"><a href="#TensorflowSavedModelBundleWeightsDescr-2430"><span class="linenos">2430</span></a>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2431"><a href="#TensorflowSavedModelBundleWeightsDescr-2431"><span class="linenos">2431</span></a>    <span class="n">dependencies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileDescr_dependencies</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2432"><a href="#TensorflowSavedModelBundleWeightsDescr-2432"><span class="linenos">2432</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom dependencies beyond tensorflow.</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2433"><a href="#TensorflowSavedModelBundleWeightsDescr-2433"><span class="linenos">2433</span></a><span class="sd">    Should include tensorflow and any version pinning has to be compatible with **tensorflow_version**.&quot;&quot;&quot;</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2434"><a href="#TensorflowSavedModelBundleWeightsDescr-2434"><span class="linenos">2434</span></a>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2435"><a href="#TensorflowSavedModelBundleWeightsDescr-2435"><span class="linenos">2435</span></a>    <span class="n">source</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">FileSource</span><span class="p">,</span> <span class="n">AfterValidator</span><span class="p">(</span><span class="n">wo_special_file_name</span><span class="p">)]</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2436"><a href="#TensorflowSavedModelBundleWeightsDescr-2436"><span class="linenos">2436</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The multi-file weights.</span>
</span><span id="TensorflowSavedModelBundleWeightsDescr-2437"><a href="#TensorflowSavedModelBundleWeightsDescr-2437"><span class="linenos">2437</span></a><span class="sd">    All required files/folders should be a zip archive.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="TensorflowSavedModelBundleWeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;tensorflow_saved_model_bundle&#39;</span>

        
    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr.type"></a>
    
    

                            </div>
                            <div id="TensorflowSavedModelBundleWeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;Tensorflow Saved Model&#39;</span>

        
    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="TensorflowSavedModelBundleWeightsDescr.tensorflow_version" class="classattr">
                                <div class="attr variable">
            <span class="name">tensorflow_version</span><span class="annotation">: bioimageio.spec._internal.version_type.Version</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr.tensorflow_version"></a>
    
            <div class="docstring"><p>Version of the TensorFlow library used.</p>
</div>


                            </div>
                            <div id="TensorflowSavedModelBundleWeightsDescr.dependencies" class="classattr">
                                <div class="attr variable">
            <span class="name">dependencies</span><span class="annotation">: Optional[Annotated[bioimageio.spec._internal.io.FileDescr, AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), WrapSerializer(func=&lt;function package_file_descr_serializer at 0x7fc593b72020&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=(&#39;.yaml&#39;, &#39;.yml&#39;), case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[{&#39;source&#39;: &#39;environment.yaml&#39;}])]]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr.dependencies"></a>
    
            <div class="docstring"><p>Custom dependencies beyond tensorflow.
Should include tensorflow and any version pinning has to be compatible with <strong>tensorflow_version</strong>.</p>
</div>


                            </div>
                            <div id="TensorflowSavedModelBundleWeightsDescr.source" class="classattr">
                                <div class="attr variable">
            <span class="name">source</span><span class="annotation">: Annotated[Union[bioimageio.spec._internal.url.HttpUrl, bioimageio.spec._internal.io.RelativeFilePath, Annotated[pathlib.Path, PathType(path_type=&#39;file&#39;), FieldInfo(annotation=NoneType, required=True, title=&#39;FilePath&#39;)]], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)]), AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TensorflowSavedModelBundleWeightsDescr.source"></a>
    
            <div class="docstring"><p>The multi-file weights.
All required files/folders should be a zip archive.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="TensorflowSavedModelBundleWeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="TensorflowSavedModelBundleWeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="TensorflowSavedModelBundleWeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TorchscriptWeightsDescr">
                            <input id="TorchscriptWeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TorchscriptWeightsDescr</span><wbr>(<span class="base"><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></span>):

                <label class="view-source-button" for="TorchscriptWeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TorchscriptWeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TorchscriptWeightsDescr-2440"><a href="#TorchscriptWeightsDescr-2440"><span class="linenos">2440</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TorchscriptWeightsDescr</span><span class="p">(</span><span class="n">WeightsEntryDescrBase</span><span class="p">):</span>
</span><span id="TorchscriptWeightsDescr-2441"><a href="#TorchscriptWeightsDescr-2441"><span class="linenos">2441</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;torchscript&quot;</span>
</span><span id="TorchscriptWeightsDescr-2442"><a href="#TorchscriptWeightsDescr-2442"><span class="linenos">2442</span></a>    <span class="n">weights_format_name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;TorchScript&quot;</span>
</span><span id="TorchscriptWeightsDescr-2443"><a href="#TorchscriptWeightsDescr-2443"><span class="linenos">2443</span></a>    <span class="n">pytorch_version</span><span class="p">:</span> <span class="n">Version</span>
</span><span id="TorchscriptWeightsDescr-2444"><a href="#TorchscriptWeightsDescr-2444"><span class="linenos">2444</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Version of the PyTorch library used.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A file description</p>
</div>


                            <div id="TorchscriptWeightsDescr.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;torchscript&#39;</span>

        
    </div>
    <a class="headerlink" href="#TorchscriptWeightsDescr.type"></a>
    
    

                            </div>
                            <div id="TorchscriptWeightsDescr.weights_format_name" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_format_name</span><span class="annotation">: ClassVar[str]</span>        =
<span class="default_value">&#39;TorchScript&#39;</span>

        
    </div>
    <a class="headerlink" href="#TorchscriptWeightsDescr.weights_format_name"></a>
    
    

                            </div>
                            <div id="TorchscriptWeightsDescr.pytorch_version" class="classattr">
                                <div class="attr variable">
            <span class="name">pytorch_version</span><span class="annotation">: bioimageio.spec._internal.version_type.Version</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#TorchscriptWeightsDescr.pytorch_version"></a>
    
            <div class="docstring"><p>Version of the PyTorch library used.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#WeightsEntryDescrBase">WeightsEntryDescrBase</a></dt>
                                <dd id="TorchscriptWeightsDescr.source" class="variable"><a href="#WeightsEntryDescrBase.source">source</a></dd>
                <dd id="TorchscriptWeightsDescr.authors" class="variable"><a href="#WeightsEntryDescrBase.authors">authors</a></dd>
                <dd id="TorchscriptWeightsDescr.parent" class="variable"><a href="#WeightsEntryDescrBase.parent">parent</a></dd>
                <dd id="TorchscriptWeightsDescr.comment" class="variable"><a href="#WeightsEntryDescrBase.comment">comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="WeightsDescr">
                            <input id="WeightsDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeightsDescr</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="WeightsDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeightsDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeightsDescr-2447"><a href="#WeightsDescr-2447"><span class="linenos">2447</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WeightsDescr</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="WeightsDescr-2448"><a href="#WeightsDescr-2448"><span class="linenos">2448</span></a>    <span class="n">keras_hdf5</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">KerasHdf5WeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2449"><a href="#WeightsDescr-2449"><span class="linenos">2449</span></a>    <span class="n">onnx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OnnxWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2450"><a href="#WeightsDescr-2450"><span class="linenos">2450</span></a>    <span class="n">pytorch_state_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PytorchStateDictWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2451"><a href="#WeightsDescr-2451"><span class="linenos">2451</span></a>    <span class="n">tensorflow_js</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorflowJsWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2452"><a href="#WeightsDescr-2452"><span class="linenos">2452</span></a>    <span class="n">tensorflow_saved_model_bundle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorflowSavedModelBundleWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="WeightsDescr-2453"><a href="#WeightsDescr-2453"><span class="linenos">2453</span></a>        <span class="kc">None</span>
</span><span id="WeightsDescr-2454"><a href="#WeightsDescr-2454"><span class="linenos">2454</span></a>    <span class="p">)</span>
</span><span id="WeightsDescr-2455"><a href="#WeightsDescr-2455"><span class="linenos">2455</span></a>    <span class="n">torchscript</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TorchscriptWeightsDescr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2456"><a href="#WeightsDescr-2456"><span class="linenos">2456</span></a>
</span><span id="WeightsDescr-2457"><a href="#WeightsDescr-2457"><span class="linenos">2457</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr-2458"><a href="#WeightsDescr-2458"><span class="linenos">2458</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="WeightsDescr-2459"><a href="#WeightsDescr-2459"><span class="linenos">2459</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="p">{</span><span class="n">wtype</span> <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="WeightsDescr-2460"><a href="#WeightsDescr-2460"><span class="linenos">2460</span></a>
</span><span id="WeightsDescr-2461"><a href="#WeightsDescr-2461"><span class="linenos">2461</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="WeightsDescr-2462"><a href="#WeightsDescr-2462"><span class="linenos">2462</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing weights entry&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr-2463"><a href="#WeightsDescr-2463"><span class="linenos">2463</span></a>
</span><span id="WeightsDescr-2464"><a href="#WeightsDescr-2464"><span class="linenos">2464</span></a>        <span class="n">entries_wo_parent</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="WeightsDescr-2465"><a href="#WeightsDescr-2465"><span class="linenos">2465</span></a>            <span class="n">wtype</span>
</span><span id="WeightsDescr-2466"><a href="#WeightsDescr-2466"><span class="linenos">2466</span></a>            <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span>
</span><span id="WeightsDescr-2467"><a href="#WeightsDescr-2467"><span class="linenos">2467</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2468"><a href="#WeightsDescr-2468"><span class="linenos">2468</span></a>        <span class="p">}</span>
</span><span id="WeightsDescr-2469"><a href="#WeightsDescr-2469"><span class="linenos">2469</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeightsDescr-2470"><a href="#WeightsDescr-2470"><span class="linenos">2470</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="WeightsDescr-2471"><a href="#WeightsDescr-2471"><span class="linenos">2471</span></a>                <span class="s2">&quot;Exactly one weights entry may not specify the `parent` field (got&quot;</span>
</span><span id="WeightsDescr-2472"><a href="#WeightsDescr-2472"><span class="linenos">2472</span></a>                <span class="o">+</span> <span class="s2">&quot; </span><span class="si">{value}</span><span class="s2">). That entry is considered the original set of model weights.&quot;</span>
</span><span id="WeightsDescr-2473"><a href="#WeightsDescr-2473"><span class="linenos">2473</span></a>                <span class="o">+</span> <span class="s2">&quot; Other weight formats are created through conversion of the orignal or&quot;</span>
</span><span id="WeightsDescr-2474"><a href="#WeightsDescr-2474"><span class="linenos">2474</span></a>                <span class="o">+</span> <span class="s2">&quot; already converted weights. They have to reference the weights format&quot;</span>
</span><span id="WeightsDescr-2475"><a href="#WeightsDescr-2475"><span class="linenos">2475</span></a>                <span class="o">+</span> <span class="s2">&quot; they were converted from as their `parent`.&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2476"><a href="#WeightsDescr-2476"><span class="linenos">2476</span></a>                <span class="n">value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">),</span>
</span><span id="WeightsDescr-2477"><a href="#WeightsDescr-2477"><span class="linenos">2477</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;weights&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2478"><a href="#WeightsDescr-2478"><span class="linenos">2478</span></a>            <span class="p">)</span>
</span><span id="WeightsDescr-2479"><a href="#WeightsDescr-2479"><span class="linenos">2479</span></a>
</span><span id="WeightsDescr-2480"><a href="#WeightsDescr-2480"><span class="linenos">2480</span></a>        <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="WeightsDescr-2481"><a href="#WeightsDescr-2481"><span class="linenos">2481</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeightsDescr-2482"><a href="#WeightsDescr-2482"><span class="linenos">2482</span></a>                <span class="k">continue</span>
</span><span id="WeightsDescr-2483"><a href="#WeightsDescr-2483"><span class="linenos">2483</span></a>
</span><span id="WeightsDescr-2484"><a href="#WeightsDescr-2484"><span class="linenos">2484</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr-2485"><a href="#WeightsDescr-2485"><span class="linenos">2485</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr-2486"><a href="#WeightsDescr-2486"><span class="linenos">2486</span></a>            <span class="k">assert</span> <span class="n">wtype</span> <span class="o">==</span> <span class="n">entry</span><span class="o">.</span><span class="n">type</span>
</span><span id="WeightsDescr-2487"><a href="#WeightsDescr-2487"><span class="linenos">2487</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="WeightsDescr-2488"><a href="#WeightsDescr-2488"><span class="linenos">2488</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entries</span>
</span><span id="WeightsDescr-2489"><a href="#WeightsDescr-2489"><span class="linenos">2489</span></a>            <span class="p">):</span>  <span class="c1"># self reference checked for `parent` field</span>
</span><span id="WeightsDescr-2490"><a href="#WeightsDescr-2490"><span class="linenos">2490</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeightsDescr-2491"><a href="#WeightsDescr-2491"><span class="linenos">2491</span></a>                    <span class="sa">f</span><span class="s2">&quot;`weights.</span><span class="si">{</span><span class="n">wtype</span><span class="si">}</span><span class="s2">.parent=</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2"> not in specified weight&quot;</span>
</span><span id="WeightsDescr-2492"><a href="#WeightsDescr-2492"><span class="linenos">2492</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; formats: </span><span class="si">{</span><span class="n">entries</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="WeightsDescr-2493"><a href="#WeightsDescr-2493"><span class="linenos">2493</span></a>                <span class="p">)</span>
</span><span id="WeightsDescr-2494"><a href="#WeightsDescr-2494"><span class="linenos">2494</span></a>
</span><span id="WeightsDescr-2495"><a href="#WeightsDescr-2495"><span class="linenos">2495</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="WeightsDescr-2496"><a href="#WeightsDescr-2496"><span class="linenos">2496</span></a>
</span><span id="WeightsDescr-2497"><a href="#WeightsDescr-2497"><span class="linenos">2497</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="WeightsDescr-2498"><a href="#WeightsDescr-2498"><span class="linenos">2498</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WeightsDescr-2499"><a href="#WeightsDescr-2499"><span class="linenos">2499</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="WeightsDescr-2500"><a href="#WeightsDescr-2500"><span class="linenos">2500</span></a>            <span class="s2">&quot;keras_hdf5&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2501"><a href="#WeightsDescr-2501"><span class="linenos">2501</span></a>            <span class="s2">&quot;onnx&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2502"><a href="#WeightsDescr-2502"><span class="linenos">2502</span></a>            <span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2503"><a href="#WeightsDescr-2503"><span class="linenos">2503</span></a>            <span class="s2">&quot;tensorflow_js&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2504"><a href="#WeightsDescr-2504"><span class="linenos">2504</span></a>            <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2505"><a href="#WeightsDescr-2505"><span class="linenos">2505</span></a>            <span class="s2">&quot;torchscript&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr-2506"><a href="#WeightsDescr-2506"><span class="linenos">2506</span></a>        <span class="p">],</span>
</span><span id="WeightsDescr-2507"><a href="#WeightsDescr-2507"><span class="linenos">2507</span></a>    <span class="p">):</span>
</span><span id="WeightsDescr-2508"><a href="#WeightsDescr-2508"><span class="linenos">2508</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;keras_hdf5&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2509"><a href="#WeightsDescr-2509"><span class="linenos">2509</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span>
</span><span id="WeightsDescr-2510"><a href="#WeightsDescr-2510"><span class="linenos">2510</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;onnx&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2511"><a href="#WeightsDescr-2511"><span class="linenos">2511</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span>
</span><span id="WeightsDescr-2512"><a href="#WeightsDescr-2512"><span class="linenos">2512</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2513"><a href="#WeightsDescr-2513"><span class="linenos">2513</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span>
</span><span id="WeightsDescr-2514"><a href="#WeightsDescr-2514"><span class="linenos">2514</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;tensorflow_js&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2515"><a href="#WeightsDescr-2515"><span class="linenos">2515</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span>
</span><span id="WeightsDescr-2516"><a href="#WeightsDescr-2516"><span class="linenos">2516</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2517"><a href="#WeightsDescr-2517"><span class="linenos">2517</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="WeightsDescr-2518"><a href="#WeightsDescr-2518"><span class="linenos">2518</span></a>        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;torchscript&quot;</span><span class="p">:</span>
</span><span id="WeightsDescr-2519"><a href="#WeightsDescr-2519"><span class="linenos">2519</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span>
</span><span id="WeightsDescr-2520"><a href="#WeightsDescr-2520"><span class="linenos">2520</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeightsDescr-2521"><a href="#WeightsDescr-2521"><span class="linenos">2521</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="WeightsDescr-2522"><a href="#WeightsDescr-2522"><span class="linenos">2522</span></a>
</span><span id="WeightsDescr-2523"><a href="#WeightsDescr-2523"><span class="linenos">2523</span></a>        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeightsDescr-2524"><a href="#WeightsDescr-2524"><span class="linenos">2524</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="WeightsDescr-2525"><a href="#WeightsDescr-2525"><span class="linenos">2525</span></a>
</span><span id="WeightsDescr-2526"><a href="#WeightsDescr-2526"><span class="linenos">2526</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="WeightsDescr-2527"><a href="#WeightsDescr-2527"><span class="linenos">2527</span></a>
</span><span id="WeightsDescr-2528"><a href="#WeightsDescr-2528"><span class="linenos">2528</span></a>    <span class="nd">@property</span>
</span><span id="WeightsDescr-2529"><a href="#WeightsDescr-2529"><span class="linenos">2529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeightsDescr-2530"><a href="#WeightsDescr-2530"><span class="linenos">2530</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="WeightsDescr-2531"><a href="#WeightsDescr-2531"><span class="linenos">2531</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;keras_hdf5&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span><span class="p">}),</span>
</span><span id="WeightsDescr-2532"><a href="#WeightsDescr-2532"><span class="linenos">2532</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;onnx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span><span class="p">}),</span>
</span><span id="WeightsDescr-2533"><a href="#WeightsDescr-2533"><span class="linenos">2533</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr-2534"><a href="#WeightsDescr-2534"><span class="linenos">2534</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr-2535"><a href="#WeightsDescr-2535"><span class="linenos">2535</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2536"><a href="#WeightsDescr-2536"><span class="linenos">2536</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span><span class="p">}</span>
</span><span id="WeightsDescr-2537"><a href="#WeightsDescr-2537"><span class="linenos">2537</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr-2538"><a href="#WeightsDescr-2538"><span class="linenos">2538</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr-2539"><a href="#WeightsDescr-2539"><span class="linenos">2539</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr-2540"><a href="#WeightsDescr-2540"><span class="linenos">2540</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2541"><a href="#WeightsDescr-2541"><span class="linenos">2541</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;tensorflow_js&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span><span class="p">}</span>
</span><span id="WeightsDescr-2542"><a href="#WeightsDescr-2542"><span class="linenos">2542</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr-2543"><a href="#WeightsDescr-2543"><span class="linenos">2543</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr-2544"><a href="#WeightsDescr-2544"><span class="linenos">2544</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr-2545"><a href="#WeightsDescr-2545"><span class="linenos">2545</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr-2546"><a href="#WeightsDescr-2546"><span class="linenos">2546</span></a>                <span class="k">else</span> <span class="p">{</span>
</span><span id="WeightsDescr-2547"><a href="#WeightsDescr-2547"><span class="linenos">2547</span></a>                    <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="WeightsDescr-2548"><a href="#WeightsDescr-2548"><span class="linenos">2548</span></a>                <span class="p">}</span>
</span><span id="WeightsDescr-2549"><a href="#WeightsDescr-2549"><span class="linenos">2549</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr-2550"><a href="#WeightsDescr-2550"><span class="linenos">2550</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;torchscript&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span><span class="p">}),</span>
</span><span id="WeightsDescr-2551"><a href="#WeightsDescr-2551"><span class="linenos">2551</span></a>        <span class="p">}</span>
</span><span id="WeightsDescr-2552"><a href="#WeightsDescr-2552"><span class="linenos">2552</span></a>
</span><span id="WeightsDescr-2553"><a href="#WeightsDescr-2553"><span class="linenos">2553</span></a>    <span class="nd">@property</span>
</span><span id="WeightsDescr-2554"><a href="#WeightsDescr-2554"><span class="linenos">2554</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">missing_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeightsDescr-2555"><a href="#WeightsDescr-2555"><span class="linenos">2555</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="WeightsDescr-2556"><a href="#WeightsDescr-2556"><span class="linenos">2556</span></a>            <span class="n">wf</span> <span class="k">for</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">WeightsFormat</span><span class="p">)</span> <span class="k">if</span> <span class="n">wf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_formats</span>
</span><span id="WeightsDescr-2557"><a href="#WeightsDescr-2557"><span class="linenos">2557</span></a>        <span class="p">}</span>
</span></pre></div>


    

                            <div id="WeightsDescr.keras_hdf5" class="classattr">
                                <div class="attr variable">
            <span class="name">keras_hdf5</span><span class="annotation">: Optional[<a href="#KerasHdf5WeightsDescr">KerasHdf5WeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.keras_hdf5"></a>
    
    

                            </div>
                            <div id="WeightsDescr.onnx" class="classattr">
                                <div class="attr variable">
            <span class="name">onnx</span><span class="annotation">: Optional[<a href="#OnnxWeightsDescr">OnnxWeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.onnx"></a>
    
    

                            </div>
                            <div id="WeightsDescr.pytorch_state_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">pytorch_state_dict</span><span class="annotation">: Optional[<a href="#PytorchStateDictWeightsDescr">PytorchStateDictWeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.pytorch_state_dict"></a>
    
    

                            </div>
                            <div id="WeightsDescr.tensorflow_js" class="classattr">
                                <div class="attr variable">
            <span class="name">tensorflow_js</span><span class="annotation">: Optional[<a href="#TensorflowJsWeightsDescr">TensorflowJsWeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.tensorflow_js"></a>
    
    

                            </div>
                            <div id="WeightsDescr.tensorflow_saved_model_bundle" class="classattr">
                                <div class="attr variable">
            <span class="name">tensorflow_saved_model_bundle</span><span class="annotation">: Optional[<a href="#TensorflowSavedModelBundleWeightsDescr">TensorflowSavedModelBundleWeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.tensorflow_saved_model_bundle"></a>
    
    

                            </div>
                            <div id="WeightsDescr.torchscript" class="classattr">
                                <div class="attr variable">
            <span class="name">torchscript</span><span class="annotation">: Optional[<a href="#TorchscriptWeightsDescr">TorchscriptWeightsDescr</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#WeightsDescr.torchscript"></a>
    
    

                            </div>
                            <div id="WeightsDescr.check_entries" class="classattr">
                                        <input id="WeightsDescr.check_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-model_validator">@model_validator(mode=&#39;after&#39;)</div>

        <span class="def">def</span>
        <span class="name">check_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="WeightsDescr.check_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeightsDescr.check_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeightsDescr.check_entries-2457"><a href="#WeightsDescr.check_entries-2457"><span class="linenos">2457</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2458"><a href="#WeightsDescr.check_entries-2458"><span class="linenos">2458</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="WeightsDescr.check_entries-2459"><a href="#WeightsDescr.check_entries-2459"><span class="linenos">2459</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="p">{</span><span class="n">wtype</span> <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="WeightsDescr.check_entries-2460"><a href="#WeightsDescr.check_entries-2460"><span class="linenos">2460</span></a>
</span><span id="WeightsDescr.check_entries-2461"><a href="#WeightsDescr.check_entries-2461"><span class="linenos">2461</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="WeightsDescr.check_entries-2462"><a href="#WeightsDescr.check_entries-2462"><span class="linenos">2462</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing weights entry&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2463"><a href="#WeightsDescr.check_entries-2463"><span class="linenos">2463</span></a>
</span><span id="WeightsDescr.check_entries-2464"><a href="#WeightsDescr.check_entries-2464"><span class="linenos">2464</span></a>        <span class="n">entries_wo_parent</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="WeightsDescr.check_entries-2465"><a href="#WeightsDescr.check_entries-2465"><span class="linenos">2465</span></a>            <span class="n">wtype</span>
</span><span id="WeightsDescr.check_entries-2466"><a href="#WeightsDescr.check_entries-2466"><span class="linenos">2466</span></a>            <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span>
</span><span id="WeightsDescr.check_entries-2467"><a href="#WeightsDescr.check_entries-2467"><span class="linenos">2467</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr.check_entries-2468"><a href="#WeightsDescr.check_entries-2468"><span class="linenos">2468</span></a>        <span class="p">}</span>
</span><span id="WeightsDescr.check_entries-2469"><a href="#WeightsDescr.check_entries-2469"><span class="linenos">2469</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeightsDescr.check_entries-2470"><a href="#WeightsDescr.check_entries-2470"><span class="linenos">2470</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="WeightsDescr.check_entries-2471"><a href="#WeightsDescr.check_entries-2471"><span class="linenos">2471</span></a>                <span class="s2">&quot;Exactly one weights entry may not specify the `parent` field (got&quot;</span>
</span><span id="WeightsDescr.check_entries-2472"><a href="#WeightsDescr.check_entries-2472"><span class="linenos">2472</span></a>                <span class="o">+</span> <span class="s2">&quot; </span><span class="si">{value}</span><span class="s2">). That entry is considered the original set of model weights.&quot;</span>
</span><span id="WeightsDescr.check_entries-2473"><a href="#WeightsDescr.check_entries-2473"><span class="linenos">2473</span></a>                <span class="o">+</span> <span class="s2">&quot; Other weight formats are created through conversion of the orignal or&quot;</span>
</span><span id="WeightsDescr.check_entries-2474"><a href="#WeightsDescr.check_entries-2474"><span class="linenos">2474</span></a>                <span class="o">+</span> <span class="s2">&quot; already converted weights. They have to reference the weights format&quot;</span>
</span><span id="WeightsDescr.check_entries-2475"><a href="#WeightsDescr.check_entries-2475"><span class="linenos">2475</span></a>                <span class="o">+</span> <span class="s2">&quot; they were converted from as their `parent`.&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr.check_entries-2476"><a href="#WeightsDescr.check_entries-2476"><span class="linenos">2476</span></a>                <span class="n">value</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries_wo_parent</span><span class="p">),</span>
</span><span id="WeightsDescr.check_entries-2477"><a href="#WeightsDescr.check_entries-2477"><span class="linenos">2477</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;weights&quot;</span><span class="p">,</span>
</span><span id="WeightsDescr.check_entries-2478"><a href="#WeightsDescr.check_entries-2478"><span class="linenos">2478</span></a>            <span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2479"><a href="#WeightsDescr.check_entries-2479"><span class="linenos">2479</span></a>
</span><span id="WeightsDescr.check_entries-2480"><a href="#WeightsDescr.check_entries-2480"><span class="linenos">2480</span></a>        <span class="k">for</span> <span class="n">wtype</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="WeightsDescr.check_entries-2481"><a href="#WeightsDescr.check_entries-2481"><span class="linenos">2481</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeightsDescr.check_entries-2482"><a href="#WeightsDescr.check_entries-2482"><span class="linenos">2482</span></a>                <span class="k">continue</span>
</span><span id="WeightsDescr.check_entries-2483"><a href="#WeightsDescr.check_entries-2483"><span class="linenos">2483</span></a>
</span><span id="WeightsDescr.check_entries-2484"><a href="#WeightsDescr.check_entries-2484"><span class="linenos">2484</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2485"><a href="#WeightsDescr.check_entries-2485"><span class="linenos">2485</span></a>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2486"><a href="#WeightsDescr.check_entries-2486"><span class="linenos">2486</span></a>            <span class="k">assert</span> <span class="n">wtype</span> <span class="o">==</span> <span class="n">entry</span><span class="o">.</span><span class="n">type</span>
</span><span id="WeightsDescr.check_entries-2487"><a href="#WeightsDescr.check_entries-2487"><span class="linenos">2487</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="WeightsDescr.check_entries-2488"><a href="#WeightsDescr.check_entries-2488"><span class="linenos">2488</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entries</span>
</span><span id="WeightsDescr.check_entries-2489"><a href="#WeightsDescr.check_entries-2489"><span class="linenos">2489</span></a>            <span class="p">):</span>  <span class="c1"># self reference checked for `parent` field</span>
</span><span id="WeightsDescr.check_entries-2490"><a href="#WeightsDescr.check_entries-2490"><span class="linenos">2490</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeightsDescr.check_entries-2491"><a href="#WeightsDescr.check_entries-2491"><span class="linenos">2491</span></a>                    <span class="sa">f</span><span class="s2">&quot;`weights.</span><span class="si">{</span><span class="n">wtype</span><span class="si">}</span><span class="s2">.parent=</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2"> not in specified weight&quot;</span>
</span><span id="WeightsDescr.check_entries-2492"><a href="#WeightsDescr.check_entries-2492"><span class="linenos">2492</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; formats: </span><span class="si">{</span><span class="n">entries</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="WeightsDescr.check_entries-2493"><a href="#WeightsDescr.check_entries-2493"><span class="linenos">2493</span></a>                <span class="p">)</span>
</span><span id="WeightsDescr.check_entries-2494"><a href="#WeightsDescr.check_entries-2494"><span class="linenos">2494</span></a>
</span><span id="WeightsDescr.check_entries-2495"><a href="#WeightsDescr.check_entries-2495"><span class="linenos">2495</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            </div>
                            <div id="WeightsDescr.available_formats" class="classattr">
                                        <input id="WeightsDescr.available_formats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">available_formats</span>

                <label class="view-source-button" for="WeightsDescr.available_formats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeightsDescr.available_formats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeightsDescr.available_formats-2528"><a href="#WeightsDescr.available_formats-2528"><span class="linenos">2528</span></a>    <span class="nd">@property</span>
</span><span id="WeightsDescr.available_formats-2529"><a href="#WeightsDescr.available_formats-2529"><span class="linenos">2529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeightsDescr.available_formats-2530"><a href="#WeightsDescr.available_formats-2530"><span class="linenos">2530</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="WeightsDescr.available_formats-2531"><a href="#WeightsDescr.available_formats-2531"><span class="linenos">2531</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;keras_hdf5&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">keras_hdf5</span><span class="p">}),</span>
</span><span id="WeightsDescr.available_formats-2532"><a href="#WeightsDescr.available_formats-2532"><span class="linenos">2532</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;onnx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onnx</span><span class="p">}),</span>
</span><span id="WeightsDescr.available_formats-2533"><a href="#WeightsDescr.available_formats-2533"><span class="linenos">2533</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr.available_formats-2534"><a href="#WeightsDescr.available_formats-2534"><span class="linenos">2534</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr.available_formats-2535"><a href="#WeightsDescr.available_formats-2535"><span class="linenos">2535</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr.available_formats-2536"><a href="#WeightsDescr.available_formats-2536"><span class="linenos">2536</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;pytorch_state_dict&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pytorch_state_dict</span><span class="p">}</span>
</span><span id="WeightsDescr.available_formats-2537"><a href="#WeightsDescr.available_formats-2537"><span class="linenos">2537</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr.available_formats-2538"><a href="#WeightsDescr.available_formats-2538"><span class="linenos">2538</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr.available_formats-2539"><a href="#WeightsDescr.available_formats-2539"><span class="linenos">2539</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr.available_formats-2540"><a href="#WeightsDescr.available_formats-2540"><span class="linenos">2540</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr.available_formats-2541"><a href="#WeightsDescr.available_formats-2541"><span class="linenos">2541</span></a>                <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;tensorflow_js&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_js</span><span class="p">}</span>
</span><span id="WeightsDescr.available_formats-2542"><a href="#WeightsDescr.available_formats-2542"><span class="linenos">2542</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr.available_formats-2543"><a href="#WeightsDescr.available_formats-2543"><span class="linenos">2543</span></a>            <span class="o">**</span><span class="p">(</span>
</span><span id="WeightsDescr.available_formats-2544"><a href="#WeightsDescr.available_formats-2544"><span class="linenos">2544</span></a>                <span class="p">{}</span>
</span><span id="WeightsDescr.available_formats-2545"><a href="#WeightsDescr.available_formats-2545"><span class="linenos">2545</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="WeightsDescr.available_formats-2546"><a href="#WeightsDescr.available_formats-2546"><span class="linenos">2546</span></a>                <span class="k">else</span> <span class="p">{</span>
</span><span id="WeightsDescr.available_formats-2547"><a href="#WeightsDescr.available_formats-2547"><span class="linenos">2547</span></a>                    <span class="s2">&quot;tensorflow_saved_model_bundle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tensorflow_saved_model_bundle</span>
</span><span id="WeightsDescr.available_formats-2548"><a href="#WeightsDescr.available_formats-2548"><span class="linenos">2548</span></a>                <span class="p">}</span>
</span><span id="WeightsDescr.available_formats-2549"><a href="#WeightsDescr.available_formats-2549"><span class="linenos">2549</span></a>            <span class="p">),</span>
</span><span id="WeightsDescr.available_formats-2550"><a href="#WeightsDescr.available_formats-2550"><span class="linenos">2550</span></a>            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;torchscript&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">torchscript</span><span class="p">}),</span>
</span><span id="WeightsDescr.available_formats-2551"><a href="#WeightsDescr.available_formats-2551"><span class="linenos">2551</span></a>        <span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="WeightsDescr.missing_formats" class="classattr">
                                        <input id="WeightsDescr.missing_formats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">missing_formats</span>

                <label class="view-source-button" for="WeightsDescr.missing_formats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeightsDescr.missing_formats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeightsDescr.missing_formats-2553"><a href="#WeightsDescr.missing_formats-2553"><span class="linenos">2553</span></a>    <span class="nd">@property</span>
</span><span id="WeightsDescr.missing_formats-2554"><a href="#WeightsDescr.missing_formats-2554"><span class="linenos">2554</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">missing_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeightsDescr.missing_formats-2555"><a href="#WeightsDescr.missing_formats-2555"><span class="linenos">2555</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="WeightsDescr.missing_formats-2556"><a href="#WeightsDescr.missing_formats-2556"><span class="linenos">2556</span></a>            <span class="n">wf</span> <span class="k">for</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">WeightsFormat</span><span class="p">)</span> <span class="k">if</span> <span class="n">wf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_formats</span>
</span><span id="WeightsDescr.missing_formats-2557"><a href="#WeightsDescr.missing_formats-2557"><span class="linenos">2557</span></a>        <span class="p">}</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="ModelId">
                            <input id="ModelId-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ModelId</span><wbr>(<span class="base"><a href="../generic/v0_3.html#ResourceId">bioimageio.spec.generic.v0_3.ResourceId</a></span>):

                <label class="view-source-button" for="ModelId-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelId"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelId-2560"><a href="#ModelId-2560"><span class="linenos">2560</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelId</span><span class="p">(</span><span class="n">ResourceId</span><span class="p">):</span>
</span><span id="ModelId-2561"><a href="#ModelId-2561"><span class="linenos">2561</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>str(object='') -> str
str(bytes_or_buffer[, encoding[, errors]]) -> str</p>

<p>Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.__str__() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to 'strict'.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../generic/v0_3.html#ResourceId">bioimageio.spec.generic.v0_3.ResourceId</a></dt>
                                <dd id="ModelId.root_model" class="variable"><a href="../generic/v0_3.html#ResourceId.root_model">root_model</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="LinkedModel">
                            <input id="LinkedModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LinkedModel</span><wbr>(<span class="base"><a href="../generic/v0_3.html#LinkedResourceBase">bioimageio.spec.generic.v0_3.LinkedResourceBase</a></span>):

                <label class="view-source-button" for="LinkedModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinkedModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinkedModel-2564"><a href="#LinkedModel-2564"><span class="linenos">2564</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LinkedModel</span><span class="p">(</span><span class="n">LinkedResourceBase</span><span class="p">):</span>
</span><span id="LinkedModel-2565"><a href="#LinkedModel-2565"><span class="linenos">2565</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reference to a bioimage.io model.&quot;&quot;&quot;</span>
</span><span id="LinkedModel-2566"><a href="#LinkedModel-2566"><span class="linenos">2566</span></a>
</span><span id="LinkedModel-2567"><a href="#LinkedModel-2567"><span class="linenos">2567</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">ModelId</span>
</span><span id="LinkedModel-2568"><a href="#LinkedModel-2568"><span class="linenos">2568</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A valid model `id` from the bioimage.io collection.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Reference to a bioimage.io model.</p>
</div>


                            <div id="LinkedModel.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: <a href="#ModelId">ModelId</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#LinkedModel.id"></a>
    
            <div class="docstring"><p>A valid model <code><a href="#LinkedModel.id">id</a></code> from the bioimage.io collection.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../generic/v0_3.html#LinkedResourceBase">bioimageio.spec.generic.v0_3.LinkedResourceBase</a></dt>
                                <dd id="LinkedModel.version" class="variable"><a href="../generic/v0_3.html#LinkedResourceBase.version">version</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ReproducibilityTolerance">
                            <input id="ReproducibilityTolerance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReproducibilityTolerance</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="ReproducibilityTolerance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReproducibilityTolerance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReproducibilityTolerance-2590"><a href="#ReproducibilityTolerance-2590"><span class="linenos">2590</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReproducibilityTolerance</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="ReproducibilityTolerance-2591"><a href="#ReproducibilityTolerance-2591"><span class="linenos">2591</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes what small numerical differences -- if any -- may be tolerated</span>
</span><span id="ReproducibilityTolerance-2592"><a href="#ReproducibilityTolerance-2592"><span class="linenos">2592</span></a><span class="sd">    in the generated output when executing in different environments.</span>
</span><span id="ReproducibilityTolerance-2593"><a href="#ReproducibilityTolerance-2593"><span class="linenos">2593</span></a>
</span><span id="ReproducibilityTolerance-2594"><a href="#ReproducibilityTolerance-2594"><span class="linenos">2594</span></a><span class="sd">    A tensor element *output* is considered mismatched to the **test_tensor** if</span>
</span><span id="ReproducibilityTolerance-2595"><a href="#ReproducibilityTolerance-2595"><span class="linenos">2595</span></a><span class="sd">    abs(*output* - **test_tensor**) &gt; **absolute_tolerance** + **relative_tolerance** * abs(**test_tensor**).</span>
</span><span id="ReproducibilityTolerance-2596"><a href="#ReproducibilityTolerance-2596"><span class="linenos">2596</span></a><span class="sd">    (Internally we call [numpy.testing.assert_allclose](https://numpy.org/doc/stable/reference/generated/numpy.testing.assert_allclose.html).)</span>
</span><span id="ReproducibilityTolerance-2597"><a href="#ReproducibilityTolerance-2597"><span class="linenos">2597</span></a>
</span><span id="ReproducibilityTolerance-2598"><a href="#ReproducibilityTolerance-2598"><span class="linenos">2598</span></a><span class="sd">    Motivation:</span>
</span><span id="ReproducibilityTolerance-2599"><a href="#ReproducibilityTolerance-2599"><span class="linenos">2599</span></a><span class="sd">        For testing we can request the respective deep learning frameworks to be as</span>
</span><span id="ReproducibilityTolerance-2600"><a href="#ReproducibilityTolerance-2600"><span class="linenos">2600</span></a><span class="sd">        reproducible as possible by setting seeds and chosing deterministic algorithms,</span>
</span><span id="ReproducibilityTolerance-2601"><a href="#ReproducibilityTolerance-2601"><span class="linenos">2601</span></a><span class="sd">        but differences in operating systems, available hardware and installed drivers</span>
</span><span id="ReproducibilityTolerance-2602"><a href="#ReproducibilityTolerance-2602"><span class="linenos">2602</span></a><span class="sd">        may still lead to numerical differences.</span>
</span><span id="ReproducibilityTolerance-2603"><a href="#ReproducibilityTolerance-2603"><span class="linenos">2603</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReproducibilityTolerance-2604"><a href="#ReproducibilityTolerance-2604"><span class="linenos">2604</span></a>
</span><span id="ReproducibilityTolerance-2605"><a href="#ReproducibilityTolerance-2605"><span class="linenos">2605</span></a>    <span class="n">relative_tolerance</span><span class="p">:</span> <span class="n">RelativeTolerance</span> <span class="o">=</span> <span class="mf">1e-3</span>
</span><span id="ReproducibilityTolerance-2606"><a href="#ReproducibilityTolerance-2606"><span class="linenos">2606</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum relative tolerance of reproduced test tensor.&quot;&quot;&quot;</span>
</span><span id="ReproducibilityTolerance-2607"><a href="#ReproducibilityTolerance-2607"><span class="linenos">2607</span></a>
</span><span id="ReproducibilityTolerance-2608"><a href="#ReproducibilityTolerance-2608"><span class="linenos">2608</span></a>    <span class="n">absolute_tolerance</span><span class="p">:</span> <span class="n">AbsoluteTolerance</span> <span class="o">=</span> <span class="mf">1e-4</span>
</span><span id="ReproducibilityTolerance-2609"><a href="#ReproducibilityTolerance-2609"><span class="linenos">2609</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum absolute tolerance of reproduced test tensor.&quot;&quot;&quot;</span>
</span><span id="ReproducibilityTolerance-2610"><a href="#ReproducibilityTolerance-2610"><span class="linenos">2610</span></a>
</span><span id="ReproducibilityTolerance-2611"><a href="#ReproducibilityTolerance-2611"><span class="linenos">2611</span></a>    <span class="n">mismatched_elements_per_million</span><span class="p">:</span> <span class="n">MismatchedElementsPerMillion</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="ReproducibilityTolerance-2612"><a href="#ReproducibilityTolerance-2612"><span class="linenos">2612</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of mismatched elements/pixels per million to tolerate.&quot;&quot;&quot;</span>
</span><span id="ReproducibilityTolerance-2613"><a href="#ReproducibilityTolerance-2613"><span class="linenos">2613</span></a>
</span><span id="ReproducibilityTolerance-2614"><a href="#ReproducibilityTolerance-2614"><span class="linenos">2614</span></a>    <span class="n">output_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="ReproducibilityTolerance-2615"><a href="#ReproducibilityTolerance-2615"><span class="linenos">2615</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Limits the output tensor IDs these reproducibility details apply to.&quot;&quot;&quot;</span>
</span><span id="ReproducibilityTolerance-2616"><a href="#ReproducibilityTolerance-2616"><span class="linenos">2616</span></a>
</span><span id="ReproducibilityTolerance-2617"><a href="#ReproducibilityTolerance-2617"><span class="linenos">2617</span></a>    <span class="n">weights_formats</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">WeightsFormat</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="ReproducibilityTolerance-2618"><a href="#ReproducibilityTolerance-2618"><span class="linenos">2618</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Limits the weights formats these details apply to.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Describes what small numerical differences -- if any -- may be tolerated
in the generated output when executing in different environments.</p>

<p>A tensor element <em>output</em> is considered mismatched to the <strong>test_tensor</strong> if
abs(<em>output</em> - <strong>test_tensor</strong>) &gt; <strong>absolute_tolerance</strong> + <strong>relative_tolerance</strong> * abs(<strong>test_tensor</strong>).
(Internally we call <a href="https://numpy.org/doc/stable/reference/generated/numpy.testing.assert_allclose.html">numpy.testing.assert_allclose</a>.)</p>

<h6 id="motivation">Motivation:</h6>

<blockquote>
  <p>For testing we can request the respective deep learning frameworks to be as
  reproducible as possible by setting seeds and chosing deterministic algorithms,
  but differences in operating systems, available hardware and installed drivers
  may still lead to numerical differences.</p>
</blockquote>
</div>


                            <div id="ReproducibilityTolerance.relative_tolerance" class="classattr">
                                <div class="attr variable">
            <span class="name">relative_tolerance</span><span class="annotation">: Annotated[float, Interval(gt=None, ge=0, lt=None, le=0.01)]</span>        =
<span class="default_value">0.001</span>

        
    </div>
    <a class="headerlink" href="#ReproducibilityTolerance.relative_tolerance"></a>
    
            <div class="docstring"><p>Maximum relative tolerance of reproduced test tensor.</p>
</div>


                            </div>
                            <div id="ReproducibilityTolerance.absolute_tolerance" class="classattr">
                                <div class="attr variable">
            <span class="name">absolute_tolerance</span><span class="annotation">: Annotated[float, Interval(gt=None, ge=0, lt=None, le=None)]</span>        =
<span class="default_value">0.0001</span>

        
    </div>
    <a class="headerlink" href="#ReproducibilityTolerance.absolute_tolerance"></a>
    
            <div class="docstring"><p>Maximum absolute tolerance of reproduced test tensor.</p>
</div>


                            </div>
                            <div id="ReproducibilityTolerance.mismatched_elements_per_million" class="classattr">
                                <div class="attr variable">
            <span class="name">mismatched_elements_per_million</span><span class="annotation">: Annotated[int, Interval(gt=None, ge=0, lt=None, le=1000)]</span>        =
<span class="default_value">100</span>

        
    </div>
    <a class="headerlink" href="#ReproducibilityTolerance.mismatched_elements_per_million"></a>
    
            <div class="docstring"><p>Maximum number of mismatched elements/pixels per million to tolerate.</p>
</div>


                            </div>
                            <div id="ReproducibilityTolerance.output_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">output_ids</span><span class="annotation">: Sequence[<a href="#TensorId">TensorId</a>]</span>        =
<span class="default_value">()</span>

        
    </div>
    <a class="headerlink" href="#ReproducibilityTolerance.output_ids"></a>
    
            <div class="docstring"><p>Limits the output tensor IDs these reproducibility details apply to.</p>
</div>


                            </div>
                            <div id="ReproducibilityTolerance.weights_formats" class="classattr">
                                <div class="attr variable">
            <span class="name">weights_formats</span><span class="annotation">: Sequence[Literal[&#39;keras_hdf5&#39;, &#39;onnx&#39;, &#39;pytorch_state_dict&#39;, &#39;tensorflow_js&#39;, &#39;tensorflow_saved_model_bundle&#39;, &#39;torchscript&#39;]]</span>        =
<span class="default_value">()</span>

        
    </div>
    <a class="headerlink" href="#ReproducibilityTolerance.weights_formats"></a>
    
            <div class="docstring"><p>Limits the weights formats these details apply to.</p>
</div>


                            </div>
                </section>
                <section id="BioimageioConfig">
                            <input id="BioimageioConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BioimageioConfig</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="BioimageioConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BioimageioConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BioimageioConfig-2621"><a href="#BioimageioConfig-2621"><span class="linenos">2621</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BioimageioConfig</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="BioimageioConfig-2622"><a href="#BioimageioConfig-2622"><span class="linenos">2622</span></a>    <span class="n">reproducibility_tolerance</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ReproducibilityTolerance</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="BioimageioConfig-2623"><a href="#BioimageioConfig-2623"><span class="linenos">2623</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Tolerances to allow when reproducing the model&#39;s test outputs</span>
</span><span id="BioimageioConfig-2624"><a href="#BioimageioConfig-2624"><span class="linenos">2624</span></a><span class="sd">    from the model&#39;s test inputs.</span>
</span><span id="BioimageioConfig-2625"><a href="#BioimageioConfig-2625"><span class="linenos">2625</span></a><span class="sd">    Only the first entry matching tensor id and weights format is considered.</span>
</span><span id="BioimageioConfig-2626"><a href="#BioimageioConfig-2626"><span class="linenos">2626</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="BioimageioConfig.reproducibility_tolerance" class="classattr">
                                <div class="attr variable">
            <span class="name">reproducibility_tolerance</span><span class="annotation">: Sequence[<a href="#ReproducibilityTolerance">ReproducibilityTolerance</a>]</span>        =
<span class="default_value">()</span>

        
    </div>
    <a class="headerlink" href="#BioimageioConfig.reproducibility_tolerance"></a>
    
            <div class="docstring"><p>Tolerances to allow when reproducing the model's test outputs
from the model's test inputs.
Only the first entry matching tensor id and weights format is considered.</p>
</div>


                            </div>
                </section>
                <section id="Config">
                            <input id="Config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Config</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>):

                <label class="view-source-button" for="Config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Config-2629"><a href="#Config-2629"><span class="linenos">2629</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">):</span>
</span><span id="Config-2630"><a href="#Config-2630"><span class="linenos">2630</span></a>    <span class="n">bioimageio</span><span class="p">:</span> <span class="n">BioimageioConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="Config-2631"><a href="#Config-2631"><span class="linenos">2631</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">BioimageioConfig</span><span class="o">.</span><span class="n">model_construct</span>
</span><span id="Config-2632"><a href="#Config-2632"><span class="linenos">2632</span></a>    <span class="p">)</span>
</span></pre></div>


    

                            <div id="Config.bioimageio" class="classattr">
                                <div class="attr variable">
            <span class="name">bioimageio</span><span class="annotation">: <a href="#BioimageioConfig">BioimageioConfig</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#Config.bioimageio"></a>
    
    

                            </div>
                </section>
                <section id="ModelDescr">
                            <input id="ModelDescr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ModelDescr</span><wbr>(<span class="base"><a href="../generic/v0_3.html#GenericModelDescrBase">bioimageio.spec.generic.v0_3.GenericModelDescrBase</a></span>):

                <label class="view-source-button" for="ModelDescr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr-2635"><a href="#ModelDescr-2635"><span class="linenos">2635</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelDescr</span><span class="p">(</span><span class="n">GenericModelDescrBase</span><span class="p">):</span>
</span><span id="ModelDescr-2636"><a href="#ModelDescr-2636"><span class="linenos">2636</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Specification of the fields used in a bioimage.io-compliant RDF to describe AI models with pretrained weights.</span>
</span><span id="ModelDescr-2637"><a href="#ModelDescr-2637"><span class="linenos">2637</span></a><span class="sd">    These fields are typically stored in a YAML file which we call a model resource description file (model RDF).</span>
</span><span id="ModelDescr-2638"><a href="#ModelDescr-2638"><span class="linenos">2638</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ModelDescr-2639"><a href="#ModelDescr-2639"><span class="linenos">2639</span></a>
</span><span id="ModelDescr-2640"><a href="#ModelDescr-2640"><span class="linenos">2640</span></a>    <span class="n">implemented_format_version</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;0.5.6&quot;</span>
</span><span id="ModelDescr-2641"><a href="#ModelDescr-2641"><span class="linenos">2641</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ModelDescr-2642"><a href="#ModelDescr-2642"><span class="linenos">2642</span></a>        <span class="n">format_version</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0.5.6&quot;</span>
</span><span id="ModelDescr-2643"><a href="#ModelDescr-2643"><span class="linenos">2643</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-2644"><a href="#ModelDescr-2644"><span class="linenos">2644</span></a>        <span class="n">format_version</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;0.5.6&quot;</span><span class="p">]</span>
</span><span id="ModelDescr-2645"><a href="#ModelDescr-2645"><span class="linenos">2645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of the bioimage.io model description specification used.</span>
</span><span id="ModelDescr-2646"><a href="#ModelDescr-2646"><span class="linenos">2646</span></a><span class="sd">        When creating a new model always use the latest micro/patch version described here.</span>
</span><span id="ModelDescr-2647"><a href="#ModelDescr-2647"><span class="linenos">2647</span></a><span class="sd">        The `format_version` is important for any consumer software to understand how to parse the fields.</span>
</span><span id="ModelDescr-2648"><a href="#ModelDescr-2648"><span class="linenos">2648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelDescr-2649"><a href="#ModelDescr-2649"><span class="linenos">2649</span></a>
</span><span id="ModelDescr-2650"><a href="#ModelDescr-2650"><span class="linenos">2650</span></a>    <span class="n">implemented_type</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>
</span><span id="ModelDescr-2651"><a href="#ModelDescr-2651"><span class="linenos">2651</span></a>    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="ModelDescr-2652"><a href="#ModelDescr-2652"><span class="linenos">2652</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>
</span><span id="ModelDescr-2653"><a href="#ModelDescr-2653"><span class="linenos">2653</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-2654"><a href="#ModelDescr-2654"><span class="linenos">2654</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="ModelDescr-2655"><a href="#ModelDescr-2655"><span class="linenos">2655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Specialized resource type &#39;model&#39;&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2656"><a href="#ModelDescr-2656"><span class="linenos">2656</span></a>
</span><span id="ModelDescr-2657"><a href="#ModelDescr-2657"><span class="linenos">2657</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-2658"><a href="#ModelDescr-2658"><span class="linenos">2658</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;bioimage.io-wide unique resource identifier</span>
</span><span id="ModelDescr-2659"><a href="#ModelDescr-2659"><span class="linenos">2659</span></a><span class="sd">    assigned by bioimage.io; version **un**specific.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2660"><a href="#ModelDescr-2660"><span class="linenos">2660</span></a>
</span><span id="ModelDescr-2661"><a href="#ModelDescr-2661"><span class="linenos">2661</span></a>    <span class="n">authors</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ModelDescr-2662"><a href="#ModelDescr-2662"><span class="linenos">2662</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="ModelDescr-2663"><a href="#ModelDescr-2663"><span class="linenos">2663</span></a>    <span class="p">)</span>
</span><span id="ModelDescr-2664"><a href="#ModelDescr-2664"><span class="linenos">2664</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The authors are the creators of the model RDF and the primary points of contact.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2665"><a href="#ModelDescr-2665"><span class="linenos">2665</span></a>
</span><span id="ModelDescr-2666"><a href="#ModelDescr-2666"><span class="linenos">2666</span></a>    <span class="n">documentation</span><span class="p">:</span> <span class="n">FAIR</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-2667"><a href="#ModelDescr-2667"><span class="linenos">2667</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;URL or relative path to a markdown file with additional documentation.</span>
</span><span id="ModelDescr-2668"><a href="#ModelDescr-2668"><span class="linenos">2668</span></a><span class="sd">    The recommended documentation file name is `README.md`. An `.md` suffix is mandatory.</span>
</span><span id="ModelDescr-2669"><a href="#ModelDescr-2669"><span class="linenos">2669</span></a><span class="sd">    The documentation should include a &#39;#[#] Validation&#39; (sub)section</span>
</span><span id="ModelDescr-2670"><a href="#ModelDescr-2670"><span class="linenos">2670</span></a><span class="sd">    with details on how to quantitatively validate the model on unseen data.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2671"><a href="#ModelDescr-2671"><span class="linenos">2671</span></a>
</span><span id="ModelDescr-2672"><a href="#ModelDescr-2672"><span class="linenos">2672</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;documentation&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2673"><a href="#ModelDescr-2673"><span class="linenos">2673</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-2674"><a href="#ModelDescr-2674"><span class="linenos">2674</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_documentation</span><span class="p">(</span>
</span><span id="ModelDescr-2675"><a href="#ModelDescr-2675"><span class="linenos">2675</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]</span>
</span><span id="ModelDescr-2676"><a href="#ModelDescr-2676"><span class="linenos">2676</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileSource_documentation</span><span class="p">]:</span>
</span><span id="ModelDescr-2677"><a href="#ModelDescr-2677"><span class="linenos">2677</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-2678"><a href="#ModelDescr-2678"><span class="linenos">2678</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="ModelDescr-2679"><a href="#ModelDescr-2679"><span class="linenos">2679</span></a>
</span><span id="ModelDescr-2680"><a href="#ModelDescr-2680"><span class="linenos">2680</span></a>        <span class="n">doc_reader</span> <span class="o">=</span> <span class="n">get_reader</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ModelDescr-2681"><a href="#ModelDescr-2681"><span class="linenos">2681</span></a>        <span class="n">doc_content</span> <span class="o">=</span> <span class="n">doc_reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2682"><a href="#ModelDescr-2682"><span class="linenos">2682</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;#.*[vV]alidation&quot;</span><span class="p">,</span> <span class="n">doc_content</span><span class="p">):</span>
</span><span id="ModelDescr-2683"><a href="#ModelDescr-2683"><span class="linenos">2683</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="ModelDescr-2684"><a href="#ModelDescr-2684"><span class="linenos">2684</span></a>                <span class="s2">&quot;No &#39;# Validation&#39; (sub)section found in </span><span class="si">{value}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-2685"><a href="#ModelDescr-2685"><span class="linenos">2685</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
</span><span id="ModelDescr-2686"><a href="#ModelDescr-2686"><span class="linenos">2686</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;documentation&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-2687"><a href="#ModelDescr-2687"><span class="linenos">2687</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2688"><a href="#ModelDescr-2688"><span class="linenos">2688</span></a>
</span><span id="ModelDescr-2689"><a href="#ModelDescr-2689"><span class="linenos">2689</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="ModelDescr-2690"><a href="#ModelDescr-2690"><span class="linenos">2690</span></a>
</span><span id="ModelDescr-2691"><a href="#ModelDescr-2691"><span class="linenos">2691</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]]</span>
</span><span id="ModelDescr-2692"><a href="#ModelDescr-2692"><span class="linenos">2692</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes the input tensors expected by this model.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2693"><a href="#ModelDescr-2693"><span class="linenos">2693</span></a>
</span><span id="ModelDescr-2694"><a href="#ModelDescr-2694"><span class="linenos">2694</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2695"><a href="#ModelDescr-2695"><span class="linenos">2695</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-2696"><a href="#ModelDescr-2696"><span class="linenos">2696</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_input_axes</span><span class="p">(</span>
</span><span id="ModelDescr-2697"><a href="#ModelDescr-2697"><span class="linenos">2697</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]</span>
</span><span id="ModelDescr-2698"><a href="#ModelDescr-2698"><span class="linenos">2698</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">]:</span>
</span><span id="ModelDescr-2699"><a href="#ModelDescr-2699"><span class="linenos">2699</span></a>        <span class="n">input_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="ModelDescr-2700"><a href="#ModelDescr-2700"><span class="linenos">2700</span></a>
</span><span id="ModelDescr-2701"><a href="#ModelDescr-2701"><span class="linenos">2701</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ipt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
</span><span id="ModelDescr-2702"><a href="#ModelDescr-2702"><span class="linenos">2702</span></a>            <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="ModelDescr-2703"><a href="#ModelDescr-2703"><span class="linenos">2703</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="ModelDescr-2704"><a href="#ModelDescr-2704"><span class="linenos">2704</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="ModelDescr-2705"><a href="#ModelDescr-2705"><span class="linenos">2705</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-2706"><a href="#ModelDescr-2706"><span class="linenos">2706</span></a>                <span class="o">**</span><span class="p">{</span>
</span><span id="ModelDescr-2707"><a href="#ModelDescr-2707"><span class="linenos">2707</span></a>                    <span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-2708"><a href="#ModelDescr-2708"><span class="linenos">2708</span></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ipt</span><span class="o">.</span><span class="n">axes</span>
</span><span id="ModelDescr-2709"><a href="#ModelDescr-2709"><span class="linenos">2709</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr-2710"><a href="#ModelDescr-2710"><span class="linenos">2710</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="ModelDescr-2711"><a href="#ModelDescr-2711"><span class="linenos">2711</span></a>                <span class="p">},</span>
</span><span id="ModelDescr-2712"><a href="#ModelDescr-2712"><span class="linenos">2712</span></a>                <span class="o">**</span><span class="n">input_size_refs</span><span class="p">,</span>
</span><span id="ModelDescr-2713"><a href="#ModelDescr-2713"><span class="linenos">2713</span></a>            <span class="p">}</span>
</span><span id="ModelDescr-2714"><a href="#ModelDescr-2714"><span class="linenos">2714</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ModelDescr-2715"><a href="#ModelDescr-2715"><span class="linenos">2715</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_axis</span><span class="p">(</span>
</span><span id="ModelDescr-2716"><a href="#ModelDescr-2716"><span class="linenos">2716</span></a>                    <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-2717"><a href="#ModelDescr-2717"><span class="linenos">2717</span></a>                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="ModelDescr-2718"><a href="#ModelDescr-2718"><span class="linenos">2718</span></a>                    <span class="n">tensor_id</span><span class="o">=</span><span class="n">ipt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-2719"><a href="#ModelDescr-2719"><span class="linenos">2719</span></a>                    <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
</span><span id="ModelDescr-2720"><a href="#ModelDescr-2720"><span class="linenos">2720</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="ModelDescr-2721"><a href="#ModelDescr-2721"><span class="linenos">2721</span></a>                    <span class="n">valid_independent_refs</span><span class="o">=</span><span class="n">valid_independent_refs</span><span class="p">,</span>
</span><span id="ModelDescr-2722"><a href="#ModelDescr-2722"><span class="linenos">2722</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2723"><a href="#ModelDescr-2723"><span class="linenos">2723</span></a>        <span class="k">return</span> <span class="n">inputs</span>
</span><span id="ModelDescr-2724"><a href="#ModelDescr-2724"><span class="linenos">2724</span></a>
</span><span id="ModelDescr-2725"><a href="#ModelDescr-2725"><span class="linenos">2725</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr-2726"><a href="#ModelDescr-2726"><span class="linenos">2726</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_axis</span><span class="p">(</span>
</span><span id="ModelDescr-2727"><a href="#ModelDescr-2727"><span class="linenos">2727</span></a>        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModelDescr-2728"><a href="#ModelDescr-2728"><span class="linenos">2728</span></a>        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ModelDescr-2729"><a href="#ModelDescr-2729"><span class="linenos">2729</span></a>        <span class="n">tensor_id</span><span class="p">:</span> <span class="n">TensorId</span><span class="p">,</span>
</span><span id="ModelDescr-2730"><a href="#ModelDescr-2730"><span class="linenos">2730</span></a>        <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ModelDescr-2731"><a href="#ModelDescr-2731"><span class="linenos">2731</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="n">AnyAxis</span><span class="p">,</span>
</span><span id="ModelDescr-2732"><a href="#ModelDescr-2732"><span class="linenos">2732</span></a>        <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="ModelDescr-2733"><a href="#ModelDescr-2733"><span class="linenos">2733</span></a>            <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="ModelDescr-2734"><a href="#ModelDescr-2734"><span class="linenos">2734</span></a>            <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="ModelDescr-2735"><a href="#ModelDescr-2735"><span class="linenos">2735</span></a>        <span class="p">],</span>
</span><span id="ModelDescr-2736"><a href="#ModelDescr-2736"><span class="linenos">2736</span></a>    <span class="p">):</span>
</span><span id="ModelDescr-2737"><a href="#ModelDescr-2737"><span class="linenos">2737</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="ModelDescr-2738"><a href="#ModelDescr-2738"><span class="linenos">2738</span></a>            <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">)</span>
</span><span id="ModelDescr-2739"><a href="#ModelDescr-2739"><span class="linenos">2739</span></a>        <span class="p">):</span>
</span><span id="ModelDescr-2740"><a href="#ModelDescr-2740"><span class="linenos">2740</span></a>            <span class="k">return</span>
</span><span id="ModelDescr-2741"><a href="#ModelDescr-2741"><span class="linenos">2741</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr-2742"><a href="#ModelDescr-2742"><span class="linenos">2742</span></a>            <span class="n">assert_never</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-2743"><a href="#ModelDescr-2743"><span class="linenos">2743</span></a>
</span><span id="ModelDescr-2744"><a href="#ModelDescr-2744"><span class="linenos">2744</span></a>        <span class="c1"># validate axis.size SizeReference</span>
</span><span id="ModelDescr-2745"><a href="#ModelDescr-2745"><span class="linenos">2745</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">)</span>
</span><span id="ModelDescr-2746"><a href="#ModelDescr-2746"><span class="linenos">2746</span></a>        <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_independent_refs</span><span class="p">:</span>
</span><span id="ModelDescr-2747"><a href="#ModelDescr-2747"><span class="linenos">2747</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2748"><a href="#ModelDescr-2748"><span class="linenos">2748</span></a>                <span class="s2">&quot;Invalid tensor axis reference at&quot;</span>
</span><span id="ModelDescr-2749"><a href="#ModelDescr-2749"><span class="linenos">2749</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">].axes[</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">].size: </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ModelDescr-2750"><a href="#ModelDescr-2750"><span class="linenos">2750</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2751"><a href="#ModelDescr-2751"><span class="linenos">2751</span></a>        <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="p">(</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
</span><span id="ModelDescr-2752"><a href="#ModelDescr-2752"><span class="linenos">2752</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2753"><a href="#ModelDescr-2753"><span class="linenos">2753</span></a>                <span class="s2">&quot;Self-referencing not allowed for&quot;</span>
</span><span id="ModelDescr-2754"><a href="#ModelDescr-2754"><span class="linenos">2754</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">].axes[</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">].size: </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ModelDescr-2755"><a href="#ModelDescr-2755"><span class="linenos">2755</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2756"><a href="#ModelDescr-2756"><span class="linenos">2756</span></a>        <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="ModelDescr-2757"><a href="#ModelDescr-2757"><span class="linenos">2757</span></a>            <span class="k">if</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span>
</span><span id="ModelDescr-2758"><a href="#ModelDescr-2758"><span class="linenos">2758</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2759"><a href="#ModelDescr-2759"><span class="linenos">2759</span></a>                    <span class="s2">&quot;A channel axis&#39; size may only reference another fixed size&quot;</span>
</span><span id="ModelDescr-2760"><a href="#ModelDescr-2760"><span class="linenos">2760</span></a>                    <span class="o">+</span> <span class="s2">&quot; channel axis.&quot;</span>
</span><span id="ModelDescr-2761"><a href="#ModelDescr-2761"><span class="linenos">2761</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2762"><a href="#ModelDescr-2762"><span class="linenos">2762</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="si">{i}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="p">:</span>
</span><span id="ModelDescr-2763"><a href="#ModelDescr-2763"><span class="linenos">2763</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ModelDescr-2764"><a href="#ModelDescr-2764"><span class="linenos">2764</span></a>                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span>
</span><span id="ModelDescr-2765"><a href="#ModelDescr-2765"><span class="linenos">2765</span></a>                    <span class="s2">&quot;channel axis ref (another channel axis) has to specify fixed&quot;</span>
</span><span id="ModelDescr-2766"><a href="#ModelDescr-2766"><span class="linenos">2766</span></a>                    <span class="o">+</span> <span class="s2">&quot; size&quot;</span>
</span><span id="ModelDescr-2767"><a href="#ModelDescr-2767"><span class="linenos">2767</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2768"><a href="#ModelDescr-2768"><span class="linenos">2768</span></a>                <span class="n">generated_channel_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ModelDescr-2769"><a href="#ModelDescr-2769"><span class="linenos">2769</span></a>                    <span class="n">Identifier</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
</span><span id="ModelDescr-2770"><a href="#ModelDescr-2770"><span class="linenos">2770</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ref_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ModelDescr-2771"><a href="#ModelDescr-2771"><span class="linenos">2771</span></a>                <span class="p">]</span>
</span><span id="ModelDescr-2772"><a href="#ModelDescr-2772"><span class="linenos">2772</span></a>                <span class="n">axis</span><span class="o">.</span><span class="n">channel_names</span> <span class="o">=</span> <span class="n">generated_channel_names</span>
</span><span id="ModelDescr-2773"><a href="#ModelDescr-2773"><span class="linenos">2773</span></a>
</span><span id="ModelDescr-2774"><a href="#ModelDescr-2774"><span class="linenos">2774</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ax_unit</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span>
</span><span id="ModelDescr-2775"><a href="#ModelDescr-2775"><span class="linenos">2775</span></a>            <span class="n">ref_unit</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ModelDescr-2776"><a href="#ModelDescr-2776"><span class="linenos">2776</span></a>        <span class="p">):</span>
</span><span id="ModelDescr-2777"><a href="#ModelDescr-2777"><span class="linenos">2777</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2778"><a href="#ModelDescr-2778"><span class="linenos">2778</span></a>                <span class="s2">&quot;The units of an axis and its reference axis need to match, but&quot;</span>
</span><span id="ModelDescr-2779"><a href="#ModelDescr-2779"><span class="linenos">2779</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">ax_unit</span><span class="si">}</span><span class="s2">&#39; != &#39;</span><span class="si">{</span><span class="n">ref_unit</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="ModelDescr-2780"><a href="#ModelDescr-2780"><span class="linenos">2780</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2781"><a href="#ModelDescr-2781"><span class="linenos">2781</span></a>        <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">valid_independent_refs</span><span class="p">[</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ModelDescr-2782"><a href="#ModelDescr-2782"><span class="linenos">2782</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="ModelDescr-2783"><a href="#ModelDescr-2783"><span class="linenos">2783</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2784"><a href="#ModelDescr-2784"><span class="linenos">2784</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid reference axis &#39;</span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ModelDescr-2785"><a href="#ModelDescr-2785"><span class="linenos">2785</span></a>                <span class="o">+</span> <span class="s2">&quot; (a batch axis is not allowed as reference).&quot;</span>
</span><span id="ModelDescr-2786"><a href="#ModelDescr-2786"><span class="linenos">2786</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2787"><a href="#ModelDescr-2787"><span class="linenos">2787</span></a>
</span><span id="ModelDescr-2788"><a href="#ModelDescr-2788"><span class="linenos">2788</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">WithHalo</span><span class="p">):</span>
</span><span id="ModelDescr-2789"><a href="#ModelDescr-2789"><span class="linenos">2789</span></a>            <span class="n">min_size</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ModelDescr-2790"><a href="#ModelDescr-2790"><span class="linenos">2790</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">min_size</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ModelDescr-2791"><a href="#ModelDescr-2791"><span class="linenos">2791</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2792"><a href="#ModelDescr-2792"><span class="linenos">2792</span></a>                    <span class="sa">f</span><span class="s2">&quot;axis </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> with minimum size </span><span class="si">{</span><span class="n">min_size</span><span class="si">}</span><span class="s2"> is too small for halo&quot;</span>
</span><span id="ModelDescr-2793"><a href="#ModelDescr-2793"><span class="linenos">2793</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ModelDescr-2794"><a href="#ModelDescr-2794"><span class="linenos">2794</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2795"><a href="#ModelDescr-2795"><span class="linenos">2795</span></a>
</span><span id="ModelDescr-2796"><a href="#ModelDescr-2796"><span class="linenos">2796</span></a>            <span class="n">input_halo</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">halo</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">scale</span> <span class="o">/</span> <span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span>
</span><span id="ModelDescr-2797"><a href="#ModelDescr-2797"><span class="linenos">2797</span></a>            <span class="k">if</span> <span class="n">input_halo</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_halo</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_halo</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ModelDescr-2798"><a href="#ModelDescr-2798"><span class="linenos">2798</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2799"><a href="#ModelDescr-2799"><span class="linenos">2799</span></a>                    <span class="sa">f</span><span class="s2">&quot;input_halo </span><span class="si">{</span><span class="n">input_halo</span><span class="si">}</span><span class="s2"> (output_halo </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">halo</span><span class="si">}</span><span class="s2"> *&quot;</span>
</span><span id="ModelDescr-2800"><a href="#ModelDescr-2800"><span class="linenos">2800</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; output_scale </span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2"> / input_scale </span><span class="si">{</span><span class="n">ref_axis</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ModelDescr-2801"><a href="#ModelDescr-2801"><span class="linenos">2801</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">tensor_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">axis</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ModelDescr-2802"><a href="#ModelDescr-2802"><span class="linenos">2802</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2803"><a href="#ModelDescr-2803"><span class="linenos">2803</span></a>
</span><span id="ModelDescr-2804"><a href="#ModelDescr-2804"><span class="linenos">2804</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2805"><a href="#ModelDescr-2805"><span class="linenos">2805</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_test_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ModelDescr-2806"><a href="#ModelDescr-2806"><span class="linenos">2806</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span><span class="p">:</span>
</span><span id="ModelDescr-2807"><a href="#ModelDescr-2807"><span class="linenos">2807</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-2808"><a href="#ModelDescr-2808"><span class="linenos">2808</span></a>
</span><span id="ModelDescr-2809"><a href="#ModelDescr-2809"><span class="linenos">2809</span></a>        <span class="n">test_output_arrays</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ModelDescr-2810"><a href="#ModelDescr-2810"><span class="linenos">2810</span></a>            <span class="kc">None</span> <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">load_array</span><span class="p">(</span><span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="ModelDescr-2811"><a href="#ModelDescr-2811"><span class="linenos">2811</span></a>            <span class="k">for</span> <span class="n">descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="ModelDescr-2812"><a href="#ModelDescr-2812"><span class="linenos">2812</span></a>        <span class="p">]</span>
</span><span id="ModelDescr-2813"><a href="#ModelDescr-2813"><span class="linenos">2813</span></a>        <span class="n">test_input_arrays</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ModelDescr-2814"><a href="#ModelDescr-2814"><span class="linenos">2814</span></a>            <span class="kc">None</span> <span class="k">if</span> <span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">load_array</span><span class="p">(</span><span class="n">descr</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="ModelDescr-2815"><a href="#ModelDescr-2815"><span class="linenos">2815</span></a>            <span class="k">for</span> <span class="n">descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="ModelDescr-2816"><a href="#ModelDescr-2816"><span class="linenos">2816</span></a>        <span class="p">]</span>
</span><span id="ModelDescr-2817"><a href="#ModelDescr-2817"><span class="linenos">2817</span></a>
</span><span id="ModelDescr-2818"><a href="#ModelDescr-2818"><span class="linenos">2818</span></a>        <span class="n">tensors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-2819"><a href="#ModelDescr-2819"><span class="linenos">2819</span></a>            <span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="ModelDescr-2820"><a href="#ModelDescr-2820"><span class="linenos">2820</span></a>            <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="ModelDescr-2821"><a href="#ModelDescr-2821"><span class="linenos">2821</span></a>                <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">),</span> <span class="n">test_input_arrays</span> <span class="o">+</span> <span class="n">test_output_arrays</span>
</span><span id="ModelDescr-2822"><a href="#ModelDescr-2822"><span class="linenos">2822</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-2823"><a href="#ModelDescr-2823"><span class="linenos">2823</span></a>        <span class="p">}</span>
</span><span id="ModelDescr-2824"><a href="#ModelDescr-2824"><span class="linenos">2824</span></a>        <span class="n">validate_tensors</span><span class="p">(</span><span class="n">tensors</span><span class="p">,</span> <span class="n">tensor_origin</span><span class="o">=</span><span class="s2">&quot;test_tensor&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2825"><a href="#ModelDescr-2825"><span class="linenos">2825</span></a>
</span><span id="ModelDescr-2826"><a href="#ModelDescr-2826"><span class="linenos">2826</span></a>        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-2827"><a href="#ModelDescr-2827"><span class="linenos">2827</span></a>            <span class="n">descr</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">array</span> <span class="k">for</span> <span class="n">descr</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="n">test_output_arrays</span><span class="p">)</span>
</span><span id="ModelDescr-2828"><a href="#ModelDescr-2828"><span class="linenos">2828</span></a>        <span class="p">}</span>
</span><span id="ModelDescr-2829"><a href="#ModelDescr-2829"><span class="linenos">2829</span></a>        <span class="k">for</span> <span class="n">rep_tol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bioimageio</span><span class="o">.</span><span class="n">reproducibility_tolerance</span><span class="p">:</span>
</span><span id="ModelDescr-2830"><a href="#ModelDescr-2830"><span class="linenos">2830</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span><span class="p">:</span>
</span><span id="ModelDescr-2831"><a href="#ModelDescr-2831"><span class="linenos">2831</span></a>                <span class="k">continue</span>
</span><span id="ModelDescr-2832"><a href="#ModelDescr-2832"><span class="linenos">2832</span></a>
</span><span id="ModelDescr-2833"><a href="#ModelDescr-2833"><span class="linenos">2833</span></a>            <span class="k">if</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">output_ids</span><span class="p">:</span>
</span><span id="ModelDescr-2834"><a href="#ModelDescr-2834"><span class="linenos">2834</span></a>                <span class="n">out_arrays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-2835"><a href="#ModelDescr-2835"><span class="linenos">2835</span></a>                    <span class="n">oid</span><span class="p">:</span> <span class="n">a</span>
</span><span id="ModelDescr-2836"><a href="#ModelDescr-2836"><span class="linenos">2836</span></a>                    <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">output_arrays</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ModelDescr-2837"><a href="#ModelDescr-2837"><span class="linenos">2837</span></a>                    <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">output_ids</span>
</span><span id="ModelDescr-2838"><a href="#ModelDescr-2838"><span class="linenos">2838</span></a>                <span class="p">}</span>
</span><span id="ModelDescr-2839"><a href="#ModelDescr-2839"><span class="linenos">2839</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-2840"><a href="#ModelDescr-2840"><span class="linenos">2840</span></a>                <span class="n">out_arrays</span> <span class="o">=</span> <span class="n">output_arrays</span>
</span><span id="ModelDescr-2841"><a href="#ModelDescr-2841"><span class="linenos">2841</span></a>
</span><span id="ModelDescr-2842"><a href="#ModelDescr-2842"><span class="linenos">2842</span></a>            <span class="k">for</span> <span class="n">out_id</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">out_arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr-2843"><a href="#ModelDescr-2843"><span class="linenos">2843</span></a>                <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-2844"><a href="#ModelDescr-2844"><span class="linenos">2844</span></a>                    <span class="k">continue</span>
</span><span id="ModelDescr-2845"><a href="#ModelDescr-2845"><span class="linenos">2845</span></a>
</span><span id="ModelDescr-2846"><a href="#ModelDescr-2846"><span class="linenos">2846</span></a>                <span class="k">if</span> <span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">max_test_value</span> <span class="o">:=</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">:</span>
</span><span id="ModelDescr-2847"><a href="#ModelDescr-2847"><span class="linenos">2847</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2848"><a href="#ModelDescr-2848"><span class="linenos">2848</span></a>                        <span class="s2">&quot;config.bioimageio.reproducibility_tolerance.absolute_tolerance=&quot;</span>
</span><span id="ModelDescr-2849"><a href="#ModelDescr-2849"><span class="linenos">2849</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rep_tol</span><span class="o">.</span><span class="n">absolute_tolerance</span><span class="si">}</span><span class="s2"> &gt; 0.01*</span><span class="si">{</span><span class="n">max_test_value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ModelDescr-2850"><a href="#ModelDescr-2850"><span class="linenos">2850</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (1% of the maximum value of the test tensor &#39;</span><span class="si">{</span><span class="n">out_id</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span><span id="ModelDescr-2851"><a href="#ModelDescr-2851"><span class="linenos">2851</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-2852"><a href="#ModelDescr-2852"><span class="linenos">2852</span></a>
</span><span id="ModelDescr-2853"><a href="#ModelDescr-2853"><span class="linenos">2853</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-2854"><a href="#ModelDescr-2854"><span class="linenos">2854</span></a>
</span><span id="ModelDescr-2855"><a href="#ModelDescr-2855"><span class="linenos">2855</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2856"><a href="#ModelDescr-2856"><span class="linenos">2856</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tensor_references_in_proc_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ModelDescr-2857"><a href="#ModelDescr-2857"><span class="linenos">2857</span></a>        <span class="n">ipt_refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="ModelDescr-2858"><a href="#ModelDescr-2858"><span class="linenos">2858</span></a>        <span class="n">out_refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span><span id="ModelDescr-2859"><a href="#ModelDescr-2859"><span class="linenos">2859</span></a>        <span class="k">for</span> <span class="n">ipt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="ModelDescr-2860"><a href="#ModelDescr-2860"><span class="linenos">2860</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ipt</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
</span><span id="ModelDescr-2861"><a href="#ModelDescr-2861"><span class="linenos">2861</span></a>                <span class="n">ref</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference_tensor&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2862"><a href="#ModelDescr-2862"><span class="linenos">2862</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-2863"><a href="#ModelDescr-2863"><span class="linenos">2863</span></a>                    <span class="k">continue</span>
</span><span id="ModelDescr-2864"><a href="#ModelDescr-2864"><span class="linenos">2864</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ipt_refs</span><span class="p">:</span>
</span><span id="ModelDescr-2865"><a href="#ModelDescr-2865"><span class="linenos">2865</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2866"><a href="#ModelDescr-2866"><span class="linenos">2866</span></a>                        <span class="sa">f</span><span class="s2">&quot;`reference_tensor` &#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s2">&#39; not found. Valid input tensor&quot;</span>
</span><span id="ModelDescr-2867"><a href="#ModelDescr-2867"><span class="linenos">2867</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; references are: </span><span class="si">{</span><span class="n">ipt_refs</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ModelDescr-2868"><a href="#ModelDescr-2868"><span class="linenos">2868</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-2869"><a href="#ModelDescr-2869"><span class="linenos">2869</span></a>
</span><span id="ModelDescr-2870"><a href="#ModelDescr-2870"><span class="linenos">2870</span></a>        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="ModelDescr-2871"><a href="#ModelDescr-2871"><span class="linenos">2871</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">postprocessing</span><span class="p">:</span>
</span><span id="ModelDescr-2872"><a href="#ModelDescr-2872"><span class="linenos">2872</span></a>                <span class="n">ref</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference_tensor&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2873"><a href="#ModelDescr-2873"><span class="linenos">2873</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-2874"><a href="#ModelDescr-2874"><span class="linenos">2874</span></a>                    <span class="k">continue</span>
</span><span id="ModelDescr-2875"><a href="#ModelDescr-2875"><span class="linenos">2875</span></a>
</span><span id="ModelDescr-2876"><a href="#ModelDescr-2876"><span class="linenos">2876</span></a>                <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ipt_refs</span> <span class="ow">and</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out_refs</span><span class="p">:</span>
</span><span id="ModelDescr-2877"><a href="#ModelDescr-2877"><span class="linenos">2877</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-2878"><a href="#ModelDescr-2878"><span class="linenos">2878</span></a>                        <span class="sa">f</span><span class="s2">&quot;`reference_tensor` &#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s2">&#39; not found. Valid tensor references&quot;</span>
</span><span id="ModelDescr-2879"><a href="#ModelDescr-2879"><span class="linenos">2879</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; are: </span><span class="si">{</span><span class="n">ipt_refs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">out_refs</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ModelDescr-2880"><a href="#ModelDescr-2880"><span class="linenos">2880</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-2881"><a href="#ModelDescr-2881"><span class="linenos">2881</span></a>
</span><span id="ModelDescr-2882"><a href="#ModelDescr-2882"><span class="linenos">2882</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-2883"><a href="#ModelDescr-2883"><span class="linenos">2883</span></a>
</span><span id="ModelDescr-2884"><a href="#ModelDescr-2884"><span class="linenos">2884</span></a>    <span class="c1"># TODO: use validate funcs in validate_test_tensors</span>
</span><span id="ModelDescr-2885"><a href="#ModelDescr-2885"><span class="linenos">2885</span></a>    <span class="c1"># def validate_inputs(self, input_tensors: Mapping[TensorId, NDArray[Any]]) -&gt; Mapping[TensorId, NDArray[Any]]:</span>
</span><span id="ModelDescr-2886"><a href="#ModelDescr-2886"><span class="linenos">2886</span></a>
</span><span id="ModelDescr-2887"><a href="#ModelDescr-2887"><span class="linenos">2887</span></a>    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ModelDescr-2888"><a href="#ModelDescr-2888"><span class="linenos">2888</span></a>        <span class="nb">str</span><span class="p">,</span>
</span><span id="ModelDescr-2889"><a href="#ModelDescr-2889"><span class="linenos">2889</span></a>        <span class="n">RestrictCharacters</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&quot;_+- ()&quot;</span><span class="p">),</span>
</span><span id="ModelDescr-2890"><a href="#ModelDescr-2890"><span class="linenos">2890</span></a>        <span class="n">MinLen</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
</span><span id="ModelDescr-2891"><a href="#ModelDescr-2891"><span class="linenos">2891</span></a>        <span class="n">MaxLen</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
</span><span id="ModelDescr-2892"><a href="#ModelDescr-2892"><span class="linenos">2892</span></a>        <span class="n">warn</span><span class="p">(</span><span class="n">MaxLen</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="s2">&quot;Name longer than 64 characters.&quot;</span><span class="p">,</span> <span class="n">INFO</span><span class="p">),</span>
</span><span id="ModelDescr-2893"><a href="#ModelDescr-2893"><span class="linenos">2893</span></a>    <span class="p">]</span>
</span><span id="ModelDescr-2894"><a href="#ModelDescr-2894"><span class="linenos">2894</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A human-readable name of this model.</span>
</span><span id="ModelDescr-2895"><a href="#ModelDescr-2895"><span class="linenos">2895</span></a><span class="sd">    It should be no longer than 64 characters</span>
</span><span id="ModelDescr-2896"><a href="#ModelDescr-2896"><span class="linenos">2896</span></a><span class="sd">    and may only contain letter, number, underscore, minus, parentheses and spaces.</span>
</span><span id="ModelDescr-2897"><a href="#ModelDescr-2897"><span class="linenos">2897</span></a><span class="sd">    We recommend to chose a name that refers to the model&#39;s task and image modality.</span>
</span><span id="ModelDescr-2898"><a href="#ModelDescr-2898"><span class="linenos">2898</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ModelDescr-2899"><a href="#ModelDescr-2899"><span class="linenos">2899</span></a>
</span><span id="ModelDescr-2900"><a href="#ModelDescr-2900"><span class="linenos">2900</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">NotEmpty</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]]</span>
</span><span id="ModelDescr-2901"><a href="#ModelDescr-2901"><span class="linenos">2901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Describes the output tensors.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2902"><a href="#ModelDescr-2902"><span class="linenos">2902</span></a>
</span><span id="ModelDescr-2903"><a href="#ModelDescr-2903"><span class="linenos">2903</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2904"><a href="#ModelDescr-2904"><span class="linenos">2904</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-2905"><a href="#ModelDescr-2905"><span class="linenos">2905</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_tensor_ids</span><span class="p">(</span>
</span><span id="ModelDescr-2906"><a href="#ModelDescr-2906"><span class="linenos">2906</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">],</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
</span><span id="ModelDescr-2907"><a href="#ModelDescr-2907"><span class="linenos">2907</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]:</span>
</span><span id="ModelDescr-2908"><a href="#ModelDescr-2908"><span class="linenos">2908</span></a>        <span class="n">tensor_ids</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ModelDescr-2909"><a href="#ModelDescr-2909"><span class="linenos">2909</span></a>            <span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ModelDescr-2910"><a href="#ModelDescr-2910"><span class="linenos">2910</span></a>        <span class="p">]</span>
</span><span id="ModelDescr-2911"><a href="#ModelDescr-2911"><span class="linenos">2911</span></a>        <span class="n">duplicate_tensor_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ModelDescr-2912"><a href="#ModelDescr-2912"><span class="linenos">2912</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ModelDescr-2913"><a href="#ModelDescr-2913"><span class="linenos">2913</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tensor_ids</span><span class="p">:</span>
</span><span id="ModelDescr-2914"><a href="#ModelDescr-2914"><span class="linenos">2914</span></a>            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="ModelDescr-2915"><a href="#ModelDescr-2915"><span class="linenos">2915</span></a>                <span class="n">duplicate_tensor_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="ModelDescr-2916"><a href="#ModelDescr-2916"><span class="linenos">2916</span></a>
</span><span id="ModelDescr-2917"><a href="#ModelDescr-2917"><span class="linenos">2917</span></a>            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="ModelDescr-2918"><a href="#ModelDescr-2918"><span class="linenos">2918</span></a>
</span><span id="ModelDescr-2919"><a href="#ModelDescr-2919"><span class="linenos">2919</span></a>        <span class="k">if</span> <span class="n">duplicate_tensor_ids</span><span class="p">:</span>
</span><span id="ModelDescr-2920"><a href="#ModelDescr-2920"><span class="linenos">2920</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate tensor ids: </span><span class="si">{</span><span class="n">duplicate_tensor_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2921"><a href="#ModelDescr-2921"><span class="linenos">2921</span></a>
</span><span id="ModelDescr-2922"><a href="#ModelDescr-2922"><span class="linenos">2922</span></a>        <span class="k">return</span> <span class="n">outputs</span>
</span><span id="ModelDescr-2923"><a href="#ModelDescr-2923"><span class="linenos">2923</span></a>
</span><span id="ModelDescr-2924"><a href="#ModelDescr-2924"><span class="linenos">2924</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr-2925"><a href="#ModelDescr-2925"><span class="linenos">2925</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_axes_with_parameterized_size</span><span class="p">(</span>
</span><span id="ModelDescr-2926"><a href="#ModelDescr-2926"><span class="linenos">2926</span></a>        <span class="n">io</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="ModelDescr-2927"><a href="#ModelDescr-2927"><span class="linenos">2927</span></a>    <span class="p">):</span>
</span><span id="ModelDescr-2928"><a href="#ModelDescr-2928"><span class="linenos">2928</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ModelDescr-2929"><a href="#ModelDescr-2929"><span class="linenos">2929</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-2930"><a href="#ModelDescr-2930"><span class="linenos">2930</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">io</span>
</span><span id="ModelDescr-2931"><a href="#ModelDescr-2931"><span class="linenos">2931</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span>
</span><span id="ModelDescr-2932"><a href="#ModelDescr-2932"><span class="linenos">2932</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="ModelDescr-2933"><a href="#ModelDescr-2933"><span class="linenos">2933</span></a>        <span class="p">}</span>
</span><span id="ModelDescr-2934"><a href="#ModelDescr-2934"><span class="linenos">2934</span></a>
</span><span id="ModelDescr-2935"><a href="#ModelDescr-2935"><span class="linenos">2935</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr-2936"><a href="#ModelDescr-2936"><span class="linenos">2936</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_axes_with_independent_size</span><span class="p">(</span>
</span><span id="ModelDescr-2937"><a href="#ModelDescr-2937"><span class="linenos">2937</span></a>        <span class="n">io</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="ModelDescr-2938"><a href="#ModelDescr-2938"><span class="linenos">2938</span></a>    <span class="p">):</span>
</span><span id="ModelDescr-2939"><a href="#ModelDescr-2939"><span class="linenos">2939</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ModelDescr-2940"><a href="#ModelDescr-2940"><span class="linenos">2940</span></a>            <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-2941"><a href="#ModelDescr-2941"><span class="linenos">2941</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">io</span>
</span><span id="ModelDescr-2942"><a href="#ModelDescr-2942"><span class="linenos">2942</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span>
</span><span id="ModelDescr-2943"><a href="#ModelDescr-2943"><span class="linenos">2943</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr-2944"><a href="#ModelDescr-2944"><span class="linenos">2944</span></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="ModelDescr-2945"><a href="#ModelDescr-2945"><span class="linenos">2945</span></a>        <span class="p">}</span>
</span><span id="ModelDescr-2946"><a href="#ModelDescr-2946"><span class="linenos">2946</span></a>
</span><span id="ModelDescr-2947"><a href="#ModelDescr-2947"><span class="linenos">2947</span></a>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2948"><a href="#ModelDescr-2948"><span class="linenos">2948</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-2949"><a href="#ModelDescr-2949"><span class="linenos">2949</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_output_axes</span><span class="p">(</span>
</span><span id="ModelDescr-2950"><a href="#ModelDescr-2950"><span class="linenos">2950</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">],</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
</span><span id="ModelDescr-2951"><a href="#ModelDescr-2951"><span class="linenos">2951</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]:</span>
</span><span id="ModelDescr-2952"><a href="#ModelDescr-2952"><span class="linenos">2952</span></a>        <span class="n">input_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span>
</span><span id="ModelDescr-2953"><a href="#ModelDescr-2953"><span class="linenos">2953</span></a>            <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ModelDescr-2954"><a href="#ModelDescr-2954"><span class="linenos">2954</span></a>        <span class="p">)</span>
</span><span id="ModelDescr-2955"><a href="#ModelDescr-2955"><span class="linenos">2955</span></a>        <span class="n">output_size_refs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_axes_with_independent_size</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="ModelDescr-2956"><a href="#ModelDescr-2956"><span class="linenos">2956</span></a>
</span><span id="ModelDescr-2957"><a href="#ModelDescr-2957"><span class="linenos">2957</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="ModelDescr-2958"><a href="#ModelDescr-2958"><span class="linenos">2958</span></a>            <span class="n">valid_independent_refs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
</span><span id="ModelDescr-2959"><a href="#ModelDescr-2959"><span class="linenos">2959</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span>
</span><span id="ModelDescr-2960"><a href="#ModelDescr-2960"><span class="linenos">2960</span></a>                <span class="n">Tuple</span><span class="p">[</span><span class="n">TensorDescr</span><span class="p">,</span> <span class="n">AnyAxis</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">]],</span>
</span><span id="ModelDescr-2961"><a href="#ModelDescr-2961"><span class="linenos">2961</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-2962"><a href="#ModelDescr-2962"><span class="linenos">2962</span></a>                <span class="o">**</span><span class="p">{</span>
</span><span id="ModelDescr-2963"><a href="#ModelDescr-2963"><span class="linenos">2963</span></a>                    <span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">):</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-2964"><a href="#ModelDescr-2964"><span class="linenos">2964</span></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">axes</span>
</span><span id="ModelDescr-2965"><a href="#ModelDescr-2965"><span class="linenos">2965</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr-2966"><a href="#ModelDescr-2966"><span class="linenos">2966</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">))</span>
</span><span id="ModelDescr-2967"><a href="#ModelDescr-2967"><span class="linenos">2967</span></a>                <span class="p">},</span>
</span><span id="ModelDescr-2968"><a href="#ModelDescr-2968"><span class="linenos">2968</span></a>                <span class="o">**</span><span class="n">input_size_refs</span><span class="p">,</span>
</span><span id="ModelDescr-2969"><a href="#ModelDescr-2969"><span class="linenos">2969</span></a>                <span class="o">**</span><span class="n">output_size_refs</span><span class="p">,</span>
</span><span id="ModelDescr-2970"><a href="#ModelDescr-2970"><span class="linenos">2970</span></a>            <span class="p">}</span>
</span><span id="ModelDescr-2971"><a href="#ModelDescr-2971"><span class="linenos">2971</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
</span><span id="ModelDescr-2972"><a href="#ModelDescr-2972"><span class="linenos">2972</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_axis</span><span class="p">(</span>
</span><span id="ModelDescr-2973"><a href="#ModelDescr-2973"><span class="linenos">2973</span></a>                    <span class="s2">&quot;outputs&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-2974"><a href="#ModelDescr-2974"><span class="linenos">2974</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="ModelDescr-2975"><a href="#ModelDescr-2975"><span class="linenos">2975</span></a>                    <span class="n">out</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-2976"><a href="#ModelDescr-2976"><span class="linenos">2976</span></a>                    <span class="n">a</span><span class="p">,</span>
</span><span id="ModelDescr-2977"><a href="#ModelDescr-2977"><span class="linenos">2977</span></a>                    <span class="n">ax</span><span class="p">,</span>
</span><span id="ModelDescr-2978"><a href="#ModelDescr-2978"><span class="linenos">2978</span></a>                    <span class="n">valid_independent_refs</span><span class="o">=</span><span class="n">valid_independent_refs</span><span class="p">,</span>
</span><span id="ModelDescr-2979"><a href="#ModelDescr-2979"><span class="linenos">2979</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-2980"><a href="#ModelDescr-2980"><span class="linenos">2980</span></a>
</span><span id="ModelDescr-2981"><a href="#ModelDescr-2981"><span class="linenos">2981</span></a>        <span class="k">return</span> <span class="n">outputs</span>
</span><span id="ModelDescr-2982"><a href="#ModelDescr-2982"><span class="linenos">2982</span></a>
</span><span id="ModelDescr-2983"><a href="#ModelDescr-2983"><span class="linenos">2983</span></a>    <span class="n">packaged_by</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ModelDescr-2984"><a href="#ModelDescr-2984"><span class="linenos">2984</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">List</span><span class="p">[</span><span class="n">Author</span><span class="p">]],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="ModelDescr-2985"><a href="#ModelDescr-2985"><span class="linenos">2985</span></a>    <span class="p">)</span>
</span><span id="ModelDescr-2986"><a href="#ModelDescr-2986"><span class="linenos">2986</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The persons that have packaged and uploaded this model.</span>
</span><span id="ModelDescr-2987"><a href="#ModelDescr-2987"><span class="linenos">2987</span></a><span class="sd">    Only required if those persons differ from the `authors`.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2988"><a href="#ModelDescr-2988"><span class="linenos">2988</span></a>
</span><span id="ModelDescr-2989"><a href="#ModelDescr-2989"><span class="linenos">2989</span></a>    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LinkedModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-2990"><a href="#ModelDescr-2990"><span class="linenos">2990</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The model from which this model is derived, e.g. by fine-tuning the weights.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-2991"><a href="#ModelDescr-2991"><span class="linenos">2991</span></a>
</span><span id="ModelDescr-2992"><a href="#ModelDescr-2992"><span class="linenos">2992</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2993"><a href="#ModelDescr-2993"><span class="linenos">2993</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_parent_is_not_self</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ModelDescr-2994"><a href="#ModelDescr-2994"><span class="linenos">2994</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
</span><span id="ModelDescr-2995"><a href="#ModelDescr-2995"><span class="linenos">2995</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A model description may not reference itself as parent.&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-2996"><a href="#ModelDescr-2996"><span class="linenos">2996</span></a>
</span><span id="ModelDescr-2997"><a href="#ModelDescr-2997"><span class="linenos">2997</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-2998"><a href="#ModelDescr-2998"><span class="linenos">2998</span></a>
</span><span id="ModelDescr-2999"><a href="#ModelDescr-2999"><span class="linenos">2999</span></a>    <span class="n">run_mode</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ModelDescr-3000"><a href="#ModelDescr-3000"><span class="linenos">3000</span></a>        <span class="n">Optional</span><span class="p">[</span><span class="n">RunMode</span><span class="p">],</span>
</span><span id="ModelDescr-3001"><a href="#ModelDescr-3001"><span class="linenos">3001</span></a>        <span class="n">warn</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Run mode &#39;</span><span class="si">{value}</span><span class="s2">&#39; has limited support across consumer softwares.&quot;</span><span class="p">),</span>
</span><span id="ModelDescr-3002"><a href="#ModelDescr-3002"><span class="linenos">3002</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-3003"><a href="#ModelDescr-3003"><span class="linenos">3003</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom run mode for this model: for more complex prediction procedures like test time</span>
</span><span id="ModelDescr-3004"><a href="#ModelDescr-3004"><span class="linenos">3004</span></a><span class="sd">    data augmentation that currently cannot be expressed in the specification.</span>
</span><span id="ModelDescr-3005"><a href="#ModelDescr-3005"><span class="linenos">3005</span></a><span class="sd">    No standard run modes are defined yet.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3006"><a href="#ModelDescr-3006"><span class="linenos">3006</span></a>
</span><span id="ModelDescr-3007"><a href="#ModelDescr-3007"><span class="linenos">3007</span></a>    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span><span id="ModelDescr-3008"><a href="#ModelDescr-3008"><span class="linenos">3008</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Timestamp in [ISO 8601](#https://en.wikipedia.org/wiki/ISO_8601) format</span>
</span><span id="ModelDescr-3009"><a href="#ModelDescr-3009"><span class="linenos">3009</span></a><span class="sd">    with a few restrictions listed [here](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat).</span>
</span><span id="ModelDescr-3010"><a href="#ModelDescr-3010"><span class="linenos">3010</span></a><span class="sd">    (In Python a datetime object is valid, too).&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3011"><a href="#ModelDescr-3011"><span class="linenos">3011</span></a>
</span><span id="ModelDescr-3012"><a href="#ModelDescr-3012"><span class="linenos">3012</span></a>    <span class="n">training_data</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span>
</span><span id="ModelDescr-3013"><a href="#ModelDescr-3013"><span class="linenos">3013</span></a>        <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">LinkedDataset</span><span class="p">,</span> <span class="n">DatasetDescr</span><span class="p">,</span> <span class="n">DatasetDescr02</span><span class="p">],</span>
</span><span id="ModelDescr-3014"><a href="#ModelDescr-3014"><span class="linenos">3014</span></a>        <span class="n">Field</span><span class="p">(</span><span class="n">union_mode</span><span class="o">=</span><span class="s2">&quot;left_to_right&quot;</span><span class="p">),</span>
</span><span id="ModelDescr-3015"><a href="#ModelDescr-3015"><span class="linenos">3015</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-3016"><a href="#ModelDescr-3016"><span class="linenos">3016</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dataset used to train this model&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3017"><a href="#ModelDescr-3017"><span class="linenos">3017</span></a>
</span><span id="ModelDescr-3018"><a href="#ModelDescr-3018"><span class="linenos">3018</span></a>    <span class="n">weights</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">WeightsDescr</span><span class="p">,</span> <span class="n">WrapSerializer</span><span class="p">(</span><span class="n">package_weights</span><span class="p">)]</span>
</span><span id="ModelDescr-3019"><a href="#ModelDescr-3019"><span class="linenos">3019</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The weights for this model.</span>
</span><span id="ModelDescr-3020"><a href="#ModelDescr-3020"><span class="linenos">3020</span></a><span class="sd">    Weights can be given for different formats, but should otherwise be equivalent.</span>
</span><span id="ModelDescr-3021"><a href="#ModelDescr-3021"><span class="linenos">3021</span></a><span class="sd">    The available weight formats determine which consumers can use this model.&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3022"><a href="#ModelDescr-3022"><span class="linenos">3022</span></a>
</span><span id="ModelDescr-3023"><a href="#ModelDescr-3023"><span class="linenos">3023</span></a>    <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Config</span><span class="o">.</span><span class="n">model_construct</span><span class="p">)</span>
</span><span id="ModelDescr-3024"><a href="#ModelDescr-3024"><span class="linenos">3024</span></a>
</span><span id="ModelDescr-3025"><a href="#ModelDescr-3025"><span class="linenos">3025</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-3026"><a href="#ModelDescr-3026"><span class="linenos">3026</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_default_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ModelDescr-3027"><a href="#ModelDescr-3027"><span class="linenos">3027</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_validation_context</span><span class="p">()</span><span class="o">.</span><span class="n">perform_io_checks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="p">:</span>
</span><span id="ModelDescr-3028"><a href="#ModelDescr-3028"><span class="linenos">3028</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-3029"><a href="#ModelDescr-3029"><span class="linenos">3029</span></a>
</span><span id="ModelDescr-3030"><a href="#ModelDescr-3030"><span class="linenos">3030</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ModelDescr-3031"><a href="#ModelDescr-3031"><span class="linenos">3031</span></a>            <span class="n">generated_covers</span> <span class="o">=</span> <span class="n">generate_covers</span><span class="p">(</span>
</span><span id="ModelDescr-3032"><a href="#ModelDescr-3032"><span class="linenos">3032</span></a>                <span class="p">[</span>
</span><span id="ModelDescr-3033"><a href="#ModelDescr-3033"><span class="linenos">3033</span></a>                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">))</span>
</span><span id="ModelDescr-3034"><a href="#ModelDescr-3034"><span class="linenos">3034</span></a>                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="ModelDescr-3035"><a href="#ModelDescr-3035"><span class="linenos">3035</span></a>                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ModelDescr-3036"><a href="#ModelDescr-3036"><span class="linenos">3036</span></a>                <span class="p">],</span>
</span><span id="ModelDescr-3037"><a href="#ModelDescr-3037"><span class="linenos">3037</span></a>                <span class="p">[</span>
</span><span id="ModelDescr-3038"><a href="#ModelDescr-3038"><span class="linenos">3038</span></a>                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">))</span>
</span><span id="ModelDescr-3039"><a href="#ModelDescr-3039"><span class="linenos">3039</span></a>                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="ModelDescr-3040"><a href="#ModelDescr-3040"><span class="linenos">3040</span></a>                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ModelDescr-3041"><a href="#ModelDescr-3041"><span class="linenos">3041</span></a>                <span class="p">],</span>
</span><span id="ModelDescr-3042"><a href="#ModelDescr-3042"><span class="linenos">3042</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-3043"><a href="#ModelDescr-3043"><span class="linenos">3043</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ModelDescr-3044"><a href="#ModelDescr-3044"><span class="linenos">3044</span></a>            <span class="n">issue_warning</span><span class="p">(</span>
</span><span id="ModelDescr-3045"><a href="#ModelDescr-3045"><span class="linenos">3045</span></a>                <span class="s2">&quot;Failed to generate cover image(s): </span><span class="si">{e}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3046"><a href="#ModelDescr-3046"><span class="linenos">3046</span></a>                <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span>
</span><span id="ModelDescr-3047"><a href="#ModelDescr-3047"><span class="linenos">3047</span></a>                <span class="n">msg_context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">),</span>
</span><span id="ModelDescr-3048"><a href="#ModelDescr-3048"><span class="linenos">3048</span></a>                <span class="n">field</span><span class="o">=</span><span class="s2">&quot;covers&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3049"><a href="#ModelDescr-3049"><span class="linenos">3049</span></a>            <span class="p">)</span>
</span><span id="ModelDescr-3050"><a href="#ModelDescr-3050"><span class="linenos">3050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-3051"><a href="#ModelDescr-3051"><span class="linenos">3051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">covers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">generated_covers</span><span class="p">)</span>
</span><span id="ModelDescr-3052"><a href="#ModelDescr-3052"><span class="linenos">3052</span></a>
</span><span id="ModelDescr-3053"><a href="#ModelDescr-3053"><span class="linenos">3053</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ModelDescr-3054"><a href="#ModelDescr-3054"><span class="linenos">3054</span></a>
</span><span id="ModelDescr-3055"><a href="#ModelDescr-3055"><span class="linenos">3055</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="ModelDescr-3056"><a href="#ModelDescr-3056"><span class="linenos">3056</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="ModelDescr-3057"><a href="#ModelDescr-3057"><span class="linenos">3057</span></a>
</span><span id="ModelDescr-3058"><a href="#ModelDescr-3058"><span class="linenos">3058</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="ModelDescr-3059"><a href="#ModelDescr-3059"><span class="linenos">3059</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="ModelDescr-3060"><a href="#ModelDescr-3060"><span class="linenos">3060</span></a>
</span><span id="ModelDescr-3061"><a href="#ModelDescr-3061"><span class="linenos">3061</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr-3062"><a href="#ModelDescr-3062"><span class="linenos">3062</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_test_arrays</span><span class="p">(</span>
</span><span id="ModelDescr-3063"><a href="#ModelDescr-3063"><span class="linenos">3063</span></a>        <span class="n">io_descr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">]],</span>
</span><span id="ModelDescr-3064"><a href="#ModelDescr-3064"><span class="linenos">3064</span></a>    <span class="p">):</span>
</span><span id="ModelDescr-3065"><a href="#ModelDescr-3065"><span class="linenos">3065</span></a>        <span class="n">ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FileDescr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ModelDescr-3066"><a href="#ModelDescr-3066"><span class="linenos">3066</span></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">io_descr</span><span class="p">:</span>
</span><span id="ModelDescr-3067"><a href="#ModelDescr-3067"><span class="linenos">3067</span></a>            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">test_tensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-3068"><a href="#ModelDescr-3068"><span class="linenos">3068</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-3069"><a href="#ModelDescr-3069"><span class="linenos">3069</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to get test arrays: description of &#39;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; is missing a `test_tensor`.&quot;</span>
</span><span id="ModelDescr-3070"><a href="#ModelDescr-3070"><span class="linenos">3070</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-3071"><a href="#ModelDescr-3071"><span class="linenos">3071</span></a>            <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">test_tensor</span><span class="p">)</span>
</span><span id="ModelDescr-3072"><a href="#ModelDescr-3072"><span class="linenos">3072</span></a>
</span><span id="ModelDescr-3073"><a href="#ModelDescr-3073"><span class="linenos">3073</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">load_array</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">]</span>
</span><span id="ModelDescr-3074"><a href="#ModelDescr-3074"><span class="linenos">3074</span></a>        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
</span><span id="ModelDescr-3075"><a href="#ModelDescr-3075"><span class="linenos">3075</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="ModelDescr-3076"><a href="#ModelDescr-3076"><span class="linenos">3076</span></a>
</span><span id="ModelDescr-3077"><a href="#ModelDescr-3077"><span class="linenos">3077</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr-3078"><a href="#ModelDescr-3078"><span class="linenos">3078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_batch_size</span><span class="p">(</span><span class="n">tensor_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ModelDescr-3079"><a href="#ModelDescr-3079"><span class="linenos">3079</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ModelDescr-3080"><a href="#ModelDescr-3080"><span class="linenos">3080</span></a>        <span class="n">tensor_with_batchsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-3081"><a href="#ModelDescr-3081"><span class="linenos">3081</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">:</span>
</span><span id="ModelDescr-3082"><a href="#ModelDescr-3082"><span class="linenos">3082</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr-3083"><a href="#ModelDescr-3083"><span class="linenos">3083</span></a>                <span class="k">if</span> <span class="n">aid</span> <span class="o">!=</span> <span class="n">BATCH_AXIS_ID</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="n">batch_size</span><span class="p">:</span>
</span><span id="ModelDescr-3084"><a href="#ModelDescr-3084"><span class="linenos">3084</span></a>                    <span class="k">continue</span>
</span><span id="ModelDescr-3085"><a href="#ModelDescr-3085"><span class="linenos">3085</span></a>
</span><span id="ModelDescr-3086"><a href="#ModelDescr-3086"><span class="linenos">3086</span></a>                <span class="k">if</span> <span class="n">batch_size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ModelDescr-3087"><a href="#ModelDescr-3087"><span class="linenos">3087</span></a>                    <span class="k">assert</span> <span class="n">tensor_with_batchsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ModelDescr-3088"><a href="#ModelDescr-3088"><span class="linenos">3088</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-3089"><a href="#ModelDescr-3089"><span class="linenos">3089</span></a>                        <span class="sa">f</span><span class="s2">&quot;batch size mismatch for tensors &#39;</span><span class="si">{</span><span class="n">tensor_with_batchsize</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">) and &#39;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ModelDescr-3090"><a href="#ModelDescr-3090"><span class="linenos">3090</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3091"><a href="#ModelDescr-3091"><span class="linenos">3091</span></a>
</span><span id="ModelDescr-3092"><a href="#ModelDescr-3092"><span class="linenos">3092</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr-3093"><a href="#ModelDescr-3093"><span class="linenos">3093</span></a>                <span class="n">tensor_with_batchsize</span> <span class="o">=</span> <span class="n">tid</span>
</span><span id="ModelDescr-3094"><a href="#ModelDescr-3094"><span class="linenos">3094</span></a>
</span><span id="ModelDescr-3095"><a href="#ModelDescr-3095"><span class="linenos">3095</span></a>        <span class="k">return</span> <span class="n">batch_size</span>
</span><span id="ModelDescr-3096"><a href="#ModelDescr-3096"><span class="linenos">3096</span></a>
</span><span id="ModelDescr-3097"><a href="#ModelDescr-3097"><span class="linenos">3097</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_tensor_sizes</span><span class="p">(</span>
</span><span id="ModelDescr-3098"><a href="#ModelDescr-3098"><span class="linenos">3098</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="ModelDescr-3099"><a href="#ModelDescr-3099"><span class="linenos">3099</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]]:</span>
</span><span id="ModelDescr-3100"><a href="#ModelDescr-3100"><span class="linenos">3100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the tensor output sizes for given **input_sizes**.</span>
</span><span id="ModelDescr-3101"><a href="#ModelDescr-3101"><span class="linenos">3101</span></a><span class="sd">        Only if **input_sizes** has a valid input shape, the tensor output size is exact.</span>
</span><span id="ModelDescr-3102"><a href="#ModelDescr-3102"><span class="linenos">3102</span></a><span class="sd">        Otherwise it might be larger than the actual (valid) output&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3103"><a href="#ModelDescr-3103"><span class="linenos">3103</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_batch_size</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="ModelDescr-3104"><a href="#ModelDescr-3104"><span class="linenos">3104</span></a>        <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="ModelDescr-3105"><a href="#ModelDescr-3105"><span class="linenos">3105</span></a>
</span><span id="ModelDescr-3106"><a href="#ModelDescr-3106"><span class="linenos">3106</span></a>        <span class="n">tensor_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tensor_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="ModelDescr-3107"><a href="#ModelDescr-3107"><span class="linenos">3107</span></a>        <span class="k">return</span> <span class="n">tensor_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="ModelDescr-3108"><a href="#ModelDescr-3108"><span class="linenos">3108</span></a>
</span><span id="ModelDescr-3109"><a href="#ModelDescr-3109"><span class="linenos">3109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="ModelDescr-3110"><a href="#ModelDescr-3110"><span class="linenos">3110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;get parameter `n` for each parameterized axis</span>
</span><span id="ModelDescr-3111"><a href="#ModelDescr-3111"><span class="linenos">3111</span></a><span class="sd">        such that the valid input size is &gt;= the given input size&quot;&quot;&quot;</span>
</span><span id="ModelDescr-3112"><a href="#ModelDescr-3112"><span class="linenos">3112</span></a>        <span class="n">ret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr-3113"><a href="#ModelDescr-3113"><span class="linenos">3113</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="ModelDescr-3114"><a href="#ModelDescr-3114"><span class="linenos">3114</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">:</span>
</span><span id="ModelDescr-3115"><a href="#ModelDescr-3115"><span class="linenos">3115</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr-3116"><a href="#ModelDescr-3116"><span class="linenos">3116</span></a>                <span class="n">size_descr</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">tid</span><span class="p">][</span><span class="n">aid</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="ModelDescr-3117"><a href="#ModelDescr-3117"><span class="linenos">3117</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="ModelDescr-3118"><a href="#ModelDescr-3118"><span class="linenos">3118</span></a>                    <span class="n">ret</span><span class="p">[(</span><span class="n">tid</span><span class="p">,</span> <span class="n">aid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">size_descr</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="ModelDescr-3119"><a href="#ModelDescr-3119"><span class="linenos">3119</span></a>                <span class="k">elif</span> <span class="n">size_descr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">)):</span>
</span><span id="ModelDescr-3120"><a href="#ModelDescr-3120"><span class="linenos">3120</span></a>                    <span class="k">pass</span>
</span><span id="ModelDescr-3121"><a href="#ModelDescr-3121"><span class="linenos">3121</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-3122"><a href="#ModelDescr-3122"><span class="linenos">3122</span></a>                    <span class="n">assert_never</span><span class="p">(</span><span class="n">size_descr</span><span class="p">)</span>
</span><span id="ModelDescr-3123"><a href="#ModelDescr-3123"><span class="linenos">3123</span></a>
</span><span id="ModelDescr-3124"><a href="#ModelDescr-3124"><span class="linenos">3124</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="ModelDescr-3125"><a href="#ModelDescr-3125"><span class="linenos">3125</span></a>
</span><span id="ModelDescr-3126"><a href="#ModelDescr-3126"><span class="linenos">3126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tensor_sizes</span><span class="p">(</span>
</span><span id="ModelDescr-3127"><a href="#ModelDescr-3127"><span class="linenos">3127</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ModelDescr-3128"><a href="#ModelDescr-3128"><span class="linenos">3128</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorSizes</span><span class="p">:</span>
</span><span id="ModelDescr-3129"><a href="#ModelDescr-3129"><span class="linenos">3129</span></a>        <span class="n">axis_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="ModelDescr-3130"><a href="#ModelDescr-3130"><span class="linenos">3130</span></a>        <span class="k">return</span> <span class="n">_TensorSizes</span><span class="p">(</span>
</span><span id="ModelDescr-3131"><a href="#ModelDescr-3131"><span class="linenos">3131</span></a>            <span class="p">{</span>
</span><span id="ModelDescr-3132"><a href="#ModelDescr-3132"><span class="linenos">3132</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ModelDescr-3133"><a href="#ModelDescr-3133"><span class="linenos">3133</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="ModelDescr-3134"><a href="#ModelDescr-3134"><span class="linenos">3134</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="ModelDescr-3135"><a href="#ModelDescr-3135"><span class="linenos">3135</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="ModelDescr-3136"><a href="#ModelDescr-3136"><span class="linenos">3136</span></a>                <span class="p">}</span>
</span><span id="ModelDescr-3137"><a href="#ModelDescr-3137"><span class="linenos">3137</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="ModelDescr-3138"><a href="#ModelDescr-3138"><span class="linenos">3138</span></a>            <span class="p">},</span>
</span><span id="ModelDescr-3139"><a href="#ModelDescr-3139"><span class="linenos">3139</span></a>            <span class="p">{</span>
</span><span id="ModelDescr-3140"><a href="#ModelDescr-3140"><span class="linenos">3140</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ModelDescr-3141"><a href="#ModelDescr-3141"><span class="linenos">3141</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="ModelDescr-3142"><a href="#ModelDescr-3142"><span class="linenos">3142</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="ModelDescr-3143"><a href="#ModelDescr-3143"><span class="linenos">3143</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="ModelDescr-3144"><a href="#ModelDescr-3144"><span class="linenos">3144</span></a>                <span class="p">}</span>
</span><span id="ModelDescr-3145"><a href="#ModelDescr-3145"><span class="linenos">3145</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span><span id="ModelDescr-3146"><a href="#ModelDescr-3146"><span class="linenos">3146</span></a>            <span class="p">},</span>
</span><span id="ModelDescr-3147"><a href="#ModelDescr-3147"><span class="linenos">3147</span></a>        <span class="p">)</span>
</span><span id="ModelDescr-3148"><a href="#ModelDescr-3148"><span class="linenos">3148</span></a>
</span><span id="ModelDescr-3149"><a href="#ModelDescr-3149"><span class="linenos">3149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes</span><span class="p">(</span>
</span><span id="ModelDescr-3150"><a href="#ModelDescr-3150"><span class="linenos">3150</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ModelDescr-3151"><a href="#ModelDescr-3151"><span class="linenos">3151</span></a>        <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span>
</span><span id="ModelDescr-3152"><a href="#ModelDescr-3152"><span class="linenos">3152</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModelDescr-3153"><a href="#ModelDescr-3153"><span class="linenos">3153</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ModelDescr-3154"><a href="#ModelDescr-3154"><span class="linenos">3154</span></a>        <span class="n">max_input_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModelDescr-3155"><a href="#ModelDescr-3155"><span class="linenos">3155</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_AxisSizes</span><span class="p">:</span>
</span><span id="ModelDescr-3156"><a href="#ModelDescr-3156"><span class="linenos">3156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine input and output block shape for scale factors **ns**</span>
</span><span id="ModelDescr-3157"><a href="#ModelDescr-3157"><span class="linenos">3157</span></a><span class="sd">        of parameterized input sizes.</span>
</span><span id="ModelDescr-3158"><a href="#ModelDescr-3158"><span class="linenos">3158</span></a>
</span><span id="ModelDescr-3159"><a href="#ModelDescr-3159"><span class="linenos">3159</span></a><span class="sd">        Args:</span>
</span><span id="ModelDescr-3160"><a href="#ModelDescr-3160"><span class="linenos">3160</span></a><span class="sd">            ns: Scale factor `n` for each axis (keyed by (tensor_id, axis_id))</span>
</span><span id="ModelDescr-3161"><a href="#ModelDescr-3161"><span class="linenos">3161</span></a><span class="sd">                that is parameterized as `size = min + n * step`.</span>
</span><span id="ModelDescr-3162"><a href="#ModelDescr-3162"><span class="linenos">3162</span></a><span class="sd">            batch_size: The desired size of the batch dimension.</span>
</span><span id="ModelDescr-3163"><a href="#ModelDescr-3163"><span class="linenos">3163</span></a><span class="sd">                If given **batch_size** overwrites any batch size present in</span>
</span><span id="ModelDescr-3164"><a href="#ModelDescr-3164"><span class="linenos">3164</span></a><span class="sd">                **max_input_shape**. Default 1.</span>
</span><span id="ModelDescr-3165"><a href="#ModelDescr-3165"><span class="linenos">3165</span></a><span class="sd">            max_input_shape: Limits the derived block shapes.</span>
</span><span id="ModelDescr-3166"><a href="#ModelDescr-3166"><span class="linenos">3166</span></a><span class="sd">                Each axis for which the input size, parameterized by `n`, is larger</span>
</span><span id="ModelDescr-3167"><a href="#ModelDescr-3167"><span class="linenos">3167</span></a><span class="sd">                than **max_input_shape** is set to the minimal value `n_min` for which</span>
</span><span id="ModelDescr-3168"><a href="#ModelDescr-3168"><span class="linenos">3168</span></a><span class="sd">                this is still true.</span>
</span><span id="ModelDescr-3169"><a href="#ModelDescr-3169"><span class="linenos">3169</span></a><span class="sd">                Use this for small input samples or large values of **ns**.</span>
</span><span id="ModelDescr-3170"><a href="#ModelDescr-3170"><span class="linenos">3170</span></a><span class="sd">                Or simply whenever you know the full input shape.</span>
</span><span id="ModelDescr-3171"><a href="#ModelDescr-3171"><span class="linenos">3171</span></a>
</span><span id="ModelDescr-3172"><a href="#ModelDescr-3172"><span class="linenos">3172</span></a><span class="sd">        Returns:</span>
</span><span id="ModelDescr-3173"><a href="#ModelDescr-3173"><span class="linenos">3173</span></a><span class="sd">            Resolved axis sizes for model inputs and outputs.</span>
</span><span id="ModelDescr-3174"><a href="#ModelDescr-3174"><span class="linenos">3174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelDescr-3175"><a href="#ModelDescr-3175"><span class="linenos">3175</span></a>        <span class="n">max_input_shape</span> <span class="o">=</span> <span class="n">max_input_shape</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ModelDescr-3176"><a href="#ModelDescr-3176"><span class="linenos">3176</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-3177"><a href="#ModelDescr-3177"><span class="linenos">3177</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">_t_id</span><span class="p">,</span> <span class="n">a_id</span><span class="p">),</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr-3178"><a href="#ModelDescr-3178"><span class="linenos">3178</span></a>                <span class="k">if</span> <span class="n">a_id</span> <span class="o">==</span> <span class="n">BATCH_AXIS_ID</span><span class="p">:</span>
</span><span id="ModelDescr-3179"><a href="#ModelDescr-3179"><span class="linenos">3179</span></a>                    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr-3180"><a href="#ModelDescr-3180"><span class="linenos">3180</span></a>                    <span class="k">break</span>
</span><span id="ModelDescr-3181"><a href="#ModelDescr-3181"><span class="linenos">3181</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-3182"><a href="#ModelDescr-3182"><span class="linenos">3182</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ModelDescr-3183"><a href="#ModelDescr-3183"><span class="linenos">3183</span></a>
</span><span id="ModelDescr-3184"><a href="#ModelDescr-3184"><span class="linenos">3184</span></a>        <span class="n">all_axes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr-3185"><a href="#ModelDescr-3185"><span class="linenos">3185</span></a>            <span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="ModelDescr-3186"><a href="#ModelDescr-3186"><span class="linenos">3186</span></a>        <span class="p">}</span>
</span><span id="ModelDescr-3187"><a href="#ModelDescr-3187"><span class="linenos">3187</span></a>
</span><span id="ModelDescr-3188"><a href="#ModelDescr-3188"><span class="linenos">3188</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr-3189"><a href="#ModelDescr-3189"><span class="linenos">3189</span></a>        <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr-3190"><a href="#ModelDescr-3190"><span class="linenos">3190</span></a>
</span><span id="ModelDescr-3191"><a href="#ModelDescr-3191"><span class="linenos">3191</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">,</span> <span class="n">OutputAxis</span><span class="p">]):</span>
</span><span id="ModelDescr-3192"><a href="#ModelDescr-3192"><span class="linenos">3192</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="ModelDescr-3193"><a href="#ModelDescr-3193"><span class="linenos">3193</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr-3194"><a href="#ModelDescr-3194"><span class="linenos">3194</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr-3195"><a href="#ModelDescr-3195"><span class="linenos">3195</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for batch axis&quot;</span>
</span><span id="ModelDescr-3196"><a href="#ModelDescr-3196"><span class="linenos">3196</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3197"><a href="#ModelDescr-3197"><span class="linenos">3197</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3198"><a href="#ModelDescr-3198"><span class="linenos">3198</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3199"><a href="#ModelDescr-3199"><span class="linenos">3199</span></a>                <span class="k">return</span> <span class="n">batch_size</span>
</span><span id="ModelDescr-3200"><a href="#ModelDescr-3200"><span class="linenos">3200</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="ModelDescr-3201"><a href="#ModelDescr-3201"><span class="linenos">3201</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr-3202"><a href="#ModelDescr-3202"><span class="linenos">3202</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr-3203"><a href="#ModelDescr-3203"><span class="linenos">3203</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for fixed size&quot;</span>
</span><span id="ModelDescr-3204"><a href="#ModelDescr-3204"><span class="linenos">3204</span></a>                        <span class="o">+</span> <span class="s2">&quot; axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3205"><a href="#ModelDescr-3205"><span class="linenos">3205</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3206"><a href="#ModelDescr-3206"><span class="linenos">3206</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3207"><a href="#ModelDescr-3207"><span class="linenos">3207</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3208"><a href="#ModelDescr-3208"><span class="linenos">3208</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span>
</span><span id="ModelDescr-3209"><a href="#ModelDescr-3209"><span class="linenos">3209</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="ModelDescr-3210"><a href="#ModelDescr-3210"><span class="linenos">3210</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr-3211"><a href="#ModelDescr-3211"><span class="linenos">3211</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr-3212"><a href="#ModelDescr-3212"><span class="linenos">3212</span></a>                        <span class="s2">&quot;Size increment factor (n) missing for parametrized axis&quot;</span>
</span><span id="ModelDescr-3213"><a href="#ModelDescr-3213"><span class="linenos">3213</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="ModelDescr-3214"><a href="#ModelDescr-3214"><span class="linenos">3214</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3215"><a href="#ModelDescr-3215"><span class="linenos">3215</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
</span><span id="ModelDescr-3216"><a href="#ModelDescr-3216"><span class="linenos">3216</span></a>                <span class="n">s_max</span> <span class="o">=</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="ModelDescr-3217"><a href="#ModelDescr-3217"><span class="linenos">3217</span></a>                <span class="k">if</span> <span class="n">s_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-3218"><a href="#ModelDescr-3218"><span class="linenos">3218</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s_max</span><span class="p">))</span>
</span><span id="ModelDescr-3219"><a href="#ModelDescr-3219"><span class="linenos">3219</span></a>
</span><span id="ModelDescr-3220"><a href="#ModelDescr-3220"><span class="linenos">3220</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="ModelDescr-3221"><a href="#ModelDescr-3221"><span class="linenos">3221</span></a>
</span><span id="ModelDescr-3222"><a href="#ModelDescr-3222"><span class="linenos">3222</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr-3223"><a href="#ModelDescr-3223"><span class="linenos">3223</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr-3224"><a href="#ModelDescr-3224"><span class="linenos">3224</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr-3225"><a href="#ModelDescr-3225"><span class="linenos">3225</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for axis &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
</span><span id="ModelDescr-3226"><a href="#ModelDescr-3226"><span class="linenos">3226</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39; with size reference.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3227"><a href="#ModelDescr-3227"><span class="linenos">3227</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3228"><a href="#ModelDescr-3228"><span class="linenos">3228</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3229"><a href="#ModelDescr-3229"><span class="linenos">3229</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3230"><a href="#ModelDescr-3230"><span class="linenos">3230</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr-3231"><a href="#ModelDescr-3231"><span class="linenos">3231</span></a>                <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">all_axes</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">]</span>
</span><span id="ModelDescr-3232"><a href="#ModelDescr-3232"><span class="linenos">3232</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr-3233"><a href="#ModelDescr-3233"><span class="linenos">3233</span></a>                <span class="n">ref_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">)</span>
</span><span id="ModelDescr-3234"><a href="#ModelDescr-3234"><span class="linenos">3234</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">,</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">))</span>
</span><span id="ModelDescr-3235"><a href="#ModelDescr-3235"><span class="linenos">3235</span></a>                <span class="k">assert</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ref_key</span>
</span><span id="ModelDescr-3236"><a href="#ModelDescr-3236"><span class="linenos">3236</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_size</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">),</span> <span class="n">ref_key</span>
</span><span id="ModelDescr-3237"><a href="#ModelDescr-3237"><span class="linenos">3237</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span>
</span><span id="ModelDescr-3238"><a href="#ModelDescr-3238"><span class="linenos">3238</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
</span><span id="ModelDescr-3239"><a href="#ModelDescr-3239"><span class="linenos">3239</span></a>                    <span class="n">ref_axis</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">,</span>
</span><span id="ModelDescr-3240"><a href="#ModelDescr-3240"><span class="linenos">3240</span></a>                    <span class="n">ref_size</span><span class="o">=</span><span class="n">ref_size</span><span class="p">,</span>
</span><span id="ModelDescr-3241"><a href="#ModelDescr-3241"><span class="linenos">3241</span></a>                <span class="p">)</span>
</span><span id="ModelDescr-3242"><a href="#ModelDescr-3242"><span class="linenos">3242</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="ModelDescr-3243"><a href="#ModelDescr-3243"><span class="linenos">3243</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr-3244"><a href="#ModelDescr-3244"><span class="linenos">3244</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr-3245"><a href="#ModelDescr-3245"><span class="linenos">3245</span></a>                        <span class="s2">&quot;Ignoring unexpected increment factor (n) for data dependent&quot;</span>
</span><span id="ModelDescr-3246"><a href="#ModelDescr-3246"><span class="linenos">3246</span></a>                        <span class="o">+</span> <span class="s2">&quot; size axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr-3247"><a href="#ModelDescr-3247"><span class="linenos">3247</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3248"><a href="#ModelDescr-3248"><span class="linenos">3248</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr-3249"><a href="#ModelDescr-3249"><span class="linenos">3249</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr-3250"><a href="#ModelDescr-3250"><span class="linenos">3250</span></a>                <span class="k">return</span> <span class="n">_DataDepSize</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</span><span id="ModelDescr-3251"><a href="#ModelDescr-3251"><span class="linenos">3251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-3252"><a href="#ModelDescr-3252"><span class="linenos">3252</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr-3253"><a href="#ModelDescr-3253"><span class="linenos">3253</span></a>
</span><span id="ModelDescr-3254"><a href="#ModelDescr-3254"><span class="linenos">3254</span></a>        <span class="c1"># first resolve all , but the `SizeReference` input sizes</span>
</span><span id="ModelDescr-3255"><a href="#ModelDescr-3255"><span class="linenos">3255</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="ModelDescr-3256"><a href="#ModelDescr-3256"><span class="linenos">3256</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr-3257"><a href="#ModelDescr-3257"><span class="linenos">3257</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr-3258"><a href="#ModelDescr-3258"><span class="linenos">3258</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr-3259"><a href="#ModelDescr-3259"><span class="linenos">3259</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="ModelDescr-3260"><a href="#ModelDescr-3260"><span class="linenos">3260</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr-3261"><a href="#ModelDescr-3261"><span class="linenos">3261</span></a>
</span><span id="ModelDescr-3262"><a href="#ModelDescr-3262"><span class="linenos">3262</span></a>        <span class="c1"># resolve all other input axis sizes</span>
</span><span id="ModelDescr-3263"><a href="#ModelDescr-3263"><span class="linenos">3263</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="ModelDescr-3264"><a href="#ModelDescr-3264"><span class="linenos">3264</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr-3265"><a href="#ModelDescr-3265"><span class="linenos">3265</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr-3266"><a href="#ModelDescr-3266"><span class="linenos">3266</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr-3267"><a href="#ModelDescr-3267"><span class="linenos">3267</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="ModelDescr-3268"><a href="#ModelDescr-3268"><span class="linenos">3268</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr-3269"><a href="#ModelDescr-3269"><span class="linenos">3269</span></a>
</span><span id="ModelDescr-3270"><a href="#ModelDescr-3270"><span class="linenos">3270</span></a>        <span class="c1"># resolve all output axis sizes</span>
</span><span id="ModelDescr-3271"><a href="#ModelDescr-3271"><span class="linenos">3271</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="ModelDescr-3272"><a href="#ModelDescr-3272"><span class="linenos">3272</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr-3273"><a href="#ModelDescr-3273"><span class="linenos">3273</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="ModelDescr-3274"><a href="#ModelDescr-3274"><span class="linenos">3274</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr-3275"><a href="#ModelDescr-3275"><span class="linenos">3275</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr-3276"><a href="#ModelDescr-3276"><span class="linenos">3276</span></a>
</span><span id="ModelDescr-3277"><a href="#ModelDescr-3277"><span class="linenos">3277</span></a>        <span class="k">return</span> <span class="n">_AxisSizes</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="ModelDescr-3278"><a href="#ModelDescr-3278"><span class="linenos">3278</span></a>
</span><span id="ModelDescr-3279"><a href="#ModelDescr-3279"><span class="linenos">3279</span></a>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-3280"><a href="#ModelDescr-3280"><span class="linenos">3280</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-3281"><a href="#ModelDescr-3281"><span class="linenos">3281</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ModelDescr-3282"><a href="#ModelDescr-3282"><span class="linenos">3282</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">convert_from_old_format_wo_validation</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModelDescr-3283"><a href="#ModelDescr-3283"><span class="linenos">3283</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="ModelDescr-3284"><a href="#ModelDescr-3284"><span class="linenos">3284</span></a>
</span><span id="ModelDescr-3285"><a href="#ModelDescr-3285"><span class="linenos">3285</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr-3286"><a href="#ModelDescr-3286"><span class="linenos">3286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_from_old_format_wo_validation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-3287"><a href="#ModelDescr-3287"><span class="linenos">3287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert metadata following an older format version to this classes&#39; format</span>
</span><span id="ModelDescr-3288"><a href="#ModelDescr-3288"><span class="linenos">3288</span></a><span class="sd">        without validating the result.</span>
</span><span id="ModelDescr-3289"><a href="#ModelDescr-3289"><span class="linenos">3289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelDescr-3290"><a href="#ModelDescr-3290"><span class="linenos">3290</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ModelDescr-3291"><a href="#ModelDescr-3291"><span class="linenos">3291</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span>
</span><span id="ModelDescr-3292"><a href="#ModelDescr-3292"><span class="linenos">3292</span></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fv</span> <span class="o">:=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format_version&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="ModelDescr-3293"><a href="#ModelDescr-3293"><span class="linenos">3293</span></a>            <span class="ow">and</span> <span class="n">fv</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="ModelDescr-3294"><a href="#ModelDescr-3294"><span class="linenos">3294</span></a>        <span class="p">):</span>
</span><span id="ModelDescr-3295"><a href="#ModelDescr-3295"><span class="linenos">3295</span></a>            <span class="n">fv_parts</span> <span class="o">=</span> <span class="n">fv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="ModelDescr-3296"><a href="#ModelDescr-3296"><span class="linenos">3296</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fv_parts</span><span class="p">):</span>
</span><span id="ModelDescr-3297"><a href="#ModelDescr-3297"><span class="linenos">3297</span></a>                <span class="k">return</span>
</span><span id="ModelDescr-3298"><a href="#ModelDescr-3298"><span class="linenos">3298</span></a>
</span><span id="ModelDescr-3299"><a href="#ModelDescr-3299"><span class="linenos">3299</span></a>            <span class="n">fv_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">fv_parts</span><span class="p">))</span>
</span><span id="ModelDescr-3300"><a href="#ModelDescr-3300"><span class="linenos">3300</span></a>
</span><span id="ModelDescr-3301"><a href="#ModelDescr-3301"><span class="linenos">3301</span></a>            <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="ModelDescr-3302"><a href="#ModelDescr-3302"><span class="linenos">3302</span></a>            <span class="k">if</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
</span><span id="ModelDescr-3303"><a href="#ModelDescr-3303"><span class="linenos">3303</span></a>                <span class="n">m04</span> <span class="o">=</span> <span class="n">_ModelDescr_v0_4</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModelDescr-3304"><a href="#ModelDescr-3304"><span class="linenos">3304</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m04</span><span class="p">,</span> <span class="n">InvalidDescr</span><span class="p">):</span>
</span><span id="ModelDescr-3305"><a href="#ModelDescr-3305"><span class="linenos">3305</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ModelDescr-3306"><a href="#ModelDescr-3306"><span class="linenos">3306</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span>
</span><span id="ModelDescr-3307"><a href="#ModelDescr-3307"><span class="linenos">3307</span></a>                            <span class="n">m04</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="ModelDescr-3308"><a href="#ModelDescr-3308"><span class="linenos">3308</span></a>                        <span class="p">)</span>
</span><span id="ModelDescr-3309"><a href="#ModelDescr-3309"><span class="linenos">3309</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ModelDescr-3310"><a href="#ModelDescr-3310"><span class="linenos">3310</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ModelDescr-3311"><a href="#ModelDescr-3311"><span class="linenos">3311</span></a>                            <span class="s2">&quot;Failed to convert from invalid model 0.4 description.&quot;</span>
</span><span id="ModelDescr-3312"><a href="#ModelDescr-3312"><span class="linenos">3312</span></a>                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ModelDescr-3313"><a href="#ModelDescr-3313"><span class="linenos">3313</span></a>                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceeding with model 0.5 validation without conversion.&quot;</span>
</span><span id="ModelDescr-3314"><a href="#ModelDescr-3314"><span class="linenos">3314</span></a>                        <span class="p">)</span>
</span><span id="ModelDescr-3315"><a href="#ModelDescr-3315"><span class="linenos">3315</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr-3316"><a href="#ModelDescr-3316"><span class="linenos">3316</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr-3317"><a href="#ModelDescr-3317"><span class="linenos">3317</span></a>                    <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">m04</span><span class="p">)</span>
</span><span id="ModelDescr-3318"><a href="#ModelDescr-3318"><span class="linenos">3318</span></a>
</span><span id="ModelDescr-3319"><a href="#ModelDescr-3319"><span class="linenos">3319</span></a>                <span class="k">if</span> <span class="n">updated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr-3320"><a href="#ModelDescr-3320"><span class="linenos">3320</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ModelDescr-3321"><a href="#ModelDescr-3321"><span class="linenos">3321</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
</span><span id="ModelDescr-3322"><a href="#ModelDescr-3322"><span class="linenos">3322</span></a>
</span><span id="ModelDescr-3323"><a href="#ModelDescr-3323"><span class="linenos">3323</span></a>            <span class="k">elif</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="ModelDescr-3324"><a href="#ModelDescr-3324"><span class="linenos">3324</span></a>                <span class="c1"># bump patch version</span>
</span><span id="ModelDescr-3325"><a href="#ModelDescr-3325"><span class="linenos">3325</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;format_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version</span>
</span></pre></div>


            <div class="docstring"><p>Specification of the fields used in a bioimage.io-compliant RDF to describe AI models with pretrained weights.
These fields are typically stored in a YAML file which we call a model resource description file (model RDF).</p>
</div>


                            <div id="ModelDescr.implemented_format_version" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_format_version</span><span class="annotation">: ClassVar[Literal[&#39;0.5.6&#39;]]</span>        =
<span class="default_value">&#39;0.5.6&#39;</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.implemented_format_version"></a>
    
    

                            </div>
                            <div id="ModelDescr.implemented_type" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_type</span><span class="annotation">: ClassVar[Literal[&#39;model&#39;]]</span>        =
<span class="default_value">&#39;model&#39;</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.implemented_type"></a>
    
    

                            </div>
                            <div id="ModelDescr.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Optional[<a href="#ModelId">ModelId</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.id"></a>
    
            <div class="docstring"><p>bioimage.io-wide unique resource identifier
assigned by bioimage.io; version <strong>un</strong>specific.</p>
</div>


                            </div>
                            <div id="ModelDescr.authors" class="classattr">
                                <div class="attr variable">
            <span class="name">authors</span><span class="annotation">: Annotated[List[<a href="../generic/v0_3.html#Author">bioimageio.spec.generic.v0_3.Author</a>], AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc593b73a60&gt;, severity=35, msg=None, context=None)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.authors"></a>
    
            <div class="docstring"><p>The authors are the creators of the model RDF and the primary points of contact.</p>
</div>


                            </div>
                            <div id="ModelDescr.documentation" class="classattr">
                                <div class="attr variable">
            <span class="name">documentation</span><span class="annotation">: Annotated[Optional[Annotated[Union[bioimageio.spec._internal.url.HttpUrl, bioimageio.spec._internal.io.RelativeFilePath, Annotated[pathlib.Path, PathType(path_type=&#39;file&#39;), FieldInfo(annotation=NoneType, required=True, title=&#39;FilePath&#39;)]], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)]), AfterValidator(func=&lt;function wo_special_file_name at 0x7fc5a20b42c0&gt;), PlainSerializer(func=&lt;function _package_serializer at 0x7fc593b71940&gt;, return_type=PydanticUndefined, when_used=&#39;unless-none&#39;), WithSuffix(suffix=&#39;.md&#39;, case_sensitive=True), FieldInfo(annotation=NoneType, required=True, examples=[&#39;https://raw.githubusercontent.com/bioimage-io/spec-bioimage-io/main/example_descriptions/models/unet2d_nuclei_broad/README.md&#39;, &#39;README.md&#39;])]], AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc593b73a60&gt;, severity=35, msg=None, context=None)]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.documentation"></a>
    
            <div class="docstring"><p>URL or relative path to a markdown file with additional documentation.
The recommended documentation file name is <code>README.md</code>. An <code>.md</code> suffix is mandatory.
The documentation should include a '#[#] Validation' (sub)section
with details on how to quantitatively validate the model on unseen data.</p>
</div>


                            </div>
                            <div id="ModelDescr.inputs" class="classattr">
                                <div class="attr variable">
            <span class="name">inputs</span><span class="annotation">: Annotated[Sequence[<a href="#InputTensorDescr">InputTensorDescr</a>], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.inputs"></a>
    
            <div class="docstring"><p>Describes the input tensors expected by this model.</p>
</div>


                            </div>
                            <div id="ModelDescr.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: Annotated[str, RestrictCharacters(alphabet=&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_+- ()&#39;), MinLen(min_length=5), MaxLen(max_length=128), AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc58cdb9440&gt;, severity=20, msg=&#39;Name longer than 64 characters.&#39;, context={&#39;typ&#39;: Annotated[Any, MaxLen(max_length=64)]})]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.name"></a>
    
            <div class="docstring"><p>A human-readable name of this model.
It should be no longer than 64 characters
and may only contain letter, number, underscore, minus, parentheses and spaces.
We recommend to chose a name that refers to the model's task and image modality.</p>
</div>


                            </div>
                            <div id="ModelDescr.outputs" class="classattr">
                                <div class="attr variable">
            <span class="name">outputs</span><span class="annotation">: Annotated[Sequence[<a href="#OutputTensorDescr">OutputTensorDescr</a>], MinLen(min_length=1)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.outputs"></a>
    
            <div class="docstring"><p>Describes the output tensors.</p>
</div>


                            </div>
                            <div id="ModelDescr.packaged_by" class="classattr">
                                <div class="attr variable">
            <span class="name">packaged_by</span><span class="annotation">: List[<a href="../generic/v0_3.html#Author">bioimageio.spec.generic.v0_3.Author</a>]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.packaged_by"></a>
    
            <div class="docstring"><p>The persons that have packaged and uploaded this model.
Only required if those persons differ from the <code><a href="#ModelDescr.authors">authors</a></code>.</p>
</div>


                            </div>
                            <div id="ModelDescr.parent" class="classattr">
                                <div class="attr variable">
            <span class="name">parent</span><span class="annotation">: Optional[<a href="#LinkedModel">LinkedModel</a>]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.parent"></a>
    
            <div class="docstring"><p>The model from which this model is derived, e.g. by fine-tuning the weights.</p>
</div>


                            </div>
                            <div id="ModelDescr.run_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">run_mode</span><span class="annotation">: Annotated[Optional[<a href="v0_4.html#RunMode">bioimageio.spec.model.v0_4.RunMode</a>], AfterWarner(func=&lt;function as_warning.&lt;locals&gt;.wrapper at 0x7fc58cdb8ae0&gt;, severity=30, msg=&#34;Run mode &#39;{value}&#39; has limited support across consumer softwares.&#34;, context={&#39;typ&#39;: None})]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.run_mode"></a>
    
            <div class="docstring"><p>Custom run mode for this model: for more complex prediction procedures like test time
data augmentation that currently cannot be expressed in the specification.
No standard run modes are defined yet.</p>
</div>


                            </div>
                            <div id="ModelDescr.timestamp" class="classattr">
                                <div class="attr variable">
            <span class="name">timestamp</span><span class="annotation">: bioimageio.spec._internal.types.Datetime</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.timestamp"></a>
    
            <div class="docstring"><p>Timestamp in <a href="#https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format
with a few restrictions listed <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat">here</a>.
(In Python a datetime object is valid, too).</p>
</div>


                            </div>
                            <div id="ModelDescr.training_data" class="classattr">
                                <div class="attr variable">
            <span class="name">training_data</span><span class="annotation">: Annotated[Union[NoneType, <a href="../dataset/v0_3.html#LinkedDataset">bioimageio.spec.dataset.v0_3.LinkedDataset</a>, <a href="../../spec.html#DatasetDescr">bioimageio.spec.DatasetDescr</a>, <a href="../dataset/v0_2.html#DatasetDescr">bioimageio.spec.dataset.v0_2.DatasetDescr</a>], FieldInfo(annotation=NoneType, required=True, metadata=[_PydanticGeneralMetadata(union_mode=&#39;left_to_right&#39;)])]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.training_data"></a>
    
            <div class="docstring"><p>The dataset used to train this model</p>
</div>


                            </div>
                            <div id="ModelDescr.weights" class="classattr">
                                <div class="attr variable">
            <span class="name">weights</span><span class="annotation">: Annotated[<a href="#WeightsDescr">WeightsDescr</a>, WrapSerializer(func=&lt;function package_weights at 0x7fc593986340&gt;, return_type=PydanticUndefined, when_used=&#39;always&#39;)]</span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.weights"></a>
    
            <div class="docstring"><p>The weights for this model.
Weights can be given for different formats, but should otherwise be equivalent.
The available weight formats determine which consumers can use this model.</p>
</div>


                            </div>
                            <div id="ModelDescr.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span><span class="annotation">: <a href="#Config">Config</a></span>        =
<span class="default_value">PydanticUndefined</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.config"></a>
    
    

                            </div>
                            <div id="ModelDescr.get_input_test_arrays" class="classattr">
                                        <input id="ModelDescr.get_input_test_arrays-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_input_test_arrays</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_input_test_arrays-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_input_test_arrays"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_input_test_arrays-3055"><a href="#ModelDescr.get_input_test_arrays-3055"><span class="linenos">3055</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="ModelDescr.get_input_test_arrays-3056"><a href="#ModelDescr.get_input_test_arrays-3056"><span class="linenos">3056</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ModelDescr.get_output_test_arrays" class="classattr">
                                        <input id="ModelDescr.get_output_test_arrays-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_output_test_arrays</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_output_test_arrays-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_output_test_arrays"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_output_test_arrays-3058"><a href="#ModelDescr.get_output_test_arrays-3058"><span class="linenos">3058</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="ModelDescr.get_output_test_arrays-3059"><a href="#ModelDescr.get_output_test_arrays-3059"><span class="linenos">3059</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_test_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ModelDescr.get_batch_size" class="classattr">
                                        <input id="ModelDescr.get_batch_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_batch_size</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tensor_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#AxisId">AxisId</a></span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_batch_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_batch_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_batch_size-3077"><a href="#ModelDescr.get_batch_size-3077"><span class="linenos">3077</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModelDescr.get_batch_size-3078"><a href="#ModelDescr.get_batch_size-3078"><span class="linenos">3078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_batch_size</span><span class="p">(</span><span class="n">tensor_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ModelDescr.get_batch_size-3079"><a href="#ModelDescr.get_batch_size-3079"><span class="linenos">3079</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ModelDescr.get_batch_size-3080"><a href="#ModelDescr.get_batch_size-3080"><span class="linenos">3080</span></a>        <span class="n">tensor_with_batchsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr.get_batch_size-3081"><a href="#ModelDescr.get_batch_size-3081"><span class="linenos">3081</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">:</span>
</span><span id="ModelDescr.get_batch_size-3082"><a href="#ModelDescr.get_batch_size-3082"><span class="linenos">3082</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tensor_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr.get_batch_size-3083"><a href="#ModelDescr.get_batch_size-3083"><span class="linenos">3083</span></a>                <span class="k">if</span> <span class="n">aid</span> <span class="o">!=</span> <span class="n">BATCH_AXIS_ID</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="n">batch_size</span><span class="p">:</span>
</span><span id="ModelDescr.get_batch_size-3084"><a href="#ModelDescr.get_batch_size-3084"><span class="linenos">3084</span></a>                    <span class="k">continue</span>
</span><span id="ModelDescr.get_batch_size-3085"><a href="#ModelDescr.get_batch_size-3085"><span class="linenos">3085</span></a>
</span><span id="ModelDescr.get_batch_size-3086"><a href="#ModelDescr.get_batch_size-3086"><span class="linenos">3086</span></a>                <span class="k">if</span> <span class="n">batch_size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ModelDescr.get_batch_size-3087"><a href="#ModelDescr.get_batch_size-3087"><span class="linenos">3087</span></a>                    <span class="k">assert</span> <span class="n">tensor_with_batchsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ModelDescr.get_batch_size-3088"><a href="#ModelDescr.get_batch_size-3088"><span class="linenos">3088</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr.get_batch_size-3089"><a href="#ModelDescr.get_batch_size-3089"><span class="linenos">3089</span></a>                        <span class="sa">f</span><span class="s2">&quot;batch size mismatch for tensors &#39;</span><span class="si">{</span><span class="n">tensor_with_batchsize</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">) and &#39;</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ModelDescr.get_batch_size-3090"><a href="#ModelDescr.get_batch_size-3090"><span class="linenos">3090</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_batch_size-3091"><a href="#ModelDescr.get_batch_size-3091"><span class="linenos">3091</span></a>
</span><span id="ModelDescr.get_batch_size-3092"><a href="#ModelDescr.get_batch_size-3092"><span class="linenos">3092</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr.get_batch_size-3093"><a href="#ModelDescr.get_batch_size-3093"><span class="linenos">3093</span></a>                <span class="n">tensor_with_batchsize</span> <span class="o">=</span> <span class="n">tid</span>
</span><span id="ModelDescr.get_batch_size-3094"><a href="#ModelDescr.get_batch_size-3094"><span class="linenos">3094</span></a>
</span><span id="ModelDescr.get_batch_size-3095"><a href="#ModelDescr.get_batch_size-3095"><span class="linenos">3095</span></a>        <span class="k">return</span> <span class="n">batch_size</span>
</span></pre></div>


    

                            </div>
                            <div id="ModelDescr.get_output_tensor_sizes" class="classattr">
                                        <input id="ModelDescr.get_output_tensor_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_output_tensor_sizes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#AxisId">AxisId</a></span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n"><a href="#AxisId">AxisId</a></span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">bioimageio</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">v0_5</span><span class="o">.</span><span class="n">_DataDepSize</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_output_tensor_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_output_tensor_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_output_tensor_sizes-3097"><a href="#ModelDescr.get_output_tensor_sizes-3097"><span class="linenos">3097</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_tensor_sizes</span><span class="p">(</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3098"><a href="#ModelDescr.get_output_tensor_sizes-3098"><span class="linenos">3098</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3099"><a href="#ModelDescr.get_output_tensor_sizes-3099"><span class="linenos">3099</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]]:</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3100"><a href="#ModelDescr.get_output_tensor_sizes-3100"><span class="linenos">3100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the tensor output sizes for given **input_sizes**.</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3101"><a href="#ModelDescr.get_output_tensor_sizes-3101"><span class="linenos">3101</span></a><span class="sd">        Only if **input_sizes** has a valid input shape, the tensor output size is exact.</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3102"><a href="#ModelDescr.get_output_tensor_sizes-3102"><span class="linenos">3102</span></a><span class="sd">        Otherwise it might be larger than the actual (valid) output&quot;&quot;&quot;</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3103"><a href="#ModelDescr.get_output_tensor_sizes-3103"><span class="linenos">3103</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_batch_size</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3104"><a href="#ModelDescr.get_output_tensor_sizes-3104"><span class="linenos">3104</span></a>        <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ns</span><span class="p">(</span><span class="n">input_sizes</span><span class="p">)</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3105"><a href="#ModelDescr.get_output_tensor_sizes-3105"><span class="linenos">3105</span></a>
</span><span id="ModelDescr.get_output_tensor_sizes-3106"><a href="#ModelDescr.get_output_tensor_sizes-3106"><span class="linenos">3106</span></a>        <span class="n">tensor_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tensor_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="ModelDescr.get_output_tensor_sizes-3107"><a href="#ModelDescr.get_output_tensor_sizes-3107"><span class="linenos">3107</span></a>        <span class="k">return</span> <span class="n">tensor_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span></pre></div>


            <div class="docstring"><p>Returns the tensor output sizes for given <strong>input_sizes</strong>.
Only if <strong>input_sizes</strong> has a valid input shape, the tensor output size is exact.
Otherwise it might be larger than the actual (valid) output</p>
</div>


                            </div>
                            <div id="ModelDescr.get_ns" class="classattr">
                                        <input id="ModelDescr.get_ns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ns</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#AxisId">AxisId</a></span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ModelDescr.get_ns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_ns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_ns-3109"><a href="#ModelDescr.get_ns-3109"><span class="linenos">3109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sizes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">AxisId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="ModelDescr.get_ns-3110"><a href="#ModelDescr.get_ns-3110"><span class="linenos">3110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;get parameter `n` for each parameterized axis</span>
</span><span id="ModelDescr.get_ns-3111"><a href="#ModelDescr.get_ns-3111"><span class="linenos">3111</span></a><span class="sd">        such that the valid input size is &gt;= the given input size&quot;&quot;&quot;</span>
</span><span id="ModelDescr.get_ns-3112"><a href="#ModelDescr.get_ns-3112"><span class="linenos">3112</span></a>        <span class="n">ret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr.get_ns-3113"><a href="#ModelDescr.get_ns-3113"><span class="linenos">3113</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="ModelDescr.get_ns-3114"><a href="#ModelDescr.get_ns-3114"><span class="linenos">3114</span></a>        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">:</span>
</span><span id="ModelDescr.get_ns-3115"><a href="#ModelDescr.get_ns-3115"><span class="linenos">3115</span></a>            <span class="k">for</span> <span class="n">aid</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">input_sizes</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr.get_ns-3116"><a href="#ModelDescr.get_ns-3116"><span class="linenos">3116</span></a>                <span class="n">size_descr</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">tid</span><span class="p">][</span><span class="n">aid</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="ModelDescr.get_ns-3117"><a href="#ModelDescr.get_ns-3117"><span class="linenos">3117</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="ModelDescr.get_ns-3118"><a href="#ModelDescr.get_ns-3118"><span class="linenos">3118</span></a>                    <span class="n">ret</span><span class="p">[(</span><span class="n">tid</span><span class="p">,</span> <span class="n">aid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">size_descr</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="ModelDescr.get_ns-3119"><a href="#ModelDescr.get_ns-3119"><span class="linenos">3119</span></a>                <span class="k">elif</span> <span class="n">size_descr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_descr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">)):</span>
</span><span id="ModelDescr.get_ns-3120"><a href="#ModelDescr.get_ns-3120"><span class="linenos">3120</span></a>                    <span class="k">pass</span>
</span><span id="ModelDescr.get_ns-3121"><a href="#ModelDescr.get_ns-3121"><span class="linenos">3121</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr.get_ns-3122"><a href="#ModelDescr.get_ns-3122"><span class="linenos">3122</span></a>                    <span class="n">assert_never</span><span class="p">(</span><span class="n">size_descr</span><span class="p">)</span>
</span><span id="ModelDescr.get_ns-3123"><a href="#ModelDescr.get_ns-3123"><span class="linenos">3123</span></a>
</span><span id="ModelDescr.get_ns-3124"><a href="#ModelDescr.get_ns-3124"><span class="linenos">3124</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


            <div class="docstring"><p>get parameter <code>n</code> for each parameterized axis
such that the valid input size is &gt;= the given input size</p>
</div>


                            </div>
                            <div id="ModelDescr.get_tensor_sizes" class="classattr">
                                        <input id="ModelDescr.get_tensor_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tensor_sizes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n"><a href="#AxisId">AxisId</a></span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">bioimageio</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">v0_5</span><span class="o">.</span><span class="n">_TensorSizes</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_tensor_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_tensor_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_tensor_sizes-3126"><a href="#ModelDescr.get_tensor_sizes-3126"><span class="linenos">3126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_tensor_sizes</span><span class="p">(</span>
</span><span id="ModelDescr.get_tensor_sizes-3127"><a href="#ModelDescr.get_tensor_sizes-3127"><span class="linenos">3127</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ModelDescr.get_tensor_sizes-3128"><a href="#ModelDescr.get_tensor_sizes-3128"><span class="linenos">3128</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorSizes</span><span class="p">:</span>
</span><span id="ModelDescr.get_tensor_sizes-3129"><a href="#ModelDescr.get_tensor_sizes-3129"><span class="linenos">3129</span></a>        <span class="n">axis_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_sizes</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="ModelDescr.get_tensor_sizes-3130"><a href="#ModelDescr.get_tensor_sizes-3130"><span class="linenos">3130</span></a>        <span class="k">return</span> <span class="n">_TensorSizes</span><span class="p">(</span>
</span><span id="ModelDescr.get_tensor_sizes-3131"><a href="#ModelDescr.get_tensor_sizes-3131"><span class="linenos">3131</span></a>            <span class="p">{</span>
</span><span id="ModelDescr.get_tensor_sizes-3132"><a href="#ModelDescr.get_tensor_sizes-3132"><span class="linenos">3132</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ModelDescr.get_tensor_sizes-3133"><a href="#ModelDescr.get_tensor_sizes-3133"><span class="linenos">3133</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="ModelDescr.get_tensor_sizes-3134"><a href="#ModelDescr.get_tensor_sizes-3134"><span class="linenos">3134</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="ModelDescr.get_tensor_sizes-3135"><a href="#ModelDescr.get_tensor_sizes-3135"><span class="linenos">3135</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="ModelDescr.get_tensor_sizes-3136"><a href="#ModelDescr.get_tensor_sizes-3136"><span class="linenos">3136</span></a>                <span class="p">}</span>
</span><span id="ModelDescr.get_tensor_sizes-3137"><a href="#ModelDescr.get_tensor_sizes-3137"><span class="linenos">3137</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">inputs</span><span class="p">}</span>
</span><span id="ModelDescr.get_tensor_sizes-3138"><a href="#ModelDescr.get_tensor_sizes-3138"><span class="linenos">3138</span></a>            <span class="p">},</span>
</span><span id="ModelDescr.get_tensor_sizes-3139"><a href="#ModelDescr.get_tensor_sizes-3139"><span class="linenos">3139</span></a>            <span class="p">{</span>
</span><span id="ModelDescr.get_tensor_sizes-3140"><a href="#ModelDescr.get_tensor_sizes-3140"><span class="linenos">3140</span></a>                <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ModelDescr.get_tensor_sizes-3141"><a href="#ModelDescr.get_tensor_sizes-3141"><span class="linenos">3141</span></a>                    <span class="n">aa</span><span class="p">:</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">[(</span><span class="n">tt</span><span class="p">,</span> <span class="n">aa</span><span class="p">)]</span>
</span><span id="ModelDescr.get_tensor_sizes-3142"><a href="#ModelDescr.get_tensor_sizes-3142"><span class="linenos">3142</span></a>                    <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span>
</span><span id="ModelDescr.get_tensor_sizes-3143"><a href="#ModelDescr.get_tensor_sizes-3143"><span class="linenos">3143</span></a>                    <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="n">t</span>
</span><span id="ModelDescr.get_tensor_sizes-3144"><a href="#ModelDescr.get_tensor_sizes-3144"><span class="linenos">3144</span></a>                <span class="p">}</span>
</span><span id="ModelDescr.get_tensor_sizes-3145"><a href="#ModelDescr.get_tensor_sizes-3145"><span class="linenos">3145</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">axis_sizes</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span><span id="ModelDescr.get_tensor_sizes-3146"><a href="#ModelDescr.get_tensor_sizes-3146"><span class="linenos">3146</span></a>            <span class="p">},</span>
</span><span id="ModelDescr.get_tensor_sizes-3147"><a href="#ModelDescr.get_tensor_sizes-3147"><span class="linenos">3147</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ModelDescr.get_axis_sizes" class="classattr">
                                        <input id="ModelDescr.get_axis_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_axis_sizes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n"><a href="#AxisId">AxisId</a></span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">max_input_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="#TensorId">TensorId</a></span><span class="p">,</span> <span class="n"><a href="#AxisId">AxisId</a></span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">bioimageio</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">v0_5</span><span class="o">.</span><span class="n">_AxisSizes</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.get_axis_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.get_axis_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.get_axis_sizes-3149"><a href="#ModelDescr.get_axis_sizes-3149"><span class="linenos">3149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_sizes</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3150"><a href="#ModelDescr.get_axis_sizes-3150"><span class="linenos">3150</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3151"><a href="#ModelDescr.get_axis_sizes-3151"><span class="linenos">3151</span></a>        <span class="n">ns</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">ParameterizedSize_N</span><span class="p">],</span>
</span><span id="ModelDescr.get_axis_sizes-3152"><a href="#ModelDescr.get_axis_sizes-3152"><span class="linenos">3152</span></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3153"><a href="#ModelDescr.get_axis_sizes-3153"><span class="linenos">3153</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3154"><a href="#ModelDescr.get_axis_sizes-3154"><span class="linenos">3154</span></a>        <span class="n">max_input_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3155"><a href="#ModelDescr.get_axis_sizes-3155"><span class="linenos">3155</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_AxisSizes</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3156"><a href="#ModelDescr.get_axis_sizes-3156"><span class="linenos">3156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine input and output block shape for scale factors **ns**</span>
</span><span id="ModelDescr.get_axis_sizes-3157"><a href="#ModelDescr.get_axis_sizes-3157"><span class="linenos">3157</span></a><span class="sd">        of parameterized input sizes.</span>
</span><span id="ModelDescr.get_axis_sizes-3158"><a href="#ModelDescr.get_axis_sizes-3158"><span class="linenos">3158</span></a>
</span><span id="ModelDescr.get_axis_sizes-3159"><a href="#ModelDescr.get_axis_sizes-3159"><span class="linenos">3159</span></a><span class="sd">        Args:</span>
</span><span id="ModelDescr.get_axis_sizes-3160"><a href="#ModelDescr.get_axis_sizes-3160"><span class="linenos">3160</span></a><span class="sd">            ns: Scale factor `n` for each axis (keyed by (tensor_id, axis_id))</span>
</span><span id="ModelDescr.get_axis_sizes-3161"><a href="#ModelDescr.get_axis_sizes-3161"><span class="linenos">3161</span></a><span class="sd">                that is parameterized as `size = min + n * step`.</span>
</span><span id="ModelDescr.get_axis_sizes-3162"><a href="#ModelDescr.get_axis_sizes-3162"><span class="linenos">3162</span></a><span class="sd">            batch_size: The desired size of the batch dimension.</span>
</span><span id="ModelDescr.get_axis_sizes-3163"><a href="#ModelDescr.get_axis_sizes-3163"><span class="linenos">3163</span></a><span class="sd">                If given **batch_size** overwrites any batch size present in</span>
</span><span id="ModelDescr.get_axis_sizes-3164"><a href="#ModelDescr.get_axis_sizes-3164"><span class="linenos">3164</span></a><span class="sd">                **max_input_shape**. Default 1.</span>
</span><span id="ModelDescr.get_axis_sizes-3165"><a href="#ModelDescr.get_axis_sizes-3165"><span class="linenos">3165</span></a><span class="sd">            max_input_shape: Limits the derived block shapes.</span>
</span><span id="ModelDescr.get_axis_sizes-3166"><a href="#ModelDescr.get_axis_sizes-3166"><span class="linenos">3166</span></a><span class="sd">                Each axis for which the input size, parameterized by `n`, is larger</span>
</span><span id="ModelDescr.get_axis_sizes-3167"><a href="#ModelDescr.get_axis_sizes-3167"><span class="linenos">3167</span></a><span class="sd">                than **max_input_shape** is set to the minimal value `n_min` for which</span>
</span><span id="ModelDescr.get_axis_sizes-3168"><a href="#ModelDescr.get_axis_sizes-3168"><span class="linenos">3168</span></a><span class="sd">                this is still true.</span>
</span><span id="ModelDescr.get_axis_sizes-3169"><a href="#ModelDescr.get_axis_sizes-3169"><span class="linenos">3169</span></a><span class="sd">                Use this for small input samples or large values of **ns**.</span>
</span><span id="ModelDescr.get_axis_sizes-3170"><a href="#ModelDescr.get_axis_sizes-3170"><span class="linenos">3170</span></a><span class="sd">                Or simply whenever you know the full input shape.</span>
</span><span id="ModelDescr.get_axis_sizes-3171"><a href="#ModelDescr.get_axis_sizes-3171"><span class="linenos">3171</span></a>
</span><span id="ModelDescr.get_axis_sizes-3172"><a href="#ModelDescr.get_axis_sizes-3172"><span class="linenos">3172</span></a><span class="sd">        Returns:</span>
</span><span id="ModelDescr.get_axis_sizes-3173"><a href="#ModelDescr.get_axis_sizes-3173"><span class="linenos">3173</span></a><span class="sd">            Resolved axis sizes for model inputs and outputs.</span>
</span><span id="ModelDescr.get_axis_sizes-3174"><a href="#ModelDescr.get_axis_sizes-3174"><span class="linenos">3174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3175"><a href="#ModelDescr.get_axis_sizes-3175"><span class="linenos">3175</span></a>        <span class="n">max_input_shape</span> <span class="o">=</span> <span class="n">max_input_shape</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ModelDescr.get_axis_sizes-3176"><a href="#ModelDescr.get_axis_sizes-3176"><span class="linenos">3176</span></a>        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3177"><a href="#ModelDescr.get_axis_sizes-3177"><span class="linenos">3177</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">_t_id</span><span class="p">,</span> <span class="n">a_id</span><span class="p">),</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModelDescr.get_axis_sizes-3178"><a href="#ModelDescr.get_axis_sizes-3178"><span class="linenos">3178</span></a>                <span class="k">if</span> <span class="n">a_id</span> <span class="o">==</span> <span class="n">BATCH_AXIS_ID</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3179"><a href="#ModelDescr.get_axis_sizes-3179"><span class="linenos">3179</span></a>                    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr.get_axis_sizes-3180"><a href="#ModelDescr.get_axis_sizes-3180"><span class="linenos">3180</span></a>                    <span class="k">break</span>
</span><span id="ModelDescr.get_axis_sizes-3181"><a href="#ModelDescr.get_axis_sizes-3181"><span class="linenos">3181</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3182"><a href="#ModelDescr.get_axis_sizes-3182"><span class="linenos">3182</span></a>                <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ModelDescr.get_axis_sizes-3183"><a href="#ModelDescr.get_axis_sizes-3183"><span class="linenos">3183</span></a>
</span><span id="ModelDescr.get_axis_sizes-3184"><a href="#ModelDescr.get_axis_sizes-3184"><span class="linenos">3184</span></a>        <span class="n">all_axes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ModelDescr.get_axis_sizes-3185"><a href="#ModelDescr.get_axis_sizes-3185"><span class="linenos">3185</span></a>            <span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axes</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3186"><a href="#ModelDescr.get_axis_sizes-3186"><span class="linenos">3186</span></a>        <span class="p">}</span>
</span><span id="ModelDescr.get_axis_sizes-3187"><a href="#ModelDescr.get_axis_sizes-3187"><span class="linenos">3187</span></a>
</span><span id="ModelDescr.get_axis_sizes-3188"><a href="#ModelDescr.get_axis_sizes-3188"><span class="linenos">3188</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr.get_axis_sizes-3189"><a href="#ModelDescr.get_axis_sizes-3189"><span class="linenos">3189</span></a>        <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">TensorId</span><span class="p">,</span> <span class="n">AxisId</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ModelDescr.get_axis_sizes-3190"><a href="#ModelDescr.get_axis_sizes-3190"><span class="linenos">3190</span></a>
</span><span id="ModelDescr.get_axis_sizes-3191"><a href="#ModelDescr.get_axis_sizes-3191"><span class="linenos">3191</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InputAxis</span><span class="p">,</span> <span class="n">OutputAxis</span><span class="p">]):</span>
</span><span id="ModelDescr.get_axis_sizes-3192"><a href="#ModelDescr.get_axis_sizes-3192"><span class="linenos">3192</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3193"><a href="#ModelDescr.get_axis_sizes-3193"><span class="linenos">3193</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3194"><a href="#ModelDescr.get_axis_sizes-3194"><span class="linenos">3194</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3195"><a href="#ModelDescr.get_axis_sizes-3195"><span class="linenos">3195</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for batch axis&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3196"><a href="#ModelDescr.get_axis_sizes-3196"><span class="linenos">3196</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3197"><a href="#ModelDescr.get_axis_sizes-3197"><span class="linenos">3197</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3198"><a href="#ModelDescr.get_axis_sizes-3198"><span class="linenos">3198</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3199"><a href="#ModelDescr.get_axis_sizes-3199"><span class="linenos">3199</span></a>                <span class="k">return</span> <span class="n">batch_size</span>
</span><span id="ModelDescr.get_axis_sizes-3200"><a href="#ModelDescr.get_axis_sizes-3200"><span class="linenos">3200</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3201"><a href="#ModelDescr.get_axis_sizes-3201"><span class="linenos">3201</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3202"><a href="#ModelDescr.get_axis_sizes-3202"><span class="linenos">3202</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3203"><a href="#ModelDescr.get_axis_sizes-3203"><span class="linenos">3203</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for fixed size&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3204"><a href="#ModelDescr.get_axis_sizes-3204"><span class="linenos">3204</span></a>                        <span class="o">+</span> <span class="s2">&quot; axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3205"><a href="#ModelDescr.get_axis_sizes-3205"><span class="linenos">3205</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3206"><a href="#ModelDescr.get_axis_sizes-3206"><span class="linenos">3206</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3207"><a href="#ModelDescr.get_axis_sizes-3207"><span class="linenos">3207</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3208"><a href="#ModelDescr.get_axis_sizes-3208"><span class="linenos">3208</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span>
</span><span id="ModelDescr.get_axis_sizes-3209"><a href="#ModelDescr.get_axis_sizes-3209"><span class="linenos">3209</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3210"><a href="#ModelDescr.get_axis_sizes-3210"><span class="linenos">3210</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3211"><a href="#ModelDescr.get_axis_sizes-3211"><span class="linenos">3211</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3212"><a href="#ModelDescr.get_axis_sizes-3212"><span class="linenos">3212</span></a>                        <span class="s2">&quot;Size increment factor (n) missing for parametrized axis&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3213"><a href="#ModelDescr.get_axis_sizes-3213"><span class="linenos">3213</span></a>                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3214"><a href="#ModelDescr.get_axis_sizes-3214"><span class="linenos">3214</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3215"><a href="#ModelDescr.get_axis_sizes-3215"><span class="linenos">3215</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
</span><span id="ModelDescr.get_axis_sizes-3216"><a href="#ModelDescr.get_axis_sizes-3216"><span class="linenos">3216</span></a>                <span class="n">s_max</span> <span class="o">=</span> <span class="n">max_input_shape</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="ModelDescr.get_axis_sizes-3217"><a href="#ModelDescr.get_axis_sizes-3217"><span class="linenos">3217</span></a>                <span class="k">if</span> <span class="n">s_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3218"><a href="#ModelDescr.get_axis_sizes-3218"><span class="linenos">3218</span></a>                    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_n</span><span class="p">(</span><span class="n">s_max</span><span class="p">))</span>
</span><span id="ModelDescr.get_axis_sizes-3219"><a href="#ModelDescr.get_axis_sizes-3219"><span class="linenos">3219</span></a>
</span><span id="ModelDescr.get_axis_sizes-3220"><a href="#ModelDescr.get_axis_sizes-3220"><span class="linenos">3220</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3221"><a href="#ModelDescr.get_axis_sizes-3221"><span class="linenos">3221</span></a>
</span><span id="ModelDescr.get_axis_sizes-3222"><a href="#ModelDescr.get_axis_sizes-3222"><span class="linenos">3222</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3223"><a href="#ModelDescr.get_axis_sizes-3223"><span class="linenos">3223</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3224"><a href="#ModelDescr.get_axis_sizes-3224"><span class="linenos">3224</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3225"><a href="#ModelDescr.get_axis_sizes-3225"><span class="linenos">3225</span></a>                        <span class="s2">&quot;Ignoring unexpected size increment factor (n) for axis &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3226"><a href="#ModelDescr.get_axis_sizes-3226"><span class="linenos">3226</span></a>                        <span class="o">+</span> <span class="s2">&quot; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39; with size reference.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3227"><a href="#ModelDescr.get_axis_sizes-3227"><span class="linenos">3227</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3228"><a href="#ModelDescr.get_axis_sizes-3228"><span class="linenos">3228</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3229"><a href="#ModelDescr.get_axis_sizes-3229"><span class="linenos">3229</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3230"><a href="#ModelDescr.get_axis_sizes-3230"><span class="linenos">3230</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3231"><a href="#ModelDescr.get_axis_sizes-3231"><span class="linenos">3231</span></a>                <span class="n">ref_axis</span> <span class="o">=</span> <span class="n">all_axes</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">]</span>
</span><span id="ModelDescr.get_axis_sizes-3232"><a href="#ModelDescr.get_axis_sizes-3232"><span class="linenos">3232</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">BatchAxis</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3233"><a href="#ModelDescr.get_axis_sizes-3233"><span class="linenos">3233</span></a>                <span class="n">ref_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">tensor_id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">axis_id</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3234"><a href="#ModelDescr.get_axis_sizes-3234"><span class="linenos">3234</span></a>                <span class="n">ref_size</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">,</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref_key</span><span class="p">))</span>
</span><span id="ModelDescr.get_axis_sizes-3235"><a href="#ModelDescr.get_axis_sizes-3235"><span class="linenos">3235</span></a>                <span class="k">assert</span> <span class="n">ref_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ref_key</span>
</span><span id="ModelDescr.get_axis_sizes-3236"><a href="#ModelDescr.get_axis_sizes-3236"><span class="linenos">3236</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_size</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">),</span> <span class="n">ref_key</span>
</span><span id="ModelDescr.get_axis_sizes-3237"><a href="#ModelDescr.get_axis_sizes-3237"><span class="linenos">3237</span></a>                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3238"><a href="#ModelDescr.get_axis_sizes-3238"><span class="linenos">3238</span></a>                    <span class="n">axis</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3239"><a href="#ModelDescr.get_axis_sizes-3239"><span class="linenos">3239</span></a>                    <span class="n">ref_axis</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3240"><a href="#ModelDescr.get_axis_sizes-3240"><span class="linenos">3240</span></a>                    <span class="n">ref_size</span><span class="o">=</span><span class="n">ref_size</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3241"><a href="#ModelDescr.get_axis_sizes-3241"><span class="linenos">3241</span></a>                <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3242"><a href="#ModelDescr.get_axis_sizes-3242"><span class="linenos">3242</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">DataDependentSize</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3243"><a href="#ModelDescr.get_axis_sizes-3243"><span class="linenos">3243</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3244"><a href="#ModelDescr.get_axis_sizes-3244"><span class="linenos">3244</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ModelDescr.get_axis_sizes-3245"><a href="#ModelDescr.get_axis_sizes-3245"><span class="linenos">3245</span></a>                        <span class="s2">&quot;Ignoring unexpected increment factor (n) for data dependent&quot;</span>
</span><span id="ModelDescr.get_axis_sizes-3246"><a href="#ModelDescr.get_axis_sizes-3246"><span class="linenos">3246</span></a>                        <span class="o">+</span> <span class="s2">&quot; size axis &#39;</span><span class="si">{}</span><span class="s2">&#39; of tensor &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3247"><a href="#ModelDescr.get_axis_sizes-3247"><span class="linenos">3247</span></a>                        <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3248"><a href="#ModelDescr.get_axis_sizes-3248"><span class="linenos">3248</span></a>                        <span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="ModelDescr.get_axis_sizes-3249"><a href="#ModelDescr.get_axis_sizes-3249"><span class="linenos">3249</span></a>                    <span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3250"><a href="#ModelDescr.get_axis_sizes-3250"><span class="linenos">3250</span></a>                <span class="k">return</span> <span class="n">_DataDepSize</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3251"><a href="#ModelDescr.get_axis_sizes-3251"><span class="linenos">3251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3252"><a href="#ModelDescr.get_axis_sizes-3252"><span class="linenos">3252</span></a>                <span class="n">assert_never</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3253"><a href="#ModelDescr.get_axis_sizes-3253"><span class="linenos">3253</span></a>
</span><span id="ModelDescr.get_axis_sizes-3254"><a href="#ModelDescr.get_axis_sizes-3254"><span class="linenos">3254</span></a>        <span class="c1"># first resolve all , but the `SizeReference` input sizes</span>
</span><span id="ModelDescr.get_axis_sizes-3255"><a href="#ModelDescr.get_axis_sizes-3255"><span class="linenos">3255</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3256"><a href="#ModelDescr.get_axis_sizes-3256"><span class="linenos">3256</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3257"><a href="#ModelDescr.get_axis_sizes-3257"><span class="linenos">3257</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3258"><a href="#ModelDescr.get_axis_sizes-3258"><span class="linenos">3258</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3259"><a href="#ModelDescr.get_axis_sizes-3259"><span class="linenos">3259</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3260"><a href="#ModelDescr.get_axis_sizes-3260"><span class="linenos">3260</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr.get_axis_sizes-3261"><a href="#ModelDescr.get_axis_sizes-3261"><span class="linenos">3261</span></a>
</span><span id="ModelDescr.get_axis_sizes-3262"><a href="#ModelDescr.get_axis_sizes-3262"><span class="linenos">3262</span></a>        <span class="c1"># resolve all other input axis sizes</span>
</span><span id="ModelDescr.get_axis_sizes-3263"><a href="#ModelDescr.get_axis_sizes-3263"><span class="linenos">3263</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3264"><a href="#ModelDescr.get_axis_sizes-3264"><span class="linenos">3264</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3265"><a href="#ModelDescr.get_axis_sizes-3265"><span class="linenos">3265</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">SizeReference</span><span class="p">):</span>
</span><span id="ModelDescr.get_axis_sizes-3266"><a href="#ModelDescr.get_axis_sizes-3266"><span class="linenos">3266</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3267"><a href="#ModelDescr.get_axis_sizes-3267"><span class="linenos">3267</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">_DataDepSize</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3268"><a href="#ModelDescr.get_axis_sizes-3268"><span class="linenos">3268</span></a>                    <span class="n">inputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr.get_axis_sizes-3269"><a href="#ModelDescr.get_axis_sizes-3269"><span class="linenos">3269</span></a>
</span><span id="ModelDescr.get_axis_sizes-3270"><a href="#ModelDescr.get_axis_sizes-3270"><span class="linenos">3270</span></a>        <span class="c1"># resolve all output axis sizes</span>
</span><span id="ModelDescr.get_axis_sizes-3271"><a href="#ModelDescr.get_axis_sizes-3271"><span class="linenos">3271</span></a>        <span class="k">for</span> <span class="n">t_descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3272"><a href="#ModelDescr.get_axis_sizes-3272"><span class="linenos">3272</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
</span><span id="ModelDescr.get_axis_sizes-3273"><a href="#ModelDescr.get_axis_sizes-3273"><span class="linenos">3273</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ParameterizedSize</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3274"><a href="#ModelDescr.get_axis_sizes-3274"><span class="linenos">3274</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">get_axis_size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="ModelDescr.get_axis_sizes-3275"><a href="#ModelDescr.get_axis_sizes-3275"><span class="linenos">3275</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">t_descr</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="ModelDescr.get_axis_sizes-3276"><a href="#ModelDescr.get_axis_sizes-3276"><span class="linenos">3276</span></a>
</span><span id="ModelDescr.get_axis_sizes-3277"><a href="#ModelDescr.get_axis_sizes-3277"><span class="linenos">3277</span></a>        <span class="k">return</span> <span class="n">_AxisSizes</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Determine input and output block shape for scale factors <strong>ns</strong>
of parameterized input sizes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>ns:</strong>  Scale factor <code>n</code> for each axis (keyed by (tensor_id, axis_id))
that is parameterized as <code>size = min + n * step</code>.</li>
<li><strong>batch_size:</strong>  The desired size of the batch dimension.
If given <strong>batch_size</strong> overwrites any batch size present in
<strong>max_input_shape</strong>. Default 1.</li>
<li><strong>max_input_shape:</strong>  Limits the derived block shapes.
Each axis for which the input size, parameterized by <code>n</code>, is larger
than <strong>max_input_shape</strong> is set to the minimal value <code>n_min</code> for which
this is still true.
Use this for small input samples or large values of <strong>ns</strong>.
Or simply whenever you know the full input shape.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Resolved axis sizes for model inputs and outputs.</p>
</blockquote>
</div>


                            </div>
                            <div id="ModelDescr.convert_from_old_format_wo_validation" class="classattr">
                                        <input id="ModelDescr.convert_from_old_format_wo_validation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">convert_from_old_format_wo_validation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ModelDescr.convert_from_old_format_wo_validation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelDescr.convert_from_old_format_wo_validation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelDescr.convert_from_old_format_wo_validation-3285"><a href="#ModelDescr.convert_from_old_format_wo_validation-3285"><span class="linenos">3285</span></a>    <span class="nd">@classmethod</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3286"><a href="#ModelDescr.convert_from_old_format_wo_validation-3286"><span class="linenos">3286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_from_old_format_wo_validation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3287"><a href="#ModelDescr.convert_from_old_format_wo_validation-3287"><span class="linenos">3287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert metadata following an older format version to this classes&#39; format</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3288"><a href="#ModelDescr.convert_from_old_format_wo_validation-3288"><span class="linenos">3288</span></a><span class="sd">        without validating the result.</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3289"><a href="#ModelDescr.convert_from_old_format_wo_validation-3289"><span class="linenos">3289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3290"><a href="#ModelDescr.convert_from_old_format_wo_validation-3290"><span class="linenos">3290</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3291"><a href="#ModelDescr.convert_from_old_format_wo_validation-3291"><span class="linenos">3291</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3292"><a href="#ModelDescr.convert_from_old_format_wo_validation-3292"><span class="linenos">3292</span></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fv</span> <span class="o">:=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format_version&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3293"><a href="#ModelDescr.convert_from_old_format_wo_validation-3293"><span class="linenos">3293</span></a>            <span class="ow">and</span> <span class="n">fv</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3294"><a href="#ModelDescr.convert_from_old_format_wo_validation-3294"><span class="linenos">3294</span></a>        <span class="p">):</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3295"><a href="#ModelDescr.convert_from_old_format_wo_validation-3295"><span class="linenos">3295</span></a>            <span class="n">fv_parts</span> <span class="o">=</span> <span class="n">fv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3296"><a href="#ModelDescr.convert_from_old_format_wo_validation-3296"><span class="linenos">3296</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fv_parts</span><span class="p">):</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3297"><a href="#ModelDescr.convert_from_old_format_wo_validation-3297"><span class="linenos">3297</span></a>                <span class="k">return</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3298"><a href="#ModelDescr.convert_from_old_format_wo_validation-3298"><span class="linenos">3298</span></a>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3299"><a href="#ModelDescr.convert_from_old_format_wo_validation-3299"><span class="linenos">3299</span></a>            <span class="n">fv_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">fv_parts</span><span class="p">))</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3300"><a href="#ModelDescr.convert_from_old_format_wo_validation-3300"><span class="linenos">3300</span></a>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3301"><a href="#ModelDescr.convert_from_old_format_wo_validation-3301"><span class="linenos">3301</span></a>            <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3302"><a href="#ModelDescr.convert_from_old_format_wo_validation-3302"><span class="linenos">3302</span></a>            <span class="k">if</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3303"><a href="#ModelDescr.convert_from_old_format_wo_validation-3303"><span class="linenos">3303</span></a>                <span class="n">m04</span> <span class="o">=</span> <span class="n">_ModelDescr_v0_4</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3304"><a href="#ModelDescr.convert_from_old_format_wo_validation-3304"><span class="linenos">3304</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m04</span><span class="p">,</span> <span class="n">InvalidDescr</span><span class="p">):</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3305"><a href="#ModelDescr.convert_from_old_format_wo_validation-3305"><span class="linenos">3305</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3306"><a href="#ModelDescr.convert_from_old_format_wo_validation-3306"><span class="linenos">3306</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3307"><a href="#ModelDescr.convert_from_old_format_wo_validation-3307"><span class="linenos">3307</span></a>                            <span class="n">m04</span>  <span class="c1"># pyright: ignore[reportArgumentType]</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3308"><a href="#ModelDescr.convert_from_old_format_wo_validation-3308"><span class="linenos">3308</span></a>                        <span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3309"><a href="#ModelDescr.convert_from_old_format_wo_validation-3309"><span class="linenos">3309</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3310"><a href="#ModelDescr.convert_from_old_format_wo_validation-3310"><span class="linenos">3310</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3311"><a href="#ModelDescr.convert_from_old_format_wo_validation-3311"><span class="linenos">3311</span></a>                            <span class="s2">&quot;Failed to convert from invalid model 0.4 description.&quot;</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3312"><a href="#ModelDescr.convert_from_old_format_wo_validation-3312"><span class="linenos">3312</span></a>                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3313"><a href="#ModelDescr.convert_from_old_format_wo_validation-3313"><span class="linenos">3313</span></a>                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Proceeding with model 0.5 validation without conversion.&quot;</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3314"><a href="#ModelDescr.convert_from_old_format_wo_validation-3314"><span class="linenos">3314</span></a>                        <span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3315"><a href="#ModelDescr.convert_from_old_format_wo_validation-3315"><span class="linenos">3315</span></a>                        <span class="n">updated</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3316"><a href="#ModelDescr.convert_from_old_format_wo_validation-3316"><span class="linenos">3316</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3317"><a href="#ModelDescr.convert_from_old_format_wo_validation-3317"><span class="linenos">3317</span></a>                    <span class="n">updated</span> <span class="o">=</span> <span class="n">_model_conv</span><span class="o">.</span><span class="n">convert_as_dict</span><span class="p">(</span><span class="n">m04</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3318"><a href="#ModelDescr.convert_from_old_format_wo_validation-3318"><span class="linenos">3318</span></a>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3319"><a href="#ModelDescr.convert_from_old_format_wo_validation-3319"><span class="linenos">3319</span></a>                <span class="k">if</span> <span class="n">updated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3320"><a href="#ModelDescr.convert_from_old_format_wo_validation-3320"><span class="linenos">3320</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3321"><a href="#ModelDescr.convert_from_old_format_wo_validation-3321"><span class="linenos">3321</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3322"><a href="#ModelDescr.convert_from_old_format_wo_validation-3322"><span class="linenos">3322</span></a>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3323"><a href="#ModelDescr.convert_from_old_format_wo_validation-3323"><span class="linenos">3323</span></a>            <span class="k">elif</span> <span class="n">fv_tuple</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3324"><a href="#ModelDescr.convert_from_old_format_wo_validation-3324"><span class="linenos">3324</span></a>                <span class="c1"># bump patch version</span>
</span><span id="ModelDescr.convert_from_old_format_wo_validation-3325"><a href="#ModelDescr.convert_from_old_format_wo_validation-3325"><span class="linenos">3325</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;format_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">implemented_format_version</span>
</span></pre></div>


            <div class="docstring"><p>Convert metadata following an older format version to this classes' format
without validating the result.</p>
</div>


                            </div>
                            <div id="ModelDescr.implemented_format_version_tuple" class="classattr">
                                <div class="attr variable">
            <span class="name">implemented_format_version_tuple</span><span class="annotation">: ClassVar[Tuple[int, int, int]]</span>        =
<span class="default_value">(0, 5, 6)</span>

        
    </div>
    <a class="headerlink" href="#ModelDescr.implemented_format_version_tuple"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../generic/v0_3.html#GenericModelDescrBase">bioimageio.spec.generic.v0_3.GenericModelDescrBase</a></dt>
                                <dd id="ModelDescr.description" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.description">description</a></dd>
                <dd id="ModelDescr.covers" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.covers">covers</a></dd>
                <dd id="ModelDescr.id_emoji" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.id_emoji">id_emoji</a></dd>
                <dd id="ModelDescr.attachments" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.attachments">attachments</a></dd>
                <dd id="ModelDescr.cite" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.cite">cite</a></dd>
                <dd id="ModelDescr.license" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.license">license</a></dd>
                <dd id="ModelDescr.git_repo" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.git_repo">git_repo</a></dd>
                <dd id="ModelDescr.icon" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.icon">icon</a></dd>
                <dd id="ModelDescr.links" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.links">links</a></dd>
                <dd id="ModelDescr.uploader" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.uploader">uploader</a></dd>
                <dd id="ModelDescr.maintainers" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.maintainers">maintainers</a></dd>
                <dd id="ModelDescr.tags" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.tags">tags</a></dd>
                <dd id="ModelDescr.warn_about_tag_categories" class="function"><a href="../generic/v0_3.html#GenericModelDescrBase.warn_about_tag_categories">warn_about_tag_categories</a></dd>
                <dd id="ModelDescr.version" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.version">version</a></dd>
                <dd id="ModelDescr.version_comment" class="variable"><a href="../generic/v0_3.html#GenericModelDescrBase.version_comment">version_comment</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="generate_covers">
                            <input id="generate_covers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_covers</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="#InputTensorDescr">InputTensorDescr</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">outputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n"><a href="#OutputTensorDescr">OutputTensorDescr</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="generate_covers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generate_covers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generate_covers-3542"><a href="#generate_covers-3542"><span class="linenos">3542</span></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_covers</span><span class="p">(</span>
</span><span id="generate_covers-3543"><a href="#generate_covers-3543"><span class="linenos">3543</span></a>    <span class="n">inputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">InputTensorDescr</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span>
</span><span id="generate_covers-3544"><a href="#generate_covers-3544"><span class="linenos">3544</span></a>    <span class="n">outputs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OutputTensorDescr</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span>
</span><span id="generate_covers-3545"><a href="#generate_covers-3545"><span class="linenos">3545</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="generate_covers-3546"><a href="#generate_covers-3546"><span class="linenos">3546</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">squeeze</span><span class="p">(</span>
</span><span id="generate_covers-3547"><a href="#generate_covers-3547"><span class="linenos">3547</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]</span>
</span><span id="generate_covers-3548"><a href="#generate_covers-3548"><span class="linenos">3548</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]]:</span>
</span><span id="generate_covers-3549"><a href="#generate_covers-3549"><span class="linenos">3549</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;apply numpy.ndarray.squeeze while keeping track of the axis descriptions remaining&quot;&quot;&quot;</span>
</span><span id="generate_covers-3550"><a href="#generate_covers-3550"><span class="linenos">3550</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="generate_covers-3551"><a href="#generate_covers-3551"><span class="linenos">3551</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="generate_covers-3552"><a href="#generate_covers-3552"><span class="linenos">3552</span></a>                <span class="sa">f</span><span class="s2">&quot;tensor shape </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> does not match described axes&quot;</span>
</span><span id="generate_covers-3553"><a href="#generate_covers-3553"><span class="linenos">3553</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">axes</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="generate_covers-3554"><a href="#generate_covers-3554"><span class="linenos">3554</span></a>            <span class="p">)</span>
</span><span id="generate_covers-3555"><a href="#generate_covers-3555"><span class="linenos">3555</span></a>
</span><span id="generate_covers-3556"><a href="#generate_covers-3556"><span class="linenos">3556</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="generate_covers-3557"><a href="#generate_covers-3557"><span class="linenos">3557</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">axes</span>
</span><span id="generate_covers-3558"><a href="#generate_covers-3558"><span class="linenos">3558</span></a>
</span><span id="generate_covers-3559"><a href="#generate_covers-3559"><span class="linenos">3559</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span>
</span><span id="generate_covers-3560"><a href="#generate_covers-3560"><span class="linenos">3560</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="generate_covers-3561"><a href="#generate_covers-3561"><span class="linenos">3561</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
</span><span id="generate_covers-3562"><a href="#generate_covers-3562"><span class="linenos">3562</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="generate_covers-3563"><a href="#generate_covers-3563"><span class="linenos">3563</span></a>        <span class="n">data</span> <span class="o">-=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="generate_covers-3564"><a href="#generate_covers-3564"><span class="linenos">3564</span></a>        <span class="n">data</span> <span class="o">/=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
</span><span id="generate_covers-3565"><a href="#generate_covers-3565"><span class="linenos">3565</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="generate_covers-3566"><a href="#generate_covers-3566"><span class="linenos">3566</span></a>
</span><span id="generate_covers-3567"><a href="#generate_covers-3567"><span class="linenos">3567</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_2d_image</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyAxis</span><span class="p">]):</span>
</span><span id="generate_covers-3568"><a href="#generate_covers-3568"><span class="linenos">3568</span></a>        <span class="n">original_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><span id="generate_covers-3569"><a href="#generate_covers-3569"><span class="linenos">3569</span></a>        <span class="n">original_axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3570"><a href="#generate_covers-3570"><span class="linenos">3570</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3571"><a href="#generate_covers-3571"><span class="linenos">3571</span></a>
</span><span id="generate_covers-3572"><a href="#generate_covers-3572"><span class="linenos">3572</span></a>        <span class="c1"># take slice fom any batch or index axis if needed</span>
</span><span id="generate_covers-3573"><a href="#generate_covers-3573"><span class="linenos">3573</span></a>        <span class="c1"># and convert the first channel axis and take a slice from any additional channel axes</span>
</span><span id="generate_covers-3574"><a href="#generate_covers-3574"><span class="linenos">3574</span></a>        <span class="n">slices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="generate_covers-3575"><a href="#generate_covers-3575"><span class="linenos">3575</span></a>        <span class="n">ndim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="generate_covers-3576"><a href="#generate_covers-3576"><span class="linenos">3576</span></a>        <span class="n">ndim_need</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="generate_covers-3577"><a href="#generate_covers-3577"><span class="linenos">3577</span></a>        <span class="n">has_c_axis</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="generate_covers-3578"><a href="#generate_covers-3578"><span class="linenos">3578</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="generate_covers-3579"><a href="#generate_covers-3579"><span class="linenos">3579</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="generate_covers-3580"><a href="#generate_covers-3580"><span class="linenos">3580</span></a>            <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="generate_covers-3581"><a href="#generate_covers-3581"><span class="linenos">3581</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="generate_covers-3582"><a href="#generate_covers-3582"><span class="linenos">3582</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">BatchAxis</span><span class="p">,</span> <span class="n">IndexInputAxis</span><span class="p">,</span> <span class="n">IndexOutputAxis</span><span class="p">))</span>
</span><span id="generate_covers-3583"><a href="#generate_covers-3583"><span class="linenos">3583</span></a>                <span class="ow">and</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">ndim_need</span>
</span><span id="generate_covers-3584"><a href="#generate_covers-3584"><span class="linenos">3584</span></a>            <span class="p">):</span>
</span><span id="generate_covers-3585"><a href="#generate_covers-3585"><span class="linenos">3585</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="generate_covers-3586"><a href="#generate_covers-3586"><span class="linenos">3586</span></a>                <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="generate_covers-3587"><a href="#generate_covers-3587"><span class="linenos">3587</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ChannelAxis</span><span class="p">):</span>
</span><span id="generate_covers-3588"><a href="#generate_covers-3588"><span class="linenos">3588</span></a>                <span class="k">if</span> <span class="n">has_c_axis</span><span class="p">:</span>
</span><span id="generate_covers-3589"><a href="#generate_covers-3589"><span class="linenos">3589</span></a>                    <span class="c1"># second channel axis</span>
</span><span id="generate_covers-3590"><a href="#generate_covers-3590"><span class="linenos">3590</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)]</span>
</span><span id="generate_covers-3591"><a href="#generate_covers-3591"><span class="linenos">3591</span></a>                    <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="generate_covers-3592"><a href="#generate_covers-3592"><span class="linenos">3592</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="generate_covers-3593"><a href="#generate_covers-3593"><span class="linenos">3593</span></a>                    <span class="n">has_c_axis</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="generate_covers-3594"><a href="#generate_covers-3594"><span class="linenos">3594</span></a>                    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="generate_covers-3595"><a href="#generate_covers-3595"><span class="linenos">3595</span></a>                        <span class="c1"># visualize two channels with cyan and magenta</span>
</span><span id="generate_covers-3596"><a href="#generate_covers-3596"><span class="linenos">3596</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="generate_covers-3597"><a href="#generate_covers-3597"><span class="linenos">3597</span></a>                            <span class="p">[</span>
</span><span id="generate_covers-3598"><a href="#generate_covers-3598"><span class="linenos">3598</span></a>                                <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),)],</span>
</span><span id="generate_covers-3599"><a href="#generate_covers-3599"><span class="linenos">3599</span></a>                                <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)],</span>
</span><span id="generate_covers-3600"><a href="#generate_covers-3600"><span class="linenos">3600</span></a>                                <span class="p">(</span>
</span><span id="generate_covers-3601"><a href="#generate_covers-3601"><span class="linenos">3601</span></a>                                    <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)]</span>
</span><span id="generate_covers-3602"><a href="#generate_covers-3602"><span class="linenos">3602</span></a>                                    <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="generate_covers-3603"><a href="#generate_covers-3603"><span class="linenos">3603</span></a>                                <span class="p">)</span>
</span><span id="generate_covers-3604"><a href="#generate_covers-3604"><span class="linenos">3604</span></a>                                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># TODO: take maximum instead?</span>
</span><span id="generate_covers-3605"><a href="#generate_covers-3605"><span class="linenos">3605</span></a>                            <span class="p">],</span>
</span><span id="generate_covers-3606"><a href="#generate_covers-3606"><span class="linenos">3606</span></a>                            <span class="n">axis</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="generate_covers-3607"><a href="#generate_covers-3607"><span class="linenos">3607</span></a>                        <span class="p">)</span>
</span><span id="generate_covers-3608"><a href="#generate_covers-3608"><span class="linenos">3608</span></a>                    <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="generate_covers-3609"><a href="#generate_covers-3609"><span class="linenos">3609</span></a>                        <span class="k">pass</span>  <span class="c1"># visualize 3 channels as RGB</span>
</span><span id="generate_covers-3610"><a href="#generate_covers-3610"><span class="linenos">3610</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="generate_covers-3611"><a href="#generate_covers-3611"><span class="linenos">3611</span></a>                        <span class="c1"># visualize first 3 channels as RGB</span>
</span><span id="generate_covers-3612"><a href="#generate_covers-3612"><span class="linenos">3612</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">),)]</span>
</span><span id="generate_covers-3613"><a href="#generate_covers-3613"><span class="linenos">3613</span></a>
</span><span id="generate_covers-3614"><a href="#generate_covers-3614"><span class="linenos">3614</span></a>                    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="generate_covers-3615"><a href="#generate_covers-3615"><span class="linenos">3615</span></a>
</span><span id="generate_covers-3616"><a href="#generate_covers-3616"><span class="linenos">3616</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="generate_covers-3617"><a href="#generate_covers-3617"><span class="linenos">3617</span></a>
</span><span id="generate_covers-3618"><a href="#generate_covers-3618"><span class="linenos">3618</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3619"><a href="#generate_covers-3619"><span class="linenos">3619</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndim</span>
</span><span id="generate_covers-3620"><a href="#generate_covers-3620"><span class="linenos">3620</span></a>        <span class="c1"># take slice from z axis if needed</span>
</span><span id="generate_covers-3621"><a href="#generate_covers-3621"><span class="linenos">3621</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="generate_covers-3622"><a href="#generate_covers-3622"><span class="linenos">3622</span></a>        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">ndim_need</span><span class="p">:</span>
</span><span id="generate_covers-3623"><a href="#generate_covers-3623"><span class="linenos">3623</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="generate_covers-3624"><a href="#generate_covers-3624"><span class="linenos">3624</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="generate_covers-3625"><a href="#generate_covers-3625"><span class="linenos">3625</span></a>                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">AxisId</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">):</span>
</span><span id="generate_covers-3626"><a href="#generate_covers-3626"><span class="linenos">3626</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="generate_covers-3627"><a href="#generate_covers-3627"><span class="linenos">3627</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3628"><a href="#generate_covers-3628"><span class="linenos">3628</span></a>                    <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="generate_covers-3629"><a href="#generate_covers-3629"><span class="linenos">3629</span></a>                    <span class="k">break</span>
</span><span id="generate_covers-3630"><a href="#generate_covers-3630"><span class="linenos">3630</span></a>
</span><span id="generate_covers-3631"><a href="#generate_covers-3631"><span class="linenos">3631</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="generate_covers-3632"><a href="#generate_covers-3632"><span class="linenos">3632</span></a>
</span><span id="generate_covers-3633"><a href="#generate_covers-3633"><span class="linenos">3633</span></a>        <span class="c1"># take slice from any space or time axis</span>
</span><span id="generate_covers-3634"><a href="#generate_covers-3634"><span class="linenos">3634</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="generate_covers-3635"><a href="#generate_covers-3635"><span class="linenos">3635</span></a>
</span><span id="generate_covers-3636"><a href="#generate_covers-3636"><span class="linenos">3636</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
</span><span id="generate_covers-3637"><a href="#generate_covers-3637"><span class="linenos">3637</span></a>            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&lt;=</span> <span class="n">ndim_need</span><span class="p">:</span>
</span><span id="generate_covers-3638"><a href="#generate_covers-3638"><span class="linenos">3638</span></a>                <span class="k">break</span>
</span><span id="generate_covers-3639"><a href="#generate_covers-3639"><span class="linenos">3639</span></a>
</span><span id="generate_covers-3640"><a href="#generate_covers-3640"><span class="linenos">3640</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="generate_covers-3641"><a href="#generate_covers-3641"><span class="linenos">3641</span></a>            <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="generate_covers-3642"><a href="#generate_covers-3642"><span class="linenos">3642</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="generate_covers-3643"><a href="#generate_covers-3643"><span class="linenos">3643</span></a>                <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">SpaceInputAxis</span><span class="p">,</span> <span class="n">SpaceOutputAxis</span><span class="p">,</span> <span class="n">TimeInputAxis</span><span class="p">,</span> <span class="n">TimeOutputAxis</span><span class="p">)</span>
</span><span id="generate_covers-3644"><a href="#generate_covers-3644"><span class="linenos">3644</span></a>            <span class="p">):</span>
</span><span id="generate_covers-3645"><a href="#generate_covers-3645"><span class="linenos">3645</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">slices</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">s</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)]</span>
</span><span id="generate_covers-3646"><a href="#generate_covers-3646"><span class="linenos">3646</span></a>                <span class="n">ndim</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="generate_covers-3647"><a href="#generate_covers-3647"><span class="linenos">3647</span></a>
</span><span id="generate_covers-3648"><a href="#generate_covers-3648"><span class="linenos">3648</span></a>            <span class="n">slices</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)</span>
</span><span id="generate_covers-3649"><a href="#generate_covers-3649"><span class="linenos">3649</span></a>
</span><span id="generate_covers-3650"><a href="#generate_covers-3650"><span class="linenos">3650</span></a>        <span class="k">del</span> <span class="n">slices</span>
</span><span id="generate_covers-3651"><a href="#generate_covers-3651"><span class="linenos">3651</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3652"><a href="#generate_covers-3652"><span class="linenos">3652</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndim</span>
</span><span id="generate_covers-3653"><a href="#generate_covers-3653"><span class="linenos">3653</span></a>
</span><span id="generate_covers-3654"><a href="#generate_covers-3654"><span class="linenos">3654</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">has_c_axis</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">has_c_axis</span> <span class="ow">and</span> <span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="generate_covers-3655"><a href="#generate_covers-3655"><span class="linenos">3655</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="generate_covers-3656"><a href="#generate_covers-3656"><span class="linenos">3656</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to construct cover image from shape </span><span class="si">{</span><span class="n">original_shape</span><span class="si">}</span><span class="s2"> with axes </span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">original_axes</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="generate_covers-3657"><a href="#generate_covers-3657"><span class="linenos">3657</span></a>            <span class="p">)</span>
</span><span id="generate_covers-3658"><a href="#generate_covers-3658"><span class="linenos">3658</span></a>
</span><span id="generate_covers-3659"><a href="#generate_covers-3659"><span class="linenos">3659</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_c_axis</span><span class="p">:</span>
</span><span id="generate_covers-3660"><a href="#generate_covers-3660"><span class="linenos">3660</span></a>            <span class="k">assert</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="generate_covers-3661"><a href="#generate_covers-3661"><span class="linenos">3661</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="generate_covers-3662"><a href="#generate_covers-3662"><span class="linenos">3662</span></a>            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChannelAxis</span><span class="p">(</span><span class="n">channel_names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="s2">&quot;RGB&quot;</span><span class="p">))))</span>
</span><span id="generate_covers-3663"><a href="#generate_covers-3663"><span class="linenos">3663</span></a>            <span class="n">ndim</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="generate_covers-3664"><a href="#generate_covers-3664"><span class="linenos">3664</span></a>
</span><span id="generate_covers-3665"><a href="#generate_covers-3665"><span class="linenos">3665</span></a>        <span class="k">assert</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="generate_covers-3666"><a href="#generate_covers-3666"><span class="linenos">3666</span></a>
</span><span id="generate_covers-3667"><a href="#generate_covers-3667"><span class="linenos">3667</span></a>        <span class="c1"># transpose axis order such that longest axis comes first...</span>
</span><span id="generate_covers-3668"><a href="#generate_covers-3668"><span class="linenos">3668</span></a>        <span class="n">axis_order</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
</span><span id="generate_covers-3669"><a href="#generate_covers-3669"><span class="linenos">3669</span></a>        <span class="n">axis_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="generate_covers-3670"><a href="#generate_covers-3670"><span class="linenos">3670</span></a>        <span class="c1"># ... and channel axis is last</span>
</span><span id="generate_covers-3671"><a href="#generate_covers-3671"><span class="linenos">3671</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ChannelAxis</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="generate_covers-3672"><a href="#generate_covers-3672"><span class="linenos">3672</span></a>        <span class="n">axis_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis_order</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span><span id="generate_covers-3673"><a href="#generate_covers-3673"><span class="linenos">3673</span></a>        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="n">ao</span><span class="p">]</span> <span class="k">for</span> <span class="n">ao</span> <span class="ow">in</span> <span class="n">axis_order</span><span class="p">]</span>
</span><span id="generate_covers-3674"><a href="#generate_covers-3674"><span class="linenos">3674</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">axis_order</span><span class="p">)</span>
</span><span id="generate_covers-3675"><a href="#generate_covers-3675"><span class="linenos">3675</span></a>
</span><span id="generate_covers-3676"><a href="#generate_covers-3676"><span class="linenos">3676</span></a>        <span class="c1"># h, w = data.shape[:2]</span>
</span><span id="generate_covers-3677"><a href="#generate_covers-3677"><span class="linenos">3677</span></a>        <span class="c1"># if h / w  in (1.0 or 2.0):</span>
</span><span id="generate_covers-3678"><a href="#generate_covers-3678"><span class="linenos">3678</span></a>        <span class="c1">#     pass</span>
</span><span id="generate_covers-3679"><a href="#generate_covers-3679"><span class="linenos">3679</span></a>        <span class="c1"># elif h / w &lt; 2:</span>
</span><span id="generate_covers-3680"><a href="#generate_covers-3680"><span class="linenos">3680</span></a>        <span class="c1"># TODO: enforce 2:1 or 1:1 aspect ratio for generated cover images</span>
</span><span id="generate_covers-3681"><a href="#generate_covers-3681"><span class="linenos">3681</span></a>
</span><span id="generate_covers-3682"><a href="#generate_covers-3682"><span class="linenos">3682</span></a>        <span class="n">norm_along</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="generate_covers-3683"><a href="#generate_covers-3683"><span class="linenos">3683</span></a>            <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="generate_covers-3684"><a href="#generate_covers-3684"><span class="linenos">3684</span></a>        <span class="p">)</span>
</span><span id="generate_covers-3685"><a href="#generate_covers-3685"><span class="linenos">3685</span></a>        <span class="c1"># normalize the data and map to 8 bit</span>
</span><span id="generate_covers-3686"><a href="#generate_covers-3686"><span class="linenos">3686</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">norm_along</span><span class="p">)</span>
</span><span id="generate_covers-3687"><a href="#generate_covers-3687"><span class="linenos">3687</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="generate_covers-3688"><a href="#generate_covers-3688"><span class="linenos">3688</span></a>
</span><span id="generate_covers-3689"><a href="#generate_covers-3689"><span class="linenos">3689</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="generate_covers-3690"><a href="#generate_covers-3690"><span class="linenos">3690</span></a>
</span><span id="generate_covers-3691"><a href="#generate_covers-3691"><span class="linenos">3691</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_diagonal_split_image</span><span class="p">(</span><span class="n">im0</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">im1</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]):</span>
</span><span id="generate_covers-3692"><a href="#generate_covers-3692"><span class="linenos">3692</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">im1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
</span><span id="generate_covers-3693"><a href="#generate_covers-3693"><span class="linenos">3693</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">im1</span><span class="o">.</span><span class="n">shape</span>
</span><span id="generate_covers-3694"><a href="#generate_covers-3694"><span class="linenos">3694</span></a>        <span class="k">assert</span> <span class="n">im0</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="generate_covers-3695"><a href="#generate_covers-3695"><span class="linenos">3695</span></a>        <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">im0</span><span class="o">.</span><span class="n">shape</span>
</span><span id="generate_covers-3696"><a href="#generate_covers-3696"><span class="linenos">3696</span></a>        <span class="k">assert</span> <span class="n">C</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="generate_covers-3697"><a href="#generate_covers-3697"><span class="linenos">3697</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="generate_covers-3698"><a href="#generate_covers-3698"><span class="linenos">3698</span></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
</span><span id="generate_covers-3699"><a href="#generate_covers-3699"><span class="linenos">3699</span></a>            <span class="n">outc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">im0</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
</span><span id="generate_covers-3700"><a href="#generate_covers-3700"><span class="linenos">3700</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">outc</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="generate_covers-3701"><a href="#generate_covers-3701"><span class="linenos">3701</span></a>            <span class="n">outc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">im1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="generate_covers-3702"><a href="#generate_covers-3702"><span class="linenos">3702</span></a>            <span class="n">out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">outc</span>
</span><span id="generate_covers-3703"><a href="#generate_covers-3703"><span class="linenos">3703</span></a>
</span><span id="generate_covers-3704"><a href="#generate_covers-3704"><span class="linenos">3704</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="generate_covers-3705"><a href="#generate_covers-3705"><span class="linenos">3705</span></a>
</span><span id="generate_covers-3706"><a href="#generate_covers-3706"><span class="linenos">3706</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="generate_covers-3707"><a href="#generate_covers-3707"><span class="linenos">3707</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing test input tensor for cover generation.&quot;</span><span class="p">)</span>
</span><span id="generate_covers-3708"><a href="#generate_covers-3708"><span class="linenos">3708</span></a>
</span><span id="generate_covers-3709"><a href="#generate_covers-3709"><span class="linenos">3709</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">outputs</span><span class="p">:</span>
</span><span id="generate_covers-3710"><a href="#generate_covers-3710"><span class="linenos">3710</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing test output tensor for cover generation.&quot;</span><span class="p">)</span>
</span><span id="generate_covers-3711"><a href="#generate_covers-3711"><span class="linenos">3711</span></a>
</span><span id="generate_covers-3712"><a href="#generate_covers-3712"><span class="linenos">3712</span></a>    <span class="n">ipt_descr</span><span class="p">,</span> <span class="n">ipt</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="generate_covers-3713"><a href="#generate_covers-3713"><span class="linenos">3713</span></a>    <span class="n">out_descr</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="generate_covers-3714"><a href="#generate_covers-3714"><span class="linenos">3714</span></a>
</span><span id="generate_covers-3715"><a href="#generate_covers-3715"><span class="linenos">3715</span></a>    <span class="n">ipt_img</span> <span class="o">=</span> <span class="n">to_2d_image</span><span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">ipt_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3716"><a href="#generate_covers-3716"><span class="linenos">3716</span></a>    <span class="n">out_img</span> <span class="o">=</span> <span class="n">to_2d_image</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out_descr</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</span><span id="generate_covers-3717"><a href="#generate_covers-3717"><span class="linenos">3717</span></a>
</span><span id="generate_covers-3718"><a href="#generate_covers-3718"><span class="linenos">3718</span></a>    <span class="n">cover_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">mkdtemp</span><span class="p">())</span>
</span><span id="generate_covers-3719"><a href="#generate_covers-3719"><span class="linenos">3719</span></a>    <span class="k">if</span> <span class="n">ipt_img</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">out_img</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="generate_covers-3720"><a href="#generate_covers-3720"><span class="linenos">3720</span></a>        <span class="n">covers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;cover.png&quot;</span><span class="p">]</span>
</span><span id="generate_covers-3721"><a href="#generate_covers-3721"><span class="linenos">3721</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">create_diagonal_split_image</span><span class="p">(</span><span class="n">ipt_img</span><span class="p">,</span> <span class="n">out_img</span><span class="p">))</span>
</span><span id="generate_covers-3722"><a href="#generate_covers-3722"><span class="linenos">3722</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="generate_covers-3723"><a href="#generate_covers-3723"><span class="linenos">3723</span></a>        <span class="n">covers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;input.png&quot;</span><span class="p">,</span> <span class="n">cover_folder</span> <span class="o">/</span> <span class="s2">&quot;output.png&quot;</span><span class="p">]</span>
</span><span id="generate_covers-3724"><a href="#generate_covers-3724"><span class="linenos">3724</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ipt_img</span><span class="p">)</span>
</span><span id="generate_covers-3725"><a href="#generate_covers-3725"><span class="linenos">3725</span></a>        <span class="n">imwrite</span><span class="p">(</span><span class="n">covers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_img</span><span class="p">)</span>
</span><span id="generate_covers-3726"><a href="#generate_covers-3726"><span class="linenos">3726</span></a>
</span><span id="generate_covers-3727"><a href="#generate_covers-3727"><span class="linenos">3727</span></a>    <span class="k">return</span> <span class="n">covers</span>
</span></pre></div>


    

                </section>
                <section id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]]">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]]</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>, <span class="base">typing.Generic[~IO_AxisT]</span>):

        
    </div>
    <a class="headerlink" href="#TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]]"></a>
    
    

                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TensorDescrBase">TensorDescrBase</a></dt>
                                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].id" class="variable"><a href="#TensorDescrBase.id">id</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].description" class="variable"><a href="#TensorDescrBase.description">description</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].axes" class="variable"><a href="#TensorDescrBase.axes">axes</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].shape" class="variable"><a href="#TensorDescrBase.shape">shape</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].test_tensor" class="variable"><a href="#TensorDescrBase.test_tensor">test_tensor</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].sample_tensor" class="variable"><a href="#TensorDescrBase.sample_tensor">sample_tensor</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].data" class="variable"><a href="#TensorDescrBase.data">data</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].dtype" class="variable"><a href="#TensorDescrBase.dtype">dtype</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexInputAxis, TimeInputAxis, SpaceInputAxis], Discriminator]].get_axis_sizes_for_array" class="function"><a href="#TensorDescrBase.get_axis_sizes_for_array">get_axis_sizes_for_array</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]]">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]]</span><wbr>(<span class="base">bioimageio.spec._internal.node.Node</span>, <span class="base">typing.Generic[~IO_AxisT]</span>):

        
    </div>
    <a class="headerlink" href="#TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]]"></a>
    
    

                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#TensorDescrBase">TensorDescrBase</a></dt>
                                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].id" class="variable"><a href="#TensorDescrBase.id">id</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].description" class="variable"><a href="#TensorDescrBase.description">description</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].axes" class="variable"><a href="#TensorDescrBase.axes">axes</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].shape" class="variable"><a href="#TensorDescrBase.shape">shape</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].test_tensor" class="variable"><a href="#TensorDescrBase.test_tensor">test_tensor</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].sample_tensor" class="variable"><a href="#TensorDescrBase.sample_tensor">sample_tensor</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].data" class="variable"><a href="#TensorDescrBase.data">data</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].dtype" class="variable"><a href="#TensorDescrBase.dtype">dtype</a></dd>
                <dd id="TensorDescrBase[Annotated[Union[BatchAxis, ChannelAxis, IndexOutputAxis, Annotated[Union[Annotated[TimeOutputAxis, Tag], Annotated[TimeOutputAxisWithHalo, Tag]], Discriminator], Annotated[Union[Annotated[SpaceOutputAxis, Tag], Annotated[SpaceOutputAxisWithHalo, Tag]], Discriminator]], Discriminator]].get_axis_sizes_for_array" class="function"><a href="#TensorDescrBase.get_axis_sizes_for_array">get_axis_sizes_for_array</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>